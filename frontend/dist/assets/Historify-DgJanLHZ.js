import{r as n,j as e}from"./vendor-react-RhKMXzW9.js";import{u as ps,d as pa,n as ga,e as u,c as E,B as o,D as ja,h as fa,i as va,p as ba,j as Se,k as ya,t as c,m as Na}from"./index-DerOnoSe.js";import{A as wa,b as Sa,c as Ca,d as ka,e as _a,f as Da,g as Ea,h as Ta}from"./alert-dialog-C8_B9m1c.js";import{C as I,a as L,b as Ce,c as ke}from"./card-SnKlx7GJ.js";import{D as _e,b as De,c as Ee,d as Te,e as $e,f as Fe}from"./dialog-D2H2EEpQ.js";import{I as F}from"./input-Bd3sN5G5.js";import{L as p}from"./label-BDsgyazW.js";import{P as $a}from"./progress-DMzVHNwA.js";import{S as ce}from"./scroll-area-CUDuQmW6.js";import{S,a as C,b as k,c as _,d as h}from"./select-DqLsQ7yQ.js";import{T as gs,a as js,b as P,c as f,d as fs,e as x}from"./table-D5s3iCss.js";import{T as Fa,a as Aa,b as Ae,c as ze}from"./tabs-X3dH76fd.js";import{T as za}from"./textarea-DSGb8KCC.js";import{C as J}from"./checkbox-qp9iIY-9.js";import{S as Oa}from"./switch-BEDqG0sK.js";import{D as vs,az as Ia,g as Oe,c as Ma,Z as bs,L as oe,k as Ra,l as La,ag as Ie,N as Pa,m as Ja,n as Va,aA as ys,aB as Me,ay as Re,aC as Ns,aD as Ba,aE as Ua,af as ws,i as Wa,X as Ss,R as Cs,v as Xa,a0 as Ha,aF as Ya,aG as ks,aH as qa}from"./vendor-icons-64jt6PPv.js";import{a as Qa,L as ie}from"./vendor-router-D7kKkCmL.js";import"./vendor-radix-Cue1hf3Z.js";async function v(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}const Za=[{label:"1M",months:1},{label:"3M",months:3},{label:"6M",months:6},{label:"1Y",months:12},{label:"2Y",months:24},{label:"5Y",months:60}];function Le(b){const M=new Date;return M.setMonth(M.getMonth()-b),M.toISOString().split("T")[0]}function jt(){const{appMode:b,toggleAppMode:M,mode:Pe,toggleMode:_s,isTogglingMode:Je}=ps(),{user:de,logout:Ve}=pa(),he=Qa(),[m,Ds]=n.useState([]),[me,Es]=n.useState([]),[Ga,Ts]=n.useState(null),[xe,$s]=n.useState(null),[Y,Fs]=n.useState(["NSE","BSE","NFO","BFO","MCX","CDS","BCD","NSE_INDEX","BSE_INDEX"]),[ue,As]=n.useState({database_size_mb:0,total_records:0,total_symbols:0,watchlist_count:0}),[zs,Be]=n.useState("watchlist"),[A,V]=n.useState(""),[B,q]=n.useState("NSE"),[Q,pe]=n.useState([]),[Ue,U]=n.useState(!1),Z=n.useRef(null),[We,Os]=n.useState("D"),[ge,Xe]=n.useState(()=>Le(1)),[He,Ye]=n.useState(()=>new Date().toISOString().split("T")[0]),[qe,Is]=n.useState(!1),[G,K]=n.useState([]),[Ms,Rs]=n.useState(null),[Ls,je]=n.useState({}),[Qe,Ze]=n.useState(!1),[Ps,W]=n.useState(!1),[Ge,Ke]=n.useState(""),[es,ss]=n.useState(!1),[Js,ee]=n.useState(!1),[fe,as]=n.useState(""),[ts,Vs]=n.useState("NSE"),[ls,Bs]=n.useState("D"),[se,rs]=n.useState(null),[ns,cs]=n.useState(!1),ve=n.useRef(null),[Us,be]=n.useState(!1),[ae,os]=n.useState(null),[Ws,te]=n.useState(!1),[ye,Xs]=n.useState("csv"),[T,Hs]=n.useState("all"),[y,le]=n.useState(new Set(["D"])),[$,z]=n.useState(new Set),[is,ds]=n.useState(!1),[Ne,Ys]=n.useState("25"),[X,qs]=n.useState("m"),[g,R]=n.useState(new Set),[j,we]=n.useState({exchange:"",interval:"",search:""}),{socket:N}=ga(),w=n.useMemo(()=>{const s=new Map;for(const a of me){const t=`${a.symbol}:${a.exchange}`;s.has(t)||s.set(t,{symbol:a.symbol,exchange:a.exchange,intervals:[],total_records:0,earliest_date:a.first_date,latest_date:a.last_date});const l=s.get(t);l.intervals.push({interval:a.interval,record_count:a.record_count,first_date:a.first_date,last_date:a.last_date}),l.total_records+=a.record_count,a.first_date&&(!l.earliest_date||a.first_date<l.earliest_date)&&(l.earliest_date=a.first_date),a.last_date&&(!l.latest_date||a.last_date>l.latest_date)&&(l.latest_date=a.last_date)}for(const a of s.values())a.intervals.sort((t,l)=>{const r=["1m","5m","15m","30m","1h","D","W","M"];return r.indexOf(t.interval)-r.indexOf(l.interval)});return Array.from(s.values()).sort((a,t)=>a.symbol.localeCompare(t.symbol))},[me]),H=n.useMemo(()=>w.filter(s=>!(j.exchange&&j.exchange!=="__all__"&&s.exchange!==j.exchange||j.interval&&j.interval!=="__all__"&&!s.intervals.some(a=>a.interval===j.interval)||j.search&&!s.symbol.toLowerCase().includes(j.search.toLowerCase()))),[w,j]);n.useEffect(()=>{re(),ne(),Qs(),Zs(),O(),Gs(),D()},[]),n.useEffect(()=>{if(!N)return;const s=r=>{je(d=>({...d,[r.job_id]:r})),K(d=>d.map(i=>i.id===r.job_id?{...i,completed_symbols:r.current,status:"running"}:i))},a=r=>{je(d=>{const i={...d};return delete i[r.job_id],i}),D(),ne(),O(),c.success(`Job completed: ${r.completed} success, ${r.failed} failed`)},t=r=>{K(d=>d.map(i=>i.id===r.job_id?{...i,status:"paused"}:i))},l=r=>{K(d=>d.map(i=>i.id===r.job_id?{...i,status:"cancelled"}:i)),je(d=>{const i={...d};return delete i[r.job_id],i}),c.info("Job cancelled")};return N.on("historify_progress",s),N.on("historify_job_complete",a),N.on("historify_job_paused",t),N.on("historify_job_cancelled",l),()=>{N.off("historify_progress",s),N.off("historify_job_complete",a),N.off("historify_job_paused",t),N.off("historify_job_cancelled",l)}},[N]),n.useEffect(()=>{const s=a=>{Z.current&&!Z.current.contains(a.target)&&U(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),n.useEffect(()=>{const s=setTimeout(()=>{A.length>=2?Ks(A):(pe([]),U(!1))},300);return()=>clearTimeout(s)},[A]);const re=async()=>{try{const a=await(await fetch("/historify/api/watchlist",{credentials:"include"})).json();a.status==="success"&&Ds(a.data||[])}catch(s){console.error("Error loading watchlist:",s)}},ne=async()=>{try{const a=await(await fetch("/historify/api/catalog",{credentials:"include"})).json();a.status==="success"&&Es(a.data||[])}catch(s){console.error("Error loading catalog:",s)}},Qs=async()=>{try{const a=await(await fetch("/historify/api/intervals",{credentials:"include"})).json();a.status==="success"&&Ts(a.data)}catch(s){console.error("Error loading intervals:",s)}},Zs=async()=>{try{const a=await(await fetch("/historify/api/historify-intervals",{credentials:"include"})).json();a.status==="success"&&$s({storage_intervals:a.storage_intervals,computed_intervals:a.computed_intervals,all_intervals:a.all_intervals})}catch(s){console.error("Error loading historify intervals:",s)}},O=async()=>{try{const a=await(await fetch("/historify/api/stats",{credentials:"include"})).json();a.status==="success"&&As(a.data)}catch(s){console.error("Error loading stats:",s)}},Gs=async()=>{try{const a=await(await fetch("/historify/api/exchanges",{credentials:"include"})).json();a.status==="success"&&a.data?.length>0&&Fs(a.data)}catch(s){console.error("Error loading exchanges:",s)}},D=async()=>{Ze(!0);try{const a=await(await fetch("/historify/api/jobs?limit=50",{credentials:"include"})).json();a.status==="success"&&K(a.data||[])}catch(s){console.error("Error loading jobs:",s)}finally{Ze(!1)}},Ks=async s=>{if(!(s.length<2))try{const a=new URLSearchParams({q:s});B&&a.append("exchange",B);const l=await(await fetch(`/search/api/search?${a}`,{credentials:"include"})).json();pe((l.results||[]).slice(0,10)),U(!0)}catch(a){console.error("Error searching symbols:",a),pe([])}},hs=async()=>{if(!A.trim()){c.warning("Please enter a symbol");return}try{const s=await v(),t=await(await fetch("/historify/api/watchlist",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify({symbol:A.trim().toUpperCase(),exchange:B})})).json();t.status==="success"?(c.success(t.message),V(""),re(),O()):c.error(t.message||"Failed to add symbol")}catch(s){console.error("Error adding to watchlist:",s),c.error("Failed to add symbol")}},ea=async(s,a)=>{try{const t=await v(),r=await(await fetch("/historify/api/watchlist",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({symbol:s,exchange:a})})).json();r.status==="success"?(c.success(r.message),re(),O()):c.error(r.message||"Failed to remove symbol")}catch(t){console.error("Error removing from watchlist:",t),c.error("Failed to remove symbol")}},sa=async()=>{const a=Ge.trim().split(`
`).map(t=>{const[l,r]=t.split(",").map(d=>d.trim().toUpperCase());return{symbol:l,exchange:r||"NSE"}}).filter(t=>t.symbol);if(a.length===0){c.warning("No valid symbols found");return}ss(!0);try{const t=await v(),r=await(await fetch("/historify/api/watchlist/bulk",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({symbols:a})})).json();r.status==="success"?(c.success(`Added ${r.added} symbols`),W(!1),Ke(""),re(),O()):c.error(r.message||"Failed to bulk add symbols")}catch(t){console.error("Error bulk adding:",t),c.error("Failed to bulk add symbols")}finally{ss(!1)}},ms=async(s,a="custom")=>{if(s.length===0){c.warning("No symbols selected");return}try{const t=await v(),r=await(await fetch("/historify/api/jobs",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({job_type:a,symbols:s,interval:We,start_date:ge,end_date:He,incremental:qe})})).json();r.status==="success"?(c.success(`Job started: ${r.total_symbols} symbols`),D(),Be("jobs")):c.error(r.message||"Failed to create job")}catch(t){console.error("Error creating job:",t),c.error("Failed to create job")}},aa=async()=>{if(m.length===0){c.warning("Watchlist is empty");return}const s=m.map(a=>({symbol:a.symbol,exchange:a.exchange}));await ms(s,"watchlist")},ta=async s=>{try{const a=await v(),l=await(await fetch(`/historify/api/jobs/${s}/pause`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(c.success("Job paused"),D()):c.error(l.message||"Failed to pause job")}catch(a){console.error("Error pausing job:",a),c.error("Failed to pause job")}},la=async s=>{try{const a=await v(),l=await(await fetch(`/historify/api/jobs/${s}/resume`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(c.success("Job resumed"),D()):c.error(l.message||"Failed to resume job")}catch(a){console.error("Error resuming job:",a),c.error("Failed to resume job")}},xs=async s=>{try{const a=await v(),l=await(await fetch(`/historify/api/jobs/${s}/cancel`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(c.success("Job cancellation requested"),D()):c.error(l.message||"Failed to cancel job")}catch(a){console.error("Error cancelling job:",a),c.error("Failed to cancel job")}},ra=async s=>{try{const a=await v(),l=await(await fetch(`/historify/api/jobs/${s}/retry`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(c.success(`Retrying ${l.retry_count} failed items`),D()):c.error(l.message||"Failed to retry job")}catch(a){console.error("Error retrying job:",a),c.error("Failed to retry job")}},na=async s=>{try{const a=await v(),l=await(await fetch(`/historify/api/jobs/${s}`,{method:"DELETE",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(c.success("Job deleted"),D(),Ms?.id===s&&Rs(null)):c.error(l.message||"Failed to delete job")}catch(a){console.error("Error deleting job:",a),c.error("Failed to delete job")}},ca=async()=>{if(ae)try{const s=await v(),t=await(await fetch("/historify/api/delete",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify(ae)})).json();t.status==="success"?(c.success(t.message),ne(),O()):c.error(t.message||"Failed to delete data")}catch(s){console.error("Error deleting data:",s),c.error("Failed to delete data")}finally{be(!1),os(null)}},oa=s=>{const a=s.target.files?.[0];if(a){const t=a.name.toLowerCase();if(!t.endsWith(".csv")&&!t.endsWith(".parquet")){c.error("Please select a CSV or Parquet file");return}rs(a)}},ia=async()=>{if(!se){c.warning("Please select a CSV or Parquet file");return}if(!fe.trim()){c.warning("Please enter a symbol");return}cs(!0);try{const s=await v(),a=new FormData;a.append("file",se),a.append("symbol",fe.trim().toUpperCase()),a.append("exchange",ts),a.append("interval",ls);const l=await(await fetch("/historify/api/upload",{method:"POST",headers:{"X-CSRFToken":s},credentials:"include",body:a})).json();l.status==="success"?(c.success(`${l.message}`),ee(!1),rs(null),as(""),ve.current&&(ve.current.value=""),ne(),O()):c.error(l.message||"Failed to upload data")}catch(s){console.error("Error uploading CSV:",s),c.error("Failed to upload CSV")}finally{cs(!1)}},da=async()=>{ds(!0);try{const s=await v(),a=T==="selected"?Array.from($).map(d=>{const[i,ua]=d.split(":");return{symbol:i,exchange:ua}}):null,t=Array.from(y),r=await(await fetch("/historify/api/export/bulk",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify({format:ye==="csv"&&t.length>1?"zip":ye,symbols:a,intervals:t,compression:"zstd"})})).json();r.status==="success"?(c.success(`${r.message}`),window.location.href="/historify/api/export/bulk/download",te(!1)):c.error(r.message||"Failed to export data")}catch(s){console.error("Error exporting data:",s),c.error("Failed to export data")}finally{ds(!1)}},ha=(s,a)=>{const t=`${s}:${a}`;z(l=>{const r=new Set(l);return r.has(t)?r.delete(t):r.add(t),r})},ma=s=>{switch(s){case"running":return"bg-blue-500";case"paused":return"bg-yellow-500";case"completed":return"bg-green-500";case"completed_with_errors":return"bg-orange-500";case"failed":return"bg-red-500";case"cancelled":return"bg-gray-500";default:return"bg-gray-400"}},us=async()=>{const s=await M();if(s.success){const a=ps.getState().appMode;c.success(`Switched to ${a==="live"?"Live":"Analyze"} mode`)}else c.error(s.message||"Failed to toggle mode")},xa=async()=>{try{await Na.logout(),Ve(),he("/login"),c.success("Logged out successfully")}catch{Ve(),he("/login")}};return e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[e.jsx("div",{className:"border-b border-border bg-card/50",children:e.jsxs("div",{className:"px-4 py-3 flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(vs,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Historify"}),e.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:"Historical Data Management"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Ia,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium",children:[ue.database_size_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:ue.total_records.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Ma,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:ue.total_symbols})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[de?.broker&&e.jsx(u,{variant:"outline",className:"text-xs font-medium",children:de.broker.toUpperCase()}),e.jsxs(u,{variant:b==="live"?"default":"secondary",className:E("text-xs cursor-pointer",b==="analyzer"&&"bg-purple-500 hover:bg-purple-600 text-white"),onClick:us,children:[b==="live"?e.jsx(bs,{className:"h-3 w-3 mr-1"}):e.jsx(Oe,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:b==="live"?"Live Mode":"Analyze Mode"}),e.jsx("span",{className:"sm:hidden",children:b==="live"?"Live":"Analyze"})]}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:us,disabled:Je,title:`Switch to ${b==="live"?"Analyze":"Live"} mode`,children:Je?e.jsx(oe,{className:"h-4 w-4 animate-spin"}):b==="live"?e.jsx(bs,{className:"h-4 w-4"}):e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:_s,disabled:b!=="live",title:Pe==="light"?"Switch to dark mode":"Switch to light mode",children:Pe==="light"?e.jsx(Ra,{className:"h-4 w-4"}):e.jsx(La,{className:"h-4 w-4"})}),e.jsx(ie,{to:m.length>0?`/historify/charts/${m[0].symbol}?exchange=${m[0].exchange}&interval=D`:w.length>0?`/historify/charts/${w[0].symbol}?exchange=${w[0].exchange}&interval=D`:"/historify/charts",children:e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(Ie,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Charts"})]})}),e.jsx(ie,{to:"/dashboard",children:e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(Pa,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})}),e.jsxs(ja,{children:[e.jsx(fa,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full bg-primary text-primary-foreground",children:e.jsx("span",{className:"text-sm font-medium",children:de?.username?.[0]?.toUpperCase()||"O"})})}),e.jsxs(va,{align:"end",className:"w-56",children:[ba.map(s=>e.jsxs(Se,{onSelect:()=>he(s.href),className:"cursor-pointer",children:[e.jsx(s.icon,{className:"h-4 w-4 mr-2"}),s.label]},s.href)),e.jsx(Se,{asChild:!0,children:e.jsxs("a",{href:"https://docs.openalgo.in",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(Ja,{className:"h-4 w-4"}),"Docs"]})}),e.jsx(ya,{}),e.jsxs(Se,{onClick:xa,className:"text-destructive focus:text-destructive",children:[e.jsx(Va,{className:"h-4 w-4 mr-2"}),"Logout"]})]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(Fa,{value:zs,onValueChange:Be,className:"h-full flex flex-col",children:[e.jsx("div",{className:"border-b border-border px-4 overflow-x-auto",children:e.jsxs(Aa,{className:"h-10 bg-transparent w-max min-w-full sm:w-auto",children:[e.jsxs(Ae,{value:"watchlist",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Watchlist"}),e.jsx("span",{className:"sm:hidden",children:"Watch"}),m.length>0&&e.jsx(u,{variant:"secondary",className:"ml-1 h-5 min-w-5 text-xs",children:m.length})]}),e.jsxs(Ae,{value:"catalog",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(vs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Data Catalog"}),e.jsx("span",{className:"sm:hidden",children:"Catalog"})]}),e.jsxs(Ae,{value:"jobs",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(Me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download Jobs"}),e.jsx("span",{className:"sm:hidden",children:"Jobs"}),G.filter(s=>s.status==="running"||s.status==="paused").length>0&&e.jsx(u,{variant:"default",className:"ml-1 h-5 min-w-5 text-xs bg-blue-500",children:G.filter(s=>s.status==="running"||s.status==="paused").length})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx(ze,{value:"catalog",className:"h-full m-0 p-4 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(I,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",ref:Z,children:[e.jsx(F,{placeholder:"Quick add symbol to watchlist...",value:A,onChange:s=>V(s.target.value.toUpperCase()),className:"h-9"}),Ue&&Q.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-50 max-h-60 overflow-auto",children:Q.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-muted cursor-pointer",onClick:()=>{V(s.symbol),q(s.exchange),U(!1)},children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.name," - ",s.exchange]})]},`${s.symbol}-${s.exchange}`))})]}),e.jsxs(S,{value:B,onValueChange:q,children:[e.jsx(C,{className:"w-full sm:w-28 h-9",children:e.jsx(k,{})}),e.jsx(_,{children:Y.map(s=>e.jsx(h,{value:s,children:s},s))})]}),e.jsxs(o,{onClick:hs,className:"h-9",size:"sm",children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Add to Watchlist"]}),e.jsxs(o,{variant:"outline",onClick:()=>W(!0),className:"h-9",size:"sm",children:[e.jsx(Ns,{className:"h-4 w-4 mr-1"}),"Bulk"]})]})})}),e.jsx(I,{children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{placeholder:"Filter catalog symbols...",value:j.search,onChange:s=>we(a=>({...a,search:s.target.value})),className:"h-9"})}),e.jsxs(S,{value:j.exchange||"__all__",onValueChange:s=>we(a=>({...a,exchange:s})),children:[e.jsx(C,{className:"w-full sm:w-32 h-9",children:e.jsx(k,{placeholder:"Exchange"})}),e.jsxs(_,{children:[e.jsx(h,{value:"__all__",children:"All"}),Y.map(s=>e.jsx(h,{value:s,children:s},s))]})]}),e.jsxs(S,{value:j.interval||"__all__",onValueChange:s=>we(a=>({...a,interval:s})),children:[e.jsx(C,{className:"w-full sm:w-32 h-9",title:"Filter symbols that have this interval",children:e.jsx(k,{placeholder:"Has Interval"})}),e.jsxs(_,{children:[e.jsx(h,{value:"__all__",children:"All Intervals"}),(xe?.storage_intervals||["1m","D"]).map(s=>e.jsxs(h,{value:s,children:["Has ",s]},s))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>te(!0),disabled:me.length===0,className:"h-9",children:[e.jsx(Ba,{className:"h-4 w-4 mr-1"}),"Export"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>ee(!0),className:"h-9",children:[e.jsx(Ua,{className:"h-4 w-4 mr-1"}),"Import"]})]})]})})}),e.jsx(I,{children:e.jsx(ce,{className:"h-[calc(100vh-380px)]",children:e.jsxs(gs,{children:[e.jsx(js,{children:e.jsxs(P,{children:[e.jsx(f,{className:"w-10",children:e.jsx(J,{checked:$.size===H.length&&H.length>0,onCheckedChange:s=>{z(s?new Set(H.map(a=>`${a.symbol}:${a.exchange}`)):new Set)}})}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{className:"hidden sm:table-cell",children:"Exchange"}),e.jsx(f,{children:"Available Intervals"}),e.jsx(f,{className:"text-right hidden sm:table-cell",children:"Total Records"}),e.jsx(f,{className:"hidden md:table-cell",children:"Date Range"}),e.jsx(f,{className:"w-20"})]})}),e.jsx(fs,{children:H.length===0?e.jsx(P,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No data available. Add symbols to watchlist and download data."})}):H.map(s=>e.jsxs(P,{children:[e.jsx(x,{children:e.jsx(J,{checked:$.has(`${s.symbol}:${s.exchange}`),onCheckedChange:()=>ha(s.symbol,s.exchange)})}),e.jsx(x,{className:"font-medium",children:e.jsxs("div",{children:[s.symbol,e.jsxs("span",{className:"sm:hidden text-xs text-muted-foreground ml-1",children:["(",s.exchange,")"]})]})}),e.jsx(x,{className:"hidden sm:table-cell",children:e.jsx(u,{variant:"outline",children:s.exchange})}),e.jsx(x,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.intervals.map(a=>e.jsxs(u,{variant:a.interval==="1m"?"default":a.interval==="D"?"secondary":"outline",className:"text-xs cursor-pointer hover:bg-primary/80",title:`${a.record_count.toLocaleString()} records (${a.first_date} - ${a.last_date})`,onClick:()=>{window.location.href=`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=${a.interval}`},children:[a.interval,e.jsx("span",{className:"ml-1 opacity-70",children:a.record_count>1e3?`${Math.round(a.record_count/1e3)}k`:a.record_count})]},a.interval))})}),e.jsx(x,{className:"text-right hidden sm:table-cell",children:s.total_records.toLocaleString()}),e.jsxs(x,{className:"hidden md:table-cell text-muted-foreground text-sm",children:[s.earliest_date," - ",s.latest_date]}),e.jsx(x,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,children:e.jsx(ie,{to:`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=${s.intervals[0]?.interval||"D"}`,children:e.jsx(Ie,{className:"h-3.5 w-3.5"})})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>{os({symbol:s.symbol,exchange:s.exchange}),be(!0)},children:e.jsx(ws,{className:"h-3.5 w-3.5"})})]})})]},`${s.symbol}-${s.exchange}`))})]})})})]})}),e.jsxs(ze,{value:"watchlist",className:"h-full m-0 p-4 overflow-auto",children:[e.jsx(I,{className:"mb-4",children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",ref:Z,children:[e.jsx(F,{placeholder:"Search symbol to add...",value:A,onChange:s=>V(s.target.value.toUpperCase()),className:"h-9"}),Ue&&Q.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-50 max-h-60 overflow-auto",children:Q.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-muted cursor-pointer",onClick:()=>{V(s.symbol),q(s.exchange),U(!1)},children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.name," - ",s.exchange]})]},`${s.symbol}-${s.exchange}`))})]}),e.jsxs(S,{value:B,onValueChange:q,children:[e.jsx(C,{className:"w-full sm:w-28 h-9",children:e.jsx(k,{})}),e.jsx(_,{children:Y.map(s=>e.jsx(h,{value:s,children:s},s))})]}),e.jsxs(o,{onClick:hs,className:"h-9",children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs(o,{variant:"outline",onClick:()=>W(!0),className:"h-9",children:[e.jsx(Ns,{className:"h-4 w-4 mr-1"}),"Bulk"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(100vh-240px)]",children:[e.jsxs(I,{className:"flex flex-col",children:[e.jsx(Ce,{className:"pb-3",children:e.jsxs(ke,{className:"text-base flex items-center gap-2",children:[e.jsx(Wa,{className:"h-4 w-4"}),"Download Settings"]})}),e.jsx(L,{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-sm text-muted-foreground mb-2 block",children:"Quick Date Range"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Za.map(s=>{const a=ge===Le(s.months);return e.jsx(o,{variant:a?"default":"outline",size:"sm",className:E("h-8 min-w-[3rem]",a&&"ring-2 ring-primary ring-offset-2 ring-offset-background"),onClick:()=>{Xe(Le(s.months)),Ye(new Date().toISOString().split("T")[0])},children:s.label},s.label)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-sm text-muted-foreground",children:"From"}),e.jsx(F,{type:"date",value:ge,onChange:s=>Xe(s.target.value),className:"h-9 mt-1"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-sm text-muted-foreground",children:"To"}),e.jsx(F,{type:"date",value:He,onChange:s=>Ye(s.target.value),className:"h-9 mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-sm text-muted-foreground",children:"Interval"}),e.jsxs(S,{value:We,onValueChange:Os,children:[e.jsx(C,{className:"h-9 mt-1",children:e.jsx(k,{})}),e.jsx(_,{children:(xe?.storage_intervals||["1m","D"]).map(s=>e.jsx(h,{value:s,children:s==="1m"?"1 Minute":s==="D"?"Daily":s},s))})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Other timeframes (5m, 15m, 30m, 1h) computed from 1m data"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(p,{className:"font-medium",children:"Incremental Download"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Only download new data after last timestamp"})]}),e.jsx(Oa,{checked:qe,onCheckedChange:Is})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(o,{className:"w-full h-10",onClick:()=>{if(g.size===0)aa();else{const s=m.filter(a=>g.has(`${a.symbol}:${a.exchange}`)).map(a=>({symbol:a.symbol,exchange:a.exchange}));ms(s,"watchlist")}},disabled:m.length===0,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),g.size>0?`Download Selected (${g.size})`:`Download All (${m.length})`]}),g.size>0&&e.jsx(o,{variant:"outline",className:"w-full h-9",onClick:()=>R(new Set),children:"Clear Selection"})]})]})})]}),e.jsxs(I,{className:"flex flex-col",children:[e.jsx(Ce,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ke,{className:"text-base",children:["Symbols (",m.length,")",g.size>0&&e.jsxs(u,{className:"ml-2",children:[g.size," selected"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{g.size===m.length?R(new Set):R(new Set(m.map(s=>`${s.symbol}:${s.exchange}`)))},children:g.size===m.length?"Deselect All":"Select All"})})]})}),e.jsx(L,{className:"flex-1 p-0 overflow-hidden",children:e.jsx(ce,{className:"h-full",children:e.jsxs(gs,{children:[e.jsx(js,{children:e.jsxs(P,{children:[e.jsx(f,{className:"w-10",children:e.jsx(J,{checked:g.size===m.length&&m.length>0,onCheckedChange:s=>{R(s?new Set(m.map(a=>`${a.symbol}:${a.exchange}`)):new Set)}})}),e.jsx(f,{children:"Symbol"}),e.jsx(f,{className:"hidden sm:table-cell",children:"Exchange"}),e.jsx(f,{className:"hidden md:table-cell",children:"Added"}),e.jsx(f,{className:"w-20 text-right",children:"Actions"})]})}),e.jsx(fs,{children:m.length===0?e.jsx(P,{children:e.jsxs(x,{colSpan:5,className:"text-center py-12 text-muted-foreground",children:[e.jsx(ys,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No symbols in watchlist"}),e.jsx("p",{className:"text-sm mt-1",children:"Add symbols using the search above"})]})}):m.map(s=>e.jsxs(P,{className:E(g.has(`${s.symbol}:${s.exchange}`)&&"bg-muted/50"),children:[e.jsx(x,{children:e.jsx(J,{checked:g.has(`${s.symbol}:${s.exchange}`),onCheckedChange:()=>{R(a=>{const t=new Set(a),l=`${s.symbol}:${s.exchange}`;return t.has(l)?t.delete(l):t.add(l),t})}})}),e.jsxs(x,{className:"font-medium",children:[s.symbol,e.jsxs("span",{className:"sm:hidden text-xs text-muted-foreground ml-1",children:["(",s.exchange,")"]})]}),e.jsx(x,{className:"hidden sm:table-cell",children:e.jsx(u,{variant:"outline",children:s.exchange})}),e.jsx(x,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.added_at).toLocaleDateString()}),e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"View chart",children:e.jsx(ie,{to:`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=D`,children:e.jsx(Ie,{className:"h-4 w-4"})})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>ea(s.symbol,s.exchange),title:"Remove from watchlist",children:e.jsx(Ss,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})]})]}),e.jsx(ze,{value:"jobs",className:"h-full m-0 p-4 overflow-auto",children:e.jsx("div",{className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(Ce,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ke,{className:"text-base",children:"Download Jobs"}),e.jsxs(o,{variant:"outline",size:"sm",onClick:D,disabled:Qe,children:[e.jsx(Cs,{className:E("h-4 w-4 mr-1",Qe&&"animate-spin")}),"Refresh"]})]})}),e.jsx(L,{className:"p-0",children:e.jsx(ce,{className:"h-[calc(100vh-280px)]",children:G.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No download jobs yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start a download from the Watchlist tab"})]}):e.jsx("div",{className:"divide-y divide-border",children:G.map(s=>{const a=Ls[s.id],t=a?.percent||(s.total_symbols>0?Math.round(s.completed_symbols/s.total_symbols*100):0);return e.jsx("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:E("w-2 h-2 rounded-full",ma(s.status))}),e.jsxs("span",{className:"font-medium truncate",children:["Job ",s.id]}),e.jsx(u,{variant:"outline",className:"text-xs",children:s.job_type}),e.jsx(u,{variant:s.status==="running"?"default":s.status==="paused"?"secondary":"outline",className:"text-xs",children:s.status})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.interval," | ",s.start_date," to ",s.end_date]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Xa,{className:"h-3.5 w-3.5 text-green-500"}),s.completed_symbols]}),s.failed_symbols>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[e.jsx(Ha,{className:"h-3.5 w-3.5"}),s.failed_symbols]}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",s.total_symbols," total"]})]}),(s.status==="running"||s.status==="paused")&&e.jsxs("div",{className:"mt-2",children:[e.jsx($a,{value:t,className:"h-1.5"}),a&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Downloading: ",a.symbol," (",t,"%)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>ta(s.id),children:e.jsx(Ya,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>xs(s.id),children:e.jsx(ks,{className:"h-4 w-4"})})]}),s.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>la(s.id),children:e.jsx(qa,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>xs(s.id),children:e.jsx(ks,{className:"h-4 w-4"})})]}),(s.status==="completed_with_errors"||s.status==="failed")&&s.failed_symbols>0&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>ra(s.id),children:[e.jsx(Cs,{className:"h-4 w-4 mr-1"}),"Retry"]}),s.status!=="running"&&s.status!=="paused"&&e.jsx(o,{variant:"ghost",size:"sm",className:"text-destructive",onClick:()=>na(s.id),children:e.jsx(ws,{className:"h-4 w-4"})})]})]})},s.id)})})})})]})})})]})]})}),e.jsx(_e,{open:Ps,onOpenChange:W,children:e.jsxs(De,{className:"sm:max-w-md",children:[e.jsxs(Ee,{children:[e.jsx(Te,{children:"Bulk Add Symbols"}),e.jsx($e,{children:"Add multiple symbols at once. One per line: SYMBOL,EXCHANGE"})]}),e.jsx(za,{placeholder:`RELIANCE,NSE
INFY,NSE
NIFTY24DEC25000CE,NFO`,value:Ge,onChange:s=>Ke(s.target.value),rows:8}),e.jsxs(Fe,{children:[e.jsx(o,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsxs(o,{onClick:sa,disabled:es,children:[es&&e.jsx(oe,{className:"h-4 w-4 animate-spin mr-1"}),"Add Symbols"]})]})]})}),e.jsx(_e,{open:Js,onOpenChange:ee,children:e.jsxs(De,{className:"sm:max-w-md",children:[e.jsxs(Ee,{children:[e.jsx(Te,{children:"Import Data"}),e.jsx($e,{children:"Upload a CSV or Parquet file with OHLCV data"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Symbol"}),e.jsx(F,{value:fe,onChange:s=>as(s.target.value.toUpperCase()),placeholder:"RELIANCE",className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Exchange"}),e.jsxs(S,{value:ts,onValueChange:Vs,children:[e.jsx(C,{className:"mt-1",children:e.jsx(k,{})}),e.jsx(_,{children:Y.map(s=>e.jsx(h,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Interval"}),e.jsxs(S,{value:ls,onValueChange:Bs,children:[e.jsx(C,{className:"mt-1",children:e.jsx(k,{})}),e.jsx(_,{children:(xe?.storage_intervals||["1m","D"]).map(s=>e.jsx(h,{value:s,children:s==="1m"?"1 Minute":s==="D"?"Daily":s},s))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Only 1min and Daily data can be stored"})]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Data File"}),e.jsx(F,{ref:ve,type:"file",accept:".csv,.parquet",onChange:oa,className:"mt-1"}),se&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Selected: ",se.name]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Download sample: "," ",e.jsx("a",{href:"/historify/api/sample/csv",className:"text-primary hover:underline",children:"CSV"})," | ",e.jsx("a",{href:"/historify/api/sample/parquet",className:"text-primary hover:underline",children:"Parquet"})]})]})]}),e.jsxs(Fe,{children:[e.jsx(o,{variant:"outline",onClick:()=>ee(!1),children:"Cancel"}),e.jsxs(o,{onClick:ia,disabled:ns,children:[ns&&e.jsx(oe,{className:"h-4 w-4 animate-spin mr-1"}),"Upload"]})]})]})}),e.jsx(_e,{open:Ws,onOpenChange:te,children:e.jsxs(De,{className:"sm:max-w-xl",children:[e.jsxs(Ee,{children:[e.jsx(Te,{children:"Export Data"}),e.jsx($e,{children:"Export historical data with multiple timeframes"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Export Format"}),e.jsxs(S,{value:ye,onValueChange:s=>Xs(s),children:[e.jsx(C,{className:"mt-1",children:e.jsx(k,{})}),e.jsxs(_,{children:[e.jsx(h,{value:"zip",children:"ZIP Archive (Recommended)"}),e.jsx(h,{value:"csv",children:"CSV (Single file)"}),e.jsx(h,{value:"parquet",children:"Parquet (ZSTD)"})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{children:"Symbols to Export"}),e.jsxs(S,{value:T,onValueChange:s=>Hs(s),children:[e.jsx(C,{className:"mt-1",children:e.jsx(k,{})}),e.jsxs(_,{children:[e.jsxs(h,{value:"all",children:["All (",w.length," symbols)"]}),e.jsxs(h,{value:"selected",children:["Selected (",$.size,")"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{className:"mb-2 block",children:"Select Timeframes to Export"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Intraday computed from 1m data. W/M/Q/Y computed from Daily data."}),e.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-10 gap-2",children:["1m","5m","15m","30m","1h","D","W","M","Q","Y"].map(s=>{const a=["5m","15m","30m","1h"].includes(s),t=["W","M","Q","Y"].includes(s),l=a||t,r=y.has(s);return e.jsxs("div",{className:E("flex flex-col items-center p-2 rounded-lg border cursor-pointer transition-colors",r?"bg-primary text-primary-foreground border-primary":"bg-muted/50 hover:bg-muted"),onClick:()=>{le(d=>{const i=new Set(d);return i.has(s)?i.delete(s):i.add(s),i})},children:[e.jsx(J,{checked:r,className:E("mb-1",r&&"border-primary-foreground"),onClick:d=>d.stopPropagation(),onCheckedChange:()=>{le(d=>{const i=new Set(d);return i.has(s)?i.delete(s):i.add(s),i})}}),e.jsx("span",{className:"font-medium text-sm",children:s}),e.jsx("span",{className:E("text-[10px]",r?"opacity-80":"text-muted-foreground"),children:l?"Computed":"Stored"})]},s)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Custom:"}),e.jsx(F,{type:"number",min:"1",max:"999",value:Ne,onChange:s=>Ys(s.target.value),className:"h-8 w-14 text-center",placeholder:"1"}),e.jsxs(S,{value:X,onValueChange:s=>qs(s),children:[e.jsx(C,{className:"w-20 h-8",children:e.jsx(k,{})}),e.jsxs(_,{children:[e.jsx(h,{value:"m",children:"min"}),e.jsx(h,{value:"h",children:"hr"}),e.jsx(h,{value:"W",children:"Week"}),e.jsx(h,{value:"M",children:"Month"}),e.jsx(h,{value:"Q",children:"Qtr"}),e.jsx(h,{value:"Y",children:"Year"})]})]}),e.jsxs(o,{variant:"outline",size:"sm",className:"h-8",onClick:()=>{const s=parseInt(Ne)||1;let a;["W","M","Q","Y"].includes(X)?a=s===1?X:`${s}${X}`:a=`${Ne}${X}`,s>0&&le(t=>new Set([...t,a]))},children:[e.jsx(Re,{className:"h-4 w-4 mr-1"}),"Add"]})]}),Array.from(y).filter(s=>!["1m","5m","15m","30m","1h","D","W","M","Q","Y"].includes(s)).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Array.from(y).filter(s=>!["1m","5m","15m","30m","1h","D","W","M","Q","Y"].includes(s)).map(s=>e.jsxs(u,{variant:"secondary",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{le(a=>{const t=new Set(a);return t.delete(s),t})},children:[s," ",e.jsx(Ss,{className:"h-3 w-3 ml-1"})]},s))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(p,{className:"text-sm",children:[T==="selected"?"Selected Symbols":"All Symbols"," (",T==="selected"?$.size:w.length,")"]}),T==="selected"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 text-xs",onClick:()=>{const s=w.map(a=>`${a.symbol}:${a.exchange}`);z(new Set(s))},children:"Select All"}),e.jsx(o,{variant:"ghost",size:"sm",className:"h-6 text-xs",onClick:()=>z(new Set),children:"Clear"})]})]}),e.jsx(ce,{className:"h-40 border rounded-md p-2",children:e.jsx("div",{className:"space-y-1",children:w.map(s=>{const a=`${s.symbol}:${s.exchange}`,t=$.has(a);return T==="all"?e.jsxs("div",{className:"flex items-center justify-between text-sm py-1 border-b border-border/50 last:border-0",children:[e.jsx("span",{className:"font-medium",children:s.symbol}),e.jsx(u,{variant:"outline",className:"text-xs",children:s.exchange})]},a):e.jsxs("div",{className:E("flex items-center gap-2 text-sm py-1.5 px-2 rounded cursor-pointer transition-colors border-b border-border/50 last:border-0",t?"bg-primary/10":"hover:bg-muted/50"),onClick:()=>{z(l=>{const r=new Set(l);return r.has(a)?r.delete(a):r.add(a),r})},children:[e.jsx(J,{checked:t,onCheckedChange:()=>{z(l=>{const r=new Set(l);return r.has(a)?r.delete(a):r.add(a),r})},onClick:l=>l.stopPropagation()}),e.jsx("span",{className:"font-medium flex-1",children:s.symbol}),e.jsx(u,{variant:"outline",className:"text-xs",children:s.exchange})]},a)})})})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Export Summary:"}),e.jsxs("span",{className:"font-medium",children:[T==="selected"?$.size:w.length," symbols x ",y.size," timeframe",y.size!==1?"s":""]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Files: ",Array.from(y).sort().join(", ")]})]})]}),e.jsxs(Fe,{children:[e.jsx(o,{variant:"outline",onClick:()=>te(!1),children:"Cancel"}),e.jsxs(o,{onClick:da,disabled:is||y.size===0||T==="selected"&&$.size===0,children:[is&&e.jsx(oe,{className:"h-4 w-4 animate-spin mr-1"}),"Export (",y.size," timeframe",y.size!==1?"s":"",")"]})]})]})}),e.jsx(wa,{open:Us,onOpenChange:be,children:e.jsxs(Sa,{children:[e.jsxs(Ca,{children:[e.jsx(ka,{children:"Delete Data"}),e.jsxs(_a,{children:["Are you sure you want to delete all data for ",ae?.symbol," (",ae?.exchange,")? This action cannot be undone."]})]}),e.jsxs(Da,{children:[e.jsx(Ea,{children:"Cancel"}),e.jsx(Ta,{onClick:ca,className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})})]})}export{jt as default};
