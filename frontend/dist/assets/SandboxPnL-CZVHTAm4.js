import{r as p,j as e}from"./vendor-react-CCyQGCED.js";import{B as j,c as r,e as c}from"./index-NHrG-O_Z.js";import{C as o,d as h,a as N,b as g}from"./card-Cn20bp_v.js";import{T as f,a as _,b as m,c as t,d as y,e as a}from"./table-Crau903Y.js";import{T as A,a as H,b as v,c as b}from"./tabs-DnjOpX1p.js";import{k as I,as as w,at as z,au as P,av as C,u as T}from"./vendor-icons-CCn_k3dF.js";import{L as R}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function i(l){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)}function n(l){return l>0?"text-green-500":l<0?"text-red-500":""}function G(){const[l,L]=p.useState(null),[S,M]=p.useState(!0),[E,D]=p.useState("daily");p.useEffect(()=>{k()},[]);const k=async()=>{try{const s=await fetch("/sandbox/mypnl/api/data",{credentials:"include"});if(s.ok){const x=await s.json();x.status==="success"&&L(x.data)}}catch{}finally{M(!1)}},u=s=>{window.location.href=`/sandbox/mypnl/export/${s}`};if(S)return e.jsx("div",{className:"container mx-auto py-8 px-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const d=l?.summary||{today_realized_pnl:0,positions_unrealized_pnl:0,holdings_unrealized_pnl:0,today_total_mtm:0,all_time_realized_pnl:0};return e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"My P&L History"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your daily and historical profit & loss"})]}),e.jsx(j,{asChild:!0,variant:"outline",children:e.jsxs(R,{to:"/sandbox",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Sandbox Config"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8",children:[e.jsx(o,{children:e.jsxs(h,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Realized P&L"}),e.jsx("div",{className:r("text-2xl font-bold",n(d.today_realized_pnl)),children:i(d.today_realized_pnl)}),e.jsx(c,{variant:d.today_realized_pnl>=0?"default":"destructive",className:"mt-1",children:"Today"})]})}),e.jsx(o,{children:e.jsxs(h,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Positions MTM"}),e.jsx("div",{className:r("text-2xl font-bold",n(d.positions_unrealized_pnl)),children:i(d.positions_unrealized_pnl)}),e.jsx(c,{variant:"secondary",className:"mt-1",children:"Unrealized"})]})}),e.jsx(o,{children:e.jsxs(h,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Holdings MTM"}),e.jsx("div",{className:r("text-2xl font-bold",n(d.holdings_unrealized_pnl)),children:i(d.holdings_unrealized_pnl)}),e.jsx(c,{variant:"outline",className:"mt-1",children:"Unrealized"})]})}),e.jsx(o,{className:"border-2 border-primary",children:e.jsxs(h,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total MTM"}),e.jsx("div",{className:r("text-2xl font-bold",n(d.today_total_mtm)),children:i(d.today_total_mtm)}),e.jsx(c,{className:"mt-1",children:"Today"})]})}),e.jsx(o,{children:e.jsxs(h,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"All-Time P&L"}),e.jsx("div",{className:r("text-2xl font-bold",n(d.all_time_realized_pnl)),children:i(d.all_time_realized_pnl)}),e.jsx(c,{variant:d.all_time_realized_pnl>=0?"default":"destructive",className:"mt-1",children:"Lifetime"})]})})]}),e.jsxs(A,{value:E,onValueChange:D,children:[e.jsxs(H,{className:"mb-4",children:[e.jsxs(v,{value:"daily",className:"gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Date-wise P&L"]}),e.jsxs(v,{value:"positions",className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Positions"]}),e.jsxs(v,{value:"holdings",className:"gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Holdings"]}),e.jsxs(v,{value:"trades",className:"gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),"Recent Trades"]})]}),e.jsx(b,{value:"daily",children:e.jsxs(o,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(g,{children:"Date-wise P&L Report"}),l?.daily_pnl&&l.daily_pnl.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>u("daily"),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsx(h,{children:l?.daily_pnl&&l.daily_pnl.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Date"}),e.jsx(t,{className:"text-right",children:"Realized P&L"}),e.jsx(t,{className:"text-right",children:"Positions MTM"}),e.jsx(t,{className:"text-right",children:"Holdings MTM"}),e.jsx(t,{className:"text-right",children:"Total Unrealized"}),e.jsx(t,{className:"text-right",children:"Total MTM"}),e.jsx(t,{className:"text-right",children:"Portfolio Value"})]})}),e.jsx(y,{children:l.daily_pnl.map((s,x)=>e.jsxs(m,{children:[e.jsx(a,{className:"font-semibold",children:s.date}),e.jsx(a,{className:r("text-right",n(s.realized_pnl)),children:i(s.realized_pnl)}),e.jsx(a,{className:r("text-right",n(s.positions_unrealized)),children:i(s.positions_unrealized)}),e.jsx(a,{className:r("text-right",n(s.holdings_unrealized)),children:i(s.holdings_unrealized)}),e.jsx(a,{className:r("text-right",n(s.total_unrealized)),children:i(s.total_unrealized)}),e.jsx(a,{className:r("text-right font-bold",n(s.total_mtm)),children:i(s.total_mtm)}),e.jsx(a,{className:"text-right text-primary",children:i(s.portfolio_value)})]},x))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(w,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No daily P&L data yet. Snapshots are captured at 23:59 IST daily."}),e.jsx("p",{className:"text-sm mt-2",children:"Start trading to see your date-wise P&L history."})]})})]})}),e.jsx(b,{value:"positions",children:e.jsxs(o,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(g,{children:"Position-wise P&L"}),l?.positions&&l.positions.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>u("positions"),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsx(h,{children:l?.positions&&l.positions.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Symbol"}),e.jsx(t,{children:"Exchange"}),e.jsx(t,{children:"Product"}),e.jsx(t,{className:"text-right",children:"Qty"}),e.jsx(t,{className:"text-right",children:"Avg Price"}),e.jsx(t,{className:"text-right",children:"LTP"}),e.jsx(t,{className:"text-right",children:"Today's P&L"}),e.jsx(t,{className:"text-right",children:"All-Time P&L"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Last Updated"})]})}),e.jsx(y,{children:l.positions.map((s,x)=>e.jsxs(m,{children:[e.jsx(a,{className:"font-semibold",children:s.symbol}),e.jsx(a,{children:e.jsx(c,{variant:"outline",children:s.exchange})}),e.jsx(a,{children:e.jsx(c,{variant:s.product==="MIS"?"secondary":s.product==="CNC"?"default":"outline",children:s.product})}),e.jsx(a,{className:"text-right",children:s.quantity}),e.jsx(a,{className:"text-right",children:i(s.average_price)}),e.jsx(a,{className:"text-right",children:i(s.ltp)}),e.jsx(a,{className:r("text-right",n(s.today_realized_pnl)),children:i(s.today_realized_pnl)}),e.jsx(a,{className:r("text-right",n(s.all_time_realized_pnl)),children:i(s.all_time_realized_pnl)}),e.jsx(a,{children:e.jsx(c,{variant:s.status==="Open"?"default":"secondary",children:s.status})}),e.jsx(a,{className:"text-xs text-muted-foreground",children:s.updated_at})]},x))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(z,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No positions found. Start trading to see your P&L history."})]})})]})}),e.jsx(b,{value:"holdings",children:e.jsxs(o,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(g,{children:"Holdings P&L (T+1 Settled)"}),l?.holdings&&l.holdings.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>u("holdings"),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]}),e.jsx(h,{children:l?.holdings&&l.holdings.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Symbol"}),e.jsx(t,{children:"Exchange"}),e.jsx(t,{className:"text-right",children:"Qty"}),e.jsx(t,{className:"text-right",children:"Avg Price"}),e.jsx(t,{className:"text-right",children:"LTP"}),e.jsx(t,{className:"text-right",children:"Unrealized P&L"}),e.jsx(t,{className:"text-right",children:"P&L %"}),e.jsx(t,{children:"Settlement Date"})]})}),e.jsx(y,{children:l.holdings.map((s,x)=>e.jsxs(m,{children:[e.jsx(a,{className:"font-semibold",children:s.symbol}),e.jsx(a,{children:e.jsx(c,{variant:"outline",children:s.exchange})}),e.jsx(a,{className:"text-right",children:s.quantity}),e.jsx(a,{className:"text-right",children:i(s.average_price)}),e.jsx(a,{className:"text-right",children:i(s.ltp)}),e.jsx(a,{className:r("text-right",n(s.unrealized_pnl)),children:i(s.unrealized_pnl)}),e.jsxs(a,{className:r("text-right",n(s.pnl_percent)),children:[i(s.pnl_percent),"%"]}),e.jsx(a,{className:"text-xs text-muted-foreground",children:s.settlement_date})]},x))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(P,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No holdings found. CNC positions settle to holdings after T+1."})]})})]})}),e.jsx(b,{value:"trades",children:e.jsxs(o,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(g,{children:"Recent Trades (Last 50)"}),l?.trades&&l.trades.length>0&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>u("trades"),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Export All CSV"]})]}),e.jsx(h,{children:l?.trades&&l.trades.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(f,{children:[e.jsx(_,{children:e.jsxs(m,{children:[e.jsx(t,{children:"Trade ID"}),e.jsx(t,{children:"Symbol"}),e.jsx(t,{children:"Exchange"}),e.jsx(t,{children:"Action"}),e.jsx(t,{className:"text-right",children:"Qty"}),e.jsx(t,{className:"text-right",children:"Price"}),e.jsx(t,{children:"Product"}),e.jsx(t,{children:"Timestamp"})]})}),e.jsx(y,{children:l.trades.map((s,x)=>e.jsxs(m,{children:[e.jsxs(a,{className:"font-mono text-xs",children:[s.tradeid.slice(0,12),"..."]}),e.jsx(a,{className:"font-semibold",children:s.symbol}),e.jsx(a,{children:e.jsx(c,{variant:"outline",children:s.exchange})}),e.jsx(a,{children:e.jsx(c,{variant:s.action==="BUY"?"default":"destructive",children:s.action})}),e.jsx(a,{className:"text-right",children:s.quantity}),e.jsx(a,{className:"text-right",children:i(s.price)}),e.jsx(a,{children:e.jsx(c,{variant:s.product==="MIS"?"secondary":s.product==="CNC"?"default":"outline",children:s.product})}),e.jsx(a,{className:"text-xs text-muted-foreground",children:s.timestamp})]},x))})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No trades found. Start trading to see your trade history."})]})})]})})]})]})}export{G as default};
