import{r as n,j as e}from"./vendor-react-CCyQGCED.js";import{s as i,B as d,e as m}from"./index-lxQU7X8J.js";import{a as C}from"./admin-Db7f1dqO.js";import{A as se,b as ae,c as le,d as te,e as ne,f as ie,g as ce,h as re}from"./alert-dialog-D5NfJeGb.js";import{C as N,d as _,a as de,b as oe,c as he}from"./card-CKimtJpX.js";import{C as xe}from"./checkbox-C8b8Yqzg.js";import{D as me,b as ge,c as pe,d as ue,e as je,f as ye}from"./dialog-Dx8bWbgh.js";import{I as v}from"./input-DbydIQX0.js";import{L as u}from"./label-Bq8Boaoc.js";import{S as H,a as T,b as w,c as I,d as E}from"./select-Bojw7Atx.js";import{T as fe,a as Ne,b as L,c as g,d as _e,e as o}from"./table-B051KeWV.js";import{N as ve,as as Se,aI as De,a8 as Ae,n as be,an as z}from"./vendor-icons-CCn_k3dF.js";import{L as Ce}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const He=[{value:"TRADING_HOLIDAY",label:"Trading Holiday"},{value:"SETTLEMENT_HOLIDAY",label:"Settlement Holiday"},{value:"SPECIAL_SESSION",label:"Special Session"}];function $e(){const[h,M]=n.useState([]),[S,B]=n.useState([]),[j,$]=n.useState([]),[c,D]=n.useState(new Date().getFullYear()),[V,k]=n.useState(!0),[W,y]=n.useState(!1),[l,r]=n.useState({date:"",description:"",holiday_type:"TRADING_HOLIDAY",closed_exchanges:[],open_exchanges:[]}),[O,Y]=n.useState(!1),[p,A]=n.useState(null),[P,R]=n.useState(!1);n.useEffect(()=>{b(c)},[c]);const b=async s=>{k(!0);try{const a=await C.getHolidays(s);M(a.data),B(a.years),$(a.exchanges)}catch{i.error("Failed to load holidays","admin")}finally{k(!1)}},F=(s,a)=>{const[t,f]=a.split(":").map(Number),x=new Date(s+"T00:00:00+05:30");return x.setHours(t,f,0,0),x.getTime()},q=async()=>{if(!l.date||!l.description){i.error("Please fill in date and description","admin");return}if(l.holiday_type==="TRADING_HOLIDAY"&&l.closed_exchanges.length===0){i.error("Please select at least one exchange to close","admin");return}if(l.holiday_type==="SPECIAL_SESSION"){if(l.open_exchanges.length===0){i.error("Please add at least one exchange with timings","admin");return}for(const s of l.open_exchanges)if(!s.start_time||!s.end_time){i.error(`Please enter start and end time for ${s.exchange}`,"admin");return}}Y(!0);try{const s=l.open_exchanges.map(t=>({exchange:t.exchange,start_time:F(l.date,t.start_time),end_time:F(l.date,t.end_time)})),a=await C.addHoliday({date:l.date,description:l.description,holiday_type:l.holiday_type,closed_exchanges:l.closed_exchanges,open_exchanges:l.holiday_type==="SPECIAL_SESSION"?s:void 0});a.status==="success"?(i.success(a.message||"Holiday added successfully","admin"),y(!1),r({date:"",description:"",holiday_type:"TRADING_HOLIDAY",closed_exchanges:[],open_exchanges:[]}),b(c)):i.error(a.message||"Failed to add holiday","admin")}catch(s){const a=s;i.error(a.response?.data?.message||"Failed to add holiday","admin")}finally{Y(!1)}},J=async()=>{if(p){R(!0);try{const s=await C.deleteHoliday(p.id);s.status==="success"?(i.success(s.message||"Holiday deleted successfully","admin"),A(null),b(c)):i.error(s.message||"Failed to delete holiday","admin")}catch(s){const a=s;i.error(a.response?.data?.message||"Failed to delete holiday","admin")}finally{R(!1)}}},K=s=>{r(a=>({...a,closed_exchanges:a.closed_exchanges.includes(s)?a.closed_exchanges.filter(t=>t!==s):[...a.closed_exchanges,s]}))},Q=()=>{r(s=>({...s,closed_exchanges:j}))},U=s=>{l.open_exchanges.find(a=>a.exchange===s)||r(a=>({...a,open_exchanges:[...a.open_exchanges,{exchange:s,start_time:"18:00",end_time:"19:15"}]}))},X=s=>{r(a=>({...a,open_exchanges:a.open_exchanges.filter(t=>t.exchange!==s)}))},G=(s,a,t)=>{r(f=>({...f,open_exchanges:f.open_exchanges.map(x=>x.exchange===s?{...x,[a]:t}:x)}))},Z=()=>{const s=j.filter(a=>!l.open_exchanges.find(t=>t.exchange===a)).map(a=>({exchange:a,start_time:"18:00",end_time:"19:15"}));r(a=>({...a,open_exchanges:[...a.open_exchanges,...s]}))},ee=s=>{switch(s){case"TRADING_HOLIDAY":return e.jsx(m,{variant:"destructive",children:"Trading Holiday"});case"SETTLEMENT_HOLIDAY":return e.jsx(m,{variant:"secondary",children:"Settlement Holiday"});case"SPECIAL_SESSION":return e.jsx(m,{className:"bg-purple-500 hover:bg-purple-600",children:"Special Session"});default:return e.jsx(m,{variant:"outline",children:s})}};return V?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ce,{to:"/admin",className:"text-muted-foreground hover:text-foreground",children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Se,{className:"h-6 w-6"}),"Market Holidays"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage trading holidays for all supported exchanges"})]}),e.jsxs(d,{onClick:()=>y(!0),children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Add Holiday"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.length}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total Holidays (",c,")"]})]})}),e.jsx(N,{children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.filter(s=>s.holiday_type==="TRADING_HOLIDAY").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Holidays"})]})}),e.jsx(N,{children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.filter(s=>s.holiday_type!=="TRADING_HOLIDAY").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Special Days"})]})})]}),e.jsxs(N,{children:[e.jsxs(de,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(oe,{children:"Holiday Calendar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:()=>D(s=>s-1),disabled:!S.includes(c-1),title:"Previous year","aria-label":"Previous year",children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsxs(H,{value:c.toString(),onValueChange:s=>D(parseInt(s,10)),children:[e.jsx(T,{className:"w-[120px]",children:e.jsx(w,{})}),e.jsx(I,{children:S.map(s=>e.jsx(E,{value:s.toString(),children:s},s))})]}),e.jsx(d,{variant:"outline",size:"icon",onClick:()=>D(s=>s+1),disabled:!S.includes(c+1),title:"Next year","aria-label":"Next year",children:e.jsx(be,{className:"h-4 w-4"})})]})]}),e.jsxs(he,{children:[h.length," holidays in ",c]})]}),e.jsx(_,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(fe,{children:[e.jsx(Ne,{children:e.jsxs(L,{children:[e.jsx(g,{children:"Date"}),e.jsx(g,{children:"Day"}),e.jsx(g,{children:"Description"}),e.jsx(g,{children:"Type"}),e.jsx(g,{children:"Closed Exchanges"}),e.jsx(g,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(_e,{children:h.length===0?e.jsx(L,{children:e.jsxs(o,{colSpan:6,className:"text-center text-muted-foreground py-8",children:["No holidays configured for ",c]})}):h.map(s=>e.jsxs(L,{children:[e.jsx(o,{className:"font-medium",children:s.date}),e.jsx(o,{children:s.day_name}),e.jsx(o,{children:s.description}),e.jsx(o,{children:ee(s.holiday_type)}),e.jsx(o,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.closed_exchanges.length===0?e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"}):s.closed_exchanges.map(a=>e.jsx(m,{variant:"outline",className:"text-xs",children:a},a))})}),e.jsx(o,{children:e.jsx(d,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>A(s),title:"Delete holiday","aria-label":`Delete holiday ${s.description}`,children:e.jsx(z,{className:"h-4 w-4"})})})]},s.id))})]})})})]}),e.jsx(me,{open:W,onOpenChange:y,children:e.jsxs(ge,{className:"max-w-md",children:[e.jsxs(pe,{children:[e.jsx(ue,{children:"Add Holiday"}),e.jsx(je,{children:"Add a new market holiday entry."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Date"}),e.jsx(v,{type:"date",value:l.date,onChange:s=>r({...l,date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Description"}),e.jsx(v,{placeholder:"e.g., Republic Day",value:l.description,onChange:s=>r({...l,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Holiday Type"}),e.jsxs(H,{value:l.holiday_type,onValueChange:s=>r({...l,holiday_type:s}),children:[e.jsx(T,{children:e.jsx(w,{})}),e.jsx(I,{children:He.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})]})]}),l.holiday_type==="TRADING_HOLIDAY"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Closed Exchanges"}),e.jsx(d,{variant:"link",size:"sm",className:"h-auto p-0",onClick:Q,children:"Select All"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:j.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{id:s,checked:l.closed_exchanges.includes(s),onCheckedChange:()=>K(s)}),e.jsx("label",{htmlFor:s,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s})]},s))})]}),l.holiday_type==="SPECIAL_SESSION"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Exchanges with Special Timings"}),e.jsx(d,{variant:"link",size:"sm",className:"h-auto p-0",onClick:Z,children:"Add All"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Set trading hours for each exchange during this special session (e.g., Muhurat Trading 18:00-19:15)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(H,{onValueChange:s=>U(s),value:"",children:[e.jsx(T,{className:"flex-1",children:e.jsx(w,{placeholder:"Select exchange to add..."})}),e.jsx(I,{children:j.filter(s=>!l.open_exchanges.find(a=>a.exchange===s)).map(s=>e.jsx(E,{value:s,children:s},s))})]})}),l.open_exchanges.length>0&&e.jsx("div",{className:"space-y-2 border rounded-md p-3",children:l.open_exchanges.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",className:"min-w-[50px] justify-center",children:s.exchange}),e.jsx(v,{type:"time",value:s.start_time,onChange:a=>G(s.exchange,"start_time",a.target.value),className:"w-[110px]","aria-label":`Start time for ${s.exchange}`}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(v,{type:"time",value:s.end_time,onChange:a=>G(s.exchange,"end_time",a.target.value),className:"w-[110px]","aria-label":`End time for ${s.exchange}`}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>X(s.exchange),title:"Remove exchange","aria-label":`Remove ${s.exchange} from special session`,children:e.jsx(z,{className:"h-4 w-4"})})]},s.exchange))})]})]}),e.jsxs(ye,{children:[e.jsx(d,{variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsx(d,{onClick:q,disabled:O,children:O?"Adding...":"Add Holiday"})]})]})}),e.jsx(se,{open:!!p,onOpenChange:()=>A(null),children:e.jsxs(ae,{children:[e.jsxs(le,{children:[e.jsx(te,{children:"Delete Holiday?"}),e.jsxs(ne,{children:['Are you sure you want to delete "',p?.description,'" on'," ",p?.date,"? This action cannot be undone."]})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Cancel"}),e.jsx(re,{onClick:J,disabled:P,children:P?"Deleting...":"Delete"})]})]})})]})}export{$e as default};
