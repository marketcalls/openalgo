import{j as e,r as o}from"./vendor-react-RhKMXzW9.js";import{c as Q,B as r,e as L,D as W,h as Y,i as Z,j as z,k as J,t as a}from"./index-DDNix_S6.js";import{p as c}from"./python-strategy-BerLe8p4.js";import{A as X,a as ee}from"./alert-D5rh5ttU.js";import{C as h,a as x,b as se,c as te,d as ae}from"./card-Be8ay8oW.js";import{D as re,b as le,c as ne,d as ie,e as ce,f as oe}from"./dialog-CACA0lGQ.js";import{S as w}from"./skeleton-D9a2EPt-.js";import{_ as de,$ as he,a0 as xe,a1 as me,a2 as ue,a3 as je}from"./vendor-radix-Cue1hf3Z.js";import{S as pe,a as ge,b as fe}from"./python-strategy-CDLQ7BFJ.js";import{o as Ne,R as ve,av as A,aL as y,aE as E,ai as k,P as be,aM as Se,p as we,ac as Ce,T as ye,aD as ke,aN as De,F as _e}from"./vendor-icons-D08EYFn4.js";import{a as Fe,L as D}from"./vendor-router-DdyOoyPF.js";function Te({delayDuration:n=0,...i}){return e.jsx(je,{"data-slot":"tooltip-provider",delayDuration:n,...i})}function m({...n}){return e.jsx(Te,{children:e.jsx(de,{"data-slot":"tooltip",...n})})}function u({...n}){return e.jsx(he,{"data-slot":"tooltip-trigger",...n})}function j({className:n,sideOffset:i=0,children:N,...p}){return e.jsx(xe,{children:e.jsxs(me,{"data-slot":"tooltip-content",sideOffset:i,className:Q("bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",n),...p,children:[N,e.jsx(ue,{className:"bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}function Be(){const n=Fe(),[i,N]=o.useState([]),[p,P]=o.useState(null),[R,_]=o.useState(!0),[v,l]=o.useState(null),[M,b]=o.useState(!1),[g,F]=o.useState(null),[O,$]=o.useState(new Date),d=async()=>{try{_(!0);const[s,t]=await Promise.all([c.getStrategies(),c.getMasterContractStatus()]);N(s),P(t)}catch(s){console.error("Failed to fetch data:",s),a.error("Failed to load strategies")}finally{_(!1)}};o.useEffect(()=>{d();const s=setInterval(()=>$(new Date),1e3);return()=>clearInterval(s)},[]);const U=async s=>{try{l(s.id);const t=await c.startStrategy(s.id);t.status==="success"?(a.success(`Strategy ${s.name} started`),d()):a.error(t.message||"Failed to start strategy")}catch(t){console.error("Failed to start strategy:",t),a.error("Failed to start strategy")}finally{l(null)}},I=async s=>{try{l(s.id);const t=await c.stopStrategy(s.id);t.status==="success"?(a.success(`Strategy ${s.name} stopped`),d()):a.error(t.message||"Failed to stop strategy")}catch(t){console.error("Failed to stop strategy:",t),a.error("Failed to stop strategy")}finally{l(null)}},B=async s=>{try{l(s.id);const t=await c.clearError(s.id);t.status==="success"?(a.success("Error cleared"),d()):a.error(t.message||"Failed to clear error")}catch(t){console.error("Failed to clear error:",t),a.error("Failed to clear error")}finally{l(null)}},H=async s=>{try{l(s.id);const t=await c.unscheduleStrategy(s.id);t.status==="success"?(a.success("Schedule removed"),d()):a.error(t.message||"Failed to remove schedule")}catch(t){console.error("Failed to unschedule:",t),a.error("Failed to remove schedule")}finally{l(null)}},V=async()=>{if(g)try{l(g.id);const s=await c.deleteStrategy(g.id);s.status==="success"?(a.success("Strategy deleted"),N(i.filter(t=>t.id!==g.id))):a.error(s.message||"Failed to delete strategy")}catch(s){console.error("Failed to delete strategy:",s),a.error("Failed to delete strategy")}finally{l(null),b(!1),F(null)}},q=async s=>{try{const t=await c.exportStrategy(s.id),S=URL.createObjectURL(t),f=document.createElement("a");f.href=S,f.download=s.file_name,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(S),a.success("Strategy exported")}catch(t){console.error("Failed to export strategy:",t),a.error("Failed to export strategy")}},G=async()=>{try{l("master");const s=await c.checkAndStartPending();if(s.status==="success"){const t=s.data?.started||0;a.success(`Started ${t} pending strategies`),d()}else a.error(s.message||"Failed to check contracts")}catch(s){console.error("Failed to check contracts:",s),a.error("Failed to check contracts")}finally{l(null)}},K=s=>!s||s.length===0?"":s.length===7?"Every day":s.length===5&&!s.includes("sat")&&!s.includes("sun")?"Weekdays":s.map(t=>fe.find(S=>S.value===t)?.label.slice(0,3)||t).join(", "),T=s=>s?new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}):"-",C={total:i.length,running:i.filter(s=>s.status==="running").length,scheduled:i.filter(s=>s.is_scheduled).length};return R?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(w,{className:"h-8 w-48"}),e.jsx(w,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-4",children:[1,2,3,4].map(s=>e.jsx(w,{className:"h-24"},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsx(w,{className:"h-64"},s))})]}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Python Strategies"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and run your Python trading scripts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>n("/python/guide"),children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Guide"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:d,children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(r,{onClick:()=>n("/python/new"),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Add Strategy"]})]})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-4",children:[e.jsx(h,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:C.total})]}),e.jsx(y,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(h,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Running"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:C.running})]}),e.jsx(E,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(h,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scheduled"}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:C.scheduled})]}),e.jsx(k,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(h,{children:e.jsx(x,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Master Contract"}),e.jsx(L,{variant:p?.ready?"default":"secondary",children:p?.ready?"Ready":"Not Ready"})]}),!p?.ready&&e.jsx(r,{size:"sm",variant:"outline",onClick:G,disabled:v==="master",children:"Check"})]})})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(be,{className:"h-4 w-4"}),"Current IST: ",O.toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})]}),i.length===0?e.jsx(h,{className:"py-12",children:e.jsxs(x,{className:"flex flex-col items-center justify-center text-center",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Python Strategies"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload your first Python trading script to get started."}),e.jsxs(r,{onClick:()=>n("/python/new"),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Add Strategy"]})]})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(s=>e.jsxs(h,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${pe[s.status]}`}),e.jsx(se,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(te,{className:"text-lg",children:s.name}),e.jsx(ae,{className:"font-mono text-xs",children:s.file_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:s.status==="running"?"default":"secondary",className:s.status==="running"?"bg-green-500":"",children:ge[s.status]}),e.jsxs(W,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(Se,{className:"h-4 w-4"})})}),e.jsxs(Z,{align:"end",children:[e.jsxs(z,{onClick:()=>q(s),children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsx(J,{}),e.jsxs(z,{className:"text-red-500",disabled:s.status==="running",onClick:()=>{F(s),b(!0)},children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})}),e.jsxs(x,{className:"space-y-4",children:[s.is_scheduled&&e.jsxs("div",{className:"text-sm p-2 bg-blue-50 dark:bg-blue-950 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{children:[s.schedule_start_time,s.schedule_stop_time&&` - ${s.schedule_stop_time}`]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:K(s.schedule_days)})]}),s.status==="error"&&s.error_message&&e.jsxs(X,{variant:"destructive",children:[e.jsx(ye,{className:"h-4 w-4"}),e.jsxs(ee,{className:"text-xs",children:[s.error_message,e.jsx(r,{variant:"link",size:"sm",className:"p-0 h-auto ml-2",onClick:()=>B(s),children:"Clear"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Last Started"}),e.jsx("span",{children:T(s.last_started)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Last Stopped"}),e.jsx("span",{children:T(s.last_stopped)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[s.status==="running"?e.jsxs(m,{children:[e.jsx(u,{asChild:!0,children:e.jsxs(r,{variant:"destructive",size:"sm",className:"flex-1",onClick:()=>I(s),disabled:v===s.id,children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Stop"]})}),e.jsx(j,{children:"Stop running strategy"})]}):e.jsxs(m,{children:[e.jsx(u,{asChild:!0,children:e.jsxs(r,{variant:"default",size:"sm",className:"flex-1 bg-green-600 hover:bg-green-700",onClick:()=>U(s),disabled:v===s.id,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Start"]})}),e.jsx(j,{children:"Start strategy"})]}),s.is_scheduled?e.jsxs(m,{children:[e.jsx(u,{asChild:!0,children:e.jsxs(r,{variant:"outline",size:"sm",className:"border-blue-500 bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-950 dark:text-blue-400 dark:hover:bg-blue-900",onClick:()=>H(s),disabled:v===s.id||s.status==="running",children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"On"})]})}),e.jsxs(j,{children:["Scheduled: ",s.schedule_start_time,s.schedule_stop_time&&` - ${s.schedule_stop_time}`,e.jsx("br",{}),"Click to remove"]})]}):e.jsxs(m,{children:[e.jsx(u,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",className:"text-muted-foreground hover:text-foreground",asChild:!0,disabled:s.status==="running",children:e.jsxs(D,{to:`/python/${s.id}/schedule`,children:[e.jsx(De,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Off"})]})})}),e.jsx(j,{children:"Set schedule"})]}),e.jsxs(m,{children:[e.jsx(u,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(D,{to:`/python/${s.id}/logs`,children:e.jsx(_e,{className:"h-4 w-4"})})})}),e.jsx(j,{children:"View logs"})]}),e.jsxs(m,{children:[e.jsx(u,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(D,{to:`/python/${s.id}/edit`,children:e.jsx(y,{className:"h-4 w-4"})})})}),e.jsx(j,{children:"Edit code"})]})]})]})]},s.id))}),e.jsx(re,{open:M,onOpenChange:b,children:e.jsxs(le,{children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Delete Strategy"}),e.jsxs(ce,{children:['Are you sure you want to delete "',g?.name,'"? This will remove the strategy file and all associated logs.']})]}),e.jsxs(oe,{children:[e.jsx(r,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:V,children:"Delete Strategy"})]})]})})]})}export{Be as default};
