import{j as e,r as g}from"./vendor-react-Df-MYEHc.js";import{C,d as k,a as A,b as R}from"./card-NBBx4fP2.js";import{P as z,D as H,a as V,b as q}from"./PresetSelector-qvwBdxpk.js";import{s as W}from"./strategy-DtYuZC-x.js";import{d as J}from"./strategy-dashboard-D47yV95t.js";import{B as f,w as Q,e as Z,s as w}from"./index-jmNeOP74.js";import{n as ee,b6 as se,aJ as ae}from"./vendor-icons-nFj7rtAi.js";import{I as B}from"./input-BiM5Ngw3.js";import{L as u}from"./label-BDVFS1En.js";import{S as m,a as p,b as j,c as y,d}from"./select-Mroud02a.js";import{S as te}from"./switch-C035A0rf.js";import{T as le,a as ne,b as P,c as U}from"./tabs-jWCANazw.js";import{C as re}from"./checkbox-CBxWevx5.js";import{a as ie,d as de}from"./vendor-router-4BT-EZah.js";import"./vendor-charts-DPXZ0pfV.js";import"./vendor-radix-IoylIoim.js";const $=[{key:"basics",label:"Basics",num:1},{key:"legs",label:"Legs",num:2},{key:"risk",label:"Risk",num:3},{key:"review",label:"Review",num:4}],ce=["basics","legs","risk","review"];function xe({currentStep:s,onStepClick:i}){const r=ce.indexOf(s);return e.jsx("nav",{className:"flex items-center justify-center gap-2",children:$.map((c,n)=>{const a=n<r,h=n===r,o=n<=r;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{type:"button",onClick:()=>o&&i(c.key),disabled:!o,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${h?"bg-primary text-primary-foreground":a?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 cursor-pointer":"bg-muted text-muted-foreground"}`,children:[a?e.jsx(ee,{className:"h-3 w-3"}):e.jsx("span",{className:"w-4 text-center",children:c.num}),c.label]}),n<$.length-1&&e.jsx("div",{className:`w-8 h-0.5 mx-1 ${n<r?"bg-green-400":"bg-muted"}`})]},c.key)})})}const oe=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"},{value:"CDS",label:"CDS"},{value:"BCD",label:"BCD"},{value:"MCX",label:"MCX"}],M={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX","SENSEX50"],CDS:["USDINR","EURINR","GBPINR","JPYINR"],BCD:["USDINR","EURINR"],MCX:["CRUDEOIL","GOLD","SILVER","NATURALGAS"]};function ue({basics:s,onChange:i,onNext:r}){const[c,n]=g.useState(M[s.exchange]||[]),[a,h]=g.useState(!1),o=(l,x)=>i({...s,[l]:x});g.useEffect(()=>{let l=!1;return(async()=>{h(!0);try{const N=await Q.get(`/search/api/underlyings?exchange=${s.exchange}`);!l&&N.data.underlyings?.length>0?n(N.data.underlyings):l||n(M[s.exchange]||[])}catch{l||n(M[s.exchange]||[])}finally{l||h(!1)}})(),()=>{l=!0}},[s.exchange]);const _=l=>{const x=l,N=M[x]||[];i({...s,exchange:x,underlying:N[0]||""})},t=s.name.trim().length>0;return e.jsxs("div",{className:"max-w-lg mx-auto space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Strategy Name"}),e.jsx(B,{placeholder:"e.g., NIFTY Short Straddle",value:s.name,onChange:l=>o("name",l.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Exchange"}),e.jsxs(m,{value:s.exchange,onValueChange:_,children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsx(y,{children:oe.map(l=>e.jsx(d,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Underlying"}),e.jsxs(m,{value:s.underlying,onValueChange:l=>o("underlying",l),disabled:a,children:[e.jsx(p,{children:e.jsx(j,{placeholder:a?"Loading...":"Select"})}),e.jsx(y,{children:c.map(l=>e.jsx(d,{value:l,children:l},l))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Expiry"}),e.jsxs(m,{value:s.expiry_type,onValueChange:l=>o("expiry_type",l),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"current_week",children:"Current Week"}),e.jsx(d,{value:"next_week",children:"Next Week"}),e.jsx(d,{value:"current_month",children:"Current Month"}),e.jsx(d,{value:"next_month",children:"Next Month"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Product Type"}),e.jsxs(m,{value:s.product_type,onValueChange:l=>o("product_type",l),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"MIS",children:"MIS (Intraday)"}),e.jsx(d,{value:"NRML",children:"NRML (Positional)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Trading Mode"}),e.jsxs(m,{value:s.trading_mode,onValueChange:l=>o("trading_mode",l),children:[e.jsx(p,{children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"BOTH",children:"Both"}),e.jsx(d,{value:"LONG",children:"Long Only"}),e.jsx(d,{value:"SHORT",children:"Short Only"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx(te,{checked:s.is_intraday,onCheckedChange:l=>o("is_intraday",l)}),e.jsx(u,{className:"text-sm",children:s.is_intraday?"Intraday":"Positional"})]})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsx(f,{onClick:r,disabled:!t,children:"Next: Add Legs"})})]})}const he=[{value:"ATM",label:"ATM"},{value:"ITM",label:"ITM"},{value:"OTM",label:"OTM"},{value:"specific",label:"Specific Strike"},{value:"premium_near",label:"Premium Near"}];function me(s){switch(s){case"ATM":return["ATM"];case"ITM":return Array.from({length:20},(i,r)=>`ITM${r+1}`);case"OTM":return Array.from({length:20},(i,r)=>`OTM${r+1}`);default:return["ATM"]}}function pe({leg:s,index:i,onChange:r,onRemove:c,frozen:n}){const a=(t,l)=>r({...s,[t]:l}),h=me(s.strike_type),o=s.strike_type==="ITM"||s.strike_type==="OTM",_=t=>{const l=t;let x=s.offset;l==="ATM"?x="ATM":l==="ITM"?x="ITM1":l==="OTM"?x="OTM1":x="ATM",r({...s,strike_type:l,offset:x})};return e.jsxs(C,{className:n?"relative overflow-hidden opacity-75 pointer-events-none":"",children:[n&&e.jsx(je,{}),e.jsxs(k,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-xs font-medium",children:["Leg ",i+1,e.jsxs("span",{className:`ml-2 ${s.action==="BUY"?"text-green-600":"text-red-600"}`,children:[s.action," ",s.option_type||"FUT",s.offset!=="ATM"?` ${s.offset}`:" ATM"]})]}),e.jsx(f,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:c,disabled:n,children:e.jsx(se,{className:"h-3.5 w-3.5 text-muted-foreground"})})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Action"}),e.jsxs(m,{value:s.action,onValueChange:t=>a("action",t),children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"BUY",children:"BUY"}),e.jsx(d,{value:"SELL",children:"SELL"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Type"}),e.jsxs(m,{value:s.option_type||"FUT",onValueChange:t=>a("option_type",t==="FUT"?null:t),children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"CE",children:"CE"}),e.jsx(d,{value:"PE",children:"PE"}),e.jsx(d,{value:"FUT",children:"Future"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Strike Type"}),e.jsxs(m,{value:s.strike_type,onValueChange:_,children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsx(y,{children:he.map(t=>e.jsx(d,{value:t.value,children:t.label},t.value))})]})]}),o&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Offset"}),e.jsxs(m,{value:s.offset,onValueChange:t=>a("offset",t),children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsx(y,{children:h.map(t=>e.jsx(d,{value:t,children:t},t))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Lots"}),e.jsx(B,{type:"number",min:1,className:"h-8 text-xs",value:s.quantity_lots,onChange:t=>a("quantity_lots",Math.max(1,Number(t.target.value)))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Expiry"}),e.jsxs(m,{value:s.expiry_type,onValueChange:t=>a("expiry_type",t),children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"current_week",children:"Curr Week"}),e.jsx(d,{value:"next_week",children:"Next Week"}),e.jsx(d,{value:"current_month",children:"Curr Month"}),e.jsx(d,{value:"next_month",children:"Next Month"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Product"}),e.jsxs(m,{value:s.product_type,onValueChange:t=>a("product_type",t),children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"MIS",children:"MIS"}),e.jsx(d,{value:"NRML",children:"NRML"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Order"}),e.jsxs(m,{value:s.order_type,onValueChange:t=>a("order_type",t),children:[e.jsx(p,{className:"h-8 text-xs",children:e.jsx(j,{})}),e.jsxs(y,{children:[e.jsx(d,{value:"MARKET",children:"Market"}),e.jsx(d,{value:"LIMIT",children:"Limit"})]})]})]})]})]})]})}function je(){return e.jsx("div",{className:"absolute inset-0 z-10",style:{background:`repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 6px,
          rgba(128, 128, 128, 0.08) 6px,
          rgba(128, 128, 128, 0.08) 12px
        )`}})}function Y(){return Math.random().toString(36).substring(2,10)}const ye={leg_type:"option",action:"SELL",option_type:"CE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"};function ge({legs:s,onChange:i,onPresetSelect:r,onBack:c,onNext:n}){const a=()=>{i([...s,{...ye,id:Y()}])},h=(t,l)=>{const x=[...s];x[t]=l,i(x)},o=t=>{i(s.filter((l,x)=>x!==t))},_=(t,l)=>{const x=t.map(N=>({...N,id:Y()}));i(x),r(l)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Quick Start with Presets"}),e.jsx(z,{onSelect:_})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium",children:["Legs ",s.length>0&&`(${s.length})`]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(ae,{className:"h-3.5 w-3.5 mr-1"}),"Add Leg"]})]}),s.length===0?e.jsx("div",{className:"text-center py-8 text-sm text-muted-foreground border border-dashed rounded-lg",children:"Select a preset above or add legs manually"}):e.jsx("div",{className:"space-y-2",children:s.map((t,l)=>e.jsx(pe,{leg:t,index:l,onChange:x=>h(l,x),onRemove:()=>o(l)},t.id))})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(f,{variant:"outline",onClick:c,children:"Back"}),e.jsx(f,{onClick:n,disabled:s.length===0,children:"Next: Risk Config"})]})]})}const ve=[{value:"",label:"Disabled"},{value:"percentage",label:"Percentage"},{value:"points",label:"Points"}];function b({label:s,typeValue:i,numValue:r,onTypeChange:c,onNumChange:n}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{className:"text-xs",children:s}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{value:i||"",onValueChange:a=>c(a||null),children:[e.jsx(p,{className:"w-[130px] h-8 text-xs",children:e.jsx(j,{placeholder:"Disabled"})}),e.jsx(y,{children:ve.map(a=>e.jsx(d,{value:a.value,children:a.label},a.value))})]}),e.jsx(B,{type:"number",step:"0.01",className:"h-8 text-xs",value:r??"",disabled:!i,onChange:a=>n(a.target.value?Number(a.target.value):null)})]})]})}function _e({config:s,onChange:i,onBack:r,onNext:c}){const n=(a,h)=>i({...s,[a]:h});return e.jsxs("div",{className:"max-w-lg mx-auto space-y-5",children:[e.jsxs(le,{value:s.risk_mode,onValueChange:a=>n("risk_mode",a),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Risk Mode"}),e.jsxs(ne,{children:[e.jsx(P,{value:"combined",className:"text-xs",children:"Combined"}),e.jsx(P,{value:"per_leg",className:"text-xs",children:"Per Leg"})]})]}),e.jsxs(U,{value:"combined",className:"space-y-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Combined risk applies to the net premium of all legs together."}),e.jsx(b,{label:"Combined Stop Loss",typeValue:s.combined_stoploss_type,numValue:s.combined_stoploss_value,onTypeChange:a=>n("combined_stoploss_type",a),onNumChange:a=>n("combined_stoploss_value",a)}),e.jsx(b,{label:"Combined Target",typeValue:s.combined_target_type,numValue:s.combined_target_value,onTypeChange:a=>n("combined_target_type",a),onNumChange:a=>n("combined_target_value",a)}),e.jsx(b,{label:"Combined Trailing Stop",typeValue:s.combined_trailstop_type,numValue:s.combined_trailstop_value,onTypeChange:a=>n("combined_trailstop_type",a),onNumChange:a=>n("combined_trailstop_value",a)})]}),e.jsxs(U,{value:"per_leg",className:"space-y-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per-leg risk applies to each leg individually. Configure defaults here â€” override per leg in the Legs step."}),e.jsx(b,{label:"Default Stop Loss",typeValue:s.default_stoploss_type,numValue:s.default_stoploss_value,onTypeChange:a=>n("default_stoploss_type",a),onNumChange:a=>n("default_stoploss_value",a)}),e.jsx(b,{label:"Default Target",typeValue:s.default_target_type,numValue:s.default_target_value,onTypeChange:a=>n("default_target_type",a),onNumChange:a=>n("default_target_value",a)}),e.jsx(b,{label:"Default Trailing Stop",typeValue:s.default_trailstop_type,numValue:s.default_trailstop_value,onTypeChange:a=>n("default_trailstop_type",a),onNumChange:a=>n("default_trailstop_value",a)}),e.jsx(b,{label:"Breakeven Threshold",typeValue:s.default_breakeven_type,numValue:s.default_breakeven_threshold,onTypeChange:a=>n("default_breakeven_type",a),onNumChange:a=>n("default_breakeven_threshold",a)})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(f,{variant:"outline",onClick:r,children:"Back"}),e.jsx(f,{onClick:c,children:"Next: Review"})]})]})}function fe({basics:s,legs:i,riskConfig:r,preset:c,saving:n,onBack:a,onSave:h}){const[o,_]=g.useState(!1);return e.jsxs("div",{className:"max-w-lg mx-auto space-y-4",children:[e.jsxs(C,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(R,{className:"text-sm",children:"Strategy Basics"})}),e.jsxs(k,{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name"}),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Exchange"}),e.jsx("span",{children:s.exchange})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Underlying"}),e.jsx("span",{children:s.underlying})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Expiry"}),e.jsx("span",{className:"capitalize",children:s.expiry_type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Product"}),e.jsx("span",{children:s.product_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type"}),e.jsx("span",{children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mode"}),e.jsx("span",{children:s.trading_mode})]})]})]}),e.jsxs(C,{children:[e.jsx(A,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{className:"text-sm",children:["Legs (",i.length,")"]}),c&&e.jsx(Z,{variant:"secondary",className:"text-[10px]",children:c.replace("_"," ")})]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-1.5",children:i.map((t,l)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"text-muted-foreground w-8",children:["L",l+1]}),e.jsx("span",{className:t.action==="BUY"?"text-green-600":"text-red-600",children:t.action}),e.jsx("span",{children:t.option_type||"FUT"}),e.jsx("span",{className:"text-muted-foreground",children:t.offset}),e.jsxs("span",{children:["x",t.quantity_lots]}),e.jsx("span",{className:"text-muted-foreground",children:t.expiry_type.replace("_"," ")})]},t.id))})})]}),e.jsxs(C,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(R,{className:"text-sm",children:"Risk Configuration"})}),e.jsxs(k,{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mode"}),e.jsx("span",{className:"capitalize",children:r.risk_mode.replace("_"," ")})]}),r.risk_mode==="combined"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"SL"}),e.jsx("span",{children:r.combined_stoploss_type?`${r.combined_stoploss_value} ${r.combined_stoploss_type}`:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"TGT"}),e.jsx("span",{children:r.combined_target_type?`${r.combined_target_value} ${r.combined_target_type}`:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"TSL"}),e.jsx("span",{children:r.combined_trailstop_type?`${r.combined_trailstop_value} ${r.combined_trailstop_type}`:"Disabled"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Default SL"}),e.jsx("span",{children:r.default_stoploss_type?`${r.default_stoploss_value} ${r.default_stoploss_type}`:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Default TGT"}),e.jsx("span",{children:r.default_target_type?`${r.default_target_value} ${r.default_target_type}`:"Disabled"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx(re,{id:"save-as-template",checked:o,onCheckedChange:t=>_(t===!0)}),e.jsx(u,{htmlFor:"save-as-template",className:"text-xs cursor-pointer",children:"Also save as reusable template"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(f,{variant:"outline",onClick:a,children:"Back"}),e.jsx(f,{onClick:()=>h({saveAsTemplate:o}),disabled:n,children:n?"Saving...":"Save Strategy"})]})]})}function Oe(){const s=ie(),{id:i}=de(),r=!!i,[c,n]=g.useState("basics"),[a,h]=g.useState({...H}),[o,_]=g.useState([]),[t,l]=g.useState({...V}),[x,N]=g.useState(null),[G,F]=g.useState(!1),[K,D]=g.useState(!1);g.useEffect(()=>{if(!i)return;let S=!1;return(async()=>{D(!0);try{const T=Number(i),[L,v]=await Promise.all([W.getStrategy(T),J.getRiskConfig(T,"builder").catch(()=>null)]);if(S)return;const I=L.strategy,E=L.mappings[0];h({name:I.name||"",exchange:E?.exchange||"NFO",underlying:E?.symbol||"NIFTY",expiry_type:"current_week",product_type:E?.product_type||"MIS",is_intraday:I.is_intraday??!0,trading_mode:I.trading_mode||"BOTH"}),v&&l({...V,default_stoploss_type:v.default_stoploss_type,default_stoploss_value:v.default_stoploss_value,default_target_type:v.default_target_type,default_target_value:v.default_target_value,default_trailstop_type:v.default_trailstop_type,default_trailstop_value:v.default_trailstop_value,default_breakeven_type:v.default_breakeven_type,default_breakeven_threshold:v.default_breakeven_threshold})}catch{w.error("Failed to load strategy")}finally{S||D(!1)}})(),()=>{S=!0}},[i]);const X=async S=>{F(!0);try{const O={basics:a,legs:o.map(({id:L,...v})=>v),riskConfig:t,preset:x,saveAsTemplate:S?.saveAsTemplate,...r?{strategy_id:Number(i)}:{}},T=await q.saveStrategy(O);T.status==="success"?(w.success(r?"Strategy updated":"Strategy saved successfully"),s("/strategy/hub")):w.error(T.message||"Failed to save strategy")}catch{w.error("Failed to save strategy")}finally{F(!1)}};return K?e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading strategy..."})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold mb-1",children:r?"Edit Strategy":"Strategy Builder"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?"Modify your F&O multi-leg strategy":"Build F&O multi-leg strategies with a visual wizard"})]}),e.jsx(xe,{currentStep:c,onStepClick:n}),e.jsx(C,{children:e.jsxs(k,{className:"p-6",children:[c==="basics"&&e.jsx(ue,{basics:a,onChange:h,onNext:()=>n("legs")}),c==="legs"&&e.jsx(ge,{legs:o,onChange:_,onPresetSelect:N,onBack:()=>n("basics"),onNext:()=>n("risk")}),c==="risk"&&e.jsx(_e,{config:t,onChange:l,onBack:()=>n("legs"),onNext:()=>n("review")}),c==="review"&&e.jsx(fe,{basics:a,legs:o,riskConfig:t,preset:x,saving:G,onBack:()=>n("risk"),onSave:X})]})})]})}export{Oe as default};
