import{r as l,j as e}from"./vendor-react-z89-0JOV.js";import{t as M}from"./trading-4Er4FhJi.js";import{d as z,o as Q,e as T,B as E,c as m,s as o}from"./index-D9lSGb1y.js";import{C as j,b as f,d as g,c as N,a as q}from"./card-CGsXnnkV.js";import{T as O,a as U,b as L,c as d,d as K,e as r,f as G}from"./table-BiJp7pqq.js";import{u as J,c as W,a as X}from"./useOrderEventRefresh-DDRGA3Yq.js";import{V as Y,R as Z,q as ee,c as H,_,L as se}from"./vendor-icons-CHYcgrp0.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-3k9vkKfj.js";import"./vendor-radix-CPYAX5SR.js";function h(c){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(c)}function S(c){return`${c>=0?"+":""}${c.toFixed(2)}%`}function me(){const{apiKey:c}=z(),[v,$]=l.useState([]),[u,D]=l.useState(null),[F,C]=l.useState(!0),[P,R]=l.useState(!1),[I,b]=l.useState(null),{data:p,isLive:y}=J(v,{enabled:v.length>0,useMultiQuotesFallback:!0,staleThreshold:5e3,multiQuotesRefreshInterval:3e4}),t=l.useMemo(()=>!u||!p.some(a=>a._dataSource!=="rest")?u:W(p,u),[u,p]),x=l.useCallback(async(s=!1)=>{if(!c){C(!1);return}s&&R(!0);try{const a=await M.getHoldings(c);a.status==="success"&&a.data?($(a.data.holdings||[]),D(a.data.statistics),b(null)):b(a.message||"Failed to fetch holdings")}catch{b("Failed to fetch holdings")}finally{C(!1),R(!1)}},[c]);l.useEffect(()=>{x();const a=setInterval(()=>x(),y?3e4:1e4);return()=>clearInterval(a)},[x,y]),l.useEffect(()=>{const s=Q(()=>{x()});return()=>s()},[x]),X(x,{events:["order_event","analyzer_update"],delay:500});const k=()=>{const s=["Symbol","Exchange","Quantity","Avg Price","LTP","Product","P&L","P&L %"],a=p.map(n=>[o(n.symbol),o(n.exchange),o(n.quantity),o(n.average_price),o(n.ltp),o(n.product),o(n.pnl),o(n.pnlpercent)]),A=[s,...a].map(n=>n.join(",")).join(`
`),V=new Blob([A],{type:"text/csv"}),B=URL.createObjectURL(V),w=document.createElement("a");w.href=B,w.download=`holdings_${new Date().toISOString().split("T")[0]}.csv`,w.click()},i=s=>s>=0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Investor Summary"}),y&&e.jsxs(T,{variant:"outline",className:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30 gap-1",children:[e.jsx(Y,{className:"h-3 w-3 animate-pulse"}),"Live"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"View your holdings portfolio"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>x(!0),disabled:P,children:[e.jsx(Z,{className:m("h-4 w-4 mr-2",P&&"animate-spin")}),"Refresh"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:k,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total Holding Value"}),e.jsx(N,{className:"text-2xl text-primary",children:t?h(t.totalholdingvalue):"---"})]})}),e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total Investment Value"}),e.jsx(N,{className:"text-2xl",children:t?h(t.totalinvvalue):"---"})]})}),e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total Profit and Loss"}),e.jsx(N,{className:m("text-2xl",t&&i(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?e.jsxs("div",{className:"flex items-center gap-1",children:[i(t.totalprofitandloss)?e.jsx(H,{className:"h-5 w-5"}):e.jsx(_,{className:"h-5 w-5"}),h(t.totalprofitandloss)]}):"---"})]})}),e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total PnL Percentage"}),e.jsx(N,{className:m("text-2xl",t&&i(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?S(t.totalpnlpercentage):"---"})]})})]}),e.jsx(j,{children:e.jsx(q,{className:"p-0",children:F?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(se,{className:"h-8 w-8 animate-spin"})}):I?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:I}):v.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No holdings found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(O,{children:[e.jsx(U,{children:e.jsxs(L,{children:[e.jsx(d,{children:"Trading Symbol"}),e.jsx(d,{children:"Exchange"}),e.jsx(d,{className:"text-right",children:"Quantity"}),e.jsx(d,{className:"text-right",children:"Avg Price"}),e.jsx(d,{className:"text-right",children:"LTP"}),e.jsx(d,{children:"Product"}),e.jsx(d,{className:"text-right",children:"Profit and Loss"}),e.jsx(d,{className:"text-right",children:"PnL %"})]})}),e.jsx(K,{children:p.map((s,a)=>e.jsxs(L,{children:[e.jsx(r,{className:"font-medium",children:s.symbol}),e.jsx(r,{children:e.jsx(T,{variant:"outline",children:s.exchange})}),e.jsx(r,{className:"text-right font-mono",children:s.quantity}),e.jsx(r,{className:"text-right font-mono",children:s.average_price!==void 0?h(s.average_price):"-"}),e.jsx(r,{className:"text-right font-mono",children:s.ltp!==void 0?h(s.ltp):"-"}),e.jsx(r,{children:e.jsx(T,{variant:"secondary",children:s.product})}),e.jsx(r,{className:m("text-right font-medium",i(s.pnl)?"text-green-600":"text-red-600"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i(s.pnl)?e.jsx(H,{className:"h-4 w-4"}):e.jsx(_,{className:"h-4 w-4"}),h(s.pnl)]})}),e.jsx(r,{className:m("text-right",i(s.pnlpercent)?"text-green-600":"text-red-600"),children:S(s.pnlpercent)})]},`${s.symbol}-${s.exchange}-${a}`))}),e.jsx(G,{children:e.jsxs(L,{className:"bg-muted/50",children:[e.jsx(r,{colSpan:6,className:"text-right text-muted-foreground",children:"Total P&L:"}),e.jsx(r,{className:m("text-right font-bold",t&&i(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?`${t.totalprofitandloss>=0?"+":""}${h(t.totalprofitandloss)}`:"-"}),e.jsx(r,{className:m("text-right font-bold",t&&i(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?S(t.totalpnlpercentage):"-"})]})})]})})})})]})}export{me as default};
