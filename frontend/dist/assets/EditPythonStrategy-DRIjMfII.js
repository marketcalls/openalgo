import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{B as o,e as S,D as G,j as J,k as Q,m as R,t as x}from"./index-BMUK8JJ8.js";import{p as v}from"./python-strategy-mP7VTMvV.js";import{A as X,a as Z}from"./alert-380FdS3y.js";import{C as K,b as A,c as B,a as I}from"./card-LW4Ab5PL.js";import{S as C}from"./skeleton-DIsx6ZPx.js";import{k as M,l as U,aA as ee,af as _,A as se,ax as te,aB as ae,D as ne,ae as re,T as ie}from"./vendor-icons-Vls1I20C.js";import{c as le,a as oe,L as ce}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-radix-hRiDuY7W.js";function ve(){const{strategyId:c}=le(),$=oe(),[h,O]=r.useState(null),[u,P]=r.useState(null),[a,g]=r.useState(""),[N,k]=r.useState(""),[V,D]=r.useState(!0),[p,E]=r.useState(!1),[d,F]=r.useState(()=>localStorage.getItem("editor-theme")==="dark"),[f,y]=r.useState(!1),l=a!==N,n=h?.status==="running",W=async()=>{if(c)try{D(!0);const[t,s]=await Promise.all([v.getStrategy(c),v.getStrategyContent(c)]);O(t),P(s),g(s.content),k(s.content)}catch(t){console.error("Failed to fetch strategy:",t),x.error("Failed to load strategy"),$("/python")}finally{D(!1)}};r.useEffect(()=>{W()},[]),r.useEffect(()=>{localStorage.setItem("editor-theme",d?"dark":"light")},[d]),r.useEffect(()=>{const t=s=>{(s.ctrlKey||s.metaKey)&&s.key==="s"&&(s.preventDefault(),l&&!n&&b()),s.key==="F11"&&(s.preventDefault(),y(i=>!i)),s.key==="Escape"&&f&&y(!1)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[l,n,f]);const b=async()=>{if(!(!c||!l||n))try{E(!0);const t=await v.saveStrategy(c,a);t.status==="success"?(k(a),x.success("Strategy saved")):x.error(t.message||"Failed to save strategy")}catch(t){console.error("Failed to save strategy:",t),x.error("Failed to save strategy")}finally{E(!1)}},H=()=>{g(N),x.info("Changes discarded")},T=async t=>{if(!(!c||!h))try{const s=await v.exportStrategy(c,t),i=URL.createObjectURL(s),m=document.createElement("a");m.href=i,m.download=h.file_name,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(i),x.success("Strategy exported")}catch(s){console.error("Failed to export strategy:",s),x.error("Failed to export strategy")}},Y=r.useCallback(t=>{if(t.key==="Tab"){t.preventDefault();const s=t.target,i=s.selectionStart,m=s.selectionEnd;if(t.shiftKey){const j=a.substring(0,i).lastIndexOf(`
`)+1,L=a.substring(j,i);if(L.startsWith("    ")){const w=a.substring(0,j)+a.substring(j+4);g(w),setTimeout(()=>{s.selectionStart=s.selectionEnd=i-4},0)}else if(L.startsWith("	")){const w=a.substring(0,j)+a.substring(j+1);g(w),setTimeout(()=>{s.selectionStart=s.selectionEnd=i-1},0)}}else{const z=`${a.substring(0,i)}    ${a.substring(m)}`;g(z),setTimeout(()=>{s.selectionStart=s.selectionEnd=i+4},0)}}},[a]);if(V)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(C,{className:"h-8 w-32"}),e.jsx(C,{className:"h-12"}),e.jsx(C,{className:"h-[600px]"})]});if(!h||!u)return null;const q=e.jsxs("div",{className:`relative ${f?"fixed inset-0 z-50 bg-background p-4":""}`,children:[f&&e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:h.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>F(!d),children:d?e.jsx(M,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>y(!1),children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsxs(o,{size:"sm",onClick:b,disabled:!l||p||n,className:l&&!n?"animate-pulse":"",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),p?"Saving...":"Save"]})]})]}),e.jsx("textarea",{value:a,onChange:t=>g(t.target.value),onKeyDown:Y,readOnly:n,className:`w-full font-mono text-sm p-4 rounded-lg border focus:outline-none focus:ring-2 focus:ring-primary resize-none ${d?"bg-gray-900 text-gray-100 border-gray-700":"bg-white text-gray-900 border-gray-300"} ${f?"h-[calc(100vh-120px)]":"min-h-[600px]"} ${n?"opacity-75 cursor-not-allowed":""}`,spellCheck:!1,placeholder:"# Your Python strategy code here..."}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Lines: ",a.split(`
`).length," • Size: ",(new Blob([a]).size/1024).toFixed(2)," KB"]}),e.jsx("span",{children:l?e.jsx(S,{variant:"outline",className:"text-yellow-500 border-yellow-500",children:"Unsaved Changes"}):e.jsx(S,{variant:"outline",className:"text-green-500 border-green-500",children:"Saved"})})]})]});return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(o,{variant:"ghost",asChild:!0,children:e.jsxs(ce,{to:"/python",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[n?"View":"Edit"," Strategy",n&&e.jsx(S,{className:"bg-green-500",children:"Running"})]}),e.jsxs("p",{className:"text-muted-foreground flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),h.name," • ",u.file_name]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>F(!d),children:d?e.jsx(M,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>y(!0),children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsxs(G,{children:[e.jsx(J,{asChild:!0,children:e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Export"]})}),e.jsxs(Q,{children:[e.jsx(R,{onClick:()=>T("saved"),children:"Saved Version"}),e.jsx(R,{onClick:()=>T("current"),children:"Current Content"})]})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:H,disabled:!l,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Reset"]}),e.jsxs(o,{size:"sm",onClick:b,disabled:!l||p||n,className:l&&!n?"animate-pulse":"",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),p?"Saving...":"Save"]})]})]}),n&&e.jsxs(X,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(Z,{children:"This strategy is currently running. The editor is in read-only mode. Stop the strategy to make changes."})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["File: ",u.file_name]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[u.line_count," lines"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[u.size_kb.toFixed(2)," KB"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:["Last modified: ",new Date(u.last_modified).toLocaleString()]})]}),e.jsxs(K,{children:[e.jsx(A,{className:"pb-2",children:e.jsxs(B,{className:"text-sm flex items-center justify-between",children:[e.jsx("span",{children:"Code Editor"}),e.jsx("span",{className:"font-normal text-xs text-muted-foreground",children:"Ctrl+S to save • F11 for fullscreen • Tab to indent"})]})}),e.jsx(I,{children:q})]}),e.jsxs(K,{children:[e.jsx(A,{className:"pb-2",children:e.jsx(B,{className:"text-sm",children:"Keyboard Shortcuts"})}),e.jsx(I,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-muted rounded",children:"Ctrl+S"})," Save"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-muted rounded",children:"Tab"})," Indent"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-muted rounded",children:"Shift+Tab"})," Unindent"]}),e.jsxs("div",{children:[e.jsx("kbd",{className:"px-2 py-1 bg-muted rounded",children:"F11"})," Fullscreen"]})]})})]})]})}export{ve as default};
