import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{u as P,B as j,e as W,t as b}from"./index-D0KgzChK.js";import{p as y}from"./python-strategy-ZSI3yJCK.js";import{C as T,b as E,c as k,d as O,a as B}from"./card-BrwfyFQc.js";import{C as _}from"./checkbox-BNWMUo0z.js";import{D as G,b as K,c as U,d as V,e as $,f as q}from"./dialog-avE8wTtf.js";import{L as J}from"./label-CssRL0AH.js";import{S as Q,E as M,R as X,d as Y,t as m}from"./index-C_7DtrgT.js";import{S as Z}from"./scroll-area-BlmhDX90.js";import{S as A}from"./skeleton-Dn21qlXv.js";import{A as ee,R as I,ac as te,F as se,P as re,aw as ae,aO as ne}from"./vendor-icons-D08EYFn4.js";import{d as le,L as oe}from"./vendor-router-D7kKkCmL.js";import"./vendor-radix-Cue1hf3Z.js";const ce=Q.define({token(t){return t.match(/ERROR|error|Error|CRITICAL|critical|FATAL|fatal/)?"invalid":t.match(/WARNING|warning|Warning|WARN|warn/)?"keyword":t.match(/SUCCESS|success|Success/)?"string":t.match(/INFO|info|Info/)?"comment":t.match(/DEBUG|debug|Debug/)?"meta":t.match(/\d{4}-\d{2}-\d{2}[\sT]\d{2}:\d{2}:\d{2}/)||t.match(/\d{2}:\d{2}:\d{2}/)?"number":(t.next(),null)}}),ie=t=>Y({theme:t?"dark":"light",settings:{background:t?"#111827":"#f8fafc",foreground:t?"#d1d5db":"#334155",caret:t?"#38bdf8":"#0284c7",selection:t?"rgba(56, 189, 248, 0.2)":"rgba(2, 132, 199, 0.2)",selectionMatch:t?"rgba(56, 189, 248, 0.1)":"rgba(2, 132, 199, 0.1)",lineHighlight:t?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)",gutterBackground:"transparent",gutterForeground:t?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",gutterBorder:"transparent"},styles:[{tag:m.invalid,color:t?"#f87171":"#dc2626",fontWeight:"bold"},{tag:m.keyword,color:t?"#fbbf24":"#d97706"},{tag:m.string,color:t?"#34d399":"#059669"},{tag:m.comment,color:t?"#60a5fa":"#2563eb"},{tag:m.meta,color:t?"#9ca3af":"#64748b"},{tag:m.number,color:t?"#22d3ee":"#0891b2"}]}),de=t=>{const l=t?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",f=t?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)";return M.theme({"&":{fontSize:"12px",fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace',height:"100%",backgroundColor:t?"#111827":"#f8fafc"},"&.cm-editor":{height:"100%"},".cm-scroller":{overflow:"auto",height:"100%"},".cm-content":{padding:"12px 0",lineHeight:"20px"},".cm-line":{padding:"0 12px"},".cm-gutters":{backgroundColor:f,borderRight:`1px solid ${l}`,paddingRight:"4px"},".cm-gutter":{minWidth:"48px"},".cm-gutterElement":{padding:"0 8px 0 12px",lineHeight:"20px"},"&.cm-focused":{outline:"none"},".cm-activeLine":{backgroundColor:t?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"},".cm-activeLineGutter":{backgroundColor:t?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.03)"}})};function ge({value:t,className:l="",height:f="500px",followTail:g=!1}){const{mode:C,appMode:n}=P(),d=C==="dark"||n==="analyzer",o=r.useRef(null),h=r.useRef(0),x=r.useRef(!1),p=r.useRef(t),S=r.useMemo(()=>[ce,ie(d),de(d),M.lineWrapping,M.editable.of(!1)],[d]),u=r.useCallback(()=>{const c=o.current?.view;if(c){const a=c.scrollDOM;h.current=a.scrollTop;const L=a.scrollHeight-a.scrollTop-a.clientHeight<50;x.current=!L}},[]);return r.useEffect(()=>{const c=o.current?.view;if(!c)return;const a=c.scrollDOM;return a.addEventListener("scroll",u),()=>{a.removeEventListener("scroll",u)}},[u]),r.useEffect(()=>{t!==p.current&&(p.current=t,requestAnimationFrame(()=>{const c=o.current?.view;if(!c)return;const a=c.scrollDOM;g&&!x.current?a.scrollTop=a.scrollHeight:x.current&&(a.scrollTop=h.current)}))},[t,g]),e.jsx("div",{className:`rounded-lg overflow-hidden ${l}`,children:e.jsx(X,{ref:o,value:t,extensions:S,readOnly:!0,height:f,theme:d?"dark":"light",basicSetup:{lineNumbers:!0,highlightActiveLineGutter:!0,highlightActiveLine:!0,foldGutter:!1,dropCursor:!1,allowMultipleSelections:!1,indentOnInput:!1,bracketMatching:!1,closeBrackets:!1,autocompletion:!1,rectangularSelection:!1,crosshairCursor:!1,highlightSelectionMatches:!0,searchKeymap:!0,tabSize:2}})})}function Le(){const{strategyId:t}=le(),[l,f]=r.useState(null),[g,C]=r.useState([]),[n,d]=r.useState(null),[o,h]=r.useState(null),[x,p]=r.useState(!0),[S,u]=r.useState(!1),[c,a]=r.useState(!1),[L,N]=r.useState(!1),[v,w]=r.useState(!0),D=async()=>{if(t)try{p(!0);const[s,i]=await Promise.all([y.getStrategy(t),y.getLogFiles(t)]);f(s),C(i),i.length>0&&!n&&d(i[0].name)}catch(s){console.error("Failed to fetch data:",s),b.error("Failed to load logs")}finally{p(!1)}},R=async(s,i=!0)=>{if(t)try{i&&u(!0);const F=await y.getLogContent(t,s);h(F)}catch(F){console.error("Failed to fetch log content:",F),i&&b.error("Failed to load log content")}finally{i&&u(!1)}};r.useEffect(()=>{D()},[]),r.useEffect(()=>{n&&R(n)},[n]),r.useEffect(()=>{if(l?.status==="running"&&n&&v){const s=setInterval(()=>{R(n,!1)},3e3);return()=>clearInterval(s)}},[l?.status,n,v]);const H=async()=>{if(t)try{w(!1),a(!0);const s=await y.clearLogs(t);s.status==="success"?(b.success("Logs cleared"),C([]),d(null),h(null)):b.error(s.message||"Failed to clear logs")}catch(s){console.error("Failed to clear logs:",s),b.error("Failed to clear logs")}finally{a(!1),N(!1),w(!0)}},z=s=>{const i=s.split("_");return i.length>1?i.slice(1).join("_").replace(".log",""):s.replace(".log","")};return x?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(A,{className:"h-8 w-32"}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsx(A,{className:"h-[600px]"}),e.jsx(A,{className:"h-[600px] col-span-3"})]})]}):l?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(j,{variant:"ghost",asChild:!0,children:e.jsxs(oe,{to:"/python",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Strategy Logs"}),e.jsx("p",{className:"text-muted-foreground",children:l.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{id:"auto-refresh",checked:v,onCheckedChange:s=>w(s)}),e.jsx(J,{htmlFor:"auto-refresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>n&&R(n),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>N(!0),disabled:g.length===0,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(T,{className:"lg:col-span-1",children:[e.jsxs(E,{children:[e.jsxs(k,{className:"text-sm flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Log Files"]}),e.jsxs(O,{children:[g.length," file(s)"]})]}),e.jsx(B,{children:g.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No log files found"}):e.jsx(Z,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2",children:g.map(s=>e.jsxs("button",{onClick:()=>d(s.name),className:`w-full text-left p-3 rounded-lg transition-colors ${n===s.name?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:z(s.name)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(re,{className:"h-3 w-3"}),new Date(s.last_modified).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(ae,{className:"h-3 w-3"}),s.size_kb.toFixed(2)," KB"]})]},s.name))})})})]}),e.jsxs(T,{className:"lg:col-span-3",children:[e.jsxs(E,{children:[e.jsxs(k,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Log Content"]}),l.status==="running"&&e.jsx(W,{className:"bg-green-500 animate-pulse",children:"Live"})]}),o&&e.jsxs(O,{children:[o.lines," lines • ",o.size_kb.toFixed(2)," KB • Last updated:"," ",new Date(o.last_updated).toLocaleString()]})]}),e.jsx(B,{children:n?S?e.jsx("div",{className:"flex items-center justify-center h-[500px]",children:e.jsx(I,{className:"h-6 w-6 animate-spin"})}):o?e.jsx(ge,{value:o.content,height:"500px",followTail:l?.status==="running"&&v}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"No content available"}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"Select a log file to view its contents"})})]})]}),e.jsx(G,{open:L,onOpenChange:N,children:e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx(V,{children:"Clear All Logs"}),e.jsxs($,{children:['Are you sure you want to clear all log files for "',l.name,'"? This action cannot be undone.']})]}),e.jsxs(q,{children:[e.jsx(j,{variant:"outline",onClick:()=>N(!1),children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:H,disabled:c,children:c?"Clearing...":"Clear All Logs"})]})]})})]}):null}export{Le as default};
