import{u as h}from"./useQuery-v_5DZ0OA.js";import{r as o}from"./vendor-react-Df-MYEHc.js";import{d as g}from"./strategy-dashboard-BdMkqh6u.js";async function k(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}function _(){const[s,c]=o.useState({timings:[],holidays:[],isLoading:!0,error:null});o.useEffect(()=>{(async()=>{try{const e={"X-CSRFToken":await k(),"Content-Type":"application/json"},[n,i]=await Promise.all([fetch("/admin/api/timings",{headers:e,credentials:"include"}),fetch("/admin/api/holidays",{headers:e,credentials:"include"})]),u=await n.json(),d=await i.json();c({timings:u.status==="success"?u.market_status||[]:[],holidays:d.status==="success"?d.data||[]:[],isLoading:!1,error:null})}catch(t){c(e=>({...e,isLoading:!1,error:`Failed to fetch market status: ${t}`}))}})()},[]);const r=o.useCallback(a=>{const t=new Date().toISOString().split("T")[0],e=s.holidays.find(n=>n.date===t);if(!e)return!1;if(e.closed_exchanges.includes(a)){const n=e.open_exchanges.find(i=>i.exchange===a);if(n){const i=Date.now();return!(i>=n.start_time&&i<=n.end_time)}return!0}return!1},[s.holidays]),l=o.useCallback(a=>{if(r(a))return!1;const t=s.timings.find(n=>n.exchange===a);if(!t)return!1;const e=Date.now();return e>=t.start_time&&e<=t.end_time},[s.timings,r]),f=o.useCallback(()=>s.timings.some(a=>{const t=Date.now();return t>=a.start_time&&t<=a.end_time&&!r(a.exchange)}),[s.timings,r]),m=o.useCallback(a=>{if(r(a))return"closed";const t=s.timings.find(i=>i.exchange===a);if(!t)return"closed";const e=Date.now(),n=900*1e3;return e<t.start_time-n?"closed":e<t.start_time?"pre-market":e<=t.end_time?"open":"post-market"},[s.timings,r]);return{isMarketOpen:l,isAnyMarketOpen:f,isHolidayForExchange:r,getMarketStatus:m,timings:s.timings,holidays:s.holidays,isLoading:s.isLoading,error:s.error}}function S(){return h({queryKey:["dashboard-market-status"],queryFn:()=>g.getMarketStatus(),refetchInterval:6e4,staleTime:3e4})}export{S as a,_ as u};
