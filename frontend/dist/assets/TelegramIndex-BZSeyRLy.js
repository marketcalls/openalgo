import{r as n,j as e}from"./vendor-react-CCyQGCED.js";import{w as m,s as a,B as x,e as N}from"./index-D0023jFM.js";import{A as X,b as Z,c as ee,d as se,e as ae,f as te,g as re,h as ne}from"./alert-dialog-BDgJ3H--.js";import{C as i,a as c,b as u,c as y,d as o}from"./card-CDguRyHx.js";import{T as le,a as ie,b as P,c as w,d as ce,e as v}from"./table-BKP8E0nV.js";import{T as oe}from"./textarea-Cdbakixx.js";import{M as de,bj as me,aY as xe,k as R,bk as ge,a9 as C,ax as he,i as ue,ag as H,B as je,a0 as fe}from"./vendor-icons-CCn_k3dF.js";import{L as j}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function Te(){const[l,O]=n.useState(null),[$,Y]=n.useState(!0),[S,B]=n.useState(!1),[_,T]=n.useState(!1),[A,D]=n.useState(!1),[g,F]=n.useState(""),[q,f]=n.useState(!1),[k,M]=n.useState(!1);n.useEffect(()=>{p()},[]);const p=async()=>{try{const s=await m.get("/telegram/api/index");O(s.data.data)}catch{a.error("Failed to load Telegram data","telegram")}finally{Y(!1)}},z=async()=>{B(!0);try{const s=await m.post("/telegram/bot/start");s.data.status==="success"?(a.success(s.data.message||"Bot started successfully","telegram"),p()):a.error(s.data.message||"Failed to start bot","telegram")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to start bot","telegram")}finally{B(!1)}},V=async()=>{T(!0);try{const s=await m.post("/telegram/bot/stop");s.data.status==="success"?(a.success(s.data.message||"Bot stopped successfully","telegram"),p()):a.error(s.data.message||"Failed to stop bot","telegram")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to stop bot","telegram")}finally{T(!1)}},G=async()=>{D(!0);try{const s=await m.post("/telegram/test-message");s.data.status==="success"?a.success(s.data.message||"Test message sent","telegram"):a.error(s.data.message||"Failed to send test message","telegram")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to send test message","telegram")}finally{D(!1)}},J=async()=>{if(!g.trim()){a.error("Please enter a message to broadcast","telegram");return}f(!0)},K=async()=>{f(!1),M(!0);try{const s=await m.post("/telegram/broadcast",{message:g});s.data.status==="success"?(a.success(s.data.message||"Broadcast sent successfully","telegram"),F("")):a.error(s.data.message||"Failed to send broadcast","telegram")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to send broadcast","telegram")}finally{M(!1)}};if($)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!l)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("p",{className:"text-muted-foreground",children:"Failed to load Telegram data"})});const{bot_status:r,config:d,users:I=[],stats:L=[]}=l,b=Array.isArray(I)?I:[],h=Array.isArray(L)?L:[],E=b.filter(s=>s.notifications_enabled).length;return e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(de,{className:"h-6 w-6"}),"Telegram Bot"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your Telegram bot for trade notifications"})]}),e.jsxs("div",{className:"flex gap-2",children:[r.is_running?e.jsxs(x,{variant:"destructive",onClick:V,disabled:_,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),_?"Stopping...":"Stop Bot"]}):e.jsxs(x,{onClick:z,disabled:S||!r.is_configured,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),S?"Starting...":"Start Bot"]}),e.jsx(j,{to:"/telegram/config",children:e.jsxs(x,{variant:"outline",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Configuration"]})})]})]}),e.jsxs(i,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${r.is_running?"bg-green-500":"bg-gray-400"}`,children:e.jsx(ge,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx(u,{children:d.bot_username?`@${d.bot_username}`:"Bot Not Configured"}),e.jsx(y,{children:r.is_running?"Bot is running":"Bot is stopped"})]})]}),e.jsx(N,{variant:r.is_running?"default":"secondary",className:r.is_running?"bg-green-500 hover:bg-green-600":"",children:r.is_running?"Online":"Offline"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:b.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:E}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Users"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.reduce((s,t)=>s+t.count,0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commands (7d)"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:d.rate_limit_per_minute}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rate Limit/min"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(j,{to:"/telegram/config",children:e.jsxs(i,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer group",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center",children:e.jsx(R,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-semibold group-hover:text-primary transition-colors flex items-center gap-2",children:["Configuration",e.jsx(C,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure bot settings"})]})]})}),e.jsx(j,{to:"/telegram/users",children:e.jsxs(i,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer group",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-500 flex items-center justify-center",children:e.jsx(he,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-semibold group-hover:text-primary transition-colors flex items-center gap-2",children:["Users",e.jsx(C,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage linked users"})]})]})}),e.jsx(j,{to:"/telegram/analytics",children:e.jsxs(i,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer group",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center",children:e.jsx(ue,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-semibold group-hover:text-primary transition-colors flex items-center gap-2",children:["Analytics",e.jsx(C,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View usage statistics"})]})]})}),e.jsxs(i,{className:"h-full",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center",children:e.jsx(H,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsx("h3",{className:"font-semibold",children:"Test Message"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Send a test notification"}),e.jsx(x,{size:"sm",variant:"outline",onClick:G,disabled:A||!r.is_running,children:A?"Sending...":"Send Test"})]})]})]}),l.telegram_user&&e.jsxs(i,{children:[e.jsx(c,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Your Telegram Link"]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["@",l.telegram_user.telegram_username||l.telegram_user.first_name]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Notifications: ",l.telegram_user.notifications_enabled?"Enabled":"Disabled"]})]}),e.jsx(N,{variant:l.telegram_user.notifications_enabled?"default":"secondary",children:l.telegram_user.notifications_enabled?"Active":"Inactive"})]})})]}),h.length>0&&e.jsxs(i,{children:[e.jsxs(c,{children:[e.jsx(u,{children:"Popular Commands (Last 7 Days)"}),e.jsx(y,{children:"Most used bot commands"})]}),e.jsx(o,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(P,{children:[e.jsx(w,{children:"Command"}),e.jsx(w,{children:"Count"}),e.jsx(w,{children:"Percentage"})]})}),e.jsx(ce,{children:h.map(s=>{const t=h.reduce((Q,W)=>Q+W.count,0),U=t>0?s.count/t*100:0;return e.jsxs(P,{children:[e.jsx(v,{children:e.jsxs(N,{variant:"outline",children:["/",s.command]})}),e.jsx(v,{children:s.count}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${U}%`}})}),e.jsxs("span",{className:"text-sm text-muted-foreground w-12",children:[U.toFixed(1),"%"]})]})})]},s.command)})})]})})})]}),e.jsxs(i,{children:[e.jsxs(c,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Broadcast Message"]}),e.jsx(y,{children:"Send a message to all users"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsx(oe,{placeholder:"Enter your message here...",value:g,onChange:s=>F(s.target.value),rows:4}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{onClick:J,disabled:k||!r.is_running||!d.broadcast_enabled,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),k?"Broadcasting...":"Send Broadcast"]})}),!d.broadcast_enabled&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Broadcast is disabled. Enable it in Configuration."})]})]}),e.jsx(X,{open:q,onOpenChange:f,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Confirm Broadcast"}),e.jsx(ae,{children:"Are you sure you want to send this message to all users?"})]}),e.jsx("div",{className:"bg-muted p-3 rounded-lg my-4",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:g})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["This will be sent to ",E," active users (",b.length," total users)"]}),e.jsxs(te,{children:[e.jsx(re,{children:"Cancel"}),e.jsx(ne,{onClick:K,children:"Send Broadcast"})]})]})})]})}export{Te as default};
