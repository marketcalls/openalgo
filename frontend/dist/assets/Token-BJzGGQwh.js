import{r as a,j as e}from"./vendor-react-CCyQGCED.js";import{A as Z,b as ee,a as se}from"./alert-Dlgyh2fF.js";import{B as ae}from"./index-D0023jFM.js";import{C as te,d as re}from"./card-CDguRyHx.js";import{I as k}from"./input-D8_g_dg9.js";import{L as h}from"./label-BgxgrBuS.js";import{S as $,a as P,b as q,c as z,d as g}from"./select-DXT-lI-N.js";import{S as V,I as ne}from"./vendor-icons-CCn_k3dF.js";import{a as le}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const ie=[{value:"NSE",label:"NSE - National Stock Exchange"},{value:"NFO",label:"NFO - NSE Futures & Options"},{value:"BSE",label:"BSE - Bombay Stock Exchange"},{value:"BFO",label:"BFO - BSE Futures & Options"},{value:"CDS",label:"CDS - Currency Derivatives"},{value:"MCX",label:"MCX - Multi Commodity Exchange"},{value:"NSE_INDEX",label:"NSE_INDEX - National Stock Exchange Index"},{value:"BSE_INDEX",label:"BSE_INDEX - Bombay Stock Exchange Index"}],ce=["NFO","BFO","MCX","CDS"];function be(){const G=le(),[c,C]=a.useState(""),[l,w]=a.useState(""),[i,F]=a.useState(""),[o,I]=a.useState(""),[m,R]=a.useState(""),[x,A]=a.useState(""),[p,O]=a.useState(""),[H,T]=a.useState([]),[W,j]=a.useState([]),[y,b]=a.useState([]),[B,f]=a.useState(!1),[D,L]=a.useState(!1),[Y,_]=a.useState(!1),[M,N]=a.useState(""),v=a.useRef(null),S=a.useRef(0),n=ce.includes(l),u=i||m||o||x||p,U=a.useCallback(()=>{F(""),I(""),R(""),A(""),O("")},[]);a.useEffect(()=>{if(!n){T([]),j([]),U();return}const s=++S.current;_(!0),(async()=>{try{const[r,E]=await Promise.all([fetch(`/search/api/underlyings?exchange=${l}`,{credentials:"include"}),fetch(`/search/api/expiries?exchange=${l}`,{credentials:"include"})]);if(s!==S.current)return;if(r.ok){const d=await r.json();d.status==="success"&&Array.isArray(d.underlyings)&&T(d.underlyings)}if(E.ok){const d=await E.json();d.status==="success"&&Array.isArray(d.expiries)&&j(d.expiries)}}catch{}finally{s===S.current&&_(!1)}})()},[l,n,U]),a.useEffect(()=>{if(!n||!i)return;(async()=>{try{const t=await fetch(`/search/api/expiries?exchange=${l}&underlying=${i}`,{credentials:"include"});if(t.ok){const r=await t.json();r.status==="success"&&Array.isArray(r.expiries)&&j(r.expiries)}}catch{}})()},[i,l,n]);const X=a.useCallback(async(s,t)=>{if(s.length<2&&!(n&&u)){b([]),f(!1);return}L(!0);try{const r=new URLSearchParams;s&&r.append("q",s),t&&r.append("exchange",t),i&&r.append("underlying",i),m&&r.append("expiry",m),o&&r.append("instrumenttype",o),x&&r.append("strike_min",x),p&&r.append("strike_max",p);const d=await(await fetch(`/search/api/search?${r}`,{credentials:"include"})).json();b((d.results||[]).slice(0,10)),f(!0)}catch{b([])}finally{L(!1)}},[i,m,o,x,p,n,u]);a.useEffect(()=>{const s=setTimeout(()=>{(c.length>=2||n&&u)&&X(c,l)},300);return()=>clearTimeout(s)},[c,l,X,u,n]),a.useEffect(()=>{const s=t=>{v.current&&!v.current.contains(t.target)&&f(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const J=s=>{if(s.preventDefault(),f(!1),N(""),!c&&!(n&&u)){N("Required - enter a search term");return}if(!l)return;const t=new URLSearchParams;c&&t.append("symbol",c),l&&t.append("exchange",l),i&&t.append("underlying",i),m&&t.append("expiry",m),o&&t.append("instrumenttype",o),x&&t.append("strike_min",x),p&&t.append("strike_max",p),G(`/search?${t.toString()}`)},K=s=>{C(s.symbol),w(s.exchange),f(!1)},Q=o==="CE"||o==="PE";return e.jsxs("div",{className:"max-w-4xl mx-auto py-8 px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold mb-4",children:"Symbol Search"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"Search for symbols across different exchanges to get detailed information"})]}),e.jsx(te,{className:"mb-6",children:e.jsx(re,{className:"p-6 lg:p-8",children:e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(h,{htmlFor:"symbol",children:"Symbol, Name, or Token"}),e.jsx("span",{className:`text-xs ${M?"text-red-500":n&&u?"text-green-600":"text-muted-foreground"}`,children:M||(n&&u?"(Optional with filters)":"(Required)")})]}),e.jsxs("div",{className:"relative",ref:v,children:[e.jsx(k,{id:"symbol",type:"text",placeholder:"e.g., nifty, RELIANCE, 2885",value:c,onChange:s=>{C(s.target.value),N("")},onFocus:()=>{(c.length>=2||n&&u)&&f(!0)},autoComplete:"off"}),D&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})}),B&&y.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-background border rounded-lg shadow-lg max-h-96 overflow-y-auto",children:y.map((s,t)=>e.jsx("div",{className:"p-3 border-b last:border-b-0 hover:bg-muted cursor-pointer",onClick:()=>K(s),children:e.jsxs("div",{className:"flex justify-between items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold truncate",children:s.symbol}),e.jsxs("div",{className:"text-sm text-muted-foreground truncate",children:[s.name,s.expiry&&` | ${s.expiry}`,s.strike&&s.strike>0&&` | Strike: ${s.strike}`]}),e.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["Token: ",s.token]})]}),e.jsx("span",{className:"shrink-0 bg-primary text-primary-foreground px-3 py-1 rounded-full text-xs font-semibold",children:s.exchange})]})},t))}),B&&y.length===0&&c.length>=2&&!D&&e.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-background border rounded-lg shadow-lg p-8 text-center",children:[e.jsx(V,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-3"}),e.jsx("div",{className:"font-medium",children:"No results found"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Try a different search term"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"exchange",children:"Exchange"}),e.jsxs($,{value:l,onValueChange:w,children:[e.jsx(P,{children:e.jsx(q,{placeholder:"Select Exchange"})}),e.jsx(z,{children:ie.map(s=>e.jsx(g,{value:s.value,children:s.label},s.value))})]})]}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsxs("span",{className:"bg-background px-2 text-muted-foreground flex items-center gap-2",children:["F&O Filters",Y&&e.jsx("span",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-primary"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Underlying"}),e.jsxs("select",{value:i,onChange:s=>F(s.target.value),className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("option",{value:"",children:"All Underlyings"}),(H||[]).map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Instrument Type"}),e.jsxs($,{value:o||"_all",onValueChange:s=>I(s==="_all"?"":s),children:[e.jsx(P,{children:e.jsx(q,{placeholder:"All Types"})}),e.jsxs(z,{children:[e.jsx(g,{value:"_all",children:"All Types"}),e.jsx(g,{value:"FUT",children:"Futures"}),e.jsx(g,{value:"CE",children:"Call Options (CE)"}),e.jsx(g,{value:"PE",children:"Put Options (PE)"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Expiry Date"}),e.jsxs("select",{value:m,onChange:s=>R(s.target.value),className:"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",children:[e.jsx("option",{value:"",children:"All Expiries"}),(W||[]).map(s=>e.jsx("option",{value:s,children:s},s))]})]}),Q&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Min Strike"}),e.jsx(k,{type:"number",placeholder:"e.g., 24000",value:x,onChange:s=>A(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Max Strike"}),e.jsx(k,{type:"number",placeholder:"e.g., 26000",value:p,onChange:s=>O(s.target.value)})]})]})]}),e.jsxs(ae,{type:"submit",className:"w-full",size:"lg",children:[e.jsx(V,{className:"mr-2 h-5 w-5"}),"Search Symbol"]})]})})}),e.jsxs(Z,{children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(ee,{children:"Search Tips"}),e.jsxs(se,{className:"space-y-3 mt-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Stock Search:"}),e.jsxs("ul",{className:"ml-2 space-y-0.5 text-sm",children:[e.jsxs("li",{children:["By symbol: ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"RELIANCE"}),","," ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"INFY"})]}),e.jsxs("li",{children:["By company name:"," ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"Reliance Industries"})]}),e.jsxs("li",{children:["By token number: ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"2885"})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-1",children:"Futures & Options:"}),e.jsxs("ul",{className:"ml-2 space-y-0.5 text-sm",children:[e.jsxs("li",{children:["Futures: ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"nifty oct fut"}),","," ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"banknifty dec fut"})]}),e.jsxs("li",{children:["Call Options: ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"nifty 25000 ce"})]}),e.jsxs("li",{children:["Put Options: ",e.jsx("code",{className:"bg-muted px-2 py-0.5 rounded",children:"nifty 24000 pe"})]})]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2",children:[e.jsx("strong",{children:"Tip:"})," Select the appropriate exchange (NFO for F&O, NSE for stocks) for accurate results"]})]})]})]})}export{be as default};
