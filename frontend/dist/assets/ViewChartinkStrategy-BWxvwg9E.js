import{r,j as e}from"./vendor-react--vsXx8_n.js";import{B as l,e as h,t as a}from"./index-BLx3quJX.js";import{c as x}from"./chartink-CpEePQ3Q.js";import{A as O,a as L,b as Q}from"./alert-IsXu7bgW.js";import{C as g,b as u,c as j,d as p,a as f}from"./card-BGX_OrRB.js";import{D as V,b as G,c as Y,d as J,e as K,f as X}from"./dialog-CfEewG_v.js";import{S as Z}from"./separator-CXYo5aXr.js";import{S as y}from"./skeleton-D8Jj6jzp.js";import{T as ee,a as se,b as H,c as n,d as te,e as c}from"./table-CmZZKNmG.js";import{A as ae,aQ as re,ag as I,P as ie,aO as le,t as ne,a3 as ce,I as oe,T as de,i as he}from"./vendor-icons-BPoFgeym.js";import{d as xe,a as me,L as N}from"./vendor-router-CclZ5Z6W.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DIebA-qg.js";function De(){const{strategyId:v}=xe(),b=me(),[s,C]=r.useState(null),[o,w]=r.useState([]),[U,S]=r.useState(!0),[k,_]=r.useState(!1),[D,T]=r.useState(!1),[B,d]=r.useState(!1),[R,F]=r.useState(null),[M,A]=r.useState(null),P=async()=>{if(v)try{S(!0);const t=await x.getStrategy(Number(v));C(t.strategy),w(t.mappings||[])}catch(t){console.error("Failed to fetch strategy:",t),a.error("Failed to load strategy"),b("/chartink")}finally{S(!1)}};r.useEffect(()=>{(async()=>{try{const m=await(await fetch("/api/config/host",{credentials:"include"})).json();A(m)}catch(i){console.error("Failed to fetch host config:",i),A({host_server:window.location.origin,is_localhost:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"})}})()},[]),r.useEffect(()=>{P()},[]);const $=async(t,i)=>{try{await navigator.clipboard.writeText(t),F(i),a.success("Copied to clipboard"),setTimeout(()=>F(null),2e3)}catch{a.error("Failed to copy")}},q=async()=>{if(s)try{_(!0);const t=await x.toggleStrategy(s.id);t.status==="success"?(C({...s,is_active:t.data?.is_active??!s.is_active}),a.success(t.data?.is_active?"Strategy activated":"Strategy deactivated")):a.error(t.message||"Failed to toggle strategy")}catch(t){console.error("Failed to toggle strategy:",t),a.error("Failed to toggle strategy")}finally{_(!1)}},W=async()=>{if(s)try{T(!0);const t=await x.deleteStrategy(s.id);t.status==="success"?(a.success("Strategy deleted successfully"),b("/chartink")):a.error(t.message||"Failed to delete strategy")}catch(t){console.error("Failed to delete strategy:",t),a.error("Failed to delete strategy")}finally{T(!1),d(!1)}},z=async t=>{if(s)try{const i=await x.deleteSymbolMapping(s.id,t);i.status==="success"?(w(o.filter(m=>m.id!==t)),a.success("Symbol mapping deleted")):a.error(i.message||"Failed to delete mapping")}catch(i){console.error("Failed to delete mapping:",i),a.error("Failed to delete mapping")}};if(U)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(y,{className:"h-8 w-32"}),e.jsx(y,{className:"h-48"}),e.jsx(y,{className:"h-64"})]});if(!s)return null;const E=`${M?.host_server||window.location.origin}/chartink/webhook/${s.webhook_id}`;return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(l,{variant:"ghost",asChild:!0,children:e.jsxs(N,{to:"/chartink",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Back to Chartink Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[s.name,e.jsx(h,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Chartink â€¢ Created ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:s.is_active?"outline":"default",onClick:q,disabled:k,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),k?"Updating...":s.is_active?"Deactivate":"Activate"]}),e.jsxs(l,{variant:"destructive",onClick:()=>d(!0),children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(g,{children:[e.jsxs(u,{children:[e.jsx(j,{children:"Strategy Details"}),e.jsx(p,{children:"Configuration and settings"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(h,{variant:s.is_active?"default":"secondary",className:"mt-1",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(h,{variant:"outline",className:"mt-1",children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exchanges"}),e.jsx("p",{className:"mt-1",children:"NSE, BSE only"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Products"}),e.jsx("p",{className:"mt-1",children:"MIS, CNC only"})]})]}),s.is_intraday&&s.start_time&&e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Trading Hours"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("p",{className:"font-mono",children:s.start_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("p",{className:"font-mono",children:s.end_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Square Off"}),e.jsx("p",{className:"font-mono",children:s.squareoff_time})]})]})]})]})]})]}),e.jsxs(g,{children:[e.jsxs(u,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"Webhook Configuration"]}),e.jsx(p,{children:"Use this URL in your Chartink screener"})]}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono break-all",children:E}),e.jsx(l,{variant:"outline",size:"icon",onClick:()=>$(E,"url"),children:R==="url"?e.jsx(ne,{className:"h-4 w-4 text-green-500"}):e.jsx(ce,{className:"h-4 w-4"})})]})]}),e.jsxs(O,{children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("p",{className:"font-medium mb-2",children:"Chartink Setup:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Go to your Chartink screener settings"}),e.jsx("li",{children:"Add this webhook URL"}),e.jsx("li",{children:"Include BUY/SELL/SHORT/COVER in alert name"}),e.jsx("li",{children:"Save and enable alerts"})]})]})]})]})]})]}),e.jsxs(O,{children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(Q,{children:"Important Notes"}),e.jsx(L,{children:e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsxs("li",{children:["Orders are processed only when the strategy is ",e.jsx("strong",{children:"active"})]}),s.is_intraday&&e.jsxs("li",{children:["Orders are processed only during trading hours (",s.start_time," -"," ",s.end_time,")"]}),e.jsx("li",{children:"Chartink symbol must be configured in the mappings below"}),e.jsx("li",{children:"Only NSE and BSE exchanges are supported"}),e.jsx("li",{children:"Only MIS and CNC product types are supported"})]})})]}),e.jsxs(g,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Symbol Mappings"}),e.jsxs(p,{children:["Chartink symbols configured for this strategy (",o.length," total)"]})]}),e.jsx(l,{asChild:!0,children:e.jsxs(N,{to:`/chartink/${s.id}/configure`,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Configure Symbols"]})})]}),e.jsx(f,{children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx(l,{variant:"link",asChild:!0,children:e.jsx(N,{to:`/chartink/${s.id}/configure`,children:"Add your first symbol"})})]}):e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(H,{children:[e.jsx(n,{children:"Chartink Symbol"}),e.jsx(n,{children:"Exchange"}),e.jsx(n,{className:"text-right",children:"Quantity"}),e.jsx(n,{children:"Product"}),e.jsx(n,{className:"w-16"})]})}),e.jsx(te,{children:o.map(t=>e.jsxs(H,{children:[e.jsx(c,{className:"font-medium",children:t.chartink_symbol}),e.jsx(c,{children:t.exchange}),e.jsx(c,{className:"text-right",children:t.quantity}),e.jsx(c,{children:e.jsx(h,{variant:"outline",children:t.product_type})}),e.jsx(c,{children:e.jsx(l,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>z(t.id),children:e.jsx(I,{className:"h-4 w-4"})})})]},t.id))})]})})]}),e.jsx(V,{open:B,onOpenChange:d,children:e.jsxs(G,{children:[e.jsxs(Y,{children:[e.jsx(J,{children:"Delete Strategy"}),e.jsxs(K,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All symbol mappings will also be deleted.']})]}),e.jsxs(X,{children:[e.jsx(l,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:W,disabled:D,children:D?"Deleting...":"Delete Strategy"})]})]})})]})}export{De as default};
