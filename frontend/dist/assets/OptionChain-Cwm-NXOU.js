import{r,j as e,a as He}from"./vendor-react-CCyQGCED.js";import{g as Ke,D as Ue,j as Be,B as z,k as Ve,A as je,C as _e,E as fe,n as Ce,G as Pe,c as _,e as qe,d as De,s as oe}from"./index-D0023jFM.js";import{a as Ae,u as Ge}from"./useMarketStatus-B5zaupYn.js";import{o as Oe}from"./oi-profile-Bf0_8E67.js";import{i as Je,a1 as Ze,ae as et,aT as tt,aU as st,Y as Le,c as at,aV as nt,m as rt,aB as lt,aD as it}from"./vendor-icons-CCn_k3dF.js";import{D as ze,a as ct,b as Ye,c as $e,d as Qe,e as ot,f as We,g as dt}from"./dialog-ZgnPSmJp.js";import{S as Te}from"./scroll-area-Di8UdHEU.js";import{I as Ne}from"./input-D8_g_dg9.js";import{L as ae}from"./label-BgxgrBuS.js";import{S as de,a as ue,b as me,c as xe,d as pe}from"./select-DXT-lI-N.js";import{t as Se}from"./trading-L0e-hk9o.js";import{C as ut,b as mt,a as xt}from"./collapsible-DcfHjv7p.js";import{C as ne,d as re}from"./card-CDguRyHx.js";import{P as pt,a as ht,b as ft,C as gt,c as bt,d as jt,e as yt,f as Nt,g as vt}from"./popover-BKWWulwW.js";import{T as Ct,a as St,b as we,c as le,d as wt,e as ve}from"./table-BKP8E0nV.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";function Dt(s,t,l,n,d,u={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:i,refreshInterval:b=3e4,pauseWhenHidden:v=!0}=u,{isVisible:C}=Ke(),[c,a]=r.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),x=r.useRef(null),h=r.useRef(null),f=i&&(!v||C),U=r.useCallback(async()=>{if(!(!s||!t||!l||!n)&&!h.current){a(L=>({...L,isLoading:!0}));try{const L=new AbortController;h.current=L;const j=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:l,expiry_date:n,strike_count:d}),signal:L.signal});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);const m=await j.json();m.status==="success"?a(S=>({...S,data:m,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):a(S=>({...S,isLoading:!1,error:m.message||"Failed to fetch option chain"}))}catch(L){L instanceof Error&&(L.name==="AbortError"?h.current===null&&a(j=>({...j,isLoading:!1})):a(j=>({...j,isLoading:!1,error:L.message||"Connection error",isConnected:!1})))}finally{h.current=null}}},[s,t,l,n,d]);r.useEffect(()=>{if(!f){x.current&&(clearInterval(x.current),x.current=null),a(L=>({...L,isPaused:!!i}));return}return a(L=>({...L,isConnected:!0,isPaused:!1})),U(),x.current=setInterval(U,b),()=>{x.current&&(clearInterval(x.current),x.current=null),h.current&&(h.current.abort(),h.current=null)}},[f,U,b,i]);const B=r.useCallback(()=>{U()},[U]);return{...c,refetch:B}}const kt=new Set(["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY","NIFTYNXT50","NIFTYIT","NIFTYPHARMA","NIFTYBANK"]),_t=new Set(["SENSEX","BANKEX","SENSEX50"]);function Ee(s,t){return kt.has(s)?"NSE_INDEX":_t.has(s)?"BSE_INDEX":t==="BFO"?"BSE":"NSE"}function ie(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function Pt(s,t,l,n,d,u,i={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:b,oiRefreshInterval:v=3e4,pauseWhenHidden:C=!0}=i,[c,a]=r.useState(null),[x,h]=r.useState(null),{data:f,isLoading:U,isConnected:B,isPaused:L,error:j,lastUpdate:m,refetch:S}=Dt(s,t,l,d,u,{enabled:b,refreshInterval:v,pauseWhenHidden:C}),w=r.useMemo(()=>{const N=[],A=Ee(t,n);if(N.push({symbol:t,exchange:A}),f?.chain)for(const $ of f.chain)$.ce?.symbol&&N.push({symbol:$.ce.symbol,exchange:n}),$.pe?.symbol&&N.push({symbol:$.pe.symbol,exchange:n});return N},[f?.chain,n,t]),{data:T,isConnected:M,isAuthenticated:g,isPaused:R}=Ae({symbols:w,mode:"Depth",enabled:b&&w.length>0}),X=r.useRef(0);r.useEffect(()=>{if(!f){a(null);return}if(T.size===0){a(f);return}const N=f.chain.map(P=>{const E={...P};if(P.ce?.symbol){const k=`${n}:${P.ce.symbol}`,F=T.get(k);if(F?.data){const K=F.data.depth?.buy?.[0],W=F.data.depth?.sell?.[0],Y=P.ce.tick_size;E.ce={...P.ce,ltp:ie(F.data.ltp,Y)??P.ce.ltp,bid:ie(K?.price??F.data.bid_price,Y)??P.ce.bid,ask:ie(W?.price??F.data.ask_price,Y)??P.ce.ask,bid_qty:K?.quantity??F.data.bid_size??P.ce.bid_qty??0,ask_qty:W?.quantity??F.data.ask_size??P.ce.ask_qty??0}}}if(P.pe?.symbol){const k=`${n}:${P.pe.symbol}`,F=T.get(k);if(F?.data){const K=F.data.depth?.buy?.[0],W=F.data.depth?.sell?.[0],Y=P.pe.tick_size;E.pe={...P.pe,ltp:ie(F.data.ltp,Y)??P.pe.ltp,bid:ie(K?.price??F.data.bid_price,Y)??P.pe.bid,ask:ie(W?.price??F.data.ask_price,Y)??P.pe.ask,bid_qty:K?.quantity??F.data.bid_size??P.pe.bid_qty??0,ask_qty:W?.quantity??F.data.ask_size??P.pe.ask_qty??0}}}return E});let A=!1;for(const[,P]of T)if(P.lastUpdate&&P.lastUpdate>X.current){A=!0,X.current=P.lastUpdate;break}A&&h(new Date);const y=`${Ee(t,n)}:${t}`,V=T.get(y)?.data?.ltp??f.underlying_ltp;a({...f,underlying_ltp:V,chain:N})},[f,T,n,t]);const H=M&&g&&w.length>0,J=L||R,D=r.useMemo(()=>!m&&!x?null:m?x&&x>m?x:m:x,[m,x]);return{data:c,isLoading:U,isConnected:B,isStreaming:H,isPaused:J,error:j,lastUpdate:D,streamingSymbols:w.length,refetch:S}}const Q=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],Ot=Q.map(s=>s.key),Lt=Q.filter(s=>s.defaultVisible).map(s=>s.key),G={visibleColumns:Lt,columnOrder:Ot,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Xe="openalgo_option_chain_prefs";function Tt(){if(typeof window>"u")return G;try{const s=localStorage.getItem(Xe);if(!s)return G;const t=JSON.parse(s),l=new Set(Q.map(i=>i.key)),n=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(i=>l.has(i)):G.visibleColumns;n.includes("strike")||n.push("strike");const d=Array.isArray(t.columnOrder)?t.columnOrder.filter(i=>l.has(i)):G.columnOrder,u=new Set(d);return G.columnOrder.forEach(i=>{u.has(i)||d.push(i)}),{visibleColumns:n,columnOrder:d,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:G.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:G.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:G.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:G.barStyle}}catch{return G}}function Et(s){if(!(typeof window>"u"))try{localStorage.setItem(Xe,JSON.stringify(s))}catch{}}function Mt(){const[s,t]=r.useState(()=>Tt());r.useEffect(()=>{Et(s)},[s]);const l=r.useCallback(a=>{a!=="strike"&&t(x=>{const f=x.visibleColumns.includes(a)?x.visibleColumns.filter(U=>U!==a):[...x.visibleColumns,a];return{...x,visibleColumns:f}})},[]),n=r.useCallback(a=>{t(x=>({...x,columnOrder:a}))},[]),d=r.useCallback(a=>{t(x=>({...x,strikeCount:a}))},[]),u=r.useCallback(a=>{t(x=>({...x,selectedUnderlying:a}))},[]),i=r.useCallback(a=>{t(x=>({...x,barDataSource:a}))},[]),b=r.useCallback(a=>{t(x=>({...x,barStyle:a}))},[]),v=r.useCallback(()=>{t(G)},[]),C=r.useCallback(a=>s.visibleColumns.includes(a),[s.visibleColumns]),c=r.useCallback(()=>s.columnOrder.filter(a=>s.visibleColumns.includes(a)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:l,reorderColumns:n,setStrikeCount:d,setSelectedUnderlying:u,setBarDataSource:i,setBarStyle:b,resetToDefaults:v,isColumnVisible:C,getOrderedVisibleColumns:c}}function It({barDataSource:s,barStyle:t,onBarDataSourceChange:l,onBarStyleChange:n}){return e.jsxs(Ue,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Ve,{align:"end",className:"w-48",children:[e.jsx(je,{children:"Bar Data"}),e.jsxs(_e,{value:s,onValueChange:d=>l(d),children:[e.jsx(fe,{value:"oi",children:"Open Interest"}),e.jsx(fe,{value:"volume",children:"Volume"})]}),e.jsx(Ce,{}),e.jsx(je,{children:"Bar Style"}),e.jsxs(_e,{value:t,onValueChange:d=>n(d),children:[e.jsx(fe,{value:"gradient",children:"Gradient"}),e.jsx(fe,{value:"solid",children:"Solid"})]})]})]})}function Ft({visibleColumns:s,onToggleColumn:t,onResetToDefaults:l}){const n=Q.filter(i=>i.side==="ce"),d=Q.filter(i=>i.side==="pe"),u=i=>s.includes(i);return e.jsxs(Ue,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Ve,{align:"end",className:"w-48",children:[e.jsx(je,{children:"CALLS Columns"}),n.map(i=>e.jsx(Pe,{checked:u(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ce,{}),e.jsx(je,{children:"PUTS Columns"}),d.map(i=>e.jsx(Pe,{checked:u(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ce,{}),e.jsxs(z,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:l,children:[e.jsx(et,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Me({columnKey:s,label:t,side:l,isVisible:n,isDragging:d,onDragStart:u,onDragOver:i,onDrop:b,onDragEnd:v}){return e.jsxs("div",{draggable:!0,onDragStart:C=>u(C,s),onDragOver:i,onDrop:C=>b(C,s),onDragEnd:v,className:_("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",d&&"opacity-50 border-dashed",n?"bg-card":"bg-muted/50 opacity-60",l==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(st,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:_("text-xs px-1.5 py-0.5 rounded",l==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:l==="ce"?"CE":"PE"})]})}function Rt({columnOrder:s,visibleColumns:t,onReorderColumns:l}){const[n,d]=r.useState(s),[u,i]=r.useState(null),[b,v]=r.useState(!1),C=n.filter(m=>Q.find(w=>w.key===m)?.side==="ce"),c=n.filter(m=>Q.find(w=>w.key===m)?.side==="pe"),a=m=>Q.find(w=>w.key===m)?.label??m,x=m=>Q.find(w=>w.key===m)?.side==="pe"?"pe":"ce",h=(m,S)=>{i(S),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain",S)},f=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},U=(m,S)=>{if(m.preventDefault(),!u||u===S)return;const w=x(u),T=x(S);if(w!==T)return;const M=[...n],g=M.indexOf(u),R=M.indexOf(S);M.splice(g,1),M.splice(R,0,u),d(M)},B=()=>{i(null)},L=()=>{l(n),v(!1)},j=m=>{v(m),m&&d(s)};return e.jsxs(ze,{open:b,onOpenChange:j,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Ye,{className:"sm:max-w-md",children:[e.jsxs($e,{children:[e.jsx(Qe,{children:"Reorder Columns"}),e.jsx(ot,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Te,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:C.map(m=>e.jsx(Me,{columnKey:m,label:a(m),side:"ce",isVisible:t.includes(m),isDragging:u===m,onDragStart:h,onDragOver:f,onDrop:U,onDragEnd:B},m))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Te,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:c.map(m=>e.jsx(Me,{columnKey:m,label:a(m),side:"pe",isVisible:t.includes(m),isDragging:u===m,onDragStart:h,onDragOver:f,onDrop:U,onDragEnd:B},m))})})]})]}),e.jsxs(We,{className:"gap-2 sm:gap-0",children:[e.jsx(dt,{asChild:!0,children:e.jsx(z,{variant:"outline",children:"Cancel"})}),e.jsx(z,{onClick:L,children:"Save Order"})]})]})]})}function Ut(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function Bt({exchange:s,ltp:t,prevClose:l,change:n,changePercent:d,bidPrice:u,askPrice:i,bidSize:b,askSize:v,isLoading:C}){const c=n??(t&&l?t-l:void 0),a=d??(c&&l?c/l*100:void 0),x=c!==void 0&&c>=0;return C?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(qe,{className:_("text-[10px] px-1.5 py-0",Ut(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),c!==void 0&&e.jsxs("span",{className:_("text-sm font-medium",x?"text-green-500":"text-red-500"),children:[x?"+":"",c.toFixed(2),a!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",x?"+":"",a.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:u!==void 0&&u>0?u.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",b.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:i!==void 0&&i>0?i.toFixed(2):"-"}),v!==void 0&&v>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",v.toLocaleString()]})]})]})]})}function Ie({price:s,quantity:t,maxQty:l,side:n}){const d=l>0?Math.min(t/l*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:_("absolute top-0 bottom-0 transition-all duration-300",n==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${d}%`}})}),e.jsx("span",{className:_("relative z-10 flex-1 font-mono text-xs",n==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function Vt({depth:s,isExpanded:t,onToggle:l,maxLevels:n=5}){const d=s?.buy?.slice(0,n)??[],u=s?.sell?.slice(0,n)??[],i=Math.max(...d.map(c=>c.quantity),1),b=Math.max(...u.map(c=>c.quantity),1),v=Math.max(i,b),C=d.length>0||u.length>0;return e.jsxs(ut,{open:t,onOpenChange:l,children:[e.jsxs(mt,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(xt,{children:C?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:d.length>0?d.map((c,a)=>e.jsx(Ie,{price:c.price,quantity:c.quantity,maxQty:v,side:"buy"},`buy-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:u.length>0?u.map((c,a)=>e.jsx(Ie,{price:c.price,quantity:c.quantity,maxQty:v,side:"sell"},`sell-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:d.reduce((c,a)=>c+a.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:u.reduce((c,a)=>c+a.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}function qt(s,t,l={}){const{enabled:n=!0,mode:d="Depth",useQuotesFallback:u=!0,useDepthFallback:i=!0,staleThreshold:b=5e3,refreshInterval:v=3e4}=l,{apiKey:C}=De(),{isMarketOpen:c}=Ge(),[a,x]=r.useState(null),[h,f]=r.useState(null),[U,B]=r.useState(!1),L=r.useRef(0),j=!!s&&!!t,m=r.useMemo(()=>j?[{symbol:s,exchange:t}]:[],[s,t,j]),{data:S,isConnected:w,isPaused:T,isFallbackMode:M}=Ae({symbols:m,mode:d,enabled:n&&j}),g=S.get(`${t}:${s}`)?.data,R=S.get(`${t}:${s}`)?.lastUpdate,X=c(t),H=!!(w&&g&&R&&Date.now()-R<b),J=H&&X&&!T,D=r.useCallback(async()=>{if(!(!C||!j)){B(!0);try{const E=[];u&&E.push(Se.getQuotes(C,s,t).then(k=>{k.status==="success"&&k.data&&x(k.data)}).catch(()=>{})),i&&d==="Depth"&&E.push(Se.getDepth(C,s,t).then(k=>{k.status==="success"&&k.data&&f(k.data)}).catch(()=>{})),await Promise.all(E),L.current=Date.now()}finally{B(!1)}}},[C,s,t,j,u,i,d]),N=r.useRef(n),A=r.useRef(j),$=r.useRef(D);r.useEffect(()=>{N.current=n,A.current=j,$.current=D},[n,j,D]),r.useEffect(()=>{if(!n||!j)return;$.current();const E=setInterval(()=>{N.current&&A.current&&$.current()},v);return()=>clearInterval(E)},[n,j,s,t,v]),r.useEffect(()=>{x(null),f(null)},[s,t]);const y=r.useMemo(()=>{if(h)return{buy:h.bids.map(E=>({price:E.price,quantity:E.quantity})),sell:h.asks.map(E=>({price:E.price,quantity:E.quantity}))}},[h]),I=r.useMemo(()=>{const E=g?.depth??y,k=g?.depth?.buy?.[0]?.price??y?.buy?.[0]?.price??g?.bid_price??a?.bid,F=g?.depth?.sell?.[0]?.price??y?.sell?.[0]?.price??g?.ask_price??a?.ask,K=g?.depth?.buy?.[0]?.quantity??y?.buy?.[0]?.quantity??g?.bid_size,W=g?.depth?.sell?.[0]?.quantity??y?.sell?.[0]?.quantity??g?.ask_size;return{ltp:g?.ltp??h?.ltp??a?.ltp,open:g?.open??h?.open??a?.open,high:g?.high??h?.high??a?.high,low:g?.low??h?.low??a?.low,close:g?.close??h?.prev_close??a?.prev_close,volume:g?.volume??h?.volume??a?.volume,oi:h?.oi??a?.oi,change:g?.change,changePercent:g?.change_percent,bidPrice:k,askPrice:F,bidSize:K,askSize:W,depth:E}},[g,a,h,y]),V=r.useMemo(()=>{if(I.change!==void 0)return I;const E=I.ltp&&I.close?I.ltp-I.close:void 0,k=E&&I.close?E/I.close*100:void 0;return{...I,change:E,changePercent:k}},[I]),P=r.useMemo(()=>H?"websocket":a||h?"rest":"none",[H,a,h]);return{data:V,isLive:J,isConnected:w,isLoading:U&&!a&&!h,isPaused:T,isFallbackMode:M,dataSource:P,refresh:D}}const At=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],zt=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Yt=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function be(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function ge(s,t,l){const n=be(s,t);return l==="up"?Number((n+t).toFixed(2)):Math.max(0,Number((n-t).toFixed(2)))}function Fe(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function $t({open:s,onOpenChange:t,symbol:l="",exchange:n="",action:d="BUY",quantity:u,lotSize:i=1,tickSize:b=.05,product:v="NRML",priceType:C="MARKET",strategy:c="OptionChain",onSuccess:a,onError:x}){const{apiKey:h}=De(),[f,U]=r.useState(d),[B,L]=r.useState(u??i),[j,m]=r.useState(C),[S,w]=r.useState(v),[T,M]=r.useState(0),[g,R]=r.useState(0),[X,H]=r.useState(!1),[J,D]=r.useState(!1),[N,A]=r.useState("lots"),[$,y]=r.useState(1),I=Fe(n)?zt:Yt,{data:V,isLoading:P,isConnected:E}=qt(l,n,{enabled:s&&!!l&&!!n,mode:"Depth",useQuotesFallback:!0,useDepthFallback:!0});r.useEffect(()=>{if(s){U(d),L(u??i),m(C);const p=Fe(n),O=p?"NRML":"CNC",he=v&&(p?["NRML","MIS"]:["CNC","MIS"]).includes(v)?v:O;w(he),M(0),R(0),D(!1),A("lots"),y(1)}},[s,d,u,i,C,v,n]);const k={ltp:V.ltp,close:V.close,change:V.change,change_percent:V.changePercent,bidPrice:V.bidPrice,askPrice:V.askPrice,bidSize:V.bidSize,askSize:V.askSize,depth:V.depth},F=k.change,K=k.change_percent;r.useEffect(()=>{j!=="MARKET"&&k.ltp&&T===0&&M(be(k.ltp,b))},[j,k.ltp,T,b]);const W=j==="LIMIT"||j==="SL",Y=j==="SL-M"||j==="SL",Z=r.useCallback(()=>!(!l||!n||!h||B<=0||W&&T<=0||Y&&g<=0),[l,n,h,B,W,T,Y,g]),ye=async()=>{if(!Z()){oe.error("Please fill all required fields");return}if(!h){oe.error("API key not found. Please set up your API key."),x?.("API key not found");return}H(!0);try{const O={apikey:h,strategy:c,exchange:n,symbol:l,action:f,quantity:B,pricetype:j,product:S,...W&&{price:T},...Y&&{trigger_price:g}},q=await Se.placeOrder(O),he=q.orderid;if(q.status==="success"&&he)a?.(he),t(!1);else{const ke=q.message||"Order placement failed";oe.error(ke,"orders"),x?.(ke)}}catch(p){let O="Order placement failed";if(p&&typeof p=="object"){const q=p;q.response?.data?.message?O=q.response.data.message:q.message&&(O=q.message)}oe.error(O,"orders"),x?.(O)}finally{H(!1)}},te=p=>{const O=parseInt(p)||0;if(N==="lots")L(O*i),y(O);else{const q=Math.max(i,Math.round(O/i)*i);L(q),y(q/i)}},se=N==="lots"?$:B,o=P&&!k.ltp&&!E;return e.jsx(ze,{open:s,onOpenChange:t,children:e.jsxs(Ye,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx($e,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:f==="BUY"?"text-green-500":"text-red-500",children:f}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:l})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(Bt,{exchange:n,ltp:k.ltp,prevClose:k.close,change:F,changePercent:K,bidPrice:k.bidPrice,askPrice:k.askPrice,bidSize:k.bidSize,askSize:k.askSize,isLoading:o}),e.jsx(Vt,{depth:k.depth,isExpanded:J,onToggle:()=>D(!J),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",variant:f==="BUY"?"default":"outline",className:_("flex-1",f==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>U("BUY"),children:"BUY"}),e.jsx(z,{type:"button",variant:f==="SELL"?"default":"outline",className:_("flex-1",f==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>U("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>A("lots"),className:_("px-2 py-0.5 text-[10px] rounded",N==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>A("shares"),className:_("px-2 py-0.5 text-[10px] rounded",N==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(Ne,{type:"number",value:se,onChange:p=>te(p.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",i]}),e.jsxs("span",{children:["Total qty: ",B]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Price Type"}),e.jsxs(de,{value:j,onValueChange:p=>m(p),children:[e.jsx(ue,{children:e.jsx(me,{})}),e.jsx(xe,{children:At.map(p=>e.jsx(pe,{value:p.value,children:p.label},p.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Product"}),e.jsxs(de,{value:S,onValueChange:p=>w(p),children:[e.jsx(ue,{children:e.jsx(me,{})}),e.jsx(xe,{children:I.map(p=>e.jsx(pe,{value:p.value,children:p.label},p.value))})]})]})]}),W&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>M(ge(T,b,"down")),children:"-"}),e.jsx(Ne,{type:"number",value:T,onChange:p=>M(parseFloat(p.target.value)||0),onBlur:()=>M(be(T,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>M(ge(T,b,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",b]})]}),Y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>R(ge(g,b,"down")),children:"-"}),e.jsx(Ne,{type:"number",value:g,onChange:p=>R(parseFloat(p.target.value)||0),onBlur:()=>R(be(g,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>R(ge(g,b,"up")),children:"+"})]})]})]}),e.jsxs(We,{className:"gap-2 sm:gap-0",children:[e.jsx(z,{variant:"outline",onClick:()=>t(!1),disabled:X,children:"Cancel"}),e.jsx(z,{onClick:ye,disabled:!Z()||X,className:_(f==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:X?"Placing...":`Place ${f} Order`})]})]})})}const Qt=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"}],Re={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX"]},Wt=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function ce(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const l=s/1e3;return l>=1?l.toFixed(1)+"K":s.toLocaleString()}}function ee(s){return s==null?"0.00":s.toFixed(2)}function Xt(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function Ht(s){let t=0,l=0;return s.forEach(n=>{n.ce?.oi&&(t+=n.ce.oi),n.pe?.oi&&(l+=n.pe?.oi??0)}),t===0?0:l/t}function Kt(s){let t=0,l=0,n=0,d=0;return s.forEach(u=>{u.ce&&(t+=u.ce.volume??0,n+=u.ce.oi??0),u.pe&&(l+=u.pe.volume??0,d+=u.pe.oi??0)}),{ceVolume:t,peVolume:l,ceOi:n,peOi:d}}function Gt(s,t){let l=0;return s.forEach(n=>{const d=t==="oi"?n.ce?.oi:n.ce?.volume,u=t==="oi"?n.pe?.oi:n.pe?.volume;d&&d>l&&(l=d),u&&u>l&&(l=u)}),l||1}const Jt=He.memo(function({strike:t,previousStrike:l,maxBarValue:n,visibleCeColumns:d,visiblePeColumns:u,barDataSource:i,barStyle:b,optionExchange:v,onPlaceOrder:C}){const c=t.ce,a=t.pe,x=c?.label??a?.label??"",h=x==="ATM",f=x.startsWith("OTM"),U=x.startsWith("ITM"),B=l?.ce?.ltp!==void 0&&l.ce.ltp!==c?.ltp,L=l?.pe?.ltp!==void 0&&l.pe.ltp!==a?.ltp,j=B?c&&l?.ce&&c.ltp>l.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",m=L?a&&l?.pe&&a.ltp>l.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",S=c&&c.bid>0&&c.ask>0?c.ask-c.bid:0,w=a&&a.bid>0&&a.ask>0?a.ask-a.bid:0,T=S<=1?"text-green-500":S<=2?"text-yellow-500":"text-red-500",M=w<=1?"text-green-500":w<=2?"text-yellow-500":"text-red-500",g=i==="oi"?c?.oi:c?.volume,R=i==="oi"?a?.oi:a?.volume,X=g?Math.min(g/n*100,100):0,H=R?Math.min(R/n*100,100):0,J=b==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",D=b==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",N="font-mono tabular-nums text-xs",A=y=>{switch(y){case"ce_oi":return e.jsx("span",{className:N,children:ce(c?.oi)});case"ce_volume":return e.jsx("span",{className:N,children:ce(c?.volume)});case"ce_bid_qty":return e.jsx("span",{className:N,children:c?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:_(N,"text-red-500"),children:ee(c?.bid)});case"ce_ltp":return e.jsx("span",{className:_(N,"font-semibold",j),children:ee(c?.ltp)});case"ce_ask":return e.jsx("span",{className:_(N,"text-green-500"),children:ee(c?.ask)});case"ce_ask_qty":return e.jsx("span",{className:N,children:c?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:_(N,T),children:ee(S)});default:return null}},$=y=>{switch(y){case"pe_oi":return e.jsx("span",{className:N,children:ce(a?.oi)});case"pe_volume":return e.jsx("span",{className:N,children:ce(a?.volume)});case"pe_bid_qty":return e.jsx("span",{className:N,children:a?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:_(N,"text-red-500"),children:ee(a?.bid)});case"pe_ltp":return e.jsx("span",{className:_(N,"font-semibold",m),children:ee(a?.ltp)});case"pe_ask":return e.jsx("span",{className:_(N,"text-green-500"),children:ee(a?.ask)});case"pe_ask_qty":return e.jsx("span",{className:N,children:a?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:_(N,M),children:ee(w)});default:return null}};return e.jsxs(we,{className:_("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":x,children:[d.length>0&&e.jsxs(ve,{className:_("p-0 relative",f&&!h&&"bg-amber-500/5"),children:[e.jsx("div",{className:_("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",J),style:{width:`${X}%`}}),c&&e.jsxs("div",{className:_("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:c.symbol,exchange:v,action:"BUY",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:c.symbol,exchange:v,action:"SELL",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:d.map(y=>{const I=Q.find(V=>V.key===y);return e.jsx("div",{className:_("flex-1 px-2 py-1.5 min-w-0",I?.align==="right"&&"text-right",I?.align==="center"&&"text-center",I?.align==="left"&&"text-left"),children:A(y)},y)})})]}),e.jsx(ve,{className:_("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",h?"bg-primary/15":"bg-muted/30"),children:t.strike}),u.length>0&&e.jsxs(ve,{className:_("p-0 relative",U&&!h&&"bg-amber-500/5"),children:[e.jsx("div",{className:_("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",D),style:{width:`${H}%`}}),a&&e.jsxs("div",{className:_("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:a.symbol,exchange:v,action:"BUY",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:a.symbol,exchange:v,action:"SELL",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:u.map(y=>{const I=Q.find(V=>V.key===y);return e.jsx("div",{className:_("flex-1 px-2 py-1.5 min-w-0",I?.align==="right"&&"text-right",I?.align==="center"&&"text-center",I?.align==="left"&&"text-left"),children:$(y)},y)})})]})]})});function gs(){const{apiKey:s}=De(),{visibleColumns:t,columnOrder:l,strikeCount:n,selectedUnderlying:d,barDataSource:u,barStyle:i,toggleColumn:b,reorderColumns:v,setStrikeCount:C,setSelectedUnderlying:c,setBarDataSource:a,setBarStyle:x,resetToDefaults:h}=Mt(),[f,U]=r.useState("NFO"),[B,L]=r.useState(Re.NFO),[j,m]=r.useState(!1),[S,w]=r.useState(""),[T,M]=r.useState([]),g=r.useRef(new Map),[R,X]=r.useState(null),H=f,J=f,{data:D,isConnected:N,isStreaming:A,isPaused:$,error:y,lastUpdate:I,refetch:V,isLoading:P,streamingSymbols:E}=Pt(s,d,J,H,Xt(S),n,{enabled:!!S,oiRefreshInterval:3e4,pauseWhenHidden:!0});r.useEffect(()=>{const o=Re[f]||[];L(o),c(o[0]||""),M([]),w("");let p=!1;return(async()=>{try{const q=await Oe.getUnderlyings(f);if(p)return;q.status==="success"&&q.underlyings.length>0&&(L(q.underlyings),q.underlyings.includes(o[0])||c(q.underlyings[0]))}catch{}})(),()=>{p=!0}},[f]),r.useEffect(()=>{if(!d)return;M([]),w("");let o=!1;return(async()=>{try{const O=await Oe.getExpiries(f,d);if(o)return;O.status==="success"&&O.expiries.length>0?(M(O.expiries),w(O.expiries[0])):(M([]),w(""))}catch{if(o)return;oe.error("Failed to load expiry dates")}})(),()=>{o=!0}},[d]),r.useEffect(()=>{if(D?.chain){const o=setTimeout(()=>{const p=new Map;D.chain.forEach(O=>{p.set(O.strike,O)}),g.current=p},100);return()=>clearTimeout(o)}},[D?.chain]);const k=o=>{c(o),w(""),M([])},F=()=>{V()},K=r.useCallback(o=>{X({open:!0,symbol:o.symbol,exchange:o.exchange,action:o.action,quantity:o.lotSize,lotSize:o.lotSize,tickSize:o.tickSize})},[]),W=r.useCallback(o=>{o||X(null)},[]),Y=r.useMemo(()=>D?.chain?Ht(D.chain):0,[D?.chain]),Z=r.useMemo(()=>D?.chain?Kt(D.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[D?.chain]),ye=r.useMemo(()=>D?.chain?Gt(D.chain,u):1,[D?.chain,u]),te=r.useMemo(()=>l.filter(o=>Q.find(O=>O.key===o)?.side==="ce"&&t.includes(o)),[l,t]),se=r.useMemo(()=>l.filter(o=>Q.find(O=>O.key===o)?.side==="pe"&&t.includes(o)),[l,t]);return y?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(ne,{className:"max-w-md",children:e.jsx(re,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:y}),e.jsxs(z,{onClick:F,className:"mt-4",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(de,{value:f,onValueChange:U,children:[e.jsx(ue,{className:"w-24",children:e.jsx(me,{placeholder:"Exchange"})}),e.jsx(xe,{children:Qt.map(o=>e.jsx(pe,{value:o.value,children:o.label},o.value))})]}),e.jsxs(pt,{open:j,onOpenChange:m,children:[e.jsx(ht,{asChild:!0,children:e.jsxs(z,{variant:"outline",role:"combobox","aria-expanded":j,className:"w-36 justify-between",children:[d||"Select Underlying",e.jsx(nt,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ft,{className:"w-48 p-0",align:"start",children:e.jsxs(gt,{children:[e.jsx(bt,{placeholder:"Search underlying..."}),e.jsxs(jt,{children:[e.jsx(yt,{children:"No underlying found"}),e.jsx(Nt,{children:B.map(o=>e.jsxs(vt,{value:o,onSelect:()=>{k(o),m(!1)},children:[e.jsx(rt,{className:`mr-2 h-4 w-4 ${d===o?"opacity-100":"opacity-0"}`}),o]},o))})]})]})})]}),e.jsxs(de,{value:S,onValueChange:w,disabled:T.length===0,children:[e.jsx(ue,{className:"w-36",children:e.jsx(me,{placeholder:"Select Expiry"})}),e.jsx(xe,{children:T.map(o=>e.jsx(pe,{value:o,children:o},o))})]}),e.jsxs(de,{value:String(n),onValueChange:o=>C(Number(o)),children:[e.jsx(ue,{className:"w-36",children:e.jsx(me,{placeholder:"Strike Count"})}),e.jsx(xe,{children:Wt.map(o=>e.jsx(pe,{value:String(o.value),children:o.label},o.value))})]}),e.jsx(It,{barDataSource:u,barStyle:i,onBarDataSourceChange:a,onBarStyleChange:x}),e.jsx(Ft,{visibleColumns:t,onToggleColumn:b,onResetToDefaults:h}),e.jsx(Rt,{columnOrder:l,visibleColumns:t,onReorderColumns:v}),e.jsxs(z,{onClick:F,disabled:!S||P,children:[e.jsx(Le,{className:`h-4 w-4 mr-2 ${P?"animate-spin":""}`}),"Refresh"]})]})]}),D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ne,{children:e.jsxs(re,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:ee(D.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",ee(D.underlying_prev_close)]})]})}),e.jsx(ne,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:D.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",D.expiry_date]})]})}),e.jsx(ne,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${Y>1?"text-green-500":"text-yellow-500"}`,children:Y.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(ne,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:ce(Z.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:ce(Z.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:Z.ceOi+Z.peOi>0?`${Z.ceOi/(Z.ceOi+Z.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",Y.toFixed(2)]})})]})})]}),e.jsx(ne,{children:e.jsx(re,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ct,{className:"w-full table-fixed",children:[e.jsxs(St,{children:[e.jsxs(we,{className:"bg-muted/30 border-b-0",children:[te.length>0&&e.jsx(le,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(le,{className:"text-center w-20 min-w-20"}),se.length>0&&e.jsx(le,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(we,{className:"bg-muted/50",children:[te.length>0&&e.jsx(le,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:te.map(o=>{const p=Q.find(O=>O.key===o);return e.jsx("div",{className:_("flex-1 px-2 py-2 text-xs font-medium min-w-0",p?.align==="right"&&"text-right",p?.align==="center"&&"text-center",p?.align==="left"&&"text-left"),children:p?.label},o)})})}),e.jsx(le,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),se.length>0&&e.jsx(le,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:se.map(o=>{const p=Q.find(O=>O.key===o);return e.jsx("div",{className:_("flex-1 px-2 py-2 text-xs font-medium min-w-0",p?.align==="right"&&"text-right",p?.align==="center"&&"text-center",p?.align==="left"&&"text-left"),children:p?.label},o)})})})]})]}),e.jsx(wt,{children:D.chain.map(o=>e.jsx(Jt,{strike:o,previousStrike:g.current.get(o.strike),maxBarValue:ye,visibleCeColumns:te,visiblePeColumns:se,barDataSource:u,barStyle:i,optionExchange:H,onPlaceOrder:K},o.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[A?e.jsx(lt,{className:"h-4 w-4 text-green-500"}):e.jsx(it,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(qe,{variant:A?"default":N?"secondary":"destructive",children:$?"Paused":A?`Streaming ${E} symbols`:N?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",u==="oi"?"OI":"Volume"," (",i,")"]})]}),e.jsxs("div",{children:["Last Update: ",I?I.toLocaleTimeString():"-"]})]})]}),!D&&!y&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx($t,{open:R?.open??!1,onOpenChange:W,symbol:R?.symbol,exchange:R?.exchange,action:R?.action,quantity:R?.quantity,lotSize:R?.lotSize,tickSize:R?.tickSize,strategy:"OptionChain"})]})}export{gs as default};
