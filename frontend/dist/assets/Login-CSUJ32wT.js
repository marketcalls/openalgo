import{r,j as e}from"./vendor-react-CCyQGCED.js";import{d as P,B as m,s as E}from"./index-D0023jFM.js";import{A as j,a as w,b as A}from"./alert-Dlgyh2fF.js";import{C as F,a as I,b as _,c as T,d as O}from"./card-CDguRyHx.js";import{I as y}from"./input-D8_g_dg9.js";import{L as N}from"./label-BgxgrBuS.js";import{E as R,x as B,L as G,w as H,I as U,G as q,v as z}from"./vendor-icons-CCn_k3dF.js";import{a as W,L as M}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function te(){const t=W(),{login:b}=P(),[p,v]=r.useState(""),[h,S]=r.useState(""),[c,k]=r.useState(!1),[d,u]=r.useState(!1),[C,L]=r.useState(!0),[x,n]=r.useState(null);r.useEffect(()=>{(async()=>{try{if((await(await fetch("/auth/check-setup",{credentials:"include"})).json()).needs_setup){t("/setup",{replace:!0});return}const a=await fetch("/auth/session-status",{credentials:"include"});if(a.ok){const s=await a.json();if(s.status==="success"&&s.logged_in&&s.broker){t("/dashboard",{replace:!0});return}else if(s.status==="success"&&s.authenticated&&!s.logged_in){t("/broker",{replace:!0});return}}}catch{}finally{L(!1)}})()},[t]);const D=async i=>{i.preventDefault(),u(!0),n(null);try{const l=await fetch("/auth/csrf-token",{credentials:"include"});if(!l.ok){n("Failed to initialize login. Please refresh the page."),u(!1);return}const f=await l.json(),a=new FormData;a.append("username",p),a.append("password",h),a.append("csrf_token",f.csrf_token);const s=await fetch("/auth/login",{method:"POST",body:a,credentials:"include"}),g=s.headers.get("content-type");if(!g||!g.includes("application/json")){s.url.includes("/setup")?(n("Please complete initial setup first."),t("/setup")):n("Login failed. Please try again."),u(!1);return}const o=await s.json();o.status==="error"?(n(o.message||"Login failed. Please try again."),o.redirect&&t(o.redirect)):(b(p,""),E.success("Login successful","system"),t(o.redirect||"/broker"))}catch{n("Login failed. Please try again.")}finally{u(!1)}};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center py-8 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-16",children:[e.jsxs(F,{className:"w-full max-w-md order-1 lg:order-2 shadow-xl",children:[e.jsxs(I,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/logo.png",alt:"OpenAlgo",className:"h-20 w-20"})}),e.jsx(_,{className:"text-2xl",children:"Welcome Back"}),e.jsx(T,{children:"Sign in to your OpenAlgo account"})]}),e.jsx(O,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"username",children:"Username"}),e.jsx(y,{id:"username",type:"text",placeholder:"Enter your username",value:p,onChange:i=>v(i.target.value),required:!0,disabled:d,autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"password",type:c?"text":"password",placeholder:"Enter your password",value:h,onChange:i=>S(i.target.value),required:!0,disabled:d,autoComplete:"current-password",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>k(!c),"aria-label":c?"Hide password":"Show password",children:c?e.jsx(R,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("div",{className:"text-right",children:e.jsx(M,{to:"/reset-password",className:"text-sm text-muted-foreground hover:text-primary",children:"Forgot password?"})})]}),x&&e.jsx(j,{variant:"destructive",children:e.jsx(w,{children:x})}),e.jsx(m,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Sign in"]})})]})})]}),e.jsxs("div",{className:"flex-1 max-w-xl text-center lg:text-left order-2 lg:order-1",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["Welcome to ",e.jsx("span",{className:"text-primary",children:"OpenAlgo"})]}),e.jsx("p",{className:"text-lg lg:text-xl mb-8 text-muted-foreground",children:"Sign in to your account to access your trading dashboard and manage your algorithmic trading strategies."}),e.jsxs(j,{className:"mb-6",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(A,{children:"First Time User?"}),e.jsx(w,{children:"Contact your administrator to set up your account."})]}),e.jsxs("div",{className:"flex justify-center lg:justify-start gap-4",children:[e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://github.com/marketcalls/openalgo",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"GitHub"]})}),e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://openalgo.in/discord",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Discord"]})})]})]})]})})})}export{te as default};
