import{r as l,j as e}from"./vendor-react-RhKMXzW9.js";import{u as xs,h as ba,e as w,B as o,c as ve,t as n}from"./index-COvqLpLV.js";import{A as va,b as Na,c as wa,d as Sa,e as Ca,f as ka,g as _a,h as Ea}from"./alert-dialog-BDto4hf4.js";import{C,a as O,b as L,c as $,d as Fa}from"./card-DLKA0IoA.js";import{D as Ne,b as we,c as Se,d as Ce,e as ke,f as _e}from"./dialog-I9Yx1pfw.js";import{I as k}from"./input-Be0htwmA.js";import{L as m}from"./label-DivJ5Zr3.js";import{P as Da}from"./progress-DOx4i8Qb.js";import{S as K}from"./scroll-area-CFS8GjXg.js";import{S as p,a as j,b as g,c as f,d as i}from"./select-Bid4MY-i.js";import{T as Ee,a as Fe,b as _,c as h,d as De,e as d}from"./table-BRKuz9z9.js";import{T as Ta,a as Oa,b as ee,c as se}from"./tabs-BZ_UQTql.js";import{T as Aa}from"./textarea-z2WOiSqr.js";import{C as ae}from"./checkbox-BY4BP0Wq.js";import{S as Ia}from"./switch-C5oOX3y-.js";import{D as us,aw as Ra,g as Pa,c as za,Z as La,P as $a,ad as ps,ax as Ja,S as js,ay as Te,az as Ua,aA as Ma,ac as gs,av as Va,aB as Ba,i as Xa,X as Ha,L as te,p as Wa,R as fs,v as Ya,a0 as qa,aC as Za,aD as ys,aE as Ga}from"./vendor-icons-BR5pWO19.js";import{L as bs}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-radix-gKv__6YA.js";async function y(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}const Qa=[{label:"1M",months:1},{label:"3M",months:3},{label:"6M",months:6},{label:"1Y",months:12},{label:"2Y",months:24},{label:"5Y",months:60}];function Oe(A){const I=new Date;return I.setMonth(I.getMonth()-A),I.toISOString().split("T")[0]}function ft(){const{appMode:A,toggleAppMode:I}=xs(),[b,vs]=l.useState([]),[le,Ns]=l.useState([]),[E,ws]=l.useState(null),[Ae,Ss]=l.useState(null),[ne,Cs]=l.useState(["NSE","BSE","NFO","BFO","MCX","CDS","BCD","NSE_INDEX","BSE_INDEX"]),[re,ks]=l.useState({database_size_mb:0,total_records:0,total_symbols:0,watchlist_count:0}),[_s,Ie]=l.useState("catalog"),[R,ce]=l.useState(""),[M,Re]=l.useState("NSE"),[Pe,oe]=l.useState([]),[Es,V]=l.useState(!1),ie=l.useRef(null),[ze,Fs]=l.useState("D"),[de,Le]=l.useState(()=>Oe(1)),[$e,Je]=l.useState(()=>new Date().toISOString().split("T")[0]),[Ue,Ds]=l.useState(!1),[v,Ts]=l.useState("NFO"),[Os,As]=l.useState([]),[F,Me]=l.useState(""),[Is,Ve]=l.useState([]),[he,me]=l.useState(""),[B,Rs]=l.useState("__all__"),[xe,Ps]=l.useState(""),[ue,zs]=l.useState(""),[D,Be]=l.useState([]),[P,z]=l.useState(new Set),[Xe,He]=l.useState(!1),[X,pe]=l.useState([]),[Ls,$s]=l.useState(null),[Js,We]=l.useState({}),[Ye,qe]=l.useState(!1),[Us,H]=l.useState(!1),[Ze,Ge]=l.useState(""),[Qe,Ke]=l.useState(!1),[Ms,W]=l.useState(!1),[je,es]=l.useState(""),[ss,Vs]=l.useState("NSE"),[as,Bs]=l.useState("D"),[Y,ts]=l.useState(null),[ls,ns]=l.useState(!1),ge=l.useRef(null),[Xs,fe]=l.useState(!1),[q,rs]=l.useState(null),[Hs,Z]=l.useState(!1),[cs,Ws]=l.useState("csv"),[os,Ys]=l.useState("all"),[J,ye]=l.useState(new Set),[is,ds]=l.useState(!1),[u,be]=l.useState({exchange:"",interval:"",search:""}),{socket:S}=ba(),qs=E?[...E.seconds,...E.minutes,...E.hours,...E.days,...E.weeks,...E.months]:["D"],U=l.useMemo(()=>le.filter(s=>!(u.exchange&&u.exchange!=="__all__"&&s.exchange!==u.exchange||u.interval&&u.interval!=="__all__"&&s.interval!==u.interval||u.search&&!s.symbol.toLowerCase().includes(u.search.toLowerCase()))),[le,u]);l.useEffect(()=>{G(),Q(),Zs(),Gs(),T(),Qs(),N()},[]),l.useEffect(()=>{if(!S)return;const s=r=>{We(c=>({...c,[r.job_id]:r})),pe(c=>c.map(x=>x.id===r.job_id?{...x,completed_symbols:r.current,status:"running"}:x))},a=r=>{We(c=>{const x={...c};return delete x[r.job_id],x}),N(),Q(),T(),n.success(`Job completed: ${r.completed} success, ${r.failed} failed`)},t=r=>{pe(c=>c.map(x=>x.id===r.job_id?{...x,status:"paused"}:x))};return S.on("historify_progress",s),S.on("historify_job_complete",a),S.on("historify_job_paused",t),()=>{S.off("historify_progress",s),S.off("historify_job_complete",a),S.off("historify_job_paused",t)}},[S]),l.useEffect(()=>{v&&ta()},[v]),l.useEffect(()=>{F&&v&&la()},[F,v]),l.useEffect(()=>{const s=a=>{ie.current&&!ie.current.contains(a.target)&&V(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),l.useEffect(()=>{const s=setTimeout(()=>{R.length>=2?Ks(R):(oe([]),V(!1))},300);return()=>clearTimeout(s)},[R]);const G=async()=>{try{const a=await(await fetch("/historify/api/watchlist",{credentials:"include"})).json();a.status==="success"&&vs(a.data||[])}catch(s){console.error("Error loading watchlist:",s)}},Q=async()=>{try{const a=await(await fetch("/historify/api/catalog",{credentials:"include"})).json();a.status==="success"&&Ns(a.data||[])}catch(s){console.error("Error loading catalog:",s)}},Zs=async()=>{try{const a=await(await fetch("/historify/api/intervals",{credentials:"include"})).json();a.status==="success"&&ws(a.data)}catch(s){console.error("Error loading intervals:",s)}},Gs=async()=>{try{const a=await(await fetch("/historify/api/historify-intervals",{credentials:"include"})).json();a.status==="success"&&Ss({storage_intervals:a.storage_intervals,computed_intervals:a.computed_intervals,all_intervals:a.all_intervals})}catch(s){console.error("Error loading historify intervals:",s)}},T=async()=>{try{const a=await(await fetch("/historify/api/stats",{credentials:"include"})).json();a.status==="success"&&ks(a.data)}catch(s){console.error("Error loading stats:",s)}},Qs=async()=>{try{const a=await(await fetch("/historify/api/exchanges",{credentials:"include"})).json();a.status==="success"&&a.data?.length>0&&Cs(a.data)}catch(s){console.error("Error loading exchanges:",s)}},N=async()=>{qe(!0);try{const a=await(await fetch("/historify/api/jobs?limit=50",{credentials:"include"})).json();a.status==="success"&&pe(a.data||[])}catch(s){console.error("Error loading jobs:",s)}finally{qe(!1)}},Ks=async s=>{if(!(s.length<2))try{const a=new URLSearchParams({q:s});M&&a.append("exchange",M);const r=await(await fetch(`/search/api/search?${a}`,{credentials:"include"})).json();oe((r.results||[]).slice(0,10)),V(!0)}catch(a){console.error("Error searching symbols:",a),oe([])}},ea=async()=>{if(!R.trim()){n.warning("Please enter a symbol");return}try{const s=await y(),t=await(await fetch("/historify/api/watchlist",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify({symbol:R.trim().toUpperCase(),exchange:M})})).json();t.status==="success"?(n.success(t.message),ce(""),G(),T()):n.error(t.message||"Failed to add symbol")}catch(s){console.error("Error adding to watchlist:",s),n.error("Failed to add symbol")}},sa=async(s,a)=>{try{const t=await y(),c=await(await fetch("/historify/api/watchlist",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({symbol:s,exchange:a})})).json();c.status==="success"?(n.success(c.message),G(),T()):n.error(c.message||"Failed to remove symbol")}catch(t){console.error("Error removing from watchlist:",t),n.error("Failed to remove symbol")}},aa=async()=>{const a=Ze.trim().split(`
`).map(t=>{const[r,c]=t.split(",").map(x=>x.trim().toUpperCase());return{symbol:r,exchange:c||"NSE"}}).filter(t=>t.symbol);if(a.length===0){n.warning("No valid symbols found");return}Ke(!0);try{const t=await y(),c=await(await fetch("/historify/api/watchlist/bulk",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({symbols:a})})).json();c.status==="success"?(n.success(`Added ${c.added} symbols`),H(!1),Ge(""),G(),T()):n.error(c.message||"Failed to bulk add symbols")}catch(t){console.error("Error bulk adding:",t),n.error("Failed to bulk add symbols")}finally{Ke(!1)}},ta=async()=>{try{const a=await(await fetch(`/historify/api/fno/underlyings?exchange=${v}`,{credentials:"include"})).json();a.status==="success"&&(As(a.data||[]),Me(""),Ve([]),me(""),Be([]))}catch(s){console.error("Error loading FNO underlyings:",s)}},la=async()=>{try{const s=new URLSearchParams({underlying:F,exchange:v}),t=await(await fetch(`/historify/api/fno/expiries?${s}`,{credentials:"include"})).json();t.status==="success"&&(Ve(t.data||[]),me(""))}catch(s){console.error("Error loading FNO expiries:",s)}},na=async()=>{if(!F){n.warning("Please select an underlying");return}He(!0);try{const s=new URLSearchParams({underlying:F,exchange:v,limit:"5000"});he&&s.append("expiry",he),B&&B!=="__all__"&&s.append("instrumenttype",B),xe&&s.append("strike_min",xe),ue&&s.append("strike_max",ue);const t=await(await fetch(`/historify/api/fno/chain?${s}`,{credentials:"include"})).json();t.status==="success"?(Be(t.data||[]),z(new Set),n.success(`Found ${t.count} symbols`)):n.error(t.message||"Failed to load FNO chain")}catch(s){console.error("Error loading FNO chain:",s),n.error("Failed to load FNO chain")}finally{He(!1)}},hs=async(s,a="custom")=>{if(s.length===0){n.warning("No symbols selected");return}try{const t=await y(),c=await(await fetch("/historify/api/jobs",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({job_type:a,symbols:s,interval:ze,start_date:de,end_date:$e,incremental:Ue})})).json();c.status==="success"?(n.success(`Job started: ${c.total_symbols} symbols`),N(),Ie("jobs")):n.error(c.message||"Failed to create job")}catch(t){console.error("Error creating job:",t),n.error("Failed to create job")}},ra=async()=>{if(b.length===0){n.warning("Watchlist is empty");return}const s=b.map(a=>({symbol:a.symbol,exchange:a.exchange}));await hs(s,"watchlist")},ca=async s=>{try{const a=await y(),r=await(await fetch(`/historify/api/jobs/${s}/pause`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success("Job paused"),N()):n.error(r.message||"Failed to pause job")}catch(a){console.error("Error pausing job:",a),n.error("Failed to pause job")}},oa=async s=>{try{const a=await y(),r=await(await fetch(`/historify/api/jobs/${s}/resume`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success("Job resumed"),N()):n.error(r.message||"Failed to resume job")}catch(a){console.error("Error resuming job:",a),n.error("Failed to resume job")}},ms=async s=>{try{const a=await y(),r=await(await fetch(`/historify/api/jobs/${s}/cancel`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success("Job cancellation requested"),N()):n.error(r.message||"Failed to cancel job")}catch(a){console.error("Error cancelling job:",a),n.error("Failed to cancel job")}},ia=async s=>{try{const a=await y(),r=await(await fetch(`/historify/api/jobs/${s}/retry`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success(`Retrying ${r.retry_count} failed items`),N()):n.error(r.message||"Failed to retry job")}catch(a){console.error("Error retrying job:",a),n.error("Failed to retry job")}},da=async s=>{try{const a=await y(),r=await(await fetch(`/historify/api/jobs/${s}`,{method:"DELETE",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success("Job deleted"),N(),Ls?.id===s&&$s(null)):n.error(r.message||"Failed to delete job")}catch(a){console.error("Error deleting job:",a),n.error("Failed to delete job")}},ha=async()=>{if(q)try{const s=await y(),t=await(await fetch("/historify/api/delete",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify(q)})).json();t.status==="success"?(n.success(t.message),Q(),T()):n.error(t.message||"Failed to delete data")}catch(s){console.error("Error deleting data:",s),n.error("Failed to delete data")}finally{fe(!1),rs(null)}},ma=s=>{const a=s.target.files?.[0];if(a){if(!a.name.toLowerCase().endsWith(".csv")){n.error("Please select a CSV file");return}ts(a)}},xa=async()=>{if(!Y){n.warning("Please select a CSV file");return}if(!je.trim()){n.warning("Please enter a symbol");return}ns(!0);try{const s=await y(),a=new FormData;a.append("file",Y),a.append("symbol",je.trim().toUpperCase()),a.append("exchange",ss),a.append("interval",as);const r=await(await fetch("/historify/api/upload",{method:"POST",headers:{"X-CSRFToken":s},credentials:"include",body:a})).json();r.status==="success"?(n.success(`${r.message}`),W(!1),ts(null),es(""),ge.current&&(ge.current.value=""),Q(),T()):n.error(r.message||"Failed to upload data")}catch(s){console.error("Error uploading CSV:",s),n.error("Failed to upload CSV")}finally{ns(!1)}},ua=async()=>{ds(!0);try{const s=await y(),a=os==="selected"?Array.from(J).map(c=>{const[x,ya]=c.split(":");return{symbol:x,exchange:ya}}):null,r=await(await fetch("/historify/api/export/bulk",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify({format:cs,symbols:a,compression:"zstd"})})).json();r.status==="success"?(n.success(`${r.message}`),window.location.href="/historify/api/export/bulk/download",Z(!1)):n.error(r.message||"Failed to export data")}catch(s){console.error("Error exporting data:",s),n.error("Failed to export data")}finally{ds(!1)}},pa=(s,a)=>{const t=`${s}:${a}`;ye(r=>{const c=new Set(r);return c.has(t)?c.delete(t):c.add(t),c})},ja=s=>{z(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},ga=s=>{switch(s){case"running":return"bg-blue-500";case"paused":return"bg-yellow-500";case"completed":return"bg-green-500";case"completed_with_errors":return"bg-orange-500";case"failed":return"bg-red-500";case"cancelled":return"bg-gray-500";default:return"bg-gray-400"}},fa=async()=>{const s=await I();if(s.success){const a=xs.getState().appMode;n.success(`Switched to ${a==="live"?"Live":"Analyze"} mode`)}else n.error(s.message||"Failed to toggle mode")};return e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[e.jsx("div",{className:"border-b border-border bg-card/50",children:e.jsxs("div",{className:"px-4 py-3 flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(us,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Historify"}),e.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:"Historical Data Management"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Ra,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium",children:[re.database_size_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Pa,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:re.total_records.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(za,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:re.total_symbols})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(w,{variant:A==="live"?"default":"secondary",className:"cursor-pointer",onClick:fa,children:[A==="live"?e.jsx(La,{className:"h-3 w-3 mr-1"}):e.jsx($a,{className:"h-3 w-3 mr-1"}),A==="live"?"Live":"Analyze"]}),e.jsx(bs,{to:"/historify/charts",children:e.jsxs(o,{variant:"outline",size:"sm",children:[e.jsx(ps,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Charts"})]})})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(Ta,{value:_s,onValueChange:Ie,className:"h-full flex flex-col",children:[e.jsx("div",{className:"border-b border-border px-4 overflow-x-auto",children:e.jsxs(Oa,{className:"h-10 bg-transparent w-max min-w-full sm:w-auto",children:[e.jsxs(ee,{value:"catalog",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(us,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Data Catalog"}),e.jsx("span",{className:"sm:hidden",children:"Catalog"})]}),e.jsxs(ee,{value:"watchlist",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(Ja,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Watchlist"}),e.jsx("span",{className:"sm:hidden",children:"Watch"}),b.length>0&&e.jsx(w,{variant:"secondary",className:"ml-1 h-5 min-w-5 text-xs",children:b.length})]}),e.jsxs(ee,{value:"fno",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(js,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"FNO Discovery"}),e.jsx("span",{className:"sm:hidden",children:"FNO"})]}),e.jsxs(ee,{value:"jobs",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download Jobs"}),e.jsx("span",{className:"sm:hidden",children:"Jobs"}),X.filter(s=>s.status==="running"||s.status==="paused").length>0&&e.jsx(w,{variant:"default",className:"ml-1 h-5 min-w-5 text-xs bg-blue-500",children:X.filter(s=>s.status==="running"||s.status==="paused").length})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx(se,{value:"catalog",className:"h-full m-0 p-4 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{children:e.jsx(O,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(k,{placeholder:"Search symbols...",value:u.search,onChange:s=>be(a=>({...a,search:s.target.value})),className:"h-9"})}),e.jsxs(p,{value:u.exchange||"__all__",onValueChange:s=>be(a=>({...a,exchange:s})),children:[e.jsx(j,{className:"w-full sm:w-32 h-9",children:e.jsx(g,{placeholder:"Exchange"})}),e.jsxs(f,{children:[e.jsx(i,{value:"__all__",children:"All"}),ne.map(s=>e.jsx(i,{value:s,children:s},s))]})]}),e.jsxs(p,{value:u.interval||"__all__",onValueChange:s=>be(a=>({...a,interval:s})),children:[e.jsx(j,{className:"w-full sm:w-24 h-9",children:e.jsx(g,{placeholder:"Interval"})}),e.jsxs(f,{children:[e.jsx(i,{value:"__all__",children:"All"}),qs.map(s=>e.jsx(i,{value:s,children:s},s))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Z(!0),disabled:le.length===0,className:"h-9",children:[e.jsx(Ua,{className:"h-4 w-4 mr-1"}),"Export"]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>W(!0),className:"h-9",children:[e.jsx(Ma,{className:"h-4 w-4 mr-1"}),"Import"]})]})]})})}),e.jsx(C,{children:e.jsx(K,{className:"h-[calc(100vh-320px)]",children:e.jsxs(Ee,{children:[e.jsx(Fe,{children:e.jsxs(_,{children:[e.jsx(h,{className:"w-10",children:e.jsx(ae,{checked:J.size===U.length&&U.length>0,onCheckedChange:s=>{ye(s?new Set(U.map(a=>`${a.symbol}:${a.exchange}`)):new Set)}})}),e.jsx(h,{children:"Symbol"}),e.jsx(h,{className:"hidden sm:table-cell",children:"Exchange"}),e.jsx(h,{className:"hidden sm:table-cell",children:"Interval"}),e.jsx(h,{className:"text-right",children:"Records"}),e.jsx(h,{className:"hidden md:table-cell",children:"Date Range"}),e.jsx(h,{className:"w-20"})]})}),e.jsx(De,{children:U.length===0?e.jsx(_,{children:e.jsx(d,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No data available. Add symbols to watchlist and download data."})}):U.map(s=>e.jsxs(_,{children:[e.jsx(d,{children:e.jsx(ae,{checked:J.has(`${s.symbol}:${s.exchange}`),onCheckedChange:()=>pa(s.symbol,s.exchange)})}),e.jsx(d,{className:"font-medium",children:e.jsxs("div",{children:[s.symbol,e.jsxs("span",{className:"sm:hidden text-xs text-muted-foreground ml-1",children:["(",s.exchange,")"]})]})}),e.jsx(d,{className:"hidden sm:table-cell",children:e.jsx(w,{variant:"outline",children:s.exchange})}),e.jsx(d,{className:"hidden sm:table-cell",children:s.interval}),e.jsx(d,{className:"text-right",children:s.record_count.toLocaleString()}),e.jsxs(d,{className:"hidden md:table-cell text-muted-foreground text-sm",children:[s.first_date," - ",s.last_date]}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,children:e.jsx(bs,{to:`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=${s.interval}`,children:e.jsx(ps,{className:"h-3.5 w-3.5"})})}),e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>{rs({symbol:s.symbol,exchange:s.exchange,interval:s.interval}),fe(!0)},children:e.jsx(gs,{className:"h-3.5 w-3.5"})})]})})]},`${s.symbol}-${s.exchange}-${s.interval}`))})]})})})]})}),e.jsx(se,{value:"watchlist",className:"h-full m-0 p-4 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{children:[e.jsx(L,{className:"pb-3",children:e.jsx($,{className:"text-base",children:"Add Symbol"})}),e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",ref:ie,children:[e.jsx(k,{placeholder:"Search symbol...",value:R,onChange:s=>ce(s.target.value.toUpperCase()),className:"h-9"}),Es&&Pe.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-50 max-h-60 overflow-auto",children:Pe.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-muted cursor-pointer",onClick:()=>{ce(s.symbol),Re(s.exchange),V(!1)},children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.name," - ",s.exchange]})]},`${s.symbol}-${s.exchange}`))})]}),e.jsxs(p,{value:M,onValueChange:Re,children:[e.jsx(j,{className:"w-full sm:w-28 h-9",children:e.jsx(g,{})}),e.jsx(f,{children:ne.map(s=>e.jsx(i,{value:s,children:s},s))})]}),e.jsxs(o,{onClick:ea,className:"h-9",children:[e.jsx(Va,{className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs(o,{variant:"outline",onClick:()=>H(!0),className:"h-9",children:[e.jsx(Ba,{className:"h-4 w-4 mr-1"}),"Bulk"]})]})})]}),e.jsxs(C,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs($,{className:"text-base flex items-center gap-2",children:[e.jsx(Xa,{className:"h-4 w-4"}),"Download Settings"]})}),e.jsx(O,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground mb-2 block",children:"Quick Date Range"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Qa.map(s=>e.jsx(o,{variant:"outline",size:"sm",className:ve("h-8",de===Oe(s.months)&&"bg-primary text-primary-foreground"),onClick:()=>{Le(Oe(s.months)),Je(new Date().toISOString().split("T")[0])},children:s.label},s.label))})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"From"}),e.jsx(k,{type:"date",value:de,onChange:s=>Le(s.target.value),className:"h-9 mt-1"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"To"}),e.jsx(k,{type:"date",value:$e,onChange:s=>Je(s.target.value),className:"h-9 mt-1"})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"Interval"}),e.jsxs(p,{value:ze,onValueChange:Fs,children:[e.jsx(j,{className:"h-9 mt-1",children:e.jsx(g,{})}),e.jsx(f,{children:(Ae?.storage_intervals||["1m","D"]).map(s=>e.jsx(i,{value:s,children:s==="1m"?"1 Minute":s==="D"?"Daily":s},s))})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Other timeframes (5m, 15m, 30m, 1h) computed from 1m data"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(m,{className:"font-medium",children:"Incremental Download"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Only download new data after last available timestamp"})]}),e.jsx(Ia,{checked:Ue,onCheckedChange:Ds})]}),e.jsxs(o,{className:"w-full h-10",onClick:ra,disabled:b.length===0,children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Download All Watchlist (",b.length," symbols)"]})]})})]}),e.jsxs(C,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs($,{className:"text-base",children:["Watchlist (",b.length,")"]})}),e.jsx(O,{className:"p-0",children:e.jsx(K,{className:"h-[calc(100vh-580px)]",children:e.jsxs(Ee,{children:[e.jsx(Fe,{children:e.jsxs(_,{children:[e.jsx(h,{children:"Symbol"}),e.jsx(h,{className:"hidden sm:table-cell",children:"Exchange"}),e.jsx(h,{className:"hidden md:table-cell",children:"Added"}),e.jsx(h,{className:"w-10"})]})}),e.jsx(De,{children:b.length===0?e.jsx(_,{children:e.jsx(d,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No symbols in watchlist. Add symbols above."})}):b.map(s=>e.jsxs(_,{children:[e.jsxs(d,{className:"font-medium",children:[s.symbol,e.jsxs("span",{className:"sm:hidden text-xs text-muted-foreground ml-1",children:["(",s.exchange,")"]})]}),e.jsx(d,{className:"hidden sm:table-cell",children:e.jsx(w,{variant:"outline",children:s.exchange})}),e.jsx(d,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.added_at).toLocaleDateString()}),e.jsx(d,{children:e.jsx(o,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>sa(s.symbol,s.exchange),children:e.jsx(Ha,{className:"h-4 w-4"})})})]},s.id))})]})})})]})]})}),e.jsx(se,{value:"fno",className:"h-full m-0 p-4 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{children:[e.jsxs(L,{className:"pb-3",children:[e.jsx($,{className:"text-base",children:"FNO Chain Discovery"}),e.jsx(Fa,{children:"Discover option and futures chains for bulk download"})]}),e.jsxs(O,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"Exchange"}),e.jsxs(p,{value:v,onValueChange:Ts,children:[e.jsx(j,{className:"h-9 mt-1",children:e.jsx(g,{})}),e.jsx(f,{children:["NFO","BFO","MCX","CDS"].map(s=>e.jsx(i,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"Underlying"}),e.jsxs(p,{value:F,onValueChange:Me,children:[e.jsx(j,{className:"h-9 mt-1",children:e.jsx(g,{placeholder:"Select underlying"})}),e.jsx(f,{children:Os.map(s=>e.jsx(i,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"Expiry"}),e.jsxs(p,{value:he,onValueChange:me,children:[e.jsx(j,{className:"h-9 mt-1",children:e.jsx(g,{placeholder:"All expiries"})}),e.jsxs(f,{children:[e.jsx(i,{value:"__all__",children:"All expiries"}),Is.map(s=>e.jsx(i,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(m,{className:"text-sm text-muted-foreground",children:"Instrument"}),e.jsxs(p,{value:B,onValueChange:Rs,children:[e.jsx(j,{className:"h-9 mt-1",children:e.jsx(g,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"__all__",children:"All"}),e.jsx(i,{value:"FUT",children:"Futures"}),e.jsx(i,{value:"CE",children:"Call (CE)"}),e.jsx(i,{value:"PE",children:"Put (PE)"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsx(k,{type:"number",placeholder:"Min Strike",value:xe,onChange:s=>Ps(s.target.value),className:"h-9"}),e.jsx(k,{type:"number",placeholder:"Max Strike",value:ue,onChange:s=>zs(s.target.value),className:"h-9"})]}),e.jsxs(o,{onClick:na,disabled:Xe||!F,className:"h-9",children:[Xe?e.jsx(te,{className:"h-4 w-4 animate-spin mr-1"}):e.jsx(js,{className:"h-4 w-4 mr-1"}),"Search"]})]})]})]}),D.length>0&&e.jsxs(C,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2",children:[e.jsxs($,{className:"text-base",children:["Found ",D.length," symbols",P.size>0&&e.jsxs(w,{className:"ml-2",children:[P.size," selected"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>z(new Set(D.map(s=>s.symbol))),children:"Select All"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>z(new Set),children:"Clear"}),e.jsxs(o,{size:"sm",disabled:P.size===0,onClick:()=>{const s=Array.from(P).map(a=>{const t=D.find(r=>r.symbol===a);return{symbol:a,exchange:t?.exchange||v}});hs(s,"fno_chain")},children:[e.jsx(Wa,{className:"h-4 w-4 mr-1"}),"Download"]})]})]})}),e.jsx(O,{className:"p-0",children:e.jsx(K,{className:"h-[calc(100vh-480px)]",children:e.jsxs(Ee,{children:[e.jsx(Fe,{children:e.jsxs(_,{children:[e.jsx(h,{className:"w-10",children:e.jsx(ae,{checked:P.size===D.length,onCheckedChange:s=>{z(s?new Set(D.map(a=>a.symbol)):new Set)}})}),e.jsx(h,{children:"Symbol"}),e.jsx(h,{className:"hidden sm:table-cell",children:"Type"}),e.jsx(h,{className:"hidden sm:table-cell",children:"Expiry"}),e.jsx(h,{className:"hidden md:table-cell text-right",children:"Strike"}),e.jsx(h,{className:"hidden md:table-cell text-right",children:"Lot Size"})]})}),e.jsx(De,{children:D.map(s=>e.jsxs(_,{children:[e.jsx(d,{children:e.jsx(ae,{checked:P.has(s.symbol),onCheckedChange:()=>ja(s.symbol)})}),e.jsx(d,{className:"font-medium",children:s.symbol}),e.jsx(d,{className:"hidden sm:table-cell",children:e.jsx(w,{variant:s.instrumenttype==="FUT"?"default":s.instrumenttype==="CE"?"secondary":"outline",children:s.instrumenttype})}),e.jsx(d,{className:"hidden sm:table-cell",children:s.expiry}),e.jsx(d,{className:"hidden md:table-cell text-right",children:s.strike}),e.jsx(d,{className:"hidden md:table-cell text-right",children:s.lotsize})]},s.symbol))})]})})})]})]})}),e.jsx(se,{value:"jobs",className:"h-full m-0 p-4 overflow-auto",children:e.jsx("div",{className:"space-y-4",children:e.jsxs(C,{children:[e.jsx(L,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx($,{className:"text-base",children:"Download Jobs"}),e.jsxs(o,{variant:"outline",size:"sm",onClick:N,disabled:Ye,children:[e.jsx(fs,{className:ve("h-4 w-4 mr-1",Ye&&"animate-spin")}),"Refresh"]})]})}),e.jsx(O,{className:"p-0",children:e.jsx(K,{className:"h-[calc(100vh-280px)]",children:X.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No download jobs yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start a download from the Watchlist or FNO Discovery tabs"})]}):e.jsx("div",{className:"divide-y divide-border",children:X.map(s=>{const a=Js[s.id],t=a?.percent||(s.total_symbols>0?Math.round(s.completed_symbols/s.total_symbols*100):0);return e.jsx("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:ve("w-2 h-2 rounded-full",ga(s.status))}),e.jsxs("span",{className:"font-medium truncate",children:["Job ",s.id]}),e.jsx(w,{variant:"outline",className:"text-xs",children:s.job_type}),e.jsx(w,{variant:s.status==="running"?"default":s.status==="paused"?"secondary":"outline",className:"text-xs",children:s.status})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.interval," | ",s.start_date," to ",s.end_date]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ya,{className:"h-3.5 w-3.5 text-green-500"}),s.completed_symbols]}),s.failed_symbols>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[e.jsx(qa,{className:"h-3.5 w-3.5"}),s.failed_symbols]}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",s.total_symbols," total"]})]}),(s.status==="running"||s.status==="paused")&&e.jsxs("div",{className:"mt-2",children:[e.jsx(Da,{value:t,className:"h-1.5"}),a&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Downloading: ",a.symbol," (",t,"%)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>ca(s.id),children:e.jsx(Za,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>ms(s.id),children:e.jsx(ys,{className:"h-4 w-4"})})]}),s.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>oa(s.id),children:e.jsx(Ga,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>ms(s.id),children:e.jsx(ys,{className:"h-4 w-4"})})]}),(s.status==="completed_with_errors"||s.status==="failed")&&s.failed_symbols>0&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>ia(s.id),children:[e.jsx(fs,{className:"h-4 w-4 mr-1"}),"Retry"]}),s.status!=="running"&&s.status!=="paused"&&e.jsx(o,{variant:"ghost",size:"sm",className:"text-destructive",onClick:()=>da(s.id),children:e.jsx(gs,{className:"h-4 w-4"})})]})]})},s.id)})})})})]})})})]})]})}),e.jsx(Ne,{open:Us,onOpenChange:H,children:e.jsxs(we,{className:"sm:max-w-md",children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Bulk Add Symbols"}),e.jsx(ke,{children:"Add multiple symbols at once. One per line: SYMBOL,EXCHANGE"})]}),e.jsx(Aa,{placeholder:`RELIANCE,NSE
INFY,NSE
NIFTY24DEC25000CE,NFO`,value:Ze,onChange:s=>Ge(s.target.value),rows:8}),e.jsxs(_e,{children:[e.jsx(o,{variant:"outline",onClick:()=>H(!1),children:"Cancel"}),e.jsxs(o,{onClick:aa,disabled:Qe,children:[Qe&&e.jsx(te,{className:"h-4 w-4 animate-spin mr-1"}),"Add Symbols"]})]})]})}),e.jsx(Ne,{open:Ms,onOpenChange:W,children:e.jsxs(we,{className:"sm:max-w-md",children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Import CSV Data"}),e.jsx(ke,{children:"Upload a CSV file with OHLCV data"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Symbol"}),e.jsx(k,{value:je,onChange:s=>es(s.target.value.toUpperCase()),placeholder:"RELIANCE",className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Exchange"}),e.jsxs(p,{value:ss,onValueChange:Vs,children:[e.jsx(j,{className:"mt-1",children:e.jsx(g,{})}),e.jsx(f,{children:ne.map(s=>e.jsx(i,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Interval"}),e.jsxs(p,{value:as,onValueChange:Bs,children:[e.jsx(j,{className:"mt-1",children:e.jsx(g,{})}),e.jsx(f,{children:(Ae?.storage_intervals||["1m","D"]).map(s=>e.jsx(i,{value:s,children:s==="1m"?"1 Minute":s==="D"?"Daily":s},s))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Only 1min and Daily data can be stored"})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"CSV File"}),e.jsx(k,{ref:ge,type:"file",accept:".csv",onChange:ma,className:"mt-1"}),Y&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Selected: ",Y.name]})]})]}),e.jsxs(_e,{children:[e.jsx(o,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),e.jsxs(o,{onClick:xa,disabled:ls,children:[ls&&e.jsx(te,{className:"h-4 w-4 animate-spin mr-1"}),"Upload"]})]})]})}),e.jsx(Ne,{open:Hs,onOpenChange:Z,children:e.jsxs(we,{className:"sm:max-w-md",children:[e.jsxs(Se,{children:[e.jsx(Ce,{children:"Export Data"}),e.jsx(ke,{children:"Export historical data to file"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Export Format"}),e.jsxs(p,{value:cs,onValueChange:s=>Ws(s),children:[e.jsx(j,{className:"mt-1",children:e.jsx(g,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"csv",children:"CSV"}),e.jsx(i,{value:"txt",children:"TXT (Tab-separated)"}),e.jsx(i,{value:"zip",children:"ZIP Archive"}),e.jsx(i,{value:"parquet",children:"Parquet (ZSTD)"})]})]})]}),e.jsxs("div",{children:[e.jsx(m,{children:"Symbols"}),e.jsxs(p,{value:os,onValueChange:s=>Ys(s),children:[e.jsx(j,{className:"mt-1",children:e.jsx(g,{})}),e.jsxs(f,{children:[e.jsx(i,{value:"all",children:"All Data"}),e.jsxs(i,{value:"selected",disabled:J.size===0,children:["Selected (",J.size,")"]})]})]})]})]}),e.jsxs(_e,{children:[e.jsx(o,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),e.jsxs(o,{onClick:ua,disabled:is,children:[is&&e.jsx(te,{className:"h-4 w-4 animate-spin mr-1"}),"Export"]})]})]})}),e.jsx(va,{open:Xs,onOpenChange:fe,children:e.jsxs(Na,{children:[e.jsxs(wa,{children:[e.jsx(Sa,{children:"Delete Data"}),e.jsxs(Ca,{children:["Are you sure you want to delete all data for ",q?.symbol," (",q?.exchange,")? This action cannot be undone."]})]}),e.jsxs(ka,{children:[e.jsx(_a,{children:"Cancel"}),e.jsx(Ea,{onClick:ha,className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})})]})}export{ft as default};
