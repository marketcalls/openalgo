import{r as a,j as e}from"./vendor-react-RhKMXzW9.js";import{B as l,e as $,t as r}from"./index-C0TR9J4M.js";import{c as h}from"./chartink-0ryXxVML.js";import{C as K,b as U,c as q,d as z,a as G}from"./card-BPq4fCpJ.js";import{P as xe,a as ue,b as ye,C as je,c as ge,d as pe,e as Se,f as be,g as fe}from"./popover-PATQlsP9.js";import{D as Ce,b as Ne,c as ve,d as Te,e as Ee,f as ke}from"./dialog-GPWoOsld.js";import{I as X}from"./input-CwAuW-QF.js";import{L as o}from"./label-CQY1xAoA.js";import{S as J,a as W,b as Y,c as Z,d as ee}from"./select-DX9I_Xui.js";import{S as A}from"./skeleton-8-Ymcfc9.js";import{T as we,a as De,b as se,c,d as Ae,e as i}from"./table-BZS2rMWU.js";import{T as Ie,a as Be,b as ae,c as te}from"./tabs-BV3x1_z2.js";import{T as Pe}from"./textarea-CsHPPs1B.js";import{A as Fe,R as Re,au as Le,az as Me,S as Oe,F as Ve,ab as He}from"./vendor-icons-Chlwwn8V.js";import{c as Qe,L as _e}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-radix-B_grJx4K.js";const $e=["NSE","BSE"],Ke=["MIS","CNC"];function cs(){const{strategyId:n}=Qe(),[S,re]=a.useState(null),[d,I]=a.useState([]),[le,B]=a.useState(!0),[x,u]=a.useState(!1),[b,f]=a.useState(""),[ne,P]=a.useState([]),[oe,F]=a.useState(!1),[R,L]=a.useState(!1),[M,O]=a.useState(null),[C,N]=a.useState(""),[m,v]=a.useState(""),[y,V]=a.useState("1"),[T,E]=a.useState(""),[j,k]=a.useState(""),[ce,g]=a.useState(!1),[w,H]=a.useState(null),p=async()=>{if(n)try{B(!0);const s=await h.getStrategy(Number(n));re(s.strategy),I(s.mappings||[])}catch(s){console.error("Failed to fetch strategy:",s),r.error("Failed to load strategy")}finally{B(!1)}};a.useEffect(()=>{p()},[]);const Q=a.useCallback(async s=>{if(s.length<2){P([]);return}try{F(!0);const t=m||void 0,D=await h.searchSymbols(s,t);P(D)}catch(t){console.error("Search failed:",t)}finally{F(!1)}},[m]);a.useEffect(()=>{const s=setTimeout(()=>{Q(b)},300);return()=>clearTimeout(s)},[b,Q]);const ie=s=>{O(s),f(s.symbol),N(s.symbol),(s.exchange==="NSE"||s.exchange==="BSE")&&v(s.exchange),L(!1),E("MIS")},de=async s=>{if(s.preventDefault(),!C){r.error("Please enter the Chartink symbol");return}if(!m){r.error("Please select an exchange (NSE or BSE only)");return}if(!y||Number(y)<1){r.error("Quantity must be at least 1");return}if(!T){r.error("Please select a product type (MIS or CNC)");return}try{u(!0);const t=await h.addSymbolMapping(Number(n),{symbol:C,exchange:m,quantity:Number(y),product_type:T});t.status==="success"?(r.success("Symbol added successfully"),O(null),f(""),N(""),v(""),V("1"),E(""),p()):r.error(t.message||"Failed to add symbol")}catch(t){console.error("Failed to add symbol:",t),r.error("Failed to add symbol")}finally{u(!1)}},me=async s=>{if(s.preventDefault(),!j.trim()){r.error("Please enter CSV data");return}try{u(!0);const t=await h.addBulkSymbols(Number(n),j);if(t.status==="success"){const{added:D=0,failed:_=0}=t.data||{};r.success(`Added ${D} symbols${_>0?`, ${_} failed`:""}`),k(""),p()}else r.error(t.message||"Failed to add symbols")}catch(t){console.error("Failed to add bulk symbols:",t),r.error("Failed to add symbols")}finally{u(!1)}},he=async()=>{if(!(w===null||!n))try{const s=await h.deleteSymbolMapping(Number(n),w);s.status==="success"?(I(d.filter(t=>t.id!==w)),r.success("Symbol removed")):r.error(s.message||"Failed to remove symbol")}catch(s){console.error("Failed to delete mapping:",s),r.error("Failed to remove symbol")}finally{g(!1),H(null)}};return le?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(A,{className:"h-8 w-32"}),e.jsx(A,{className:"h-64"}),e.jsx(A,{className:"h-48"})]}):S?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(l,{variant:"ghost",asChild:!0,children:e.jsxs(_e,{to:`/chartink/${n}`,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Back to ",S.name]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Configure Symbols"}),e.jsxs("p",{className:"text-muted-foreground",children:["Add Chartink symbols to ",S.name," (NSE/BSE only)"]})]}),e.jsxs(l,{variant:"outline",onClick:p,children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx(q,{children:"Add Symbols"}),e.jsx(z,{children:"Add individual symbols or bulk import from CSV (NSE/BSE exchanges, MIS/CNC products only)"})]}),e.jsx(G,{children:e.jsxs(Ie,{defaultValue:"single",children:[e.jsxs(Be,{className:"grid w-full grid-cols-2",children:[e.jsxs(ae,{value:"single",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Single Symbol"]}),e.jsxs(ae,{value:"bulk",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Bulk Import"]})]}),e.jsx(te,{value:"single",children:e.jsxs("form",{onSubmit:de,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Search Symbol"}),e.jsxs(xe,{open:R,onOpenChange:L,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(l,{variant:"outline",role:"combobox","aria-expanded":R,className:"w-full justify-between font-normal",children:[M?M.symbol:"Search...",e.jsx(Oe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ye,{className:"w-[300px] p-0",align:"start",children:e.jsxs(je,{children:[e.jsx(ge,{placeholder:"Search symbols...",value:b,onValueChange:f}),e.jsxs(pe,{children:[e.jsx(Se,{children:oe?"Searching...":"No symbols found."}),e.jsx(be,{children:ne.filter(s=>s.exchange==="NSE"||s.exchange==="BSE").map(s=>e.jsx(fe,{value:s.symbol,onSelect:()=>ie(s),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.symbol}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.name," â€¢ ",s.exchange]})]})},`${s.symbol}-${s.exchange}`))})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Chartink Symbol"}),e.jsx(X,{placeholder:"RELIANCE",value:C,onChange:s=>N(s.target.value.toUpperCase())})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Exchange"}),e.jsxs(J,{value:m,onValueChange:s=>v(s),children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"Select"})}),e.jsx(Z,{children:$e.map(s=>e.jsx(ee,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Quantity"}),e.jsx(X,{type:"number",min:"1",value:y,onChange:s=>V(s.target.value),placeholder:"Qty"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Product"}),e.jsxs(J,{value:T,onValueChange:s=>E(s),children:[e.jsx(W,{children:e.jsx(Y,{placeholder:"Select"})}),e.jsx(Z,{children:Ke.map(s=>e.jsx(ee,{value:s,children:s},s))})]})]})]}),e.jsx(l,{type:"submit",disabled:x,children:x?"Adding...":"Add Symbol"})]})}),e.jsx(te,{value:"bulk",children:e.jsxs("form",{onSubmit:me,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"CSV Data"}),e.jsx(Pe,{placeholder:`ChartinkSymbol,Exchange,Quantity,Product
RELIANCE,NSE,100,CNC
TATAMOTORS,BSE,50,MIS`,value:j,onChange:s=>k(s.target.value),rows:6,maxLength:102400,className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Format: ChartinkSymbol,Exchange,Quantity,Product (one per line, no header). Max 100KB.",e.jsx("br",{}),"Exchange: NSE or BSE only | Product: MIS or CNC only"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{type:"submit",disabled:x,children:x?"Importing...":"Import Symbols"}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>k(""),disabled:!j,children:"Clear"})]})]})})]})})]}),e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Current Symbol Mappings"]}),e.jsxs(z,{children:[d.length," symbol",d.length!==1?"s":""," configured"]})]}),e.jsx(G,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx("p",{className:"text-sm",children:"Add symbols using the form above."})]}):e.jsxs(we,{children:[e.jsx(De,{children:e.jsxs(se,{children:[e.jsx(c,{children:"Chartink Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{className:"text-right",children:"Quantity"}),e.jsx(c,{children:"Product"}),e.jsx(c,{className:"text-right",children:"Added"}),e.jsx(c,{className:"w-16"})]})}),e.jsx(Ae,{children:d.map(s=>e.jsxs(se,{children:[e.jsx(i,{className:"font-medium",children:s.chartink_symbol}),e.jsx(i,{children:e.jsx($,{variant:"outline",children:s.exchange})}),e.jsx(i,{className:"text-right",children:s.quantity}),e.jsx(i,{children:e.jsx($,{variant:"secondary",children:s.product_type})}),e.jsx(i,{className:"text-right text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(i,{children:e.jsx(l,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>{H(s.id),g(!0)},children:e.jsx(He,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(Ce,{open:ce,onOpenChange:g,children:e.jsxs(Ne,{children:[e.jsxs(ve,{children:[e.jsx(Te,{children:"Remove Symbol"}),e.jsx(Ee,{children:"Are you sure you want to remove this symbol from the strategy? This action cannot be undone."})]}),e.jsxs(ke,{children:[e.jsx(l,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:he,children:"Remove Symbol"})]})]})})]}):null}export{cs as default};
