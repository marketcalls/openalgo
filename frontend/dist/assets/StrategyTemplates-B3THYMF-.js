import{j as e,r as l}from"./vendor-react-Df-MYEHc.js";import{T as K,a as W,b as C,c as J}from"./tabs-Ct44Qaax.js";import{w as h,e as q,B as _,s as U}from"./index-Bd6js41n.js";import{C as Q,a as Z,b as ee,d as se,e as ae}from"./card-CC-hOcpD.js";import{D as te,b as le,c as ne,d as re,f as ce}from"./dialog-DXc49685.js";import{I as D}from"./input-DJQENBZF.js";import{L as x}from"./label-DqJSyuUm.js";import{S as m,a as p,b as g,c as j,d as r}from"./select-B7fGBsLz.js";import{a as ie}from"./vendor-router-4BT-EZah.js";import"./vendor-charts-DPXZ0pfV.js";import"./vendor-radix-IoylIoim.js";import"./vendor-icons-nFj7rtAi.js";const y="/strategy/api",$={getTemplates:async a=>{const t=a?`?category=${a}`:"";return(await h.get(`${y}/templates${t}`)).data.data},getTemplate:async a=>(await h.get(`${y}/templates/${a}`)).data.data,createTemplate:async a=>(await h.post(`${y}/templates`,a)).data.data,deleteTemplate:async a=>{await h.delete(`${y}/templates/${a}`)},deployTemplate:async(a,t)=>(await h.post(`${y}/templates/${a}/deploy`,t)).data.data},de={neutral:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",bullish:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",bearish:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"};function oe({template:a,onDeploy:t}){const n=a.legs_config||[];return e.jsxs(Q,{className:"flex flex-col",children:[e.jsx(Z,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"text-sm",children:a.name}),e.jsx(q,{variant:"outline",className:`text-[10px] ${de[a.category]||""}`,children:a.category})]})}),e.jsxs(se,{className:"flex-1 pb-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:a.description}),e.jsx("div",{className:"space-y-1",children:n.map((c,d)=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("span",{className:String(c.action)==="BUY"?"text-green-600":"text-red-600",children:String(c.action)}),e.jsx("span",{children:String(c.option_type||"FUT")}),e.jsx("span",{className:"text-muted-foreground",children:String(c.offset||"")})]},d))})]}),e.jsx(ae,{className:"pt-2",children:e.jsx(_,{size:"sm",className:"w-full",onClick:()=>t(a),children:"Deploy"})})]})}function xe({templates:a,onDeploy:t}){return a.length===0?e.jsx("div",{className:"flex items-center justify-center h-40 text-sm text-muted-foreground",children:"No templates match the selected filter."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(n=>e.jsx(oe,{template:n,onDeploy:t},n.id))})}const ue=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"},{value:"CDS",label:"CDS"},{value:"BCD",label:"BCD"},{value:"MCX",label:"MCX"}],E={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX","SENSEX50"],CDS:["USDINR","EURINR","GBPINR","JPYINR"],BCD:["USDINR","EURINR"],MCX:["CRUDEOIL","GOLD","SILVER","NATURALGAS"]};function he({open:a,onClose:t,template:n,onDeployed:c}){const[d,N]=l.useState(""),[o,f]=l.useState("NFO"),[u,v]=l.useState("NIFTY"),[i,S]=l.useState(E.NFO),[T,V]=l.useState("current_week"),[O,A]=l.useState(1),[F,Y]=l.useState(""),[k,M]=l.useState(null),[I,G]=l.useState(""),[B,P]=l.useState(null),[L,R]=l.useState(!1),X=s=>{s?n&&N(`${n.name} - ${u}`):t()};l.useEffect(()=>{let s=!1;return(async()=>{try{const b=await h.get(`/search/api/underlyings?exchange=${o}`);!s&&b.data.underlyings?.length>0?S(b.data.underlyings):s||S(E[o]||[])}catch{s||S(E[o]||[])}})(),()=>{s=!0}},[o]);const H=s=>{const w=s;f(w);const b=E[w]||[];v(b[0]||"")},z=async()=>{if(!(!n||!d.trim())){R(!0);try{await $.deployTemplate(n.id,{name:d,exchange:o,underlying:u,expiry_type:T,product_type:"MIS",lots:O,default_stoploss_type:F||null,default_stoploss_value:k,default_target_type:I||null,default_target_value:B}),U.success("Strategy deployed"),c(),t()}catch{U.error("Failed to deploy template")}finally{R(!1)}}};return e.jsx(te,{open:a,onOpenChange:X,children:e.jsxs(le,{className:"sm:max-w-[440px]",children:[e.jsx(ne,{children:e.jsxs(re,{children:["Deploy ",n?.name]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{children:"Strategy Name"}),e.jsx(D,{value:d,onChange:s=>N(s.target.value),placeholder:"e.g., NIFTY Short Straddle"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{children:"Exchange"}),e.jsxs(m,{value:o,onValueChange:H,children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsx(j,{children:ue.map(s=>e.jsx(r,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{children:"Underlying"}),e.jsxs(m,{value:u,onValueChange:v,children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsx(j,{children:i.map(s=>e.jsx(r,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{children:"Expiry Type"}),e.jsxs(m,{value:T,onValueChange:V,children:[e.jsx(p,{children:e.jsx(g,{})}),e.jsxs(j,{children:[e.jsx(r,{value:"current_week",children:"Current Week"}),e.jsx(r,{value:"next_week",children:"Next Week"}),e.jsx(r,{value:"current_month",children:"Current Month"}),e.jsx(r,{value:"next_month",children:"Next Month"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{children:"Lots per Leg"}),e.jsx(D,{type:"number",min:1,value:O,onChange:s=>A(Math.max(1,Number(s.target.value)))})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"Risk Parameters (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{className:"text-xs",children:"Stop Loss"}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs(m,{value:F,onValueChange:Y,children:[e.jsx(p,{className:"h-8 text-xs w-[90px]",children:e.jsx(g,{placeholder:"Off"})}),e.jsxs(j,{children:[e.jsx(r,{value:"",children:"Off"}),e.jsx(r,{value:"percentage",children:"%"}),e.jsx(r,{value:"points",children:"Pts"})]})]}),e.jsx(D,{type:"number",step:"0.01",className:"h-8 text-xs",value:k??"",disabled:!F,onChange:s=>M(s.target.value?Number(s.target.value):null)})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(x,{className:"text-xs",children:"Target"}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs(m,{value:I,onValueChange:G,children:[e.jsx(p,{className:"h-8 text-xs w-[90px]",children:e.jsx(g,{placeholder:"Off"})}),e.jsxs(j,{children:[e.jsx(r,{value:"",children:"Off"}),e.jsx(r,{value:"percentage",children:"%"}),e.jsx(r,{value:"points",children:"Pts"})]})]}),e.jsx(D,{type:"number",step:"0.01",className:"h-8 text-xs",value:B??"",disabled:!I,onChange:s=>P(s.target.value?Number(s.target.value):null)})]})]})]})]})]}),e.jsxs(ce,{children:[e.jsx(_,{variant:"outline",onClick:t,children:"Cancel"}),e.jsx(_,{onClick:z,disabled:L||!d.trim(),children:L?"Deploying...":"Deploy"})]})]})})}function De(){const a=ie(),[t,n]=l.useState("all"),[c,d]=l.useState([]),[N,o]=l.useState(!0),[f,u]=l.useState(null);l.useEffect(()=>{let i=!1;return(async()=>{try{const T=await $.getTemplates();i||d(T)}catch{}finally{i||o(!1)}})(),()=>{i=!0}},[]);const v=t==="all"?c:c.filter(i=>i.category===t);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold mb-1",children:"Strategy Templates"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pre-built F&O strategy templates. Deploy with one click and customize."})]}),e.jsxs(K,{value:t,onValueChange:i=>n(i),children:[e.jsxs(W,{children:[e.jsx(C,{value:"all",className:"text-xs",children:"All"}),e.jsx(C,{value:"neutral",className:"text-xs",children:"Neutral"}),e.jsx(C,{value:"bullish",className:"text-xs",children:"Bullish"}),e.jsx(C,{value:"bearish",className:"text-xs",children:"Bearish"})]}),e.jsx(J,{value:t,className:"mt-4",children:N?e.jsx("div",{className:"flex items-center justify-center h-40 text-sm text-muted-foreground",children:"Loading templates..."}):e.jsx(xe,{templates:v,onDeploy:u})})]}),e.jsx(he,{open:!!f,onClose:()=>u(null),template:f,onDeployed:()=>a("/strategy/hub")})]})}export{De as default};
