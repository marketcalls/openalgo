import{r,j as e}from"./vendor-react-CCyQGCED.js";import{B as j,f as y,s as W}from"./index-D0023jFM.js";import{A as k,a as S}from"./alert-Dlgyh2fF.js";import{C as Y,a as Z,b as U,d as G}from"./card-CDguRyHx.js";import{I as N}from"./input-D8_g_dg9.js";import{L as b}from"./label-BgxgrBuS.js";import{P as K}from"./progress-BcnjzSlC.js";import{c as Q,L as M}from"./vendor-router-Dzc1xxhr.js";import{y as ee,z as se,A as te,n as O,H as L,I as ae,J as re,N as le,m as ne}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function ye(){const[u]=Q(),[h,d]=r.useState("email"),[c,C]=r.useState(""),[v,_]=r.useState(""),[l,D]=r.useState(""),[x,I]=r.useState(""),[$,P]=r.useState(""),[o,i]=r.useState(!1),[T,n]=r.useState(""),[R,B]=r.useState(""),[m,z]=r.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[g,J]=r.useState(0),[w,E]=r.useState(null);r.useEffect(()=>{const s=u.get("token"),t=u.get("email"),f=u.get("verified"),a=u.get("error");if(a){n({invalid_link:"Invalid reset link. Please request a new one.",expired_link:"This reset link has expired. Please request a new one.",session_expired:"Your session has expired. Please start the reset process again.",processing_error:"An error occurred. Please try again."}[a]||"An error occurred.");return}s&&t&&f==="true"&&(P(s),C(t),d("password"))},[u]),r.useEffect(()=>{const s={length:l.length>=8,uppercase:/[A-Z]/.test(l),lowercase:/[a-z]/.test(l),number:/[0-9]/.test(l),special:/[!@#$%^&*]/.test(l)};z(s);let t=0;l.length>=8&&(t+=20),l.length>=12&&(t+=10),l.length>=16&&(t+=10),s.uppercase&&(t+=15),s.lowercase&&(t+=15),s.number&&(t+=15),s.special&&(t+=15),J(t)},[l]),r.useEffect(()=>{E(x===""?null:l===x)},[l,x]);const F=Object.values(m).every(Boolean)&&w===!0,A=()=>g>=80?{label:"Strong",color:"text-green-500"}:g>=50?{label:"Medium",color:"text-yellow-500"}:g>0?{label:"Weak",color:"text-red-500"}:{label:"",color:""},X=async s=>{s.preventDefault(),i(!0),n("");try{const t=await y(),a=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:"email",email:c})})).json();a.status==="success"?d("method"):n(a.message||"Email not found")}catch{n("Failed to process request")}finally{i(!1)}},q=async s=>{i(!0),n("");try{const t=await y(),a=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:`select_${s}`,email:c})})).json();a.status==="success"?d(s==="totp"?"totp":"email_sent"):n(a.message||"Failed to select method")}catch{n("Failed to process request")}finally{i(!1)}},H=async s=>{s.preventDefault(),i(!0),n("");try{const t=await y(),a=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:"totp",email:c,totp_code:v})})).json();a.status==="success"?(P(a.token||""),d("password")):n(a.message||"Invalid TOTP code")}catch{n("Failed to verify code")}finally{i(!1)}},V=async s=>{if(s.preventDefault(),!!F){i(!0),n("");try{const t=await y(),a=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:"password",email:c,token:$,password:l,confirm_password:x})})).json();a.status==="success"?(B("Password reset successfully! Redirecting to login..."),W.success("Password reset successfully!"),setTimeout(()=>{window.location.href="/login"},2e3)):n(a.message||"Failed to reset password")}catch{n("Failed to reset password")}finally{i(!1)}}},p=({met:s,label:t})=>e.jsxs("div",{className:`flex items-center gap-2 text-sm transition-colors ${s?"text-green-500":"text-muted-foreground"}`,children:[e.jsx(ne,{className:`h-4 w-4 ${s?"opacity-100":"opacity-0"}`}),e.jsx("span",{children:t})]});return e.jsx("div",{className:"min-h-[calc(100vh-8rem)] flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-lg",children:e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsx(U,{className:"text-2xl",children:"Reset Password"})}),e.jsxs(G,{className:"space-y-4",children:[T&&e.jsxs(k,{variant:"destructive",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx(S,{children:T})]}),R&&e.jsxs(k,{className:"border-green-500 bg-green-50 dark:bg-green-950",children:[e.jsx(se,{className:"h-4 w-4 text-green-500"}),e.jsx(S,{className:"text-green-700 dark:text-green-300",children:R})]}),h==="email"&&e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"email",children:"Email Address"}),e.jsx(N,{id:"email",type:"email",value:c,onChange:s=>C(s.target.value),placeholder:"Enter your email",required:!0,autoFocus:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the email address associated with your account"})]}),e.jsx(j,{type:"submit",className:"w-full",disabled:o,children:o?"Processing...":"Continue"})]}),h==="method"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Choose Verification Method"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"How would you like to verify your identity?"})]}),e.jsx("button",{type:"button",onClick:()=>q("totp"),disabled:o,className:"w-full p-4 rounded-lg border bg-muted/50 hover:bg-muted transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary flex items-center justify-center",children:e.jsx(te,{className:"h-6 w-6 text-primary-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:"Authenticator App (TOTP)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use your authenticator app to generate a verification code"})]}),e.jsx(O,{className:"h-5 w-5 text-muted-foreground"})]})}),e.jsx("button",{type:"button",onClick:()=>q("email"),disabled:o,className:"w-full p-4 rounded-lg border bg-muted/50 hover:bg-muted transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary flex items-center justify-center",children:e.jsx(L,{className:"h-6 w-6 text-secondary-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:"Email Reset Link"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive a password reset link via email"})]}),e.jsx(O,{className:"h-5 w-5 text-muted-foreground"})]})})]}),h==="totp"&&e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"totp",children:"TOTP Code"}),e.jsx(N,{id:"totp",type:"text",value:v,onChange:s=>_(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",pattern:"[0-9]{6}",maxLength:6,className:"text-center text-2xl tracking-widest",required:!0,autoFocus:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the 6-digit code from your authenticator app"})]}),e.jsx(j,{type:"submit",className:"w-full",disabled:o||v.length!==6,children:o?"Verifying...":"Verify Code"})]}),h==="email_sent"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(L,{className:"h-8 w-8 text-white"})})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Check Your Email"}),e.jsxs("p",{className:"text-muted-foreground",children:["We've sent a password reset link to ",e.jsx("strong",{children:c}),". Click the link in the email to continue resetting your password."]}),e.jsxs(k,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsxs(S,{children:[e.jsx("strong",{children:"Didn't receive the email?"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Check your spam/junk folder"}),e.jsxs("li",{children:["Make sure ",c," is correct"]}),e.jsx("li",{children:"The link expires in 1 hour"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(j,{variant:"outline",size:"sm",onClick:()=>d("method"),children:"Try Different Method"}),e.jsx(j,{size:"sm",asChild:!0,children:e.jsx(M,{to:"/login",children:"Back to Login"})})]})]}),h==="password"&&e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"password",children:"New Password"}),e.jsx(N,{id:"password",type:"password",value:l,onChange:s=>D(s.target.value),placeholder:"Enter new password",required:!0,autoFocus:!0}),e.jsx(K,{value:g,className:"h-2"}),l&&e.jsx("p",{className:`text-sm font-medium ${A().color}`,children:A().label})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(N,{id:"confirmPassword",type:"password",value:x,onChange:s=>I(s.target.value),placeholder:"Confirm new password",required:!0}),w!==null&&e.jsx("p",{className:`text-sm ${w?"text-green-500":"text-red-500"}`,children:w?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsx(p,{met:m.length,label:"Minimum 8 characters"}),e.jsx(p,{met:m.uppercase,label:"At least 1 uppercase letter (A-Z)"}),e.jsx(p,{met:m.lowercase,label:"At least 1 lowercase letter (a-z)"}),e.jsx(p,{met:m.number,label:"At least 1 number (0-9)"}),e.jsx(p,{met:m.special,label:"At least 1 special character (!@#$%^&*)"})]}),e.jsxs(j,{type:"submit",className:"w-full",disabled:o||!F,children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),o?"Resetting...":"Reset Password"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"OR"})})]}),e.jsx("div",{className:"text-center",children:e.jsxs(M,{to:"/login",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:[e.jsx(le,{className:"h-4 w-4"}),"Back to Login"]})})]})]})})})}export{ye as default};
