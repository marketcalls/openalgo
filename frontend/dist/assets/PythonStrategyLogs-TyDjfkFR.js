import{r as a,j as e}from"./vendor-react-RhKMXzW9.js";import{B as d,e as K,t as m}from"./index-5A0f6rqh.js";import{p as g}from"./python-strategy-BFUGXFa3.js";import{C as w,b,c as D,d as F,a as k}from"./card-DQ3ML41e.js";import{C as W}from"./checkbox-Davv5kGZ.js";import{D as G,b as U,c as Y,d as $,e as q,f as J}from"./dialog-CF7I9CHU.js";import{L as M}from"./label-B4a3RivY.js";import{S as Q}from"./scroll-area-BpnoIvAK.js";import{S as p}from"./skeleton-BUB8Ifl3.js";import{A as V,R as A,aa as X,F as Z,Y as ee,aC as se,aD as te}from"./vendor-icons-DEeYHfOp.js";import{c as ae,L as re}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-radix-hRiDuY7W.js";function je(){const{strategyId:l}=ae(),[n,R]=a.useState(null),[x,j]=a.useState([]),[r,h]=a.useState(null),[o,N]=a.useState(null),[E,y]=a.useState(!0),[T,C]=a.useState(!1),[v,S]=a.useState(!1),[I,u]=a.useState(!1),[L,B]=a.useState(!0),c=a.useRef(null),_=async()=>{if(l)try{y(!0);const[s,t]=await Promise.all([g.getStrategy(l),g.getLogFiles(l)]);R(s),j(t),t.length>0&&!r&&h(t[0].name)}catch(s){console.error("Failed to fetch data:",s),m.error("Failed to load logs")}finally{y(!1)}},f=async s=>{if(l)try{C(!0);const t=await g.getLogContent(l,s);N(t),L&&c.current&&setTimeout(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},100)}catch(t){console.error("Failed to fetch log content:",t),m.error("Failed to load log content")}finally{C(!1)}};a.useEffect(()=>{_()},[]),a.useEffect(()=>{r&&f(r)},[r]),a.useEffect(()=>{if(n?.status==="running"&&r){const s=setInterval(()=>{f(r)},5e3);return()=>clearInterval(s)}},[n?.status,r]);const O=async()=>{if(l)try{S(!0);const s=await g.clearLogs(l);s.status==="success"?(m.success("Logs cleared"),j([]),h(null),N(null)):m.error(s.message||"Failed to clear logs")}catch(s){console.error("Failed to clear logs:",s),m.error("Failed to clear logs")}finally{S(!1),u(!1)}},z=s=>{const t=s.split("_");return t.length>1?t.slice(1).join("_").replace(".log",""):s.replace(".log","")},H=s=>s.split(`
`).map((t,P)=>{let i="text-gray-300";return t.includes("ERROR")||t.includes("error")||t.includes("Error")?i="text-red-400":t.includes("WARNING")||t.includes("warning")||t.includes("Warning")?i="text-yellow-400":t.includes("SUCCESS")||t.includes("success")||t.includes("Success")?i="text-green-400":(t.includes("INFO")||t.includes("info")||t.includes("Info"))&&(i="text-blue-400"),e.jsx("div",{className:i,children:t||" "},P)});return E?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(p,{className:"h-8 w-32"}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsx(p,{className:"h-[600px]"}),e.jsx(p,{className:"h-[600px] col-span-3"})]})]}):n?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(d,{variant:"ghost",asChild:!0,children:e.jsxs(re,{to:"/python",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Strategy Logs"}),e.jsx("p",{className:"text-muted-foreground",children:n.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{id:"auto-scroll",checked:L,onCheckedChange:s=>B(s)}),e.jsx(M,{htmlFor:"auto-scroll",className:"text-sm",children:"Auto-scroll"})]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>r&&f(r),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(d,{variant:"destructive",size:"sm",onClick:()=>u(!0),disabled:x.length===0,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(w,{className:"lg:col-span-1",children:[e.jsxs(b,{children:[e.jsxs(D,{className:"text-sm flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Log Files"]}),e.jsxs(F,{children:[x.length," file(s)"]})]}),e.jsx(k,{children:x.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No log files found"}):e.jsx(Q,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2",children:x.map(s=>e.jsxs("button",{onClick:()=>h(s.name),className:`w-full text-left p-3 rounded-lg transition-colors ${r===s.name?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:z(s.name)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(ee,{className:"h-3 w-3"}),new Date(s.last_modified).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(se,{className:"h-3 w-3"}),s.size_kb.toFixed(2)," KB"]})]},s.name))})})})]}),e.jsxs(w,{className:"lg:col-span-3",children:[e.jsxs(b,{children:[e.jsxs(D,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Log Content"]}),n.status==="running"&&e.jsx(K,{className:"bg-green-500 animate-pulse",children:"Live"})]}),o&&e.jsxs(F,{children:[o.lines," lines • ",o.size_kb.toFixed(2)," KB • Last updated:"," ",new Date(o.last_updated).toLocaleString()]})]}),e.jsx(k,{children:r?T?e.jsx("div",{className:"flex items-center justify-center h-[500px]",children:e.jsx(A,{className:"h-6 w-6 animate-spin"})}):o?e.jsx("div",{ref:c,className:"h-[500px] overflow-auto bg-gray-900 rounded-lg p-4 font-mono text-xs",children:H(o.content)}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"No content available"}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"Select a log file to view its contents"})})]})]}),e.jsx(G,{open:I,onOpenChange:u,children:e.jsxs(U,{children:[e.jsxs(Y,{children:[e.jsx($,{children:"Clear All Logs"}),e.jsxs(q,{children:['Are you sure you want to clear all log files for "',n.name,'"? This action cannot be undone.']})]}),e.jsxs(J,{children:[e.jsx(d,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(d,{variant:"destructive",onClick:O,disabled:v,children:v?"Clearing...":"Clear All Logs"})]})]})})]}):null}export{je as default};
