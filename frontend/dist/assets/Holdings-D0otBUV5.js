import{r as l,j as e}from"./vendor-react--vsXx8_n.js";import{t as _}from"./trading-BQMBYqNJ.js";import{d as Q,o as q,e as T,B as E,c as x,s as o}from"./index-6Vx6gL6o.js";import{C as j,b as f,d as g,c as N,a as z}from"./card-BTzB21Yl.js";import{T as U,a as O,b as L,c as d,d as K,e as r,f as G}from"./table-Bdavy4ax.js";import{u as J,c as W}from"./useLivePrice-YBbRIFa2.js";import{V as X,R as Y,q as Z,c as H,$,L as ee}from"./vendor-icons-BPoFgeym.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CclZ5Z6W.js";import"./vendor-radix-DIebA-qg.js";function m(c){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(c)}function S(c){return`${c>=0?"+":""}${c.toFixed(2)}%`}function xe(){const{apiKey:c}=Q(),[v,D]=l.useState([]),[u,F]=l.useState(null),[k,C]=l.useState(!0),[P,R]=l.useState(!1),[I,b]=l.useState(null),{data:p,isLive:y}=J(v,{enabled:v.length>0,useMultiQuotesFallback:!0,staleThreshold:5e3,multiQuotesRefreshInterval:3e4}),t=l.useMemo(()=>!u||!p.some(a=>a._dataSource!=="rest")?u:W(p,u),[u,p]),h=l.useCallback(async(s=!1)=>{if(!c){C(!1);return}s&&R(!0);try{const a=await _.getHoldings(c);a.status==="success"&&a.data?(D(a.data.holdings||[]),F(a.data.statistics),b(null)):b(a.message||"Failed to fetch holdings")}catch{b("Failed to fetch holdings")}finally{C(!1),R(!1)}},[c]);l.useEffect(()=>{h();const a=setInterval(()=>h(),y?3e4:1e4);return()=>clearInterval(a)},[h,y]),l.useEffect(()=>{const s=q(()=>{h()});return()=>s()},[h]);const A=()=>{const s=["Symbol","Exchange","Quantity","Avg Price","LTP","Product","P&L","P&L %"],a=p.map(n=>[o(n.symbol),o(n.exchange),o(n.quantity),o(n.average_price),o(n.ltp),o(n.product),o(n.pnl),o(n.pnlpercent)]),V=[s,...a].map(n=>n.join(",")).join(`
`),B=new Blob([V],{type:"text/csv"}),M=URL.createObjectURL(B),w=document.createElement("a");w.href=M,w.download=`holdings_${new Date().toISOString().split("T")[0]}.csv`,w.click()},i=s=>s>=0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Investor Summary"}),y&&e.jsxs(T,{variant:"outline",className:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30 gap-1",children:[e.jsx(X,{className:"h-3 w-3 animate-pulse"}),"Live"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"View your holdings portfolio"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(E,{variant:"outline",size:"sm",onClick:()=>h(!0),disabled:P,children:[e.jsx(Y,{className:x("h-4 w-4 mr-2",P&&"animate-spin")}),"Refresh"]}),e.jsxs(E,{variant:"outline",size:"sm",onClick:A,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total Holding Value"}),e.jsx(N,{className:"text-2xl text-primary",children:t?m(t.totalholdingvalue):"---"})]})}),e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total Investment Value"}),e.jsx(N,{className:"text-2xl",children:t?m(t.totalinvvalue):"---"})]})}),e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total Profit and Loss"}),e.jsx(N,{className:x("text-2xl",t&&i(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?e.jsxs("div",{className:"flex items-center gap-1",children:[i(t.totalprofitandloss)?e.jsx(H,{className:"h-5 w-5"}):e.jsx($,{className:"h-5 w-5"}),m(t.totalprofitandloss)]}):"---"})]})}),e.jsx(j,{children:e.jsxs(f,{className:"pb-2",children:[e.jsx(g,{children:"Total PnL Percentage"}),e.jsx(N,{className:x("text-2xl",t&&i(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?S(t.totalpnlpercentage):"---"})]})})]}),e.jsx(j,{children:e.jsx(z,{className:"p-0",children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ee,{className:"h-8 w-8 animate-spin"})}):I?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:I}):v.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No holdings found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(U,{children:[e.jsx(O,{children:e.jsxs(L,{children:[e.jsx(d,{children:"Trading Symbol"}),e.jsx(d,{children:"Exchange"}),e.jsx(d,{className:"text-right",children:"Quantity"}),e.jsx(d,{className:"text-right",children:"Avg Price"}),e.jsx(d,{className:"text-right",children:"LTP"}),e.jsx(d,{children:"Product"}),e.jsx(d,{className:"text-right",children:"Profit and Loss"}),e.jsx(d,{className:"text-right",children:"PnL %"})]})}),e.jsx(K,{children:p.map((s,a)=>e.jsxs(L,{children:[e.jsx(r,{className:"font-medium",children:s.symbol}),e.jsx(r,{children:e.jsx(T,{variant:"outline",children:s.exchange})}),e.jsx(r,{className:"text-right font-mono",children:s.quantity}),e.jsx(r,{className:"text-right font-mono",children:s.average_price!==void 0?m(s.average_price):"-"}),e.jsx(r,{className:"text-right font-mono",children:s.ltp!==void 0?m(s.ltp):"-"}),e.jsx(r,{children:e.jsx(T,{variant:"secondary",children:s.product})}),e.jsx(r,{className:x("text-right font-medium",i(s.pnl)?"text-green-600":"text-red-600"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i(s.pnl)?e.jsx(H,{className:"h-4 w-4"}):e.jsx($,{className:"h-4 w-4"}),m(s.pnl)]})}),e.jsx(r,{className:x("text-right",i(s.pnlpercent)?"text-green-600":"text-red-600"),children:S(s.pnlpercent)})]},`${s.symbol}-${s.exchange}-${a}`))}),e.jsx(G,{children:e.jsxs(L,{className:"bg-muted/50",children:[e.jsx(r,{colSpan:6,className:"text-right text-muted-foreground",children:"Total P&L:"}),e.jsx(r,{className:x("text-right font-bold",t&&i(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?`${t.totalprofitandloss>=0?"+":""}${m(t.totalprofitandloss)}`:"-"}),e.jsx(r,{className:x("text-right font-bold",t&&i(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?S(t.totalpnlpercentage):"-"})]})})]})})})})]})}export{xe as default};
