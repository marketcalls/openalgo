import{r as t,j as e}from"./vendor-react--vsXx8_n.js";import{d as ws,u as ks,w as b,t as l,e as p,B as v}from"./index-DzBD42tN.js";import{A as N,b as y,a as w}from"./alert-qPYRQDfW.js";import{A as _s,b as Ss,c as Cs,d as Ps,e as As,f as Ts,h as Fs}from"./alert-dialog-WXI1bS8l.js";import{S as Ms,a as Ds,b as Es,c as Is,d as Rs}from"./select-erwAHFOz.js";import{C as d,b as m,c as h,a as u,d as f}from"./card-Ywi_iHZP.js";import{C as We}from"./checkbox-DBlv3wZG.js";import{I as c}from"./input-Czj9uzdI.js";import{L as n}from"./label-BQxrr3CD.js";import{P as Us}from"./progress-B-zMTXFk.js";import{T as $s,a as Bs,b as T,c as F}from"./tabs-Cp4qnySZ.js";import{A as Ls,U as zs,z as Q,K as Z,a6 as Ge,a7 as Os,y as J,x as Ye,t as Ve,X as Ks,R as j,v as z,a8 as qs,C as Hs,a9 as Ws,a1 as Gs,l as Ys,m as Vs,aa as Xs,ab as Qs,a3 as Zs,T as Js}from"./vendor-icons-BPoFgeym.js";import{L as ea}from"./vendor-router-CclZ5Z6W.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DIebA-qg.js";const sa=[{value:"light",label:"Light",icon:Ys,description:"Clean, bright interface for daytime trading"},{value:"dark",label:"Dark",icon:Vs,description:"Reduced eye strain for extended sessions"}],aa=[{value:"zinc",label:"Zinc",color:"bg-zinc-500"},{value:"slate",label:"Slate",color:"bg-slate-500"},{value:"gray",label:"Gray",color:"bg-gray-500"},{value:"neutral",label:"Neutral",color:"bg-neutral-500"},{value:"green",label:"Green",color:"bg-green-500"},{value:"blue",label:"Blue",color:"bg-blue-500"},{value:"violet",label:"Violet",color:"bg-violet-500"},{value:"orange",label:"Orange",color:"bg-orange-500"}];function fa(){const Xe=ws(s=>s.user),{mode:I,color:R,appMode:Qe,setMode:ee,setColor:se}=ks(),[Ze,Je]=t.useState("account"),[es,ss]=t.useState(!0),[P,as]=t.useState(null),[O,ae]=t.useState(""),[M,re]=t.useState(""),[D,te]=t.useState(""),[K,rs]=t.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[le,ne]=t.useState(!1),[ie,ce]=t.useState("smtp.gmail.com"),[de,oe]=t.useState("587"),[me,he]=t.useState(""),[q,xe]=t.useState(""),[ue,pe]=t.useState(""),[ge,je]=t.useState("smtp.gmail.com"),[fe,be]=t.useState(!0),[ve,Ne]=t.useState(!1),[H,ye]=t.useState(""),[we,ke]=t.useState(!1),[_e,Se]=t.useState(!1),[A,U]=t.useState(null),[r,W]=t.useState(null),[k,Ce]=t.useState(""),[_,Pe]=t.useState(""),[$,Ae]=t.useState(""),[B,Te]=t.useState(""),[o,Fe]=t.useState(""),[E,Me]=t.useState(!1),[S,De]=t.useState(""),[C,Ee]=t.useState(""),[Ie,Re]=t.useState(!1),[Ue,$e]=t.useState(!1),[ts,L]=t.useState(!1),[g,ls]=t.useState(null),[G,Be]=t.useState(!1),[Le,ze]=t.useState(!1),x=Qe==="analyzer";t.useEffect(()=>{ns(),is()},[]);const ns=async()=>{try{const s=await b.get("/auth/profile-data");if(s.data.status==="success"){as(s.data.data);const a=s.data.data.smtp_settings;a&&(ce(a.smtp_server||"smtp.gmail.com"),oe(String(a.smtp_port||587)),he(a.smtp_username||""),pe(a.smtp_from_email||""),je(a.smtp_helo_hostname||"smtp.gmail.com"),be(a.smtp_use_tls!==!1),ye(a.smtp_username||""))}}catch(s){console.error("Error fetching profile data:",s),l.error("Failed to load profile data")}finally{ss(!1)}},is=async()=>{try{const s=await b.get("/api/broker/credentials");s.data.status==="success"&&(W(s.data.data),Fe(s.data.data.current_broker),Me(s.data.data.ngrok_allow),De(s.data.data.host_server),Ee(s.data.data.websocket_url||""))}catch(s){console.error("Error fetching broker credentials:",s)}},Y=async()=>{Be(!0);try{const s=await b.get("/api/system/permissions");s.data.status==="success"&&ls(s.data.data)}catch(s){console.error("Error fetching permissions:",s),l.error("Failed to load permission status")}finally{Be(!1)}},cs=async()=>{ze(!0);try{const s=await b.post("/api/system/permissions/fix");if(s.data.status==="success"){const{fixed:a,failed:i,message:He}=s.data.data;a.length>0&&l.success(`Fixed ${a.length} permission issues`),i.length>0&&l.warning(`${i.length} issues could not be fixed automatically`),a.length===0&&i.length===0&&l.info(He),await Y()}else l.error("Failed to fix permissions")}catch(s){console.error("Error fixing permissions:",s),l.error("Failed to fix permissions")}finally{ze(!1)}},Oe=s=>{const i=(r?.redirect_url||"http://127.0.0.1:5000").match(/^(https?:\/\/[^/]+)/);return`${i?i[1]:"http://127.0.0.1:5000"}/${s}/callback`},ds=async()=>{Re(!0);try{const s=new FormData;k&&s.append("broker_api_key",k),_&&s.append("broker_api_secret",_),$&&s.append("broker_api_key_market",$),B&&s.append("broker_api_secret_market",B),o&&o!==r?.current_broker&&s.append("redirect_url",Oe(o));const a=await b.post("/api/broker/credentials",s);a.data.status==="success"?(l.success(a.data.message),r&&W({...r,current_broker:o||r.current_broker,redirect_url:o!==r.current_broker?Oe(o):r.redirect_url,broker_api_key:k?`${k.slice(0,6)}${"*".repeat(Math.max(0,k.length-6))}`:r.broker_api_key,broker_api_key_raw_length:k?k.length:r.broker_api_key_raw_length,broker_api_secret:_?`${_.slice(0,4)}${"*".repeat(Math.max(0,_.length-4))}`:r.broker_api_secret,broker_api_secret_raw_length:_?_.length:r.broker_api_secret_raw_length}),Ce(""),Pe(""),Ae(""),Te(""),L(!0)):l.error(a.data.message||"Failed to save credentials")}catch(s){const a=s;l.error(a.response?.data?.message||"Failed to save broker credentials")}finally{Re(!1)}},os=!!(k||_||$||B||o&&o!==r?.current_broker),ms=!!(E!==r?.ngrok_allow||S&&S!==r?.host_server||C&&C!==r?.websocket_url),hs=async()=>{$e(!0);try{const s={ngrok_allow:E?"TRUE":"FALSE"};S&&(s.host_server=S),C&&(s.websocket_url=C);const a=await b.post("/api/broker/credentials",s);a.data.status==="success"?(l.success(a.data.message),r&&W({...r,ngrok_allow:E,host_server:S||r.host_server,websocket_url:C||r.websocket_url}),L(!0)):l.error(a.data.message||"Failed to save settings")}catch(s){const a=s;l.error(a.response?.data?.message||"Failed to save settings")}finally{$e(!1)}},Ke=t.useCallback(s=>{const a={length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[!@#$%^&*]/.test(s)};return rs(a),Object.values(a).every(Boolean)},[]);t.useEffect(()=>{Ke(M)},[M,Ke]);const xs=()=>{const s=Object.values(K).filter(Boolean).length;return s===0?{percentage:0,label:"None",color:"bg-gray-400"}:s<=2?{percentage:40,label:"Weak",color:"bg-red-500"}:s<=3?{percentage:60,label:"Fair",color:"bg-yellow-500"}:s<=4?{percentage:80,label:"Good",color:"bg-blue-500"}:{percentage:100,label:"Strong",color:"bg-green-500"}},V=M===D&&D!=="",us=Object.values(K).every(Boolean),qe=V&&us&&O!=="",ps=async s=>{if(s.preventDefault(),!!qe){ne(!0);try{const a=new FormData;a.append("old_password",O),a.append("new_password",M),a.append("confirm_password",D);const i=await b.post("/auth/change-password",a);i.data.status==="success"?(l.success(i.data.message||"Password changed successfully"),ae(""),re(""),te("")):l.error(i.data.message||"Failed to change password")}catch(a){const i=a;l.error(i.response?.data?.message||"Failed to change password")}finally{ne(!1)}}},gs=async s=>{s.preventDefault(),Ne(!0);try{const a=new FormData;a.append("smtp_server",ie),a.append("smtp_port",de),a.append("smtp_username",me),q&&a.append("smtp_password",q),a.append("smtp_from_email",ue),a.append("smtp_helo_hostname",ge),fe&&a.append("smtp_use_tls","on");const i=await b.post("/auth/smtp-config",a);i.data.status==="success"?(l.success(i.data.message||"SMTP settings saved successfully"),xe("")):l.error(i.data.message||"Failed to save SMTP settings")}catch(a){const i=a;l.error(i.response?.data?.message||"Failed to save SMTP settings")}finally{Ne(!1)}},js=async()=>{if(!H){l.error("Please enter an email address to test");return}ke(!0),U(null);try{const s=new FormData;s.append("test_email",H);const a=await b.post("/auth/test-smtp",s);a.data.success?l.success(a.data.message||"Test email sent successfully"):l.error(a.data.message||"Failed to send test email")}catch(s){const a=s;l.error(a.response?.data?.message||"Failed to send test email")}finally{ke(!1)}},fs=async()=>{Se(!0),U(null);try{const s=await b.post("/auth/debug-smtp",{});U(s.data)}catch(s){U({success:!1,message:s.response?.data?.message||"Failed to debug SMTP",details:[]})}finally{Se(!1)}},bs=s=>{if(x){l.error("Cannot change theme while in Analyzer Mode");return}ee(s),l.success(`Theme changed to ${s}`)},vs=s=>{if(x){l.error("Cannot change theme while in Analyzer Mode");return}se(s),l.success(`Accent color changed to ${s}`)},Ns=()=>{if(x){l.error("Cannot change theme while in Analyzer Mode");return}ee("light"),se("zinc"),l.success("Theme reset to default")},ys=s=>{navigator.clipboard.writeText(s).then(()=>{l.success("Copied to clipboard")}).catch(()=>{l.error("Failed to copy")})},X=xs();return es?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ea,{to:"/dashboard",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Ls,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(zs,{className:"h-6 w-6"}),"Profile Settings"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and security preferences"})]}),e.jsxs($s,{value:Ze,onValueChange:s=>{Je(s),s==="permissions"&&!g&&Y()},children:[e.jsxs(Bs,{className:"grid w-full grid-cols-6",children:[e.jsxs(T,{value:"account",className:"gap-1",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Account"})]}),e.jsxs(T,{value:"broker",className:"gap-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Broker"})]}),e.jsxs(T,{value:"permissions",className:"gap-1",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"System"})]}),e.jsxs(T,{value:"theme",className:"gap-1",children:[e.jsx(Os,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Theme"})]}),e.jsxs(T,{value:"smtp",className:"gap-1",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"SMTP"})]}),e.jsxs(T,{value:"totp",className:"gap-1",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"TOTP"})]})]}),e.jsxs(F,{value:"account",className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(h,{children:"Account Information"})}),e.jsxs(u,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username"}),e.jsx(c,{value:Xe?.username||P?.username||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Account Type"}),e.jsx("div",{className:"pt-2",children:e.jsx(p,{children:"Administrator"})})]})]})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(h,{children:"Change Password"})}),e.jsx(u,{children:e.jsxs("form",{onSubmit:ps,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Current Password"}),e.jsx(c,{type:"password",placeholder:"Enter your current password",value:O,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"New Password"}),e.jsx(c,{type:"password",placeholder:"Enter your new password",value:M,onChange:s=>re(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Confirm New Password"}),e.jsx(c,{type:"password",placeholder:"Confirm your new password",value:D,onChange:s=>te(s.target.value)}),D&&e.jsx("p",{className:`text-sm ${V?"text-green-500":"text-red-500"}`,children:V?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Strength"}),e.jsx("span",{className:"font-medium",children:X.label})]}),e.jsx(Us,{value:X.percentage,className:X.color}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(K).map(([s,a])=>e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full border ${a?"bg-green-500/10 border-green-500 text-green-600":"bg-muted border-border text-muted-foreground"}`,children:[a?e.jsx(Ve,{className:"h-3 w-3"}):e.jsx(Ks,{className:"h-3 w-3"}),e.jsxs("span",{children:[s==="length"&&"8+ chars",s==="uppercase"&&"A-Z",s==="lowercase"&&"a-z",s==="number"&&"0-9",s==="special"&&"Special (@#$%^&*)"]})]},s))})]}),e.jsx(v,{type:"submit",disabled:!qe||le,children:le?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Change Password"]})})]})})]})]}),e.jsxs(F,{value:"broker",className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(y,{children:"Broker API Credentials"}),e.jsx(w,{children:"Update your broker API credentials. Changes require an application restart to take effect. You will be logged out after saving."})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Current Configuration"}),e.jsx(f,{children:"Your currently configured broker and credentials"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Current Broker"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(p,{variant:"outline",className:"text-base",children:r?.current_broker?.toUpperCase()||"Not configured"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Redirect URL"}),e.jsx("code",{className:"text-xs text-muted-foreground break-all",children:r?.redirect_url||"Not configured"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"API Key"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:r?.broker_api_key||"(not set)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"API Secret"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:r?.broker_api_secret||"(not set)"})]})]}),(r?.broker_api_key_market_raw_length??0)>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Key"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:r?.broker_api_key_market||"(not set)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Secret"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:r?.broker_api_secret_market||"(not set)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Ngrok Status"}),e.jsx(p,{variant:r?.ngrok_allow?"default":"secondary",children:r?.ngrok_allow?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Host Server"}),e.jsx("code",{className:"text-xs text-muted-foreground break-all",children:r?.host_server||"(not set)"})]})]})]})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Update Credentials"}),e.jsx(f,{children:"Enter new values to update. Leave fields empty to keep existing values."})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Select Broker"}),e.jsxs(Ms,{value:o,onValueChange:Fe,children:[e.jsx(Ds,{children:e.jsx(Es,{placeholder:"Select a broker"})}),e.jsx(Is,{children:r?.valid_brokers.map(s=>e.jsx(Rs,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),o&&o!==r?.current_broker&&e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-500",children:["Changing broker to: ",o.toUpperCase()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Broker API Key"}),e.jsx(c,{type:"password",value:k,onChange:s=>Ce(s.target.value),placeholder:"Enter new API key"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(r?.broker_api_key_raw_length??0)>0?`Current: ${r?.broker_api_key_raw_length} chars`:"Not currently set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Broker API Secret"}),e.jsx(c,{type:"password",value:_,onChange:s=>Pe(s.target.value),placeholder:"Enter new API secret"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(r?.broker_api_secret_raw_length??0)>0?`Current: ${r?.broker_api_secret_raw_length} chars`:"Not currently set"})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Market Data API (Optional)"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Required only for XTS API supported brokers (e.g., 5paisa XTS, Jainam XTS)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Key"}),e.jsx(c,{type:"password",value:$,onChange:s=>Ae(s.target.value),placeholder:"Enter market API key"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Secret"}),e.jsx(c,{type:"password",value:B,onChange:s=>Te(s.target.value),placeholder:"Enter market API secret"})]})]})]}),o==="fivepaisa"&&e.jsxs(N,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(y,{children:"5paisa API Key Format"}),e.jsxs(w,{children:["Format: ",e.jsx("code",{children:"User_Key:::User_ID:::client_id"})]})]}),o==="flattrade"&&e.jsxs(N,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(y,{children:"Flattrade API Key Format"}),e.jsxs(w,{children:["Format: ",e.jsx("code",{children:"client_id:::api_key"})]})]}),o==="dhan"&&e.jsxs(N,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(y,{children:"Dhan API Key Format"}),e.jsxs(w,{children:["Format: ",e.jsx("code",{children:"client_id:::api_key"})]})]}),e.jsx(v,{onClick:ds,disabled:!os||Ie,className:"w-full",children:Ie?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Save Broker Credentials"]})})]})]}),r?.server_status&&e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Server Status"}),e.jsx(f,{children:"Running services and their configured ports"})]}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center p-3 bg-muted rounded-lg",children:[e.jsx(p,{variant:"default",className:"mb-2 bg-green-600",children:"Running"}),e.jsx("span",{className:"text-sm font-medium",children:"Flask App"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.server_status.flask.host,":",r.server_status.flask.port]})]}),e.jsxs("div",{className:"flex flex-col items-center p-3 bg-muted rounded-lg",children:[e.jsx(p,{variant:"default",className:"mb-2 bg-green-600",children:"Running"}),e.jsx("span",{className:"text-sm font-medium",children:"WebSocket"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.server_status.websocket.host,":",r.server_status.websocket.port]})]}),e.jsxs("div",{className:"flex flex-col items-center p-3 bg-muted rounded-lg",children:[e.jsx(p,{variant:"default",className:"mb-2 bg-green-600",children:"Running"}),e.jsx("span",{className:"text-sm font-medium",children:"ZeroMQ"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[r.server_status.zmq.host,":",r.server_status.zmq.port]})]})]})})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Server Configuration"}),e.jsx(f,{children:"Configure ngrok for receiving webhook alerts from external services like TradingView, Chartink, GoCharting, etc."})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"ngrok_enabled",checked:E,onCheckedChange:s=>Me(s===!0)}),e.jsx(n,{htmlFor:"ngrok_enabled",children:"Enable Ngrok Tunnel"}),E!==r?.ngrok_allow&&e.jsx(p,{variant:"outline",className:"text-yellow-600",children:"Changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Host Server URL"}),e.jsx(c,{value:S,onChange:s=>De(s.target.value),placeholder:"https://your-domain.ngrok-free.app"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your ngrok domain or custom domain for receiving webhooks."}),S!==r?.host_server&&S&&e.jsxs(p,{variant:"outline",className:"text-yellow-600",children:["Changed from: ",r?.host_server]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"WebSocket URL"}),e.jsx(c,{value:C,onChange:s=>Ee(s.target.value),placeholder:"ws://127.0.0.1:8765"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"WebSocket server URL for real-time market data streaming."}),C!==r?.websocket_url&&C&&e.jsxs(p,{variant:"outline",className:"text-yellow-600",children:["Changed from: ",r?.websocket_url]})]}),e.jsx(v,{onClick:hs,disabled:!ms||Ue,className:"w-full",children:Ue?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Save Ngrok Settings"]})})]})]})]}),e.jsxs(F,{value:"permissions",className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx(y,{children:"File Permissions Monitor"}),e.jsx(w,{children:"Check file and directory permissions for OpenAlgo components. Incorrect permissions may cause the application to malfunction."})]}),g&&e.jsx(d,{children:e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(h,{className:"flex items-center gap-2",children:["System Status",g.all_correct?e.jsx(p,{className:"bg-green-500",children:"All OK"}):e.jsx(p,{variant:"destructive",children:"Issues Found"})]}),e.jsxs(f,{children:["Platform: ",g.platform,g.is_windows&&" (Windows uses access-based checks)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:Y,disabled:G,children:G?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Refresh"]})}),!g.all_correct&&!g.is_windows&&e.jsx(v,{size:"sm",onClick:cs,disabled:Le,children:Le?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(qs,{className:"h-4 w-4 mr-2"}),"Fix Issues"]})})]})]})})}),G&&!g&&e.jsx(d,{children:e.jsx(u,{className:"py-12 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Checking permissions..."})]})})}),g&&e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"Permission Details"}),e.jsx(f,{children:"Click on items with issues to see recommended fixes"})]}),e.jsx(u,{children:e.jsx("div",{className:"space-y-2",children:g.checks.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${s.is_correct?"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"mt-0.5",children:s.is_correct?e.jsx(Hs,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):s.exists?e.jsx(Ws,{className:"h-5 w-5 text-red-600 dark:text-red-400"}):e.jsx(Gs,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium font-mono text-sm",children:s.path}),s.is_sensitive&&e.jsxs(p,{variant:"outline",className:"text-xs",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Sensitive"]}),s.is_directory&&e.jsx(p,{variant:"outline",className:"text-xs",children:"Directory"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Expected: ",e.jsx("code",{className:"bg-muted px-1 rounded",children:s.expected_mode}),e.jsxs("span",{className:"ml-1 text-muted-foreground/70",children:["(",s.expected_rwx,")"]})]}),s.exists&&s.actual_mode&&e.jsxs("span",{className:s.is_correct?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:["Actual: ",e.jsx("code",{className:`px-1 rounded ${s.is_correct?"bg-green-100 dark:bg-green-900":"bg-red-100 dark:bg-red-900"}`,children:s.actual_mode}),e.jsxs("span",{className:"ml-1 opacity-70",children:["(",s.actual_rwx,")"]})]})]}),s.issue&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 rounded text-sm",children:[e.jsx("p",{className:"text-red-700 dark:text-red-300 font-medium",children:s.issue}),!g.is_windows&&!s.exists&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:"Fix: Create the directory or file"}),!g.is_windows&&s.exists&&s.actual_mode!==s.expected_mode&&e.jsxs("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:["Fix: ",e.jsxs("code",{className:"bg-red-200 dark:bg-red-800 px-1 rounded",children:["chmod ",s.expected_mode," ",s.path]})]})]}),s.warning&&!s.issue&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded text-sm",children:e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 font-medium",children:s.warning})})]})]},s.path))})})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(h,{children:"Understanding Permissions"})}),e.jsxs(u,{className:"text-sm text-muted-foreground space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Permission Format (Unix/Linux/macOS)"}),e.jsx("p",{children:"Permissions are shown as a 3-digit number (e.g., 755) where:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1 ml-2",children:[e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"7"})," = Read + Write + Execute (rwx)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"5"})," = Read + Execute (r-x)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"6"})," = Read + Write (rw-)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"4"})," = Read only (r--)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"0"})," = No permission (---)"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Sensitive Files"}),e.jsxs("p",{children:["Files marked as sensitive (like ",e.jsx("code",{className:"bg-muted px-1 rounded",children:".env"})," and ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"keys/"}),") should have restricted permissions (600 or 700) to prevent unauthorized access."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Windows"}),e.jsx("p",{children:"On Windows, the system checks if files/directories are readable and writable instead of Unix-style permissions."})]})]})]})]}),e.jsxs(F,{value:"theme",className:"space-y-6",children:[x&&e.jsxs(N,{variant:"destructive",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(y,{children:"Theme Changes Disabled"}),e.jsx(w,{children:"Theme customization is disabled while in Analyzer Mode. The purple theme is automatically applied for visual distinction. Switch back to Live Mode to change themes."})]}),e.jsx(d,{children:e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Current Theme"}),e.jsx(f,{children:x?"Analyzer Mode (Purple Theme)":`${I.charAt(0).toUpperCase()+I.slice(1)} Mode with ${R.charAt(0).toUpperCase()+R.slice(1)} accent`})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-primary",title:"Primary"}),e.jsx("div",{className:"w-6 h-6 rounded bg-secondary",title:"Secondary"}),e.jsx("div",{className:"w-6 h-6 rounded bg-accent",title:"Accent"}),e.jsx("div",{className:"w-6 h-6 rounded bg-muted",title:"Muted"})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:Ns,disabled:x||I==="light"&&R==="zinc",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})})}),e.jsxs(d,{className:x?"opacity-60":"",children:[e.jsxs(m,{children:[e.jsx(h,{children:"Theme Mode"}),e.jsx(f,{children:"Choose between light and dark interface"})]}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:sa.map(s=>{const a=s.icon,i=I===s.value&&!x;return e.jsxs("button",{type:"button",onClick:()=>bs(s.value),disabled:x,className:`flex items-start gap-4 p-4 rounded-lg border-2 transition-all text-left ${i?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${x?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("div",{className:`p-2 rounded-lg ${i?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.label}),i&&e.jsx(Ve,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]})]},s.value)})})})]}),e.jsxs(d,{className:x?"opacity-60":"",children:[e.jsxs(m,{children:[e.jsx(h,{children:"Accent Color"}),e.jsx(f,{children:"Customize the primary accent color"})]}),e.jsx(u,{children:e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-8 gap-3",children:aa.map(s=>{const a=R===s.value&&!x;return e.jsxs("button",{type:"button",onClick:()=>vs(s.value),disabled:x,className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${a?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${x?"cursor-not-allowed":"cursor-pointer"}`,title:s.label,children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${s.color} ring-2 ring-offset-2 ring-offset-background ${a?"ring-primary":"ring-transparent"}`}),e.jsx("span",{className:"text-xs font-medium",children:s.label})]},s.value)})})})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(h,{children:"About Themes"})}),e.jsxs(u,{className:"text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Light Mode:"})," Optimized for daytime use with high contrast and readability."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dark Mode:"})," Reduces eye strain during extended trading sessions, especially in low-light environments."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Analyzer Mode:"})," When in sandbox/analyzer mode, a distinct purple theme is applied automatically to clearly indicate you are not trading with real funds."]})]})]})]}),e.jsx(F,{value:"smtp",className:"space-y-6",children:e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"SMTP Configuration"}),e.jsx(f,{children:"Configure email settings for password reset notifications"})]}),e.jsxs(u,{children:[e.jsxs(N,{className:"mb-6",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(y,{children:"Gmail Configuration Tips"}),e.jsx(w,{children:e.jsxs("ul",{className:"text-sm list-disc list-inside mt-1 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Personal Gmail:"})," Server: smtp.gmail.com:587"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Password:"})," Use App Password (not your regular password)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Setup:"})," Google Account - Security - 2-Step Verification - App passwords"]})]})})]}),e.jsxs("form",{onSubmit:gs,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"SMTP Server"}),e.jsx(c,{value:ie,onChange:s=>ce(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"SMTP Port"}),e.jsx(c,{type:"number",value:de,onChange:s=>oe(s.target.value),placeholder:"587"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"587 (STARTTLS) or 465 (SSL/TLS)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username/Email"}),e.jsx(c,{type:"email",value:me,onChange:s=>he(s.target.value),placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Password/App Password"}),e.jsx(c,{type:"password",value:q,onChange:s=>xe(s.target.value),placeholder:P?.smtp_settings?.smtp_password?"Password is set (enter new to change)":"Enter your App Password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"From Email"}),e.jsx(c,{type:"email",value:ue,onChange:s=>pe(s.target.value),placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HELO Hostname"}),e.jsx(c,{value:ge,onChange:s=>je(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"smtp_tls",checked:fe,onCheckedChange:s=>be(s===!0)}),e.jsx(n,{htmlFor:"smtp_tls",children:"Use TLS/SSL"})]}),e.jsx(v,{type:"submit",disabled:ve,children:ve?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Save SMTP Settings"]})}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Test Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Send a test email to verify your SMTP settings."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"email",value:H,onChange:s=>ye(s.target.value),placeholder:"Enter email address to test",className:"flex-1"}),e.jsx(v,{type:"button",variant:"outline",onClick:js,disabled:we,children:we?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"h-4 w-4 mr-1"}),"Send Test"]})}),e.jsx(v,{type:"button",variant:"ghost",onClick:fs,disabled:_e,children:_e?e.jsx(j,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Qs,{className:"h-4 w-4 mr-1"}),"Debug"]})})]}),A&&e.jsxs(N,{className:`mt-4 ${A.success?"border-green-500":"border-yellow-500"}`,children:[e.jsx(y,{children:A.success?"SMTP Debug Complete":"SMTP Connection Issues"}),e.jsxs(w,{children:[e.jsx("p",{children:A.message}),A.details&&A.details.length>0&&e.jsx("ul",{className:"text-xs mt-2 list-disc list-inside",children:A.details.map((s,a)=>e.jsx("li",{children:s},a))})]})]})]})]})]})]})}),e.jsx(F,{value:"totp",className:"space-y-6",children:e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"TOTP Authentication"}),e.jsx(f,{children:"Manage your Two-Factor Authentication settings"})]}),e.jsxs(u,{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(y,{children:"About TOTP Authentication"}),e.jsx(w,{children:"TOTP (Time-based One-Time Password) provides an additional layer of security. You'll need an authenticator app like Google Authenticator or Authy to generate codes for password recovery."})]}),P?.qr_code&&P?.totp_secret?e.jsxs("div",{className:"bg-muted rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"font-semibold text-center",children:"Your TOTP QR Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-4 bg-white rounded-lg shadow",children:e.jsx("img",{src:`data:image/png;base64,${P.qr_code}`,alt:"TOTP QR Code",className:"w-48 h-48"})})}),e.jsxs("div",{className:"bg-background rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Manual Entry"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Secret key for manual entry:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-muted p-2 rounded text-sm break-all",children:P.totp_secret}),e.jsx(v,{size:"icon",variant:"outline",onClick:()=>ys(P.totp_secret),children:e.jsx(Zs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Install an authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx("li",{children:"Scan the QR code above or enter the secret key manually"}),e.jsx("li",{children:"Save your backup codes in a safe place"}),e.jsx("li",{children:"You'll need the TOTP code to reset your password if you forget it"})]})]})]}):e.jsxs(N,{variant:"destructive",children:[e.jsx(y,{children:"TOTP Not Available"}),e.jsx(w,{children:"Unable to load TOTP setup. Please contact your administrator."})]})]})]})})]}),e.jsx(_s,{open:ts,onOpenChange:L,children:e.jsxs(Ss,{children:[e.jsxs(Cs,{children:[e.jsxs(Ps,{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"h-5 w-5 text-yellow-500"}),"Restart Required"]}),e.jsxs(As,{className:"space-y-3",children:[e.jsxs("p",{children:["Your configuration has been saved to the ",e.jsx("code",{className:"bg-muted px-1 rounded",children:".env"})," file."]}),e.jsx("p",{children:"To apply these changes, please restart the OpenAlgo application using your usual method (terminal, service manager, or container orchestrator)."})]})]}),e.jsx(Ts,{children:e.jsx(Fs,{onClick:()=>L(!1),children:"Got it"})})]})})]})}export{fa as default};
