import{r as o,j as e}from"./vendor-react--vsXx8_n.js";import{c as u,B as L,t as R}from"./index-Cj_v6hGF.js";import{A as N,a as P}from"./alert-DkPj2IDG.js";import{C as T,a as D}from"./card-B_xd4nqk.js";import{I as p}from"./input-DyUxbrB0.js";import{L as h}from"./label-DBZNY0qD.js";import{P as E}from"./progress-q8NQWznr.js";import{I as O,L as M,t as S}from"./vendor-icons-N1cWsVu6.js";import{a as z}from"./vendor-router-CiBIGs7t.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DIebA-qg.js";function B(s){let t=0;return s.length>=8&&(t+=20),s.length>=12&&(t+=10),s.length>=16&&(t+=10),/[A-Z]/.test(s)&&(t+=15),/[a-z]/.test(s)&&(t+=15),/[0-9]/.test(s)&&(t+=15),/[!@#$%^&*]/.test(s)&&(t+=15),t}function Z(s){return{length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[!@#$%^&*]/.test(s)}}function ee(){const s=z(),[t,y]=o.useState(!1),[b,x]=o.useState(null),[a,C]=o.useState({username:"",email:"",password:"",confirmPassword:""}),[n,A]=o.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[d,F]=o.useState(0);o.useEffect(()=>{const r=Z(a.password);A(r),F(B(a.password))},[a.password]);const k=Object.values(n).every(Boolean),f=a.password===a.confirmPassword,q=Object.values(a).every(r=>r.trim()!==""),v=k&&f&&q,g=d>=80?{label:"Strong",color:"text-green-500"}:d>=50?{label:"Medium",color:"text-yellow-500"}:d>0?{label:"Weak",color:"text-red-500"}:{label:"",color:""},m=r=>{const{name:c,value:j}=r.target;C(l=>({...l,[c]:j}))},I=async r=>{if(r.preventDefault(),!!v){y(!0),x(null);try{const j=await(await fetch("/auth/csrf-token",{credentials:"include"})).json(),l=new FormData;l.append("username",a.username),l.append("email",a.email),l.append("password",a.password),l.append("confirm_password",a.confirmPassword),l.append("csrf_token",j.csrf_token);const w=await fetch("/setup",{method:"POST",body:l,credentials:"include"});if(await w.text(),w.ok||w.redirected){R.success("Account created successfully");try{await fetch("/auth/logout",{method:"POST",credentials:"include"})}catch{}s("/login")}else x("Setup failed. Please try again.")}catch(c){console.error("Setup error:",c),x("Setup failed. Please check your connection and try again.")}finally{y(!1)}}},i=({met:r,children:c})=>e.jsxs("div",{className:u("flex items-center gap-2 text-sm py-1 transition-colors",r?"text-green-500":"text-muted-foreground"),children:[e.jsx(S,{className:u("h-4 w-4",r?"opacity-100":"opacity-0")}),e.jsx("span",{children:c})]});return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center py-12 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center",children:[e.jsxs("div",{className:"space-y-6 lg:pr-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold leading-tight",children:["Initial ",e.jsx("span",{className:"text-primary",children:"Setup"})]}),e.jsx("p",{className:"text-lg lg:text-xl text-muted-foreground leading-relaxed",children:"Welcome to OpenAlgo! Create your administrator account to get started with algorithmic trading. This account will have full access to manage the platform."})]}),e.jsxs(N,{children:[e.jsx(O,{className:"h-5 w-5"}),e.jsxs(P,{children:[e.jsx("strong",{className:"block mb-1",children:"First Time Setup"}),"This form will create the initial administrator account. You'll receive a TOTP QR code for password resets after setup."]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(T,{children:e.jsx(D,{className:"p-6 lg:p-8",children:e.jsxs("form",{onSubmit:I,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"username",children:"Username"}),e.jsx(p,{id:"username",name:"username",type:"text",placeholder:"Choose a username",value:a.username,onChange:m,required:!0,disabled:t,autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"email",children:"Email"}),e.jsx(p,{id:"email",name:"email",type:"email",placeholder:"Enter your email",value:a.email,onChange:m,required:!0,disabled:t})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(p,{id:"password",name:"password",type:"password",placeholder:"Choose a password",value:a.password,onChange:m,required:!0,disabled:t,autoComplete:"new-password"}),e.jsx(E,{value:d,className:"h-2"}),g.label&&e.jsx("p",{className:u("text-xs font-medium",g.color),children:g.label})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(p,{id:"confirmPassword",name:"confirmPassword",type:"password",placeholder:"Confirm your password",value:a.confirmPassword,onChange:m,required:!0,disabled:t,autoComplete:"new-password"}),a.confirmPassword&&e.jsx("p",{className:u("text-xs",f?"text-green-500":"text-red-500"),children:f?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-1",children:[e.jsx(i,{met:n.length,children:"Minimum 8 characters"}),e.jsx(i,{met:n.uppercase,children:"At least 1 uppercase letter (A-Z)"}),e.jsx(i,{met:n.lowercase,children:"At least 1 lowercase letter (a-z)"}),e.jsx(i,{met:n.number,children:"At least 1 number (0-9)"}),e.jsx(i,{met:n.special,children:"At least 1 special character (!@#$%^&*)"})]}),b&&e.jsx(N,{variant:"destructive",children:e.jsx(P,{children:b})}),e.jsx(L,{type:"submit",className:"w-full",disabled:!v||t,children:t?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Create Account"]})})]})})})})]})})})}export{ee as default};
