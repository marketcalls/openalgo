import{r as i,j as e}from"./vendor-react-RhKMXzW9.js";import{B as b,e as t}from"./index-BoNsDlLq.js";import{C as d,b as p,c as g,a as o}from"./card-C3stnUX2.js";import{D as M,b as U,c as $,d as P}from"./dialog-CUbN_wY5.js";import{I as C}from"./input-CAyFnd52.js";import{L as _}from"./label-D9TE716G.js";import{T as V,a as X,b as y,c as l,d as q,e as r}from"./table-D7lho4NC.js";import{J as E}from"./json-editor-Zu9vP7gT.js";import{am as W,p as G,al as Y,T as R,g as K,an as Q,v as Z,t as ee}from"./vendor-icons-Ca5eNZvr.js";import"./vendor-router-DdyOoyPF.js";import"./vendor-radix-gKv__6YA.js";const se={NSE:"bg-cyan-500/10 text-cyan-600 border-cyan-500/30",NFO:"bg-purple-500/10 text-purple-600 border-purple-500/30",CDS:"bg-blue-500/10 text-blue-600 border-blue-500/30",BSE:"bg-gray-500/10 text-gray-600 border-gray-500/30",BFO:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",BCD:"bg-red-500/10 text-red-600 border-red-500/30",MCX:"bg-primary/10 text-primary border-primary/30",NCDEX:"bg-green-500/10 text-green-600 border-green-500/30"};function he(){const[N,T]=i.useState(null),[L,v]=i.useState(!0),[x,z]=i.useState(""),[m,O]=i.useState(""),[h,A]=i.useState(null),[B,w]=i.useState(!1);i.useEffect(()=>{D()},[]);const D=async(s,a)=>{v(!0);try{const n=new URLSearchParams;s&&n.append("start_date",s),a&&n.append("end_date",a);const f=n.toString()?`/analyzer/api/data?${n}`:"/analyzer/api/data",j=await fetch(f,{credentials:"include"});if(j.ok){const c=await j.json();c.status==="success"&&T(c.data)}}catch(n){console.error("Error fetching analyzer data:",n)}finally{v(!1)}},F=s=>{s.preventDefault(),D(x,m)},I=()=>{const s=new URLSearchParams;x&&s.append("start_date",x),m&&s.append("end_date",m);const a=s.toString()?`/analyzer/export?${s}`:"/analyzer/export";window.location.href=a},k=s=>{A(s),w(!0)},J=s=>{if(s.api_type==="cancelorder")return`OrderID: ${s.orderid}`;let a=s.symbol||"";return s.quantity&&(a+=` (${s.quantity})`),s.api_type==="placesmartorder"&&s.position_size&&(a+=` [Size: ${s.position_size}]`),a},H=s=>{const a={...s};return delete a.apikey,a};if(L)return e.jsx("div",{className:"container mx-auto py-8 px-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const u=N?.stats||{total_requests:0,issues:{total:0},symbols:[],sources:[]},S=N?.requests||[];return e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sandbox Request Monitor"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and validate your sandbox API requests before going live"})]}),e.jsxs("form",{onSubmit:F,className:"flex flex-wrap gap-4 items-end mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"start_date",children:"Start Date"}),e.jsx(C,{id:"start_date",type:"date",value:x,onChange:s=>z(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"end_date",children:"End Date"}),e.jsx(C,{id:"end_date",type:"date",value:m,onChange:s=>O(s.target.value)})]}),e.jsxs(b,{type:"submit",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(b,{type:"button",variant:"secondary",onClick:I,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Export to CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs(d,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Total Requests"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:u.total_requests}),e.jsx(t,{className:"mt-1",children:"Last 24 hours"})]})]}),e.jsxs(d,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Issues Found"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-500",children:u.issues.total}),e.jsx(t,{variant:"secondary",className:"mt-1",children:"Needs Attention"})]})]}),e.jsxs(d,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Unique Symbols"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold",children:u.symbols.length}),e.jsx(t,{variant:"outline",className:"mt-1",children:"Tracked"})]})]}),e.jsxs(d,{children:[e.jsx(p,{className:"pb-2",children:e.jsxs(g,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Active Sources"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"text-3xl font-bold",children:u.sources.length}),e.jsx(t,{variant:"outline",className:"mt-1",children:"Connected"})]})]})]}),e.jsx(d,{children:e.jsx(o,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(V,{children:[e.jsx(X,{children:e.jsxs(y,{children:[e.jsx(l,{children:"Timestamp"}),e.jsx(l,{children:"API Type"}),e.jsx(l,{children:"Source"}),e.jsx(l,{children:"Details"}),e.jsx(l,{children:"Exchange"}),e.jsx(l,{children:"Action"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"View"})]})}),e.jsx(q,{children:S.length===0?e.jsx(y,{children:e.jsx(r,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No requests found"})}):S.map((s,a)=>e.jsxs(y,{className:"hover:bg-muted/50",children:[e.jsx(r,{className:"text-sm",children:s.timestamp}),e.jsx(r,{children:e.jsx(t,{variant:"default",children:s.api_type})}),e.jsx(r,{children:e.jsx(t,{variant:"secondary",className:"truncate max-w-[120px]",children:s.source})}),e.jsx(r,{className:"font-medium",children:J(s)}),e.jsx(r,{children:s.exchange&&e.jsx(t,{className:se[s.exchange]||"",variant:"outline",children:s.exchange})}),e.jsx(r,{children:s.action&&e.jsx(t,{variant:s.action==="BUY"?"default":"destructive",children:s.action})}),e.jsx(r,{children:s.analysis.issues?e.jsxs(t,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Error"]}):e.jsxs(t,{variant:"secondary",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Success"]})}),e.jsx(r,{children:e.jsxs(b,{size:"sm",onClick:()=>k(s),children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"View"]})})]},a))})]})})})}),e.jsx(M,{open:B,onOpenChange:w,children:e.jsxs(U,{className:"max-w-[95vw] w-full",children:[e.jsx($,{children:e.jsx(P,{children:"Request Details"})}),h&&(()=>{const s=JSON.stringify(H(h.request_data),null,2),a=JSON.stringify(h.response_data||h.analysis,null,2),n=s.split(`
`).length,f=a.split(`
`).length,j=Math.max(n,f),c=Math.min(Math.max(j*20+24,150),600);return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Request Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50",style:{height:c},children:e.jsx(E,{value:s,readOnly:!0,lineWrapping:!1})})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Response Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50",style:{height:c},children:e.jsx(E,{value:a,readOnly:!0,lineWrapping:!1})})]})]})})()]})})]})}export{he as default};
