import{r,j as e}from"./vendor-react--vsXx8_n.js";import{w as _,B as $,c as M,e as te,t as C}from"./index-DjX_MYuF.js";import{C as l,a as o,b as m,c as v,d as c}from"./card-DODizzaF.js";import{T as H,a as I,b,c as n,d as V,e as i}from"./table-BWg86uKn.js";import{W as ae,q as U,n as q}from"./lightweight-charts.production-EcMg1Lek.js";import{L as Z,R as re,ap as ne,q as ie,aD as le,bj as ce,D as de,bk as oe,aW as me,v as K,w as xe,a1 as he,ax as ue}from"./vendor-icons-CZtcNCrV.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DnptSSCf.js";async function je(){return(await _.get("/health/api/current")).data}async function fe(s=24){return(await _.get("/health/api/history",{params:{hours:s}})).data}async function ge(s=24){return(await _.get("/health/api/stats",{params:{hours:s}})).data}async function Ne(){return(await _.get("/health/api/alerts")).data}async function pe(s){await _.post(`/health/api/alerts/${s}/acknowledge`)}function ve(s=24){return`/health/export?hours=${s}`}const be=1e4;function S({title:s,icon:u,value:d,subtitle:D,status:a,loading:W}){const w={pass:"text-green-500",warn:"text-yellow-500",fail:"text-red-500",unknown:"text-primary"},E={pass:"text-green-500 opacity-20",warn:"text-yellow-500 opacity-20",fail:"text-red-500 opacity-20",unknown:"text-primary opacity-20"};return e.jsx(l,{children:e.jsx(c,{className:"p-4",children:W?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(Z,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx("p",{className:M("text-2xl font-bold",w[a]),children:d}),D&&e.jsx("p",{className:"text-xs text-muted-foreground",children:D})]}),e.jsx(u,{className:M("h-8 w-8",E[a])})]})})})}function Y({status:s}){return s==="pass"?e.jsx(xe,{className:"h-4 w-4 text-green-500"}):s==="warn"?e.jsx(K,{className:"h-4 w-4 text-yellow-500"}):s==="fail"?e.jsx(he,{className:"h-4 w-4 text-red-500"}):e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})}const we="Asia/Kolkata";function X(s,u){const d=new Date(s);return Number.isNaN(d.getTime())?"-":new Intl.DateTimeFormat("en-IN",{timeZone:we,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0,...u}).format(d)}function ye(s){return X(s,{year:void 0,month:void 0,day:void 0})}function ke(){return document.documentElement.classList.contains("dark")}function $e(){const[s,u]=r.useState(null),[d,D]=r.useState([]),[a,W]=r.useState(null),[w,E]=r.useState([]),[G,J]=r.useState(!0),[z,O]=r.useState(!1),[y,Q]=r.useState(!0),N=r.useRef(null),p=r.useRef(null),j=r.useRef(null),f=r.useRef(null),B=r.useRef(null),L=r.useRef(null),F=async(t=!1)=>{try{O(!0);const[x,R,T,A]=await Promise.all([je(),fe(24),ge(24),Ne()]);u(x),D(R),W(T),E(A),t&&C.success("Metrics refreshed")}catch(x){console.error("Error fetching health metrics:",x),C.error("Failed to fetch health metrics")}finally{J(!1),O(!1)}};r.useEffect(()=>{F()},[]),r.useEffect(()=>{if(!y)return;const t=setInterval(()=>{F()},be);return()=>clearInterval(t)},[y]),r.useEffect(()=>{if(!d.length)return;const t=ke(),x=t?"#9ca3af":"#6b7280",R=t?"#374151":"#e5e7eb",T=t?"#4b5563":"#d1d5db",A={height:300,layout:{background:{type:ae.Solid,color:"transparent"},textColor:x},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{borderColor:T,timeVisible:!0},rightPriceScale:{borderColor:T},crosshair:{vertLine:{color:R},horzLine:{color:R}}};if(N.current&&!j.current){const g=U(N.current,{...A,width:N.current.clientWidth,localization:{priceFormatter:h=>Math.round(h).toString()}}),k=g.addSeries(q,{color:"#3b82f6",lineWidth:2,priceLineVisible:!1,lastValueVisible:!0,priceFormat:{type:"custom",formatter:h=>Math.round(h).toString()}});j.current=g,B.current=k}if(p.current&&!f.current){const g=U(p.current,{...A,width:p.current.clientWidth}),k=g.addSeries(q,{color:"#10b981",lineWidth:2,priceLineVisible:!1,lastValueVisible:!0});f.current=g,L.current=k}if(B.current&&L.current){const g=d.map(h=>({time:Math.floor(new Date(h.timestamp).getTime()/1e3),value:h.fd_count})),k=d.map(h=>({time:Math.floor(new Date(h.timestamp).getTime()/1e3),value:h.memory_rss_mb}));B.current.setData(g),L.current.setData(k)}const P=()=>{j.current&&N.current&&j.current.applyOptions({width:N.current.clientWidth}),f.current&&p.current&&f.current.applyOptions({width:p.current.clientWidth})};return window.addEventListener("resize",P),()=>window.removeEventListener("resize",P)},[d]),r.useEffect(()=>()=>{j.current&&(j.current.remove(),j.current=null),f.current&&(f.current.remove(),f.current=null)},[]);const ee=async t=>{try{await pe(t),C.success("Alert acknowledged"),F()}catch(x){console.error("Error acknowledging alert:",x),C.error("Failed to acknowledge alert")}},se=()=>{window.open(ve(24),"_blank"),C.success("Exporting metrics to CSV")};return G?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(Z,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"System Health Monitor"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Real-time infrastructure monitoring â€¢ Updates every 10 seconds"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",onClick:()=>F(!0),disabled:z,children:[e.jsx(re,{className:M("h-4 w-4 mr-2",z&&"animate-spin")}),"Refresh"]}),e.jsxs($,{variant:y?"default":"outline",size:"sm",onClick:()=>Q(!y),children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Auto: ",y?"ON":"OFF"]}),e.jsxs($,{variant:"outline",size:"sm",onClick:se,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),s&&e.jsxs("div",{className:M("rounded-lg border p-4 flex items-center gap-4",s.overall_status==="pass"&&"border-green-500/50 bg-green-500/10",s.overall_status==="warn"&&"border-yellow-500/50 bg-yellow-500/10",s.overall_status==="fail"&&"border-red-500/50 bg-red-500/10"),children:[e.jsx(Y,{status:s.overall_status}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["System Status: ",s.overall_status.toUpperCase()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated (IST): ",X(s.timestamp)]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsx(S,{title:"File Descriptors",icon:le,value:s?`${s.fd.count} / ${s.fd.limit}`:"-",subtitle:s?`${s.fd.usage_percent.toFixed(1)}% used`:void 0,status:s?.fd.status||"unknown",loading:!s}),e.jsx(S,{title:"Memory Usage",icon:ce,value:s?`${s.memory.rss_mb.toFixed(1)} MB`:"-",subtitle:s?`${s.memory.percent.toFixed(1)}% of system`:void 0,status:s?.memory.status||"unknown",loading:!s}),e.jsx(S,{title:"Database Connections",icon:de,value:s?.database.total||0,subtitle:"Active connections",status:s?.database.status||"unknown",loading:!s}),e.jsx(S,{title:"WebSocket Connections",icon:oe,value:s?.websocket.total||0,subtitle:s?`${s.websocket.total_symbols} symbols`:void 0,status:s?.websocket.status||"unknown",loading:!s}),e.jsx(S,{title:"Active Threads",icon:me,value:s?.threads.count||0,subtitle:s&&s.threads.stuck>0?`${s.threads.stuck} stuck`:"None stuck",status:s?.threads.status||"unknown",loading:!s})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(m,{className:"text-lg",children:"File Descriptors (24h)"}),e.jsx(v,{children:"Historical FD usage over the last 24 hours"})]}),e.jsx(c,{children:e.jsx("div",{ref:N,className:"w-full h-[300px]"})})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(m,{className:"text-lg",children:"Memory Usage (24h)"}),e.jsx(v,{children:"Historical memory consumption in MB"})]}),e.jsx(c,{children:e.jsx("div",{ref:p,className:"w-full h-[300px]"})})]})]}),a&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(l,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-base",children:"File Descriptor Stats"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Current:"}),e.jsx("dd",{className:"font-medium",children:a.fd.current})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Average:"}),e.jsx("dd",{className:"font-medium",children:a.fd.avg.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Min / Max:"}),e.jsxs("dd",{className:"font-medium",children:[a.fd.min," / ",a.fd.max]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Warnings:"}),e.jsx("dd",{className:"font-medium text-yellow-600 dark:text-yellow-400",children:a.fd.warn_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Failures:"}),e.jsx("dd",{className:"font-medium text-red-600 dark:text-red-400",children:a.fd.fail_count})]})]})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-base",children:"Memory Stats"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Current:"}),e.jsxs("dd",{className:"font-medium",children:[a.memory.current_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Average:"}),e.jsxs("dd",{className:"font-medium",children:[a.memory.avg_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Min / Max:"}),e.jsxs("dd",{className:"font-medium",children:[a.memory.min_mb.toFixed(1)," / ",a.memory.max_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Warnings:"}),e.jsx("dd",{className:"font-medium text-yellow-600 dark:text-yellow-400",children:a.memory.warn_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Failures:"}),e.jsx("dd",{className:"font-medium text-red-600 dark:text-red-400",children:a.memory.fail_count})]})]})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-base",children:"Connection Stats"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"DB Current:"}),e.jsx("dd",{className:"font-medium",children:a.database.current})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"DB Average:"}),e.jsx("dd",{className:"font-medium",children:a.database.avg.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"WS Current:"}),e.jsx("dd",{className:"font-medium",children:a.websocket.current})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"WS Average:"}),e.jsx("dd",{className:"font-medium",children:a.websocket.avg.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Threads:"}),e.jsx("dd",{className:"font-medium",children:a.threads.current})]})]})})]}),e.jsxs(l,{children:[e.jsx(o,{className:"pb-3",children:e.jsx(m,{className:"text-base",children:"Status Summary"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Overall (Pass/Warn/Fail):"}),e.jsx("dd",{className:"font-medium",children:a.status?.overall?`${a.status.overall.pass}/${a.status.overall.warn}/${a.status.overall.fail}`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"DB Warn/Fail:"}),e.jsx("dd",{className:"font-medium",children:a.status?.database?`${a.status.database.warn}/${a.status.database.fail}`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"WS Warn/Fail:"}),e.jsx("dd",{className:"font-medium",children:a.status?.websocket?`${a.status.websocket.warn}/${a.status.websocket.fail}`:"-"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Threads Warn/Fail:"}),e.jsx("dd",{className:"font-medium",children:a.status?.threads?`${a.status.threads.warn}/${a.status.threads.fail}`:"-"})]})]})})]})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(m,{className:"text-lg",children:"Top Memory Processes"}),e.jsx(v,{children:"Highest RSS memory usage across the host"})]}),e.jsx(c,{children:s?.processes&&s.processes.length>0?e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(b,{children:[e.jsx(n,{children:"Process"}),e.jsx(n,{className:"text-right",children:"PID"}),e.jsx(n,{className:"text-right",children:"RSS (MB)"}),e.jsx(n,{className:"text-right",children:"VMS (MB)"}),e.jsx(n,{className:"text-right",children:"Mem %"})]})}),e.jsx(V,{children:s.processes.map(t=>e.jsxs(b,{children:[e.jsx(i,{className:"font-medium",children:t.name}),e.jsx(i,{className:"text-right font-mono text-xs",children:t.pid??"-"}),e.jsx(i,{className:"text-right",children:t.rss_mb.toFixed(1)}),e.jsx(i,{className:"text-right",children:t.vms_mb.toFixed(1)}),e.jsx(i,{className:"text-right",children:t.memory_percent.toFixed(2)})]},`${t.pid}-${t.name}`))})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No process data available."})})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(m,{className:"text-lg",children:"Thread Details"}),e.jsx(v,{children:"Recent thread snapshot from the application"})]}),e.jsx(c,{children:s?.threads.details&&s.threads.details.length>0?e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(b,{children:[e.jsx(n,{children:"Thread"}),e.jsx(n,{className:"text-right",children:"ID"}),e.jsx(n,{className:"text-right",children:"Daemon"}),e.jsx(n,{className:"text-right",children:"Alive"})]})}),e.jsx(V,{children:s.threads.details.map(t=>e.jsxs(b,{children:[e.jsx(i,{className:"font-medium",children:t.name}),e.jsx(i,{className:"text-right font-mono text-xs",children:t.id??"-"}),e.jsx(i,{className:"text-right",children:t.daemon?"Yes":"No"}),e.jsx(i,{className:"text-right",children:t.alive?"Yes":"No"})]},`${t.id}-${t.name}`))})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"No thread details available."})})]}),w.length>0&&e.jsxs(l,{className:"border-destructive/50",children:[e.jsxs(o,{children:[e.jsxs(m,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(K,{className:"h-5 w-5"}),"Active Alerts (",w.length,")"]}),e.jsx(v,{children:"System health alerts requiring attention"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:w.map(t=>e.jsxs("div",{className:M("rounded-lg border p-3 flex items-start justify-between gap-4",t.severity==="fail"&&"border-red-500/50 bg-red-500/10",t.severity==="warn"&&"border-yellow-500/50 bg-yellow-500/10"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{status:t.severity}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.alert_type.replace(/_/g," ").toUpperCase()}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.message})]})]}),!t.acknowledged&&e.jsx($,{variant:"outline",size:"sm",onClick:()=>ee(t.id),children:"Acknowledge"})]},t.id))})})]}),e.jsxs(l,{children:[e.jsxs(o,{children:[e.jsx(m,{className:"text-lg",children:"Recent Metrics"}),e.jsx(v,{children:"Last 20 samples from the monitoring system"})]}),e.jsx(c,{children:e.jsxs(H,{children:[e.jsx(I,{children:e.jsxs(b,{children:[e.jsx(n,{children:"Time"}),e.jsx(n,{className:"text-right",children:"FDs"}),e.jsx(n,{className:"text-right",children:"Memory (MB)"}),e.jsx(n,{className:"text-right",children:"DB Conns"}),e.jsx(n,{className:"text-right",children:"WS Conns"}),e.jsx(n,{className:"text-right",children:"Threads"}),e.jsx(n,{children:"Status"})]})}),e.jsx(V,{children:d.slice(-20).reverse().map((t,x)=>e.jsxs(b,{children:[e.jsx(i,{className:"font-mono text-xs",children:ye(t.timestamp)}),e.jsx(i,{className:"text-right",children:t.fd_count}),e.jsx(i,{className:"text-right",children:t.memory_rss_mb.toFixed(1)}),e.jsx(i,{className:"text-right",children:t.db_connections}),e.jsx(i,{className:"text-right",children:t.ws_connections}),e.jsx(i,{className:"text-right",children:t.threads}),e.jsx(i,{children:e.jsx(te,{variant:t.overall_status==="pass"?"default":t.overall_status==="warn"?"secondary":"destructive",children:t.overall_status})})]},x))})]})})]})]})}export{$e as default};
