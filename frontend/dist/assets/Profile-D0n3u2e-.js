import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{d as vs,u as ys,w as j,t as l,e as _,B as f}from"./index-DerOnoSe.js";import{A as b,b as N,a as v}from"./alert-ByWfjKG2.js";import{A as ws,b as ks,c as _s,d as Ss,e as Cs,f as Ps,h as As}from"./alert-dialog-C8_B9m1c.js";import{S as Ts,a as Fs,b as Ms,c as Ds,d as Es}from"./select-DqLsQ7yQ.js";import{C as o,b as h,c as x,a as p,d as y}from"./card-SnKlx7GJ.js";import{C as He}from"./checkbox-qp9iIY-9.js";import{I as c}from"./input-Bd3sN5G5.js";import{L as n}from"./label-BDsgyazW.js";import{P as Is}from"./progress-DMzVHNwA.js";import{T as Rs,a as Us,b as A,c as T}from"./tabs-X3dH76fd.js";import{A as $s,U as Bs,z as X,K as Q,a5 as qe,a6 as Ls,y as Z,w as Ge,s as We,X as zs,R as g,u as L,a7 as Os,C as Ks,a8 as Hs,a0 as qs,k as Gs,l as Ws,a9 as Ys,aa as Vs,a2 as Xs,T as Qs}from"./vendor-icons-64jt6PPv.js";import{L as Zs}from"./vendor-router-D7kKkCmL.js";import"./vendor-radix-Cue1hf3Z.js";const Js=[{value:"light",label:"Light",icon:Gs,description:"Clean, bright interface for daytime trading"},{value:"dark",label:"Dark",icon:Ws,description:"Reduced eye strain for extended sessions"}],ea=[{value:"zinc",label:"Zinc",color:"bg-zinc-500"},{value:"slate",label:"Slate",color:"bg-slate-500"},{value:"gray",label:"Gray",color:"bg-gray-500"},{value:"neutral",label:"Neutral",color:"bg-neutral-500"},{value:"green",label:"Green",color:"bg-green-500"},{value:"blue",label:"Blue",color:"bg-blue-500"},{value:"violet",label:"Violet",color:"bg-violet-500"},{value:"orange",label:"Orange",color:"bg-orange-500"}];function ua(){const Ye=vs(s=>s.user),{mode:E,color:I,appMode:Ve,setMode:J,setColor:ee}=ys(),[Xe,Qe]=r.useState("account"),[Ze,Je]=r.useState(!0),[C,es]=r.useState(null),[z,se]=r.useState(""),[F,ae]=r.useState(""),[M,re]=r.useState(""),[O,ss]=r.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[te,le]=r.useState(!1),[ne,ie]=r.useState("smtp.gmail.com"),[ce,de]=r.useState("587"),[oe,me]=r.useState(""),[K,he]=r.useState(""),[xe,pe]=r.useState(""),[ue,ge]=r.useState("smtp.gmail.com"),[je,fe]=r.useState(!0),[be,Ne]=r.useState(!1),[H,ve]=r.useState(""),[ye,we]=r.useState(!1),[ke,_e]=r.useState(!1),[P,R]=r.useState(null),[t,q]=r.useState(null),[w,Se]=r.useState(""),[k,Ce]=r.useState(""),[U,Pe]=r.useState(""),[$,Ae]=r.useState(""),[d,Te]=r.useState(""),[D,Fe]=r.useState(!1),[S,Me]=r.useState(""),[De,Ee]=r.useState(!1),[Ie,Re]=r.useState(!1),[as,B]=r.useState(!1),[u,rs]=r.useState(null),[G,Ue]=r.useState(!1),[$e,Be]=r.useState(!1),m=Ve==="analyzer";r.useEffect(()=>{ts(),ls()},[]);const ts=async()=>{try{const s=await j.get("/auth/profile-data");if(s.data.status==="success"){es(s.data.data);const a=s.data.data.smtp_settings;a&&(ie(a.smtp_server||"smtp.gmail.com"),de(String(a.smtp_port||587)),me(a.smtp_username||""),pe(a.smtp_from_email||""),ge(a.smtp_helo_hostname||"smtp.gmail.com"),fe(a.smtp_use_tls!==!1),ve(a.smtp_username||""))}}catch(s){console.error("Error fetching profile data:",s),l.error("Failed to load profile data")}finally{Je(!1)}},ls=async()=>{try{const s=await j.get("/api/broker/credentials");s.data.status==="success"&&(q(s.data.data),Te(s.data.data.current_broker),Fe(s.data.data.ngrok_allow),Me(s.data.data.host_server))}catch(s){console.error("Error fetching broker credentials:",s)}},W=async()=>{Ue(!0);try{const s=await j.get("/api/system/permissions");s.data.status==="success"&&rs(s.data.data)}catch(s){console.error("Error fetching permissions:",s),l.error("Failed to load permission status")}finally{Ue(!1)}},ns=async()=>{Be(!0);try{const s=await j.post("/api/system/permissions/fix");if(s.data.status==="success"){const{fixed:a,failed:i,message:Ke}=s.data.data;a.length>0&&l.success(`Fixed ${a.length} permission issues`),i.length>0&&l.warning(`${i.length} issues could not be fixed automatically`),a.length===0&&i.length===0&&l.info(Ke),await W()}else l.error("Failed to fix permissions")}catch(s){console.error("Error fixing permissions:",s),l.error("Failed to fix permissions")}finally{Be(!1)}},Le=s=>{const i=(t?.redirect_url||"http://127.0.0.1:5000").match(/^(https?:\/\/[^/]+)/);return`${i?i[1]:"http://127.0.0.1:5000"}/${s}/callback`},is=async()=>{Ee(!0);try{const s=new FormData;w&&s.append("broker_api_key",w),k&&s.append("broker_api_secret",k),U&&s.append("broker_api_key_market",U),$&&s.append("broker_api_secret_market",$),d&&d!==t?.current_broker&&s.append("redirect_url",Le(d));const a=await j.post("/api/broker/credentials",s);a.data.status==="success"?(l.success(a.data.message),t&&q({...t,current_broker:d||t.current_broker,redirect_url:d!==t.current_broker?Le(d):t.redirect_url,broker_api_key:w?`${w.slice(0,6)}${"*".repeat(Math.max(0,w.length-6))}`:t.broker_api_key,broker_api_key_raw_length:w?w.length:t.broker_api_key_raw_length,broker_api_secret:k?`${k.slice(0,4)}${"*".repeat(Math.max(0,k.length-4))}`:t.broker_api_secret,broker_api_secret_raw_length:k?k.length:t.broker_api_secret_raw_length}),Se(""),Ce(""),Pe(""),Ae(""),B(!0)):l.error(a.data.message||"Failed to save credentials")}catch(s){const a=s;l.error(a.response?.data?.message||"Failed to save broker credentials")}finally{Ee(!1)}},cs=!!(w||k||U||$||d&&d!==t?.current_broker),ds=!!(D!==t?.ngrok_allow||S&&S!==t?.host_server),os=async()=>{Re(!0);try{const s={ngrok_allow:D?"TRUE":"FALSE"};S&&(s.host_server=S);const a=await j.post("/api/broker/credentials",s);a.data.status==="success"?(l.success(a.data.message),t&&q({...t,ngrok_allow:D,host_server:S||t.host_server}),B(!0)):l.error(a.data.message||"Failed to save ngrok settings")}catch(s){const a=s;l.error(a.response?.data?.message||"Failed to save ngrok settings")}finally{Re(!1)}},ze=r.useCallback(s=>{const a={length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[!@#$%^&*]/.test(s)};return ss(a),Object.values(a).every(Boolean)},[]);r.useEffect(()=>{ze(F)},[F,ze]);const ms=()=>{const s=Object.values(O).filter(Boolean).length;return s===0?{percentage:0,label:"None",color:"bg-gray-400"}:s<=2?{percentage:40,label:"Weak",color:"bg-red-500"}:s<=3?{percentage:60,label:"Fair",color:"bg-yellow-500"}:s<=4?{percentage:80,label:"Good",color:"bg-blue-500"}:{percentage:100,label:"Strong",color:"bg-green-500"}},Y=F===M&&M!=="",hs=Object.values(O).every(Boolean),Oe=Y&&hs&&z!=="",xs=async s=>{if(s.preventDefault(),!!Oe){le(!0);try{const a=new FormData;a.append("old_password",z),a.append("new_password",F),a.append("confirm_password",M);const i=await j.post("/auth/change-password",a);i.data.status==="success"?(l.success(i.data.message||"Password changed successfully"),se(""),ae(""),re("")):l.error(i.data.message||"Failed to change password")}catch(a){const i=a;l.error(i.response?.data?.message||"Failed to change password")}finally{le(!1)}}},ps=async s=>{s.preventDefault(),Ne(!0);try{const a=new FormData;a.append("smtp_server",ne),a.append("smtp_port",ce),a.append("smtp_username",oe),K&&a.append("smtp_password",K),a.append("smtp_from_email",xe),a.append("smtp_helo_hostname",ue),je&&a.append("smtp_use_tls","on");const i=await j.post("/auth/smtp-config",a);i.data.status==="success"?(l.success(i.data.message||"SMTP settings saved successfully"),he("")):l.error(i.data.message||"Failed to save SMTP settings")}catch(a){const i=a;l.error(i.response?.data?.message||"Failed to save SMTP settings")}finally{Ne(!1)}},us=async()=>{if(!H){l.error("Please enter an email address to test");return}we(!0),R(null);try{const s=new FormData;s.append("test_email",H);const a=await j.post("/auth/test-smtp",s);a.data.success?l.success(a.data.message||"Test email sent successfully"):l.error(a.data.message||"Failed to send test email")}catch(s){const a=s;l.error(a.response?.data?.message||"Failed to send test email")}finally{we(!1)}},gs=async()=>{_e(!0),R(null);try{const s=await j.post("/auth/debug-smtp",{});R(s.data)}catch(s){R({success:!1,message:s.response?.data?.message||"Failed to debug SMTP",details:[]})}finally{_e(!1)}},js=s=>{if(m){l.error("Cannot change theme while in Analyzer Mode");return}J(s),l.success(`Theme changed to ${s}`)},fs=s=>{if(m){l.error("Cannot change theme while in Analyzer Mode");return}ee(s),l.success(`Accent color changed to ${s}`)},bs=()=>{if(m){l.error("Cannot change theme while in Analyzer Mode");return}J("light"),ee("zinc"),l.success("Theme reset to default")},Ns=s=>{navigator.clipboard.writeText(s).then(()=>{l.success("Copied to clipboard")}).catch(()=>{l.error("Failed to copy")})},V=ms();return Ze?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Zs,{to:"/dashboard",className:"text-muted-foreground hover:text-foreground",children:e.jsx($s,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Bs,{className:"h-6 w-6"}),"Profile Settings"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and security preferences"})]}),e.jsxs(Rs,{value:Xe,onValueChange:s=>{Qe(s),s==="permissions"&&!u&&W()},children:[e.jsxs(Us,{className:"grid w-full grid-cols-6",children:[e.jsxs(A,{value:"account",className:"gap-1",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Account"})]}),e.jsxs(A,{value:"broker",className:"gap-1",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Broker"})]}),e.jsxs(A,{value:"permissions",className:"gap-1",children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"System"})]}),e.jsxs(A,{value:"theme",className:"gap-1",children:[e.jsx(Ls,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Theme"})]}),e.jsxs(A,{value:"smtp",className:"gap-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"SMTP"})]}),e.jsxs(A,{value:"totp",className:"gap-1",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"TOTP"})]})]}),e.jsxs(T,{value:"account",className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(x,{children:"Account Information"})}),e.jsxs(p,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username"}),e.jsx(c,{value:Ye?.username||C?.username||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Account Type"}),e.jsx("div",{className:"pt-2",children:e.jsx(_,{children:"Administrator"})})]})]})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(x,{children:"Change Password"})}),e.jsx(p,{children:e.jsxs("form",{onSubmit:xs,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Current Password"}),e.jsx(c,{type:"password",placeholder:"Enter your current password",value:z,onChange:s=>se(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"New Password"}),e.jsx(c,{type:"password",placeholder:"Enter your new password",value:F,onChange:s=>ae(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Confirm New Password"}),e.jsx(c,{type:"password",placeholder:"Confirm your new password",value:M,onChange:s=>re(s.target.value)}),M&&e.jsx("p",{className:`text-sm ${Y?"text-green-500":"text-red-500"}`,children:Y?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Strength"}),e.jsx("span",{className:"font-medium",children:V.label})]}),e.jsx(Is,{value:V.percentage,className:V.color}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(O).map(([s,a])=>e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full border ${a?"bg-green-500/10 border-green-500 text-green-600":"bg-muted border-border text-muted-foreground"}`,children:[a?e.jsx(We,{className:"h-3 w-3"}):e.jsx(zs,{className:"h-3 w-3"}),e.jsxs("span",{children:[s==="length"&&"8+ chars",s==="uppercase"&&"A-Z",s==="lowercase"&&"a-z",s==="number"&&"0-9",s==="special"&&"Special (@#$%^&*)"]})]},s))})]}),e.jsx(f,{type:"submit",disabled:!Oe||te,children:te?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2 animate-spin"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Change Password"]})})]})})]})]}),e.jsxs(T,{value:"broker",className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(N,{children:"Broker API Credentials"}),e.jsx(v,{children:"Update your broker API credentials. Changes require an application restart to take effect. You will be logged out after saving."})]}),e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Current Configuration"}),e.jsx(y,{children:"Your currently configured broker and credentials"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Current Broker"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(_,{variant:"outline",className:"text-base",children:t?.current_broker?.toUpperCase()||"Not configured"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Redirect URL"}),e.jsx("code",{className:"text-xs text-muted-foreground break-all",children:t?.redirect_url||"Not configured"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"API Key"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:t?.broker_api_key||"(not set)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"API Secret"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:t?.broker_api_secret||"(not set)"})]})]}),(t?.broker_api_key_market_raw_length??0)>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Key"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:t?.broker_api_key_market||"(not set)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Secret"}),e.jsx("code",{className:"text-xs text-muted-foreground",children:t?.broker_api_secret_market||"(not set)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Ngrok Status"}),e.jsx(_,{variant:t?.ngrok_allow?"default":"secondary",children:t?.ngrok_allow?"Enabled":"Disabled"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Host Server"}),e.jsx("code",{className:"text-xs text-muted-foreground break-all",children:t?.host_server||"(not set)"})]})]})]})]}),e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Update Credentials"}),e.jsx(y,{children:"Enter new values to update. Leave fields empty to keep existing values."})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Select Broker"}),e.jsxs(Ts,{value:d,onValueChange:Te,children:[e.jsx(Fs,{children:e.jsx(Ms,{placeholder:"Select a broker"})}),e.jsx(Ds,{children:t?.valid_brokers.map(s=>e.jsx(Es,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),d&&d!==t?.current_broker&&e.jsxs("p",{className:"text-sm text-yellow-600 dark:text-yellow-500",children:["Changing broker to: ",d.toUpperCase()]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Broker API Key"}),e.jsx(c,{type:"password",value:w,onChange:s=>Se(s.target.value),placeholder:"Enter new API key"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(t?.broker_api_key_raw_length??0)>0?`Current: ${t?.broker_api_key_raw_length} chars`:"Not currently set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Broker API Secret"}),e.jsx(c,{type:"password",value:k,onChange:s=>Ce(s.target.value),placeholder:"Enter new API secret"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:(t?.broker_api_secret_raw_length??0)>0?`Current: ${t?.broker_api_secret_raw_length} chars`:"Not currently set"})]})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Market Data API (Optional)"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Required only for XTS API supported brokers (e.g., 5paisa XTS, Jainam XTS)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Key"}),e.jsx(c,{type:"password",value:U,onChange:s=>Pe(s.target.value),placeholder:"Enter market API key"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Market API Secret"}),e.jsx(c,{type:"password",value:$,onChange:s=>Ae(s.target.value),placeholder:"Enter market API secret"})]})]})]}),d==="fivepaisa"&&e.jsxs(b,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(N,{children:"5paisa API Key Format"}),e.jsxs(v,{children:["Format: ",e.jsx("code",{children:"User_Key:::User_ID:::client_id"})]})]}),d==="flattrade"&&e.jsxs(b,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(N,{children:"Flattrade API Key Format"}),e.jsxs(v,{children:["Format: ",e.jsx("code",{children:"client_id:::api_key"})]})]}),d==="dhan"&&e.jsxs(b,{className:"bg-blue-50 dark:bg-blue-950 border-blue-200",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(N,{children:"Dhan API Key Format"}),e.jsxs(v,{children:["Format: ",e.jsx("code",{children:"client_id:::api_key"})]})]}),e.jsx(f,{onClick:is,disabled:!cs||De,className:"w-full",children:De?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Save Broker Credentials"]})})]})]}),e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Ngrok Configuration"}),e.jsx(y,{children:"Configure ngrok for receiving webhook alerts from external services like TradingView, Chartink, GoCharting, etc."})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(He,{id:"ngrok_enabled",checked:D,onCheckedChange:s=>Fe(s===!0)}),e.jsx(n,{htmlFor:"ngrok_enabled",children:"Enable Ngrok Tunnel"}),D!==t?.ngrok_allow&&e.jsx(_,{variant:"outline",className:"text-yellow-600",children:"Changed"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Host Server URL"}),e.jsx(c,{value:S,onChange:s=>Me(s.target.value),placeholder:"https://your-domain.ngrok-free.app"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your ngrok domain or custom domain for receiving webhooks."}),S!==t?.host_server&&S&&e.jsxs(_,{variant:"outline",className:"text-yellow-600",children:["Changed from: ",t?.host_server]})]}),e.jsx(f,{onClick:os,disabled:!ds||Ie,className:"w-full",children:Ie?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Save Ngrok Settings"]})})]})]})]}),e.jsxs(T,{value:"permissions",className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(qe,{className:"h-4 w-4"}),e.jsx(N,{children:"File Permissions Monitor"}),e.jsx(v,{children:"Check file and directory permissions for OpenAlgo components. Incorrect permissions may cause the application to malfunction."})]}),u&&e.jsx(o,{children:e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(x,{className:"flex items-center gap-2",children:["System Status",u.all_correct?e.jsx(_,{className:"bg-green-500",children:"All OK"}):e.jsx(_,{variant:"destructive",children:"Issues Found"})]}),e.jsxs(y,{children:["Platform: ",u.platform,u.is_windows&&" (Windows uses access-based checks)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:W,disabled:G,children:G?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Refresh"]})}),!u.all_correct&&!u.is_windows&&e.jsx(f,{size:"sm",onClick:ns,disabled:$e,children:$e?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Os,{className:"h-4 w-4 mr-2"}),"Fix Issues"]})})]})]})})}),G&&!u&&e.jsx(o,{children:e.jsx(p,{className:"py-12 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Checking permissions..."})]})})}),u&&e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"Permission Details"}),e.jsx(y,{children:"Click on items with issues to see recommended fixes"})]}),e.jsx(p,{children:e.jsx("div",{className:"space-y-2",children:u.checks.map(s=>e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg border ${s.is_correct?"bg-green-50 dark:bg-green-950/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800"}`,children:[e.jsx("div",{className:"mt-0.5",children:s.is_correct?e.jsx(Ks,{className:"h-5 w-5 text-green-600 dark:text-green-400"}):s.exists?e.jsx(Hs,{className:"h-5 w-5 text-red-600 dark:text-red-400"}):e.jsx(qs,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium font-mono text-sm",children:s.path}),s.is_sensitive&&e.jsxs(_,{variant:"outline",className:"text-xs",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Sensitive"]}),s.is_directory&&e.jsx(_,{variant:"outline",className:"text-xs",children:"Directory"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-0.5",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Expected: ",e.jsx("code",{className:"bg-muted px-1 rounded",children:s.expected_mode}),e.jsxs("span",{className:"ml-1 text-muted-foreground/70",children:["(",s.expected_rwx,")"]})]}),s.exists&&s.actual_mode&&e.jsxs("span",{className:s.is_correct?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:["Actual: ",e.jsx("code",{className:`px-1 rounded ${s.is_correct?"bg-green-100 dark:bg-green-900":"bg-red-100 dark:bg-red-900"}`,children:s.actual_mode}),e.jsxs("span",{className:"ml-1 opacity-70",children:["(",s.actual_rwx,")"]})]})]}),s.issue&&e.jsxs("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 rounded text-sm",children:[e.jsx("p",{className:"text-red-700 dark:text-red-300 font-medium",children:s.issue}),!u.is_windows&&!s.exists&&e.jsx("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:"Fix: Create the directory or file"}),!u.is_windows&&s.exists&&s.actual_mode!==s.expected_mode&&e.jsxs("p",{className:"text-red-600 dark:text-red-400 text-xs mt-1",children:["Fix: ",e.jsxs("code",{className:"bg-red-200 dark:bg-red-800 px-1 rounded",children:["chmod ",s.expected_mode," ",s.path]})]})]}),s.warning&&!s.issue&&e.jsx("div",{className:"mt-2 p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded text-sm",children:e.jsx("p",{className:"text-yellow-700 dark:text-yellow-300 font-medium",children:s.warning})})]})]},s.path))})})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(x,{children:"Understanding Permissions"})}),e.jsxs(p,{className:"text-sm text-muted-foreground space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Permission Format (Unix/Linux/macOS)"}),e.jsx("p",{children:"Permissions are shown as a 3-digit number (e.g., 755) where:"}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1 ml-2",children:[e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"7"})," = Read + Write + Execute (rwx)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"5"})," = Read + Execute (r-x)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"6"})," = Read + Write (rw-)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"4"})," = Read only (r--)"]}),e.jsxs("li",{children:[e.jsx("code",{className:"bg-muted px-1 rounded",children:"0"})," = No permission (---)"]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Sensitive Files"}),e.jsxs("p",{children:["Files marked as sensitive (like ",e.jsx("code",{className:"bg-muted px-1 rounded",children:".env"})," and ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"keys/"}),") should have restricted permissions (600 or 700) to prevent unauthorized access."]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-foreground",children:"Windows"}),e.jsx("p",{children:"On Windows, the system checks if files/directories are readable and writable instead of Unix-style permissions."})]})]})]})]}),e.jsxs(T,{value:"theme",className:"space-y-6",children:[m&&e.jsxs(b,{variant:"destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(N,{children:"Theme Changes Disabled"}),e.jsx(v,{children:"Theme customization is disabled while in Analyzer Mode. The purple theme is automatically applied for visual distinction. Switch back to Live Mode to change themes."})]}),e.jsx(o,{children:e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{children:"Current Theme"}),e.jsx(y,{children:m?"Analyzer Mode (Purple Theme)":`${E.charAt(0).toUpperCase()+E.slice(1)} Mode with ${I.charAt(0).toUpperCase()+I.slice(1)} accent`})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-primary",title:"Primary"}),e.jsx("div",{className:"w-6 h-6 rounded bg-secondary",title:"Secondary"}),e.jsx("div",{className:"w-6 h-6 rounded bg-accent",title:"Accent"}),e.jsx("div",{className:"w-6 h-6 rounded bg-muted",title:"Muted"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:bs,disabled:m||E==="light"&&I==="zinc",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})})}),e.jsxs(o,{className:m?"opacity-60":"",children:[e.jsxs(h,{children:[e.jsx(x,{children:"Theme Mode"}),e.jsx(y,{children:"Choose between light and dark interface"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Js.map(s=>{const a=s.icon,i=E===s.value&&!m;return e.jsxs("button",{type:"button",onClick:()=>js(s.value),disabled:m,className:`flex items-start gap-4 p-4 rounded-lg border-2 transition-all text-left ${i?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${m?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("div",{className:`p-2 rounded-lg ${i?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.label}),i&&e.jsx(We,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]})]},s.value)})})})]}),e.jsxs(o,{className:m?"opacity-60":"",children:[e.jsxs(h,{children:[e.jsx(x,{children:"Accent Color"}),e.jsx(y,{children:"Customize the primary accent color"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-8 gap-3",children:ea.map(s=>{const a=I===s.value&&!m;return e.jsxs("button",{type:"button",onClick:()=>fs(s.value),disabled:m,className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${a?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${m?"cursor-not-allowed":"cursor-pointer"}`,title:s.label,children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${s.color} ring-2 ring-offset-2 ring-offset-background ${a?"ring-primary":"ring-transparent"}`}),e.jsx("span",{className:"text-xs font-medium",children:s.label})]},s.value)})})})]}),e.jsxs(o,{children:[e.jsx(h,{children:e.jsx(x,{children:"About Themes"})}),e.jsxs(p,{className:"text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Light Mode:"})," Optimized for daytime use with high contrast and readability."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dark Mode:"})," Reduces eye strain during extended trading sessions, especially in low-light environments."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Analyzer Mode:"})," When in sandbox/analyzer mode, a distinct purple theme is applied automatically to clearly indicate you are not trading with real funds."]})]})]})]}),e.jsx(T,{value:"smtp",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"SMTP Configuration"}),e.jsx(y,{children:"Configure email settings for password reset notifications"})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"mb-6",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(N,{children:"Gmail Configuration Tips"}),e.jsx(v,{children:e.jsxs("ul",{className:"text-sm list-disc list-inside mt-1 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Personal Gmail:"})," Server: smtp.gmail.com:587"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Password:"})," Use App Password (not your regular password)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Setup:"})," Google Account - Security - 2-Step Verification - App passwords"]})]})})]}),e.jsxs("form",{onSubmit:ps,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"SMTP Server"}),e.jsx(c,{value:ne,onChange:s=>ie(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"SMTP Port"}),e.jsx(c,{type:"number",value:ce,onChange:s=>de(s.target.value),placeholder:"587"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"587 (STARTTLS) or 465 (SSL/TLS)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Username/Email"}),e.jsx(c,{type:"email",value:oe,onChange:s=>me(s.target.value),placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Password/App Password"}),e.jsx(c,{type:"password",value:K,onChange:s=>he(s.target.value),placeholder:C?.smtp_settings?.smtp_password?"Password is set (enter new to change)":"Enter your App Password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"From Email"}),e.jsx(c,{type:"email",value:xe,onChange:s=>pe(s.target.value),placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"HELO Hostname"}),e.jsx(c,{value:ue,onChange:s=>ge(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(He,{id:"smtp_tls",checked:je,onCheckedChange:s=>fe(s===!0)}),e.jsx(n,{htmlFor:"smtp_tls",children:"Use TLS/SSL"})]}),e.jsx(f,{type:"submit",disabled:be,children:be?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Save SMTP Settings"]})}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Test Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Send a test email to verify your SMTP settings."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"email",value:H,onChange:s=>ve(s.target.value),placeholder:"Enter email address to test",className:"flex-1"}),e.jsx(f,{type:"button",variant:"outline",onClick:us,disabled:ye,children:ye?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ys,{className:"h-4 w-4 mr-1"}),"Send Test"]})}),e.jsx(f,{type:"button",variant:"ghost",onClick:gs,disabled:ke,children:ke?e.jsx(g,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Vs,{className:"h-4 w-4 mr-1"}),"Debug"]})})]}),P&&e.jsxs(b,{className:`mt-4 ${P.success?"border-green-500":"border-yellow-500"}`,children:[e.jsx(N,{children:P.success?"SMTP Debug Complete":"SMTP Connection Issues"}),e.jsxs(v,{children:[e.jsx("p",{children:P.message}),P.details&&P.details.length>0&&e.jsx("ul",{className:"text-xs mt-2 list-disc list-inside",children:P.details.map((s,a)=>e.jsx("li",{children:s},a))})]})]})]})]})]})]})}),e.jsx(T,{value:"totp",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(h,{children:[e.jsx(x,{children:"TOTP Authentication"}),e.jsx(y,{children:"Manage your Two-Factor Authentication settings"})]}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx(N,{children:"About TOTP Authentication"}),e.jsx(v,{children:"TOTP (Time-based One-Time Password) provides an additional layer of security. You'll need an authenticator app like Google Authenticator or Authy to generate codes for password recovery."})]}),C?.qr_code&&C?.totp_secret?e.jsxs("div",{className:"bg-muted rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"font-semibold text-center",children:"Your TOTP QR Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-4 bg-white rounded-lg shadow",children:e.jsx("img",{src:`data:image/png;base64,${C.qr_code}`,alt:"TOTP QR Code",className:"w-48 h-48"})})}),e.jsxs("div",{className:"bg-background rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Manual Entry"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Secret key for manual entry:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-muted p-2 rounded text-sm break-all",children:C.totp_secret}),e.jsx(f,{size:"icon",variant:"outline",onClick:()=>Ns(C.totp_secret),children:e.jsx(Xs,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Install an authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx("li",{children:"Scan the QR code above or enter the secret key manually"}),e.jsx("li",{children:"Save your backup codes in a safe place"}),e.jsx("li",{children:"You'll need the TOTP code to reset your password if you forget it"})]})]})]}):e.jsxs(b,{variant:"destructive",children:[e.jsx(N,{children:"TOTP Not Available"}),e.jsx(v,{children:"Unable to load TOTP setup. Please contact your administrator."})]})]})]})})]}),e.jsx(ws,{open:as,onOpenChange:B,children:e.jsxs(ks,{children:[e.jsxs(_s,{children:[e.jsxs(Ss,{className:"flex items-center gap-2",children:[e.jsx(Qs,{className:"h-5 w-5 text-yellow-500"}),"Restart Required"]}),e.jsxs(Cs,{className:"space-y-3",children:[e.jsxs("p",{children:["Your configuration has been saved to the ",e.jsx("code",{className:"bg-muted px-1 rounded",children:".env"})," file."]}),e.jsx("p",{children:"To apply these changes, please restart the OpenAlgo application using your usual method (terminal, service manager, or container orchestrator)."})]})]}),e.jsx(Ps,{children:e.jsx(As,{onClick:()=>B(!1),children:"Got it"})})]})})]})}export{ua as default};
