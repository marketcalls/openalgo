import{r as u,j as e}from"./vendor-react-CCyQGCED.js";import{s as o,B as n}from"./index-NHrG-O_Z.js";import{A as I,a as O}from"./alert-BoGaKMRC.js";import{C as M,a as P,b as B,d as V}from"./card-Cn20bp_v.js";import{D as W,b as X,c as H,d as U,e as Y,f as q}from"./dialog-DA9GnjaJ.js";import{I as j}from"./input-BylzFlgY.js";import{L as J}from"./label-_1WWiomg.js";import{S as b,a as S,b as w,c as k,d as y}from"./select-DcHsBqkV.js";import{k as _,i as G,ae as T,ar as x}from"./vendor-icons-CCn_k3dF.js";import{L as Q}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";async function L(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}const Z=["Never","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],$=[{value:"100000",label:"1,00,000 (1 Lakh)"},{value:"500000",label:"5,00,000 (5 Lakhs)"},{value:"1000000",label:"10,00,000 (10 Lakhs)"},{value:"2500000",label:"25,00,000 (25 Lakhs)"},{value:"5000000",label:"50,00,000 (50 Lakhs)"},{value:"10000000",label:"1,00,00,000 (1 Crore)"}];function K(i){return i.split("_").map(c=>{const h=c.toUpperCase();return["NSE","BSE","CDS","BCD","MCX","NCDEX","MIS","CNC","NRML"].includes(h)?h:c.charAt(0).toUpperCase()+c.slice(1)}).join(" ")}function ue(){const[i,c]=u.useState({}),[h,f]=u.useState(new Set),[R,z]=u.useState(!0),[v,C]=u.useState(!1),[F,p]=u.useState(!1);u.useEffect(()=>{g()},[]);const g=async()=>{try{const s=await fetch("/sandbox/api/configs",{credentials:"include"});if(s.ok){const r=await s.json();r.status==="success"&&c(r.configs)}}catch{o.error("Failed to load configuration","analyzer")}finally{z(!1)}},d=(s,r)=>{c(a=>{const t={...a};for(const l in t)if(t[l].configs[s]){t[l].configs[s]={...t[l].configs[s],value:r};break}return t}),f(a=>new Set(a).add(s))},m=async s=>{let r="";for(const a in i)if(i[a].configs[s]){r=i[a].configs[s].value;break}try{const a=await L(),l=await(await fetch("/sandbox/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a},credentials:"include",body:JSON.stringify({config_key:s,config_value:r})})).json();l.status==="success"?(o.success(l.message,"analyzer"),f(E=>{const N=new Set(E);return N.delete(s),N})):o.error(l.message,"analyzer")}catch{o.error("Failed to save configuration","analyzer")}},D=async()=>{C(!0);try{const s=await L(),a=await(await fetch("/sandbox/reset",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include"})).json();a.status==="success"?(o.success(a.message,"analyzer"),p(!1),setTimeout(()=>{g()},1e3)):o.error(a.message,"analyzer")}catch{o.error("Failed to reset configuration","analyzer")}finally{C(!1)}},A=(s,r)=>{const a=h.has(s);if(s==="reset_day")return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{value:r.value,onValueChange:t=>d(s,t),children:[e.jsx(S,{className:"flex-1",children:e.jsx(w,{})}),e.jsx(k,{children:Z.map(t=>e.jsx(y,{value:t,children:t},t))})]}),e.jsxs(n,{size:"sm",variant:a?"default":"secondary",onClick:()=>m(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]});if(s==="reset_time"||s.endsWith("_square_off_time"))return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"time",value:r.value||"",onChange:t=>d(s,t.target.value),className:"flex-1"}),e.jsxs(n,{size:"sm",variant:a?"default":"secondary",onClick:()=>m(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]});if(s.endsWith("_leverage"))return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"number",value:r.value||"",onChange:t=>d(s,t.target.value),min:"1",max:"50",step:"0.1",className:"flex-1"}),e.jsxs(n,{size:"sm",variant:a?"default":"secondary",onClick:()=>m(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]});if(s==="starting_capital"){const t=parseFloat(r.value||"10000000").toFixed(0);return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{value:t,onValueChange:l=>d(s,l),children:[e.jsx(S,{className:"flex-1",children:e.jsx(w,{})}),e.jsx(k,{children:$.map(l=>e.jsx(y,{value:l.value,children:l.label},l.value))})]}),e.jsxs(n,{size:"sm",variant:a?"default":"secondary",onClick:()=>m(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]})}return s==="order_check_interval"||s==="mtm_update_interval"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"number",value:r.value||"",onChange:t=>d(s,t.target.value),min:s==="mtm_update_interval"?0:1,max:s==="mtm_update_interval"?60:30,step:"1",className:"flex-1"}),e.jsxs(n,{size:"sm",variant:a?"default":"secondary",onClick:()=>m(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"text",value:r.value||"",onChange:t=>d(s,t.target.value),className:"flex-1"}),e.jsxs(n,{size:"sm",variant:a?"default":"secondary",onClick:()=>m(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]})};return R?e.jsx("div",{className:"container mx-auto py-8 px-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(_,{className:"h-8 w-8"}),"Sandbox Configuration"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Configure sandbox environment settings"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(n,{asChild:!0,children:e.jsxs(Q,{to:"/sandbox/mypnl",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"My P&L"]})}),e.jsxs(n,{variant:"destructive",onClick:()=>p(!0),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Reset to Defaults"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(i).map(([s,r])=>e.jsxs(M,{children:[e.jsx(P,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5 text-primary"}),r.title]})}),e.jsx(V,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(r.configs).map(([a,t])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:a,className:"font-semibold",children:K(a)}),A(a,t),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},a))})})]},s))}),e.jsx(W,{open:F,onOpenChange:p,children:e.jsxs(X,{children:[e.jsxs(H,{children:[e.jsxs(U,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(T,{className:"h-5 w-5"}),"Reset ALL Sandbox Data"]}),e.jsx(Y,{asChild:!0,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(I,{variant:"destructive",children:e.jsx(O,{children:"This action cannot be undone!"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"This action will:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-sm",children:[e.jsx("li",{children:"Delete all orders, trades, positions, and holdings"}),e.jsx("li",{children:"Reset funds to starting capital (1.00 Crore)"}),e.jsx("li",{children:"Reset all configuration values to defaults"}),e.jsx("li",{children:"Clear all historical data"})]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Are you absolutely sure you want to reset everything?"})]})})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"ghost",onClick:()=>p(!1),children:"Cancel"}),e.jsx(n,{variant:"destructive",onClick:D,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"Resetting..."]}):"Yes, Reset Everything"})]})]})})]})}export{ue as default};
