import{r as a,j as e}from"./vendor-react-Z55t3GwI.js";import{B as r,t as l}from"./index-DkS0A_YW.js";import{p as S}from"./python-strategy-DD3XR0Dq.js";import{C as v,a as N,b as P,c as E,d as I}from"./card-BzfevURh.js";import{C as A}from"./checkbox-DAPlxdNA.js";import{I as C}from"./input-C1zk1ISa.js";import{L as u}from"./label-BofpAOMY.js";import{S as h}from"./skeleton-CnoJGqq4.js";import{b as B}from"./python-strategy-CDLQ7BFJ.js";import{A as b,ai as z,P as w}from"./vendor-icons-B3sIx3h3.js";import{d as q,a as H,L as _}from"./vendor-router-CuCQU4nC.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-D7j7RylB.js";function Z(){const{strategyId:i}=q(),o=H(),[d,k]=a.useState(null),[T,x]=a.useState(!0),[p,f]=a.useState(!1),[m,g]=a.useState("09:15"),[y,j]=a.useState("15:30"),[c,n]=a.useState(["mon","tue","wed","thu","fri"]);a.useEffect(()=>{(async()=>{if(i)try{x(!0);const s=await S.getStrategy(i);k(s),s.is_scheduled&&(s.schedule_start_time&&g(s.schedule_start_time),s.schedule_stop_time&&j(s.schedule_stop_time),s.schedule_days?.length&&n(s.schedule_days))}catch(s){console.error("Failed to fetch strategy:",s),l.error("Failed to load strategy"),o("/python")}finally{x(!1)}})()},[i]);const D=t=>{n(s=>s.includes(t)?s.filter(L=>L!==t):[...s,t])},F=async t=>{if(t.preventDefault(),!!i){if(c.length===0){l.error("Please select at least one day");return}if(!m){l.error("Start time is required");return}try{f(!0);const s=await S.scheduleStrategy(i,{start_time:m,stop_time:y||null,days:c});s.status==="success"?(l.success("Schedule saved successfully"),o("/python")):l.error(s.message||"Failed to save schedule")}catch(s){console.error("Failed to schedule:",s),l.error("Failed to save schedule")}finally{f(!1)}}};return T?e.jsxs("div",{className:"container mx-auto py-6 max-w-2xl space-y-6",children:[e.jsx(h,{className:"h-8 w-32"}),e.jsx(h,{className:"h-12"}),e.jsx(h,{className:"h-64"})]}):d?d.status==="running"?e.jsxs("div",{className:"container mx-auto py-6 max-w-2xl space-y-6",children:[e.jsx(r,{variant:"ghost",asChild:!0,children:e.jsxs(_,{to:"/python",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Cannot modify schedule while strategy is running. Please stop the strategy first."})})})]}):e.jsxs("div",{className:"container mx-auto py-6 max-w-2xl space-y-6",children:[e.jsx(r,{variant:"ghost",asChild:!0,children:e.jsxs(_,{to:"/python",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Schedule Strategy"}),e.jsx("p",{className:"text-muted-foreground",children:d.name})]}),e.jsxs(v,{children:[e.jsxs(P,{children:[e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Schedule Settings"]}),e.jsx(I,{children:"Set when the strategy should automatically start and stop (IST)"})]}),e.jsx(N,{children:e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"start_time",className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Start Time (IST)"]}),e.jsx(C,{id:"start_time",type:"time",value:m,onChange:t=>g(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{htmlFor:"stop_time",className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Stop Time (IST)"]}),e.jsx(C,{id:"stop_time",type:"time",value:y,onChange:t=>j(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Optional - leave empty to run until manually stopped"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(u,{children:"Days to Run"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(t=>e.jsxs("label",{className:`flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-colors ${c.includes(t.value)?"bg-primary text-primary-foreground border-primary":"bg-background hover:bg-muted"}`,children:[e.jsx(A,{checked:c.includes(t.value),onCheckedChange:()=>D(t.value),className:"hidden"}),e.jsx("span",{className:"text-sm font-medium",children:t.label})]},t.value))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>n(["mon","tue","wed","thu","fri"]),children:"Weekdays"}),e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>n(["sat","sun"]),children:"Weekend"}),e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>n(["mon","tue","wed","thu","fri","sat","sun"]),children:"Every Day"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",className:"flex-1",onClick:()=>o("/python"),children:"Cancel"}),e.jsx(r,{type:"submit",className:"flex-1",disabled:p,children:p?"Saving...":"Save Schedule"})]})]})})]})]}):null}export{Z as default};
