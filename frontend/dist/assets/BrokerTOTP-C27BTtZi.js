import{r as b,j as e}from"./vendor-react-CCyQGCED.js";import{d as U,B as w,f as Y,s as C}from"./index-D0023jFM.js";import{A as P,a as j}from"./alert-Dlgyh2fF.js";import{C as A,a as F,b as S,c as B,d as z}from"./card-CDguRyHx.js";import{I as q}from"./input-D8_g_dg9.js";import{L as G}from"./label-BgxgrBuS.js";import{d as K,a as _,L as R}from"./vendor-router-Dzc1xxhr.js";import{N,A as E,T as $,L as H,_ as J}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const x={fivepaisa:{fields:[{name:"userid",label:"Client ID / Mobile No",type:"text",placeholder:"Enter Client ID or Mobile Number"},{name:"pin",label:"PIN",type:"password",placeholder:"Enter your PIN"},{name:"totp",label:"TOTP",type:"password",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric"}],callbackUrl:"/fivepaisa/callback"},aliceblue:{fields:[{name:"userid",label:"User ID",type:"text",placeholder:"Enter your User ID (alphanumeric)"}],callbackUrl:"/aliceblue/callback"},angel:{fields:[{name:"userid",label:"Client ID",type:"text",placeholder:"Enter your Client ID"},{name:"pin",label:"PIN",type:"password",placeholder:"Enter your PIN (min 4 digits)"},{name:"totp",label:"TOTP",type:"text",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric",hint:"Get TOTP from your authenticator app"}],callbackUrl:"/angel/callback"},definedge:{fields:[{name:"otp",label:"OTP",type:"password",placeholder:"Enter OTP sent to your registered mobile/email",inputMode:"numeric",hint:"OTP has been sent to your registered mobile/email"}],callbackUrl:"/definedge/callback"},firstock:{fields:[{name:"userid",label:"User ID",type:"text",placeholder:"Enter your User ID"},{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"totp",label:"TOTP",type:"password",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric",hint:"Get TOTP from your authenticator app"}],callbackUrl:"/firstock/callback"},kotak:{fields:[{name:"mobile",label:"Mobile Number",type:"tel",placeholder:"Enter 10-digit mobile number",maxLength:10,pattern:"[0-9]{10}",inputMode:"numeric",prefix:"+91",hint:"Mobile number registered with Kotak NEO"},{name:"mpin",label:"MPIN",type:"password",placeholder:"Enter 6-digit MPIN",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric"},{name:"totp",label:"TOTP Code",type:"text",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric"}],callbackUrl:"/kotak/callback",warning:"Make sure TOTP is registered in your Kotak NEO mobile app. Go to Settings > Security > Enable TOTP."},motilal:{fields:[{name:"userid",label:"User ID",type:"text",placeholder:"Enter your User ID"},{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"dob",label:"Date of Birth",type:"text",placeholder:"DD/MM/YYYY",hint:"Format: DD/MM/YYYY"},{name:"totp",label:"TOTP",type:"password",placeholder:"Enter TOTP (optional)",maxLength:6,optional:!0,hint:"Leave blank to receive OTP via SMS/Email"}],callbackUrl:"/motilal/callback"},mstock:{fields:[{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"totp",label:"TOTP",type:"text",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric"}],callbackUrl:"/mstock/callback"},nubra:{fields:[{name:"totp",label:"TOTP Code",type:"text",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric",hint:"Enter the 6-digit code from your authenticator app"}],callbackUrl:"/nubra/callback"},samco:{fields:[{name:"yob",label:"Year of Birth",type:"text",placeholder:"YYYY",maxLength:4,pattern:"[0-9]{4}",inputMode:"numeric",hint:"Client ID and Password are configured in environment"}],callbackUrl:"/samco/callback"},shoonya:{fields:[{name:"userid",label:"User ID",type:"text",placeholder:"Enter your User ID"},{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"totp",label:"TOTP",type:"password",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric",hint:"Get TOTP from your authenticator app"}],callbackUrl:"/shoonya/callback"},tradejini:{fields:[{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"twofa",label:"2FA Code / TOTP",type:"text",placeholder:"Enter your 2FA code or TOTP",hint:"You can get TOTP from Tradejini web app under Profile > Security"}],callbackUrl:"/tradejini/callback",hiddenFields:{twofatype:"totp"}},zebu:{fields:[{name:"userid",label:"User ID",type:"text",placeholder:"Enter your User ID"},{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"totp",label:"TOTP / DOB / PAN",type:"password",placeholder:"Enter TOTP (6 digits), DOB (DDMMYYYY), or PAN",hint:"Enter 6-digit TOTP, Date of Birth (DDMMYYYY), or PAN number"}],callbackUrl:"/zebu/callback"},default:{fields:[{name:"userid",label:"User ID",type:"text",placeholder:"Enter your User ID"},{name:"password",label:"Password",type:"password",placeholder:"Enter your Password"},{name:"totp",label:"TOTP",type:"text",placeholder:"Enter 6-digit TOTP",maxLength:6,pattern:"[0-9]{6}",inputMode:"numeric"}]}},O={fivepaisa:"5Paisa","5paisa":"5Paisa",aliceblue:"AliceBlue",angel:"Angel One",definedge:"Definedge Securities",firstock:"Firstock",kotak:"Kotak NEO",motilal:"Motilal Oswal",mstock:"MStock",nubra:"Nubra (Nuvama)",samco:"Samco",shoonya:"Shoonya",tradejini:"Tradejini",zebu:"Zebu",jmfinancial:"JM Financial"};function se(){const{broker:r}=K(),y=_(),{login:D}=U(),[h,p]=b.useState(!1),[f,i]=b.useState(null),[o,M]=b.useState({}),n=r==="5paisa"?"fivepaisa":r,l=n&&x[n]?x[n]:x.default,g=r?O[r]||O[n||""]||r:"Broker",v=async a=>{if(a.preventDefault(),p(!0),i(null),!r&&!n){i("Invalid broker selected."),p(!1);return}if(l.fields.filter(t=>!t.optional).map(t=>t.name).filter(t=>!o[t]?.trim()).length>0){i("Please fill in all required fields."),p(!1);return}try{const t=await Y(),s=new FormData;Object.entries(o).forEach(([d,u])=>{n==="kotak"&&d==="mobile"?s.append(d,`+91${u.trim()}`):s.append(d,u.trim())}),l.hiddenFields&&Object.entries(l.hiddenFields).forEach(([d,u])=>{s.append(d,u)}),s.append("csrf_token",t);const L=l.callbackUrl||`/${r}/callback`,T=await fetch(L,{method:"POST",body:s,credentials:"include"}),k=await T.json();k.status==="success"||T.ok?(D(o.userid||o.mobile||"",r||""),C.success("Authentication successful"),y("/dashboard")):i(k.message||"Authentication failed. Please try again.")}catch{i("Authentication failed. Please check your credentials and try again.")}finally{p(!1)}},I=(a,c,m)=>{let t=c;m.inputMode==="numeric"&&(t=c.replace(/\D/g,"")),m.maxLength&&(t=t.slice(0,m.maxLength)),M(s=>({...s,[a]:t}))};return e.jsx("div",{className:"min-h-screen flex items-center justify-center py-8 px-4",children:e.jsx("div",{className:"container max-w-md",children:e.jsxs(A,{className:"shadow-xl",children:[e.jsxs(F,{className:"text-center relative",children:[e.jsxs(w,{variant:"ghost",size:"sm",className:"absolute left-4 top-4",onClick:()=>y("/broker"),children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Back"]}),e.jsx("div",{className:"flex justify-center mb-4 pt-6",children:e.jsx("div",{className:"h-16 w-16 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(E,{className:"h-8 w-8 text-primary"})})}),e.jsxs(S,{className:"text-2xl",children:[g," Login"]}),e.jsxs(B,{children:["Enter your credentials to authenticate with ",g]})]}),e.jsxs(z,{children:[l.warning&&e.jsxs(P,{variant:"warning",className:"mb-4",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx(j,{children:l.warning})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[l.fields.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(G,{htmlFor:a.name,children:[a.label,a.optional&&e.jsx("span",{className:"text-muted-foreground ml-1",children:"(optional)"})]}),e.jsxs("div",{className:"relative",children:[a.prefix&&e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground text-sm",children:a.prefix}),e.jsx(q,{id:a.name,type:a.type,inputMode:a.inputMode,placeholder:a.placeholder,value:o[a.name]||"",onChange:c=>I(a.name,c.target.value,a),required:!a.optional,disabled:h,maxLength:a.maxLength,pattern:a.pattern,autoComplete:a.type==="password"?"current-password":a.inputMode==="numeric"?"one-time-code":"off",className:a.prefix?"pl-12":""})]}),a.hint&&e.jsx("p",{className:"text-xs text-muted-foreground",children:a.hint})]},a.name)),f&&e.jsx(P,{variant:"destructive",children:e.jsx(j,{children:f})}),e.jsx(w,{type:"submit",className:"w-full",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4 animate-spin"}),"Authenticating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Authenticate"]})})]}),e.jsxs("div",{className:"mt-6 space-y-3 text-center text-sm text-muted-foreground",children:[e.jsx("p",{children:"Your credentials are securely transmitted and encrypted."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs(R,{to:"/broker",className:"text-primary hover:underline inline-flex items-center gap-1",children:[e.jsx(N,{className:"h-3 w-3"}),"Back to Broker Selection"]}),e.jsxs("a",{href:"https://docs.openalgo.in",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline inline-flex items-center gap-1",children:["Documentation",e.jsx(J,{className:"h-3 w-3"})]})]})]})]})]})})})}export{se as default};
