import{r as l,j as e,a as Xe}from"./vendor-react--vsXx8_n.js";import{g as He,v as De,D as Ie,j as Me,B as A,k as Fe,A as ge,C as ke,E as pe,n as Ne,G as _e,c as C,e as Re,d as Se,s as le}from"./index-JRPYi7nR.js";import{a as Be,u as Ke}from"./useMarketStatus-BGHprHsG.js";import{h as Ge,a0 as Je,ad as Ze,aT as et,aU as tt,V as Ee,c as st,aB as at,aD as nt}from"./vendor-icons-BuMiuTFa.js";import{D as Ue,a as rt,b as Ve,c as qe,d as Ae,e as lt,f as ze,g as it}from"./dialog-dJiJ6Fif.js";import{S as Pe}from"./scroll-area-Be30_uBA.js";import{I as be}from"./input-B2izTfq1.js";import{L as te}from"./label-D8BvHAzf.js";import{S as ce,a as oe,b as de,c as ue,d as me}from"./select-BL1xE19O.js";import{t as ve}from"./trading-BnsD0Zhr.js";import{C as ct,b as ot,a as dt}from"./collapsible-BJ9rSfA8.js";import{C as se,d as ae}from"./card-Bj7g2EjE.js";import{T as ut,a as mt,b as Ce,c as ne,d as xt,e as je}from"./table-BCVc3794.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DkDlinVE.js";function pt(s,t,r,a,m,x={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:c,refreshInterval:f=3e4,pauseWhenHidden:y=!0}=x,{isVisible:S}=He(),[o,n]=l.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),d=l.useRef(null),E=l.useRef(null),p=c&&(!y||S),I=l.useCallback(async()=>{if(!(!s||!t||!r||!a)&&!E.current){n(D=>({...D,isLoading:!0}));try{const D=new AbortController;E.current=D;const P=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:r,expiry_date:a,strike_count:m}),signal:D.signal});if(!P.ok)throw new Error(`HTTP error! status: ${P.status}`);const i=await P.json();i.status==="success"?n(k=>({...k,data:i,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):n(k=>({...k,isLoading:!1,error:i.message||"Failed to fetch option chain"}))}catch(D){D instanceof Error&&(D.name==="AbortError"?E.current===null&&n(P=>({...P,isLoading:!1})):n(P=>({...P,isLoading:!1,error:D.message||"Connection error",isConnected:!1})))}finally{E.current=null}}},[s,t,r,a,m]);l.useEffect(()=>{if(!p){d.current&&(clearInterval(d.current),d.current=null),n(D=>({...D,isPaused:!!c}));return}return n(D=>({...D,isConnected:!0,isPaused:!1})),I(),d.current=setInterval(I,f),()=>{d.current&&(clearInterval(d.current),d.current=null),E.current&&(E.current.abort(),E.current=null)}},[p,I,f,c]);const B=l.useCallback(()=>{I()},[I]);return{...o,refetch:B}}function re(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function ht(s,t,r,a,m,x,c={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:f,oiRefreshInterval:y=3e4,pauseWhenHidden:S=!0}=c,[o,n]=l.useState(null),[d,E]=l.useState(null),{data:p,isLoading:I,isConnected:B,isPaused:D,error:P,lastUpdate:i,refetch:k}=pt(s,t,r,m,x,{enabled:f,refreshInterval:y,pauseWhenHidden:S}),L=l.useMemo(()=>{const j=[],V=a==="BFO"?"BSE_INDEX":"NSE_INDEX";if(j.push({symbol:t,exchange:V}),p?.chain)for(const Q of p.chain)Q.ce?.symbol&&j.push({symbol:Q.ce.symbol,exchange:a}),Q.pe?.symbol&&j.push({symbol:Q.pe.symbol,exchange:a});return j},[p?.chain,a,t]),{data:M,isConnected:F,isAuthenticated:g,isPaused:b}=Be({symbols:L,mode:"Depth",enabled:f&&L.length>0,pauseWhenHidden:S}),z=l.useRef(0);l.useEffect(()=>{if(!p){n(null);return}if(M.size===0){n(p);return}const j=p.chain.map(w=>{const G={...w};if(w.ce?.symbol){const h=`${a}:${w.ce.symbol}`,N=M.get(h);if(N?.data){const W=N.data.depth?.buy?.[0],U=N.data.depth?.sell?.[0],u=w.ce.tick_size;G.ce={...w.ce,ltp:re(N.data.ltp,u)??w.ce.ltp,bid:re(W?.price??N.data.bid_price,u)??w.ce.bid,ask:re(U?.price??N.data.ask_price,u)??w.ce.ask,bid_qty:W?.quantity??N.data.bid_size??w.ce.bid_qty??0,ask_qty:U?.quantity??N.data.ask_size??w.ce.ask_qty??0}}}if(w.pe?.symbol){const h=`${a}:${w.pe.symbol}`,N=M.get(h);if(N?.data){const W=N.data.depth?.buy?.[0],U=N.data.depth?.sell?.[0],u=w.pe.tick_size;G.pe={...w.pe,ltp:re(N.data.ltp,u)??w.pe.ltp,bid:re(W?.price??N.data.bid_price,u)??w.pe.bid,ask:re(U?.price??N.data.ask_price,u)??w.pe.ask,bid_qty:W?.quantity??N.data.bid_size??w.pe.bid_qty??0,ask_qty:U?.quantity??N.data.ask_size??w.pe.ask_qty??0}}}return G});let V=!1;for(const[,w]of M)if(w.lastUpdate&&w.lastUpdate>z.current){V=!0,z.current=w.lastUpdate;break}V&&E(new Date);const v=`${a==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${t}`,_=M.get(v)?.data?.ltp??p.underlying_ltp;n({...p,underlying_ltp:_,chain:j})},[p,M,a,t]);const Z=F&&g&&L.length>0,$=D||b,K=l.useMemo(()=>!i&&!d?null:i?d&&d>i?d:i:d,[i,d]);return{data:o,isLoading:I,isConnected:B,isStreaming:Z,isPaused:$,error:P,lastUpdate:K,streamingSymbols:L.length,refetch:k}}const Y=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],ft=Y.map(s=>s.key),gt=Y.filter(s=>s.defaultVisible).map(s=>s.key),J={visibleColumns:gt,columnOrder:ft,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Ye="openalgo_option_chain_prefs";function bt(){if(typeof window>"u")return J;try{const s=localStorage.getItem(Ye);if(!s)return J;const t=JSON.parse(s),r=new Set(Y.map(c=>c.key)),a=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(c=>r.has(c)):J.visibleColumns;a.includes("strike")||a.push("strike");const m=Array.isArray(t.columnOrder)?t.columnOrder.filter(c=>r.has(c)):J.columnOrder,x=new Set(m);return J.columnOrder.forEach(c=>{x.has(c)||m.push(c)}),{visibleColumns:a,columnOrder:m,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:J.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:J.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:J.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:J.barStyle}}catch{return J}}function jt(s){if(!(typeof window>"u"))try{localStorage.setItem(Ye,JSON.stringify(s))}catch{}}function yt(){const[s,t]=l.useState(()=>bt());l.useEffect(()=>{jt(s)},[s]);const r=l.useCallback(n=>{n!=="strike"&&t(d=>{const p=d.visibleColumns.includes(n)?d.visibleColumns.filter(I=>I!==n):[...d.visibleColumns,n];return{...d,visibleColumns:p}})},[]),a=l.useCallback(n=>{t(d=>({...d,columnOrder:n}))},[]),m=l.useCallback(n=>{t(d=>({...d,strikeCount:n}))},[]),x=l.useCallback(n=>{t(d=>({...d,selectedUnderlying:n}))},[]),c=l.useCallback(n=>{t(d=>({...d,barDataSource:n}))},[]),f=l.useCallback(n=>{t(d=>({...d,barStyle:n}))},[]),y=l.useCallback(()=>{t(J)},[]),S=l.useCallback(n=>s.visibleColumns.includes(n),[s.visibleColumns]),o=l.useCallback(()=>s.columnOrder.filter(n=>s.visibleColumns.includes(n)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:r,reorderColumns:a,setStrikeCount:m,setSelectedUnderlying:x,setBarDataSource:c,setBarStyle:f,resetToDefaults:y,isColumnVisible:S,getOrderedVisibleColumns:o}}const Nt={getOptionChain:async(s,t,r,a,m)=>(await De.post("/optionchain",{apikey:s,underlying:t,exchange:r,expiry_date:a,strike_count:m??20})).data,getExpiries:async(s,t,r,a="options")=>(await De.post("/expiry",{apikey:s,symbol:t,exchange:r,instrumenttype:a})).data};function vt({barDataSource:s,barStyle:t,onBarDataSourceChange:r,onBarStyleChange:a}){return e.jsxs(Ie,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Fe,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"Bar Data"}),e.jsxs(ke,{value:s,onValueChange:m=>r(m),children:[e.jsx(pe,{value:"oi",children:"Open Interest"}),e.jsx(pe,{value:"volume",children:"Volume"})]}),e.jsx(Ne,{}),e.jsx(ge,{children:"Bar Style"}),e.jsxs(ke,{value:t,onValueChange:m=>a(m),children:[e.jsx(pe,{value:"gradient",children:"Gradient"}),e.jsx(pe,{value:"solid",children:"Solid"})]})]})]})}function Ct({visibleColumns:s,onToggleColumn:t,onResetToDefaults:r}){const a=Y.filter(c=>c.side==="ce"),m=Y.filter(c=>c.side==="pe"),x=c=>s.includes(c);return e.jsxs(Ie,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Fe,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"CALLS Columns"}),a.map(c=>e.jsx(_e,{checked:x(c.key),onCheckedChange:()=>t(c.key),children:c.label},c.key)),e.jsx(Ne,{}),e.jsx(ge,{children:"PUTS Columns"}),m.map(c=>e.jsx(_e,{checked:x(c.key),onCheckedChange:()=>t(c.key),children:c.label},c.key)),e.jsx(Ne,{}),e.jsxs(A,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:r,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Le({columnKey:s,label:t,side:r,isVisible:a,isDragging:m,onDragStart:x,onDragOver:c,onDrop:f,onDragEnd:y}){return e.jsxs("div",{draggable:!0,onDragStart:S=>x(S,s),onDragOver:c,onDrop:S=>f(S,s),onDragEnd:y,className:C("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",m&&"opacity-50 border-dashed",a?"bg-card":"bg-muted/50 opacity-60",r==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(tt,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:C("text-xs px-1.5 py-0.5 rounded",r==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:r==="ce"?"CE":"PE"})]})}function St({columnOrder:s,visibleColumns:t,onReorderColumns:r}){const[a,m]=l.useState(s),[x,c]=l.useState(null),[f,y]=l.useState(!1),S=a.filter(i=>Y.find(L=>L.key===i)?.side==="ce"),o=a.filter(i=>Y.find(L=>L.key===i)?.side==="pe"),n=i=>Y.find(L=>L.key===i)?.label??i,d=i=>Y.find(L=>L.key===i)?.side==="pe"?"pe":"ce",E=(i,k)=>{c(k),i.dataTransfer.effectAllowed="move",i.dataTransfer.setData("text/plain",k)},p=i=>{i.preventDefault(),i.dataTransfer.dropEffect="move"},I=(i,k)=>{if(i.preventDefault(),!x||x===k)return;const L=d(x),M=d(k);if(L!==M)return;const F=[...a],g=F.indexOf(x),b=F.indexOf(k);F.splice(g,1),F.splice(b,0,x),m(F)},B=()=>{c(null)},D=()=>{r(a),y(!1)},P=i=>{y(i),i&&m(s)};return e.jsxs(Ue,{open:f,onOpenChange:P,children:[e.jsx(rt,{asChild:!0,children:e.jsxs(A,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Ve,{className:"sm:max-w-md",children:[e.jsxs(qe,{children:[e.jsx(Ae,{children:"Reorder Columns"}),e.jsx(lt,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Pe,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:S.map(i=>e.jsx(Le,{columnKey:i,label:n(i),side:"ce",isVisible:t.includes(i),isDragging:x===i,onDragStart:E,onDragOver:p,onDrop:I,onDragEnd:B},i))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Pe,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:o.map(i=>e.jsx(Le,{columnKey:i,label:n(i),side:"pe",isVisible:t.includes(i),isDragging:x===i,onDragStart:E,onDragOver:p,onDrop:I,onDragEnd:B},i))})})]})]}),e.jsxs(ze,{className:"gap-2 sm:gap-0",children:[e.jsx(it,{asChild:!0,children:e.jsx(A,{variant:"outline",children:"Cancel"})}),e.jsx(A,{onClick:D,children:"Save Order"})]})]})]})}function wt(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function Dt({exchange:s,ltp:t,prevClose:r,change:a,changePercent:m,bidPrice:x,askPrice:c,bidSize:f,askSize:y,isLoading:S}){const o=a??(t&&r?t-r:void 0),n=m??(o&&r?o/r*100:void 0),d=o!==void 0&&o>=0;return S?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Re,{className:C("text-[10px] px-1.5 py-0",wt(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),o!==void 0&&e.jsxs("span",{className:C("text-sm font-medium",d?"text-green-500":"text-red-500"),children:[d?"+":"",o.toFixed(2),n!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",d?"+":"",n.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:x!==void 0&&x>0?x.toFixed(2):"-"}),f!==void 0&&f>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",f.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:c!==void 0&&c>0?c.toFixed(2):"-"}),y!==void 0&&y>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",y.toLocaleString()]})]})]})]})}function Oe({price:s,quantity:t,maxQty:r,side:a}){const m=r>0?Math.min(t/r*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:C("absolute top-0 bottom-0 transition-all duration-300",a==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${m}%`}})}),e.jsx("span",{className:C("relative z-10 flex-1 font-mono text-xs",a==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function kt({depth:s,isExpanded:t,onToggle:r,maxLevels:a=5}){const m=s?.buy?.slice(0,a)??[],x=s?.sell?.slice(0,a)??[],c=Math.max(...m.map(o=>o.quantity),1),f=Math.max(...x.map(o=>o.quantity),1),y=Math.max(c,f),S=m.length>0||x.length>0;return e.jsxs(ct,{open:t,onOpenChange:r,children:[e.jsxs(ot,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(dt,{children:S?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:m.length>0?m.map((o,n)=>e.jsx(Oe,{price:o.price,quantity:o.quantity,maxQty:y,side:"buy"},`buy-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:x.length>0?x.map((o,n)=>e.jsx(Oe,{price:o.price,quantity:o.quantity,maxQty:y,side:"sell"},`sell-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:m.reduce((o,n)=>o+n.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:x.reduce((o,n)=>o+n.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}function _t(s,t,r={}){const{enabled:a=!0,mode:m="Depth",useQuotesFallback:x=!0,useDepthFallback:c=!0,staleThreshold:f=5e3,refreshInterval:y=3e4,pauseWhenHidden:S=!0}=r,{apiKey:o}=Se(),{isMarketOpen:n}=Ke(),[d,E]=l.useState(null),[p,I]=l.useState(null),[B,D]=l.useState(!1),P=l.useRef(0),i=!!s&&!!t,k=l.useMemo(()=>i?[{symbol:s,exchange:t}]:[],[s,t,i]),{data:L,isConnected:M,isPaused:F,isFallbackMode:g}=Be({symbols:k,mode:m,enabled:a&&i,pauseWhenHidden:S}),b=L.get(`${t}:${s}`)?.data,z=L.get(`${t}:${s}`)?.lastUpdate,Z=n(t),$=!!(M&&b&&z&&Date.now()-z<f),K=$&&Z&&!F,j=l.useCallback(async()=>{if(!(!o||!i)){D(!0);try{const h=[];x&&h.push(ve.getQuotes(o,s,t).then(N=>{N.status==="success"&&N.data&&E(N.data)}).catch(()=>{console.debug("REST quotes fetch failed")})),c&&m==="Depth"&&h.push(ve.getDepth(o,s,t).then(N=>{N.status==="success"&&N.data&&I(N.data)}).catch(()=>{console.debug("REST depth fetch failed")})),await Promise.all(h),P.current=Date.now()}finally{D(!1)}}},[o,s,t,i,x,c,m]),V=l.useRef(a),Q=l.useRef(i),v=l.useRef(j);l.useEffect(()=>{V.current=a,Q.current=i,v.current=j},[a,i,j]),l.useEffect(()=>{if(!a||!i)return;v.current();const h=setInterval(()=>{V.current&&Q.current&&v.current()},y);return()=>clearInterval(h)},[a,i,s,t,y]),l.useEffect(()=>{E(null),I(null)},[s,t]);const R=l.useMemo(()=>{if(p)return{buy:p.bids.map(h=>({price:h.price,quantity:h.quantity})),sell:p.asks.map(h=>({price:h.price,quantity:h.quantity}))}},[p]),_=l.useMemo(()=>{const h=b?.depth??R,N=b?.depth?.buy?.[0]?.price??R?.buy?.[0]?.price??b?.bid_price??d?.bid,W=b?.depth?.sell?.[0]?.price??R?.sell?.[0]?.price??b?.ask_price??d?.ask,U=b?.depth?.buy?.[0]?.quantity??R?.buy?.[0]?.quantity??b?.bid_size,u=b?.depth?.sell?.[0]?.quantity??R?.sell?.[0]?.quantity??b?.ask_size;return{ltp:b?.ltp??p?.ltp??d?.ltp,open:b?.open??p?.open??d?.open,high:b?.high??p?.high??d?.high,low:b?.low??p?.low??d?.low,close:b?.close??p?.prev_close??d?.prev_close,volume:b?.volume??p?.volume??d?.volume,oi:p?.oi??d?.oi,change:b?.change,changePercent:b?.change_percent,bidPrice:N,askPrice:W,bidSize:U,askSize:u,depth:h}},[b,d,p,R]),w=l.useMemo(()=>{if(_.change!==void 0)return _;const h=_.ltp&&_.close?_.ltp-_.close:void 0,N=h&&_.close?h/_.close*100:void 0;return{..._,change:h,changePercent:N}},[_]),G=l.useMemo(()=>$?"websocket":d||p?"rest":"none",[$,d,p]);return{data:w,isLive:K,isConnected:M,isLoading:B&&!d&&!p,isPaused:F,isFallbackMode:g,dataSource:G,refresh:j}}const Et=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Pt=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Lt=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function fe(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function he(s,t,r){const a=fe(s,t);return r==="up"?Number((a+t).toFixed(2)):Math.max(0,Number((a-t).toFixed(2)))}function Te(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function Ot({open:s,onOpenChange:t,symbol:r="",exchange:a="",action:m="BUY",quantity:x,lotSize:c=1,tickSize:f=.05,product:y="NRML",priceType:S="MARKET",strategy:o="OptionChain",onSuccess:n,onError:d}){const{apiKey:E}=Se(),[p,I]=l.useState(m),[B,D]=l.useState(x??c),[P,i]=l.useState(S),[k,L]=l.useState(y),[M,F]=l.useState(0),[g,b]=l.useState(0),[z,Z]=l.useState(!1),[$,K]=l.useState(!1),[j,V]=l.useState("lots"),[Q,v]=l.useState(1),R=Te(a)?Pt:Lt,{data:_,isLoading:w,isConnected:G}=_t(r,a,{enabled:s&&!!r&&!!a,mode:"Depth",useQuotesFallback:!0,useDepthFallback:!0});l.useEffect(()=>{if(s){I(m),D(x??c),i(S);const O=Te(a),X=O?"NRML":"CNC",xe=y&&(O?["NRML","MIS"]:["CNC","MIS"]).includes(y)?y:X;L(xe),F(0),b(0),K(!1),V("lots"),v(1)}},[s,m,x,c,S,y,a]);const h={ltp:_.ltp,close:_.close,change:_.change,change_percent:_.changePercent,bidPrice:_.bidPrice,askPrice:_.askPrice,bidSize:_.bidSize,askSize:_.askSize,depth:_.depth},N=h.change,W=h.change_percent;l.useEffect(()=>{P!=="MARKET"&&h.ltp&&M===0&&F(fe(h.ltp,f))},[P,h.ltp,M,f]);const U=P==="LIMIT"||P==="SL",u=P==="SL-M"||P==="SL",T=l.useCallback(()=>!(!r||!a||!E||B<=0||U&&M<=0||u&&g<=0),[r,a,E,B,U,M,u,g]),q=async()=>{if(!T()){le.error("Please fill all required fields");return}if(!E){le.error("API key not found. Please set up your API key."),d?.("API key not found");return}Z(!0);try{const X={apikey:E,strategy:o,exchange:a,symbol:r,action:p,quantity:B,pricetype:P,product:k,...U&&{price:M},...u&&{trigger_price:g}},H=await ve.placeOrder(X),xe=H.orderid;if(H.status==="success"&&xe)n?.(xe),t(!1);else{const we=H.message||"Order placement failed";le.error(we,"orders"),d?.(we)}}catch(O){let X="Order placement failed";if(O&&typeof O=="object"){const H=O;H.response?.data?.message?X=H.response.data.message:H.message&&(X=H.message)}le.error(X,"orders"),d?.(X)}finally{Z(!1)}},$e=O=>{const X=parseInt(O)||0;if(j==="lots")D(X*c),v(X);else{const H=Math.max(c,Math.round(X/c)*c);D(H),v(H/c)}},Qe=j==="lots"?Q:B,We=w&&!h.ltp&&!G;return e.jsx(Ue,{open:s,onOpenChange:t,children:e.jsxs(Ve,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(qe,{children:e.jsxs(Ae,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:p==="BUY"?"text-green-500":"text-red-500",children:p}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:r})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(Dt,{exchange:a,ltp:h.ltp,prevClose:h.close,change:N,changePercent:W,bidPrice:h.bidPrice,askPrice:h.askPrice,bidSize:h.bidSize,askSize:h.askSize,isLoading:We}),e.jsx(kt,{depth:h.depth,isExpanded:$,onToggle:()=>K(!$),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"button",variant:p==="BUY"?"default":"outline",className:C("flex-1",p==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>I("BUY"),children:"BUY"}),e.jsx(A,{type:"button",variant:p==="SELL"?"default":"outline",className:C("flex-1",p==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>I("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>V("lots"),className:C("px-2 py-0.5 text-[10px] rounded",j==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>V("shares"),className:C("px-2 py-0.5 text-[10px] rounded",j==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(be,{type:"number",value:Qe,onChange:O=>$e(O.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",c]}),e.jsxs("span",{children:["Total qty: ",B]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price Type"}),e.jsxs(ce,{value:P,onValueChange:O=>i(O),children:[e.jsx(oe,{children:e.jsx(de,{})}),e.jsx(ue,{children:Et.map(O=>e.jsx(me,{value:O.value,children:O.label},O.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Product"}),e.jsxs(ce,{value:k,onValueChange:O=>L(O),children:[e.jsx(oe,{children:e.jsx(de,{})}),e.jsx(ue,{children:R.map(O=>e.jsx(me,{value:O.value,children:O.label},O.value))})]})]})]}),U&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>F(he(M,f,"down")),children:"-"}),e.jsx(be,{type:"number",value:M,onChange:O=>F(parseFloat(O.target.value)||0),onBlur:()=>F(fe(M,f)),className:"flex-1 text-center",step:f,min:0}),e.jsx(A,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>F(he(M,f,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",f]})]}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>b(he(g,f,"down")),children:"-"}),e.jsx(be,{type:"number",value:g,onChange:O=>b(parseFloat(O.target.value)||0),onBlur:()=>b(fe(g,f)),className:"flex-1 text-center",step:f,min:0}),e.jsx(A,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>b(he(g,f,"up")),children:"+"})]})]})]}),e.jsxs(ze,{className:"gap-2 sm:gap-0",children:[e.jsx(A,{variant:"outline",onClick:()=>t(!1),disabled:z,children:"Cancel"}),e.jsx(A,{onClick:q,disabled:!T()||z,className:C(p==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:z?"Placing...":`Place ${p} Order`})]})]})})}const ye=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],Tt=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function ie(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const r=s/1e3;return r>=1?r.toFixed(1)+"K":s.toLocaleString()}}function ee(s){return s==null?"0.00":s.toFixed(2)}function It(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function Mt(s){let t=0,r=0;return s.forEach(a=>{a.ce?.oi&&(t+=a.ce.oi),a.pe?.oi&&(r+=a.pe?.oi??0)}),t===0?0:r/t}function Ft(s){let t=0,r=0,a=0,m=0;return s.forEach(x=>{x.ce&&(t+=x.ce.volume??0,a+=x.ce.oi??0),x.pe&&(r+=x.pe.volume??0,m+=x.pe.oi??0)}),{ceVolume:t,peVolume:r,ceOi:a,peOi:m}}function Rt(s,t){let r=0;return s.forEach(a=>{const m=t==="oi"?a.ce?.oi:a.ce?.volume,x=t==="oi"?a.pe?.oi:a.pe?.volume;m&&m>r&&(r=m),x&&x>r&&(r=x)}),r||1}const Bt=Xe.memo(function({strike:t,previousStrike:r,maxBarValue:a,visibleCeColumns:m,visiblePeColumns:x,barDataSource:c,barStyle:f,optionExchange:y,onPlaceOrder:S}){const o=t.ce,n=t.pe,d=o?.label??n?.label??"",E=d==="ATM",p=d.startsWith("OTM"),I=d.startsWith("ITM"),B=r?.ce?.ltp!==void 0&&r.ce.ltp!==o?.ltp,D=r?.pe?.ltp!==void 0&&r.pe.ltp!==n?.ltp,P=B?o&&r?.ce&&o.ltp>r.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",i=D?n&&r?.pe&&n.ltp>r.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",k=o&&o.bid>0&&o.ask>0?o.ask-o.bid:0,L=n&&n.bid>0&&n.ask>0?n.ask-n.bid:0,M=k<=1?"text-green-500":k<=2?"text-yellow-500":"text-red-500",F=L<=1?"text-green-500":L<=2?"text-yellow-500":"text-red-500",g=c==="oi"?o?.oi:o?.volume,b=c==="oi"?n?.oi:n?.volume,z=g?Math.min(g/a*100,100):0,Z=b?Math.min(b/a*100,100):0,$=f==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",K=f==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",j="font-mono tabular-nums text-xs",V=v=>{switch(v){case"ce_oi":return e.jsx("span",{className:j,children:ie(o?.oi)});case"ce_volume":return e.jsx("span",{className:j,children:ie(o?.volume)});case"ce_bid_qty":return e.jsx("span",{className:j,children:o?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:C(j,"text-red-500"),children:ee(o?.bid)});case"ce_ltp":return e.jsx("span",{className:C(j,"font-semibold",P),children:ee(o?.ltp)});case"ce_ask":return e.jsx("span",{className:C(j,"text-green-500"),children:ee(o?.ask)});case"ce_ask_qty":return e.jsx("span",{className:j,children:o?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:C(j,M),children:ee(k)});default:return null}},Q=v=>{switch(v){case"pe_oi":return e.jsx("span",{className:j,children:ie(n?.oi)});case"pe_volume":return e.jsx("span",{className:j,children:ie(n?.volume)});case"pe_bid_qty":return e.jsx("span",{className:j,children:n?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:C(j,"text-red-500"),children:ee(n?.bid)});case"pe_ltp":return e.jsx("span",{className:C(j,"font-semibold",i),children:ee(n?.ltp)});case"pe_ask":return e.jsx("span",{className:C(j,"text-green-500"),children:ee(n?.ask)});case"pe_ask_qty":return e.jsx("span",{className:j,children:n?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:C(j,F),children:ee(L)});default:return null}};return e.jsxs(Ce,{className:C("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":d,children:[m.length>0&&e.jsxs(je,{className:C("p-0 relative",p&&!E&&"bg-amber-500/5"),children:[e.jsx("div",{className:C("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",$),style:{width:`${z}%`}}),o&&e.jsxs("div",{className:C("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:o.symbol,exchange:y,action:"BUY",lotSize:o.lotsize??1,tickSize:o.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:o.symbol,exchange:y,action:"SELL",lotSize:o.lotsize??1,tickSize:o.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:m.map(v=>{const R=Y.find(_=>_.key===v);return e.jsx("div",{className:C("flex-1 px-2 py-1.5 min-w-0",R?.align==="right"&&"text-right",R?.align==="center"&&"text-center",R?.align==="left"&&"text-left"),children:V(v)},v)})})]}),e.jsx(je,{className:C("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",E?"bg-primary/15":"bg-muted/30"),children:t.strike}),x.length>0&&e.jsxs(je,{className:C("p-0 relative",I&&!E&&"bg-amber-500/5"),children:[e.jsx("div",{className:C("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",K),style:{width:`${Z}%`}}),n&&e.jsxs("div",{className:C("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:n.symbol,exchange:y,action:"BUY",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:n.symbol,exchange:y,action:"SELL",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:x.map(v=>{const R=Y.find(_=>_.key===v);return e.jsx("div",{className:C("flex-1 px-2 py-1.5 min-w-0",R?.align==="right"&&"text-right",R?.align==="center"&&"text-center",R?.align==="left"&&"text-left"),children:Q(v)},v)})})]})]})});function ts(){const{apiKey:s}=Se(),{visibleColumns:t,columnOrder:r,strikeCount:a,selectedUnderlying:m,barDataSource:x,barStyle:c,toggleColumn:f,reorderColumns:y,setStrikeCount:S,setSelectedUnderlying:o,setBarDataSource:n,setBarStyle:d,resetToDefaults:E}=yt(),[p,I]=l.useState(""),[B,D]=l.useState([]),P=l.useRef(new Map),[i,k]=l.useState(null),L=ye.find(u=>u.value===m),M=L?.brokerExchange??"NSE_INDEX",F=L?.exchange??"NFO",{data:g,isConnected:b,isStreaming:z,isPaused:Z,error:$,lastUpdate:K,refetch:j,isLoading:V,streamingSymbols:Q}=ht(s,m,M,F,It(p),a,{enabled:!!p,oiRefreshInterval:3e4,pauseWhenHidden:!0});l.useEffect(()=>{(async()=>{if(!(!s||!m))try{const T=await Nt.getExpiries(s,m,F);T.status==="success"&&T.data.length>0?(D(T.data),I(q=>q||T.data[0])):le.error(T.message||"Failed to load expiries")}catch(T){console.error("Error loading expiries:",T),le.error("Failed to load expiry dates")}})()},[s,m,F]),l.useEffect(()=>{if(g?.chain){const u=setTimeout(()=>{const T=new Map;g.chain.forEach(q=>{T.set(q.strike,q)}),P.current=T},100);return()=>clearTimeout(u)}},[g?.chain]);const v=u=>{ye.find(q=>q.value===u)&&(o(u),I(""),D([]))},R=()=>{j()},_=l.useCallback(u=>{k({open:!0,symbol:u.symbol,exchange:u.exchange,action:u.action,quantity:u.lotSize,lotSize:u.lotSize,tickSize:u.tickSize})},[]),w=l.useCallback(u=>{u||k(null)},[]),G=l.useMemo(()=>g?.chain?Mt(g.chain):0,[g?.chain]),h=l.useMemo(()=>g?.chain?Ft(g.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[g?.chain]),N=l.useMemo(()=>g?.chain?Rt(g.chain,x):1,[g?.chain,x]),W=l.useMemo(()=>r.filter(u=>Y.find(q=>q.key===u)?.side==="ce"&&t.includes(u)),[r,t]),U=l.useMemo(()=>r.filter(u=>Y.find(q=>q.key===u)?.side==="pe"&&t.includes(u)),[r,t]);return $?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(se,{className:"max-w-md",children:e.jsx(ae,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:$}),e.jsxs(A,{onClick:R,className:"mt-4",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ce,{value:m,onValueChange:v,children:[e.jsx(oe,{className:"w-36",children:e.jsx(de,{placeholder:"Select Underlying"})}),e.jsx(ue,{children:ye.map(u=>e.jsx(me,{value:u.value,children:u.label},u.value))})]}),e.jsxs(ce,{value:p,onValueChange:I,disabled:B.length===0,children:[e.jsx(oe,{className:"w-36",children:e.jsx(de,{placeholder:"Select Expiry"})}),e.jsx(ue,{children:B.map(u=>e.jsx(me,{value:u,children:u},u))})]}),e.jsxs(ce,{value:String(a),onValueChange:u=>S(Number(u)),children:[e.jsx(oe,{className:"w-36",children:e.jsx(de,{placeholder:"Strike Count"})}),e.jsx(ue,{children:Tt.map(u=>e.jsx(me,{value:String(u.value),children:u.label},u.value))})]}),e.jsx(vt,{barDataSource:x,barStyle:c,onBarDataSourceChange:n,onBarStyleChange:d}),e.jsx(Ct,{visibleColumns:t,onToggleColumn:f,onResetToDefaults:E}),e.jsx(St,{columnOrder:r,visibleColumns:t,onReorderColumns:y}),e.jsxs(A,{onClick:R,disabled:!p||V,children:[e.jsx(Ee,{className:`h-4 w-4 mr-2 ${V?"animate-spin":""}`}),"Refresh"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[m," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:ee(g.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",ee(g.underlying_prev_close)]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:g.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",g.expiry_date]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${G>1?"text-green-500":"text-yellow-500"}`,children:G.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:ie(h.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:ie(h.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:h.ceOi+h.peOi>0?`${h.ceOi/(h.ceOi+h.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",G.toFixed(2)]})})]})})]}),e.jsx(se,{children:e.jsx(ae,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ut,{className:"w-full table-fixed",children:[e.jsxs(mt,{children:[e.jsxs(Ce,{className:"bg-muted/30 border-b-0",children:[W.length>0&&e.jsx(ne,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(ne,{className:"text-center w-20 min-w-20"}),U.length>0&&e.jsx(ne,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Ce,{className:"bg-muted/50",children:[W.length>0&&e.jsx(ne,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:W.map(u=>{const T=Y.find(q=>q.key===u);return e.jsx("div",{className:C("flex-1 px-2 py-2 text-xs font-medium min-w-0",T?.align==="right"&&"text-right",T?.align==="center"&&"text-center",T?.align==="left"&&"text-left"),children:T?.label},u)})})}),e.jsx(ne,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),U.length>0&&e.jsx(ne,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:U.map(u=>{const T=Y.find(q=>q.key===u);return e.jsx("div",{className:C("flex-1 px-2 py-2 text-xs font-medium min-w-0",T?.align==="right"&&"text-right",T?.align==="center"&&"text-center",T?.align==="left"&&"text-left"),children:T?.label},u)})})})]})]}),e.jsx(xt,{children:g.chain.map(u=>e.jsx(Bt,{strike:u,previousStrike:P.current.get(u.strike),maxBarValue:N,visibleCeColumns:W,visiblePeColumns:U,barDataSource:x,barStyle:c,optionExchange:F,onPlaceOrder:_},u.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[z?e.jsx(at,{className:"h-4 w-4 text-green-500"}):e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Re,{variant:z?"default":b?"secondary":"destructive",children:Z?"Paused":z?`Streaming ${Q} symbols`:b?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",x==="oi"?"OI":"Volume"," (",c,")"]})]}),e.jsxs("div",{children:["Last Update: ",K?K.toLocaleTimeString():"-"]})]})]}),!g&&!$&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Ot,{open:i?.open??!1,onOpenChange:w,symbol:i?.symbol,exchange:i?.exchange,action:i?.action,quantity:i?.quantity,lotSize:i?.lotSize,tickSize:i?.tickSize,strategy:"OptionChain"})]})}export{ts as default};
