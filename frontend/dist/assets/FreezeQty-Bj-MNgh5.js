import{r as a,j as e}from"./vendor-react-CCyQGCED.js";import{s as l,B as n}from"./index-NHrG-O_Z.js";import{a as h}from"./admin-U6yPFyvv.js";import{A as he,b as xe,c as me,d as ue,e as ge,f as fe,g as je,h as pe}from"./alert-dialog-DP5Vbj8e.js";import{C as p,d as y,a as ye,b as Ne,c as Ce}from"./card-Cn20bp_v.js";import{D as _,b as Q,c as H,d as P,e as B,f as R}from"./dialog-DA9GnjaJ.js";import{I as x}from"./input-BylzFlgY.js";import{L as m}from"./label-_1WWiomg.js";import{S as Y,a as M,b as X,c as Z,d as G}from"./select-DcHsBqkV.js";import{T as Se,a as be,b as z,c as N,d as ve,e as u}from"./table-Crau903Y.js";import{N as Fe,bi as we,aO as ze,aI as De,S as Ee,ar as Ae,X as Te,a6 as qe,an as Le}from"./vendor-icons-CCn_k3dF.js";import{L as Oe}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const $=["NFO","BFO","CDS","MCX"];function Ge(){const[i,J]=a.useState([]),[C,S]=a.useState([]),[K,W]=a.useState(!0),[c,ee]=a.useState(""),[se,g]=a.useState(!1),[r,f]=a.useState({exchange:"NFO",symbol:"",freeze_qty:""}),[D,E]=a.useState(!1),[A,b]=a.useState(null),[v,T]=a.useState(""),[ae,q]=a.useState(!1),[d,F]=a.useState(null),[L,O]=a.useState(!1),[te,j]=a.useState(!1),[V,le]=a.useState("NFO"),[w,I]=a.useState(null),[k,U]=a.useState(!1);a.useEffect(()=>{o()},[]),a.useEffect(()=>{if(c){const s=i.filter(t=>t.symbol.toLowerCase().includes(c.toLowerCase())||t.exchange.toLowerCase().includes(c.toLowerCase()));S(s)}else S(i)},[c,i]);const o=async()=>{try{const s=await h.getFreezeList();J(s),S(s)}catch{l.error("Failed to load freeze quantities","admin")}finally{W(!1)}},re=async()=>{if(!r.symbol||!r.freeze_qty){l.error("Please fill in all fields","admin");return}E(!0);try{const s=await h.addFreeze({exchange:r.exchange,symbol:r.symbol.toUpperCase(),freeze_qty:parseInt(r.freeze_qty,10)});s.status==="success"?(l.success(s.message||"Entry added successfully","admin"),g(!1),f({exchange:"NFO",symbol:"",freeze_qty:""}),o()):l.error(s.message||"Failed to add entry","admin")}catch(s){const t=s;l.error(t.response?.data?.message||"Failed to add entry","admin")}finally{E(!1)}},ne=s=>{b(s.id),T(s.freeze_qty.toString())},ie=async s=>{if(!v){l.error("Please enter a freeze quantity","admin");return}q(!0);try{const t=await h.editFreeze(s,{freeze_qty:parseInt(v,10)});t.status==="success"?(l.success(t.message||"Entry updated successfully","admin"),b(null),o()):l.error(t.message||"Failed to update entry","admin")}catch(t){const oe=t;l.error(oe.response?.data?.message||"Failed to update entry","admin")}finally{q(!1)}},ce=async()=>{if(d){O(!0);try{const s=await h.deleteFreeze(d.id);s.status==="success"?(l.success(s.message||"Entry deleted successfully","admin"),F(null),o()):l.error(s.message||"Failed to delete entry","admin")}catch(s){const t=s;l.error(t.response?.data?.message||"Failed to delete entry","admin")}finally{O(!1)}}},de=async()=>{if(!w){l.error("Please select a CSV file","admin");return}U(!0);try{const s=await h.uploadFreezeCSV(w,V);s.status==="success"?(l.success(s.message||"CSV uploaded successfully","admin"),j(!1),I(null),o()):l.error(s.message||"Failed to upload CSV","admin")}catch(s){const t=s;l.error(t.response?.data?.message||"Failed to upload CSV","admin")}finally{U(!1)}};return K?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{to:"/admin",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(we,{className:"h-6 w-6"}),"Freeze Quantities"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage F&O freeze quantity limits for automatic order splitting"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>j(!0),children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Upload CSV"]}),e.jsxs(n,{onClick:()=>g(!0),children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Add Entry"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(p,{children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:i.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Symbols"})]})}),e.jsx(p,{children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:i.filter(s=>s.exchange==="NFO").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"NFO Symbols"})]})}),e.jsx(p,{children:e.jsxs(y,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:i.filter(s=>s.exchange!=="NFO").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Other Exchanges"})]})})]}),e.jsxs(p,{children:[e.jsxs(ye,{children:[e.jsx(Ne,{children:"Freeze Quantity List"}),e.jsxs(Ce,{children:[C.length," entries total"]})]}),e.jsxs(y,{children:[e.jsx("div",{className:"flex items-center gap-2 mb-4",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{placeholder:"Search by symbol or exchange...",value:c,onChange:s=>ee(s.target.value),className:"pl-9"})]})}),e.jsx("div",{className:"border rounded-md",children:e.jsxs(Se,{children:[e.jsx(be,{children:e.jsxs(z,{children:[e.jsx(N,{children:"Exchange"}),e.jsx(N,{children:"Symbol"}),e.jsx(N,{children:"Freeze Qty"}),e.jsx(N,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(ve,{children:C.length===0?e.jsx(z,{children:e.jsx(u,{colSpan:4,className:"text-center text-muted-foreground py-8",children:c?"No matching entries found":"No freeze quantities configured"})}):C.map(s=>e.jsxs(z,{children:[e.jsx(u,{className:"font-medium",children:s.exchange}),e.jsx(u,{children:s.symbol}),e.jsx(u,{children:A===s.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{type:"number",value:v,onChange:t=>T(t.target.value),className:"w-24 h-8",min:1,"aria-label":`Freeze quantity for ${s.symbol}`}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>ie(s.id),disabled:ae,children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>b(null),children:e.jsx(Te,{className:"h-4 w-4"})})]}):s.freeze_qty.toLocaleString()}),e.jsx(u,{children:A!==s.id&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>ne(s),children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>F(s),children:e.jsx(Le,{className:"h-4 w-4"})})]})})]},s.id))})]})})]})]}),e.jsx(_,{open:se,onOpenChange:g,children:e.jsxs(Q,{children:[e.jsxs(H,{children:[e.jsx(P,{children:"Add Freeze Quantity"}),e.jsx(B,{children:"Add a new freeze quantity entry for an F&O symbol."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Exchange"}),e.jsxs(Y,{value:r.exchange,onValueChange:s=>f({...r,exchange:s}),children:[e.jsx(M,{children:e.jsx(X,{})}),e.jsx(Z,{children:$.map(s=>e.jsx(G,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Symbol"}),e.jsx(x,{placeholder:"e.g., NIFTY, RELIANCE",value:r.symbol,onChange:s=>f({...r,symbol:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Freeze Quantity"}),e.jsx(x,{type:"number",placeholder:"e.g., 1800",value:r.freeze_qty,onChange:s=>f({...r,freeze_qty:s.target.value}),min:1})]})]}),e.jsxs(R,{children:[e.jsx(n,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(n,{onClick:re,disabled:D,children:D?"Adding...":"Add Entry"})]})]})}),e.jsx(_,{open:te,onOpenChange:j,children:e.jsxs(Q,{children:[e.jsxs(H,{children:[e.jsx(P,{children:"Upload Freeze Quantities CSV"}),e.jsx(B,{children:"Upload a CSV file to bulk update freeze quantities. This will replace existing entries for the selected exchange."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Exchange"}),e.jsxs(Y,{value:V,onValueChange:le,children:[e.jsx(M,{children:e.jsx(X,{})}),e.jsx(Z,{children:$.map(s=>e.jsx(G,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"CSV File"}),e.jsx(x,{type:"file",accept:".csv",onChange:s=>I(s.target.files?.[0]||null)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"CSV should have columns: SYMBOL, VOL_FRZ_QTY (or FRZ_QTY)"})]})]}),e.jsxs(R,{children:[e.jsx(n,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(n,{onClick:de,disabled:k||!w,children:k?"Uploading...":"Upload"})]})]})}),e.jsx(he,{open:!!d,onOpenChange:()=>F(null),children:e.jsxs(xe,{children:[e.jsxs(me,{children:[e.jsx(ue,{children:"Delete Entry?"}),e.jsxs(ge,{children:["Are you sure you want to delete the freeze quantity for ",d?.symbol," (",d?.exchange,")? This action cannot be undone."]})]}),e.jsxs(fe,{children:[e.jsx(je,{children:"Cancel"}),e.jsx(pe,{onClick:ce,disabled:L,children:L?"Deleting...":"Delete"})]})]})})]})}export{Ge as default};
