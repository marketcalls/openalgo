import{r as a,j as e}from"./vendor-react-CCyQGCED.js";import{B as l,e as $,s as t}from"./index-NHrG-O_Z.js";import{c as h}from"./chartink-BPDHJ2xG.js";import{C as K,a as U,b as q,c as G,d as z}from"./card-Cn20bp_v.js";import{P as xe,a as ue,b as ye,C as je,c as ge,d as pe,e as Se,f as be,g as fe}from"./popover-DQlNqO83.js";import{D as Ce,b as Ne,c as ve,d as ke,e as Te,f as Ee}from"./dialog-DA9GnjaJ.js";import{I as X}from"./input-BylzFlgY.js";import{L as c}from"./label-_1WWiomg.js";import{S as Y,a as J,b as W,c as Z,d as ee}from"./select-DcHsBqkV.js";import{S as I}from"./skeleton-BWYif6yq.js";import{T as we,a as De,b as se,c as o,d as Ie,e as i}from"./table-Crau903Y.js";import{T as Ae,a as Be,b as ae,c as te}from"./tabs-DnjOpX1p.js";import{T as Pe}from"./textarea-BXWfH68I.js";import{N as Le,Y as Me,aI as Re,aO as Fe,S as Oe,F as Ve,an as He}from"./vendor-icons-CCn_k3dF.js";import{d as Qe,L as _e}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const $e=["NSE","BSE"],Ke=["MIS","CNC"];function os(){const{strategyId:n}=Qe(),[S,re]=a.useState(null),[d,A]=a.useState([]),[le,B]=a.useState(!0),[x,u]=a.useState(!1),[b,f]=a.useState(""),[ne,P]=a.useState([]),[ce,L]=a.useState(!1),[M,R]=a.useState(!1),[F,O]=a.useState(null),[C,N]=a.useState(""),[m,v]=a.useState(""),[y,V]=a.useState("1"),[k,T]=a.useState(""),[j,E]=a.useState(""),[oe,g]=a.useState(!1),[w,H]=a.useState(null),p=async()=>{if(n)try{B(!0);const s=await h.getStrategy(Number(n));re(s.strategy),A(s.mappings||[])}catch{t.error("Failed to load strategy","chartink")}finally{B(!1)}};a.useEffect(()=>{p()},[]);const Q=a.useCallback(async s=>{if(s.length<2){P([]);return}try{L(!0);const r=m||void 0,D=await h.searchSymbols(s,r);P(D)}catch{}finally{L(!1)}},[m]);a.useEffect(()=>{const s=setTimeout(()=>{Q(b)},300);return()=>clearTimeout(s)},[b,Q]);const ie=s=>{O(s),f(s.symbol),N(s.symbol),(s.exchange==="NSE"||s.exchange==="BSE")&&v(s.exchange),R(!1),T("MIS")},de=async s=>{if(s.preventDefault(),!C){t.error("Please enter the Chartink symbol","chartink");return}if(!m){t.error("Please select an exchange (NSE or BSE only)","chartink");return}if(!y||Number(y)<1){t.error("Quantity must be at least 1","chartink");return}if(!k){t.error("Please select a product type (MIS or CNC)","chartink");return}try{u(!0);const r=await h.addSymbolMapping(Number(n),{symbol:C,exchange:m,quantity:Number(y),product_type:k});r.status==="success"?(t.success("Symbol added successfully","chartink"),O(null),f(""),N(""),v(""),V("1"),T(""),p()):t.error(r.message||"Failed to add symbol","chartink")}catch{t.error("Failed to add symbol","chartink")}finally{u(!1)}},me=async s=>{if(s.preventDefault(),!j.trim()){t.error("Please enter CSV data","chartink");return}try{u(!0);const r=await h.addBulkSymbols(Number(n),j);if(r.status==="success"){const{added:D=0,failed:_=0}=r.data||{};t.success(`Added ${D} symbols${_>0?`, ${_} failed`:""}`,"chartink"),E(""),p()}else t.error(r.message||"Failed to add symbols","chartink")}catch{t.error("Failed to add symbols","chartink")}finally{u(!1)}},he=async()=>{if(!(w===null||!n))try{const s=await h.deleteSymbolMapping(Number(n),w);s.status==="success"?(A(d.filter(r=>r.id!==w)),t.success("Symbol removed","chartink")):t.error(s.message||"Failed to remove symbol","chartink")}catch{t.error("Failed to remove symbol","chartink")}finally{g(!1),H(null)}};return le?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(I,{className:"h-8 w-32"}),e.jsx(I,{className:"h-64"}),e.jsx(I,{className:"h-48"})]}):S?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(l,{variant:"ghost",asChild:!0,children:e.jsxs(_e,{to:`/chartink/${n}`,children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Back to ",S.name]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Configure Symbols"}),e.jsxs("p",{className:"text-muted-foreground",children:["Add Chartink symbols to ",S.name," (NSE/BSE only)"]})]}),e.jsxs(l,{variant:"outline",onClick:p,children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsx(q,{children:"Add Symbols"}),e.jsx(G,{children:"Add individual symbols or bulk import from CSV (NSE/BSE exchanges, MIS/CNC products only)"})]}),e.jsx(z,{children:e.jsxs(Ae,{defaultValue:"single",children:[e.jsxs(Be,{className:"grid w-full grid-cols-2",children:[e.jsxs(ae,{value:"single",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Single Symbol"]}),e.jsxs(ae,{value:"bulk",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Bulk Import"]})]}),e.jsx(te,{value:"single",children:e.jsxs("form",{onSubmit:de,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Search Symbol"}),e.jsxs(xe,{open:M,onOpenChange:R,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(l,{variant:"outline",role:"combobox","aria-expanded":M,className:"w-full justify-between font-normal",children:[F?F.symbol:"Search...",e.jsx(Oe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ye,{className:"w-[300px] p-0",align:"start",children:e.jsxs(je,{children:[e.jsx(ge,{placeholder:"Search symbols...",value:b,onValueChange:f}),e.jsxs(pe,{children:[e.jsx(Se,{children:ce?"Searching...":"No symbols found."}),e.jsx(be,{children:ne.filter(s=>s.exchange==="NSE"||s.exchange==="BSE").map(s=>e.jsx(fe,{value:s.symbol,onSelect:()=>ie(s),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.symbol}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.name," â€¢ ",s.exchange]})]})},`${s.symbol}-${s.exchange}`))})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Chartink Symbol"}),e.jsx(X,{placeholder:"RELIANCE",value:C,onChange:s=>N(s.target.value.toUpperCase())})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Exchange"}),e.jsxs(Y,{value:m,onValueChange:s=>v(s),children:[e.jsx(J,{children:e.jsx(W,{placeholder:"Select"})}),e.jsx(Z,{children:$e.map(s=>e.jsx(ee,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Quantity"}),e.jsx(X,{type:"number",min:"1",value:y,onChange:s=>V(s.target.value),placeholder:"Qty"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Product"}),e.jsxs(Y,{value:k,onValueChange:s=>T(s),children:[e.jsx(J,{children:e.jsx(W,{placeholder:"Select"})}),e.jsx(Z,{children:Ke.map(s=>e.jsx(ee,{value:s,children:s},s))})]})]})]}),e.jsx(l,{type:"submit",disabled:x,children:x?"Adding...":"Add Symbol"})]})}),e.jsx(te,{value:"bulk",children:e.jsxs("form",{onSubmit:me,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"CSV Data"}),e.jsx(Pe,{placeholder:`ChartinkSymbol,Exchange,Quantity,Product
RELIANCE,NSE,100,CNC
TATAMOTORS,BSE,50,MIS`,value:j,onChange:s=>E(s.target.value),rows:6,maxLength:102400,className:"font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Format: ChartinkSymbol,Exchange,Quantity,Product (one per line, no header). Max 100KB.",e.jsx("br",{}),"Exchange: NSE or BSE only | Product: MIS or CNC only"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{type:"submit",disabled:x,children:x?"Importing...":"Import Symbols"}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>E(""),disabled:!j,children:"Clear"})]})]})})]})})]}),e.jsxs(K,{children:[e.jsxs(U,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Current Symbol Mappings"]}),e.jsxs(G,{children:[d.length," symbol",d.length!==1?"s":""," configured"]})]}),e.jsx(z,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx("p",{className:"text-sm",children:"Add symbols using the form above."})]}):e.jsxs(we,{children:[e.jsx(De,{children:e.jsxs(se,{children:[e.jsx(o,{children:"Chartink Symbol"}),e.jsx(o,{children:"Exchange"}),e.jsx(o,{className:"text-right",children:"Quantity"}),e.jsx(o,{children:"Product"}),e.jsx(o,{className:"text-right",children:"Added"}),e.jsx(o,{className:"w-16"})]})}),e.jsx(Ie,{children:d.map(s=>e.jsxs(se,{children:[e.jsx(i,{className:"font-medium",children:s.chartink_symbol}),e.jsx(i,{children:e.jsx($,{variant:"outline",children:s.exchange})}),e.jsx(i,{className:"text-right",children:s.quantity}),e.jsx(i,{children:e.jsx($,{variant:"secondary",children:s.product_type})}),e.jsx(i,{className:"text-right text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(i,{children:e.jsx(l,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>{H(s.id),g(!0)},children:e.jsx(He,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(Ce,{open:oe,onOpenChange:g,children:e.jsxs(Ne,{children:[e.jsxs(ve,{children:[e.jsx(ke,{children:"Remove Symbol"}),e.jsx(Te,{children:"Are you sure you want to remove this symbol from the strategy? This action cannot be undone."})]}),e.jsxs(Ee,{children:[e.jsx(l,{variant:"outline",onClick:()=>g(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:he,children:"Remove Symbol"})]})]})})]}):null}export{os as default};
