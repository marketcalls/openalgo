import{r,j as e}from"./vendor-react-CCyQGCED.js";import{u as W,B as y,e as _,s as C}from"./index-NHrG-O_Z.js";import{p as L}from"./python-strategy-DA2b1DX_.js";import{C as M,a as E,b as k,c as B,d as I}from"./card-Cn20bp_v.js";import{C as G}from"./checkbox-CdehzPk_.js";import{D as P,b as V,c as K,d as U,e as $,f as q}from"./dialog-DA9GnjaJ.js";import{L as J}from"./label-_1WWiomg.js";import{S as Y,E as T,R as Q,d as X,t as p}from"./index-CCl19WGM.js";import{S as Z}from"./scroll-area-Cb-vfl57.js";import{S as F}from"./skeleton-BWYif6yq.js";import{N as ee,Y as O,an as te,F as se,V as re,aJ as ae,b0 as ne}from"./vendor-icons-CCn_k3dF.js";import{d as le,L as oe}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const ce=Y.define({token(t){return t.match(/ERROR|error|Error|CRITICAL|critical|FATAL|fatal/)?"invalid":t.match(/WARNING|warning|Warning|WARN|warn/)?"keyword":t.match(/SUCCESS|success|Success/)?"string":t.match(/INFO|info|Info/)?"comment":t.match(/DEBUG|debug|Debug/)?"meta":t.match(/\d{4}-\d{2}-\d{2}[\sT]\d{2}:\d{2}:\d{2}/)||t.match(/\d{2}:\d{2}:\d{2}/)?"number":(t.next(),null)}}),ie=t=>X({theme:t?"dark":"light",settings:{background:t?"#111827":"#f8fafc",foreground:t?"#d1d5db":"#334155",caret:t?"#38bdf8":"#0284c7",selection:t?"rgba(56, 189, 248, 0.2)":"rgba(2, 132, 199, 0.2)",selectionMatch:t?"rgba(56, 189, 248, 0.1)":"rgba(2, 132, 199, 0.1)",lineHighlight:t?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)",gutterBackground:"transparent",gutterForeground:t?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",gutterBorder:"transparent"},styles:[{tag:p.invalid,color:t?"#f87171":"#dc2626",fontWeight:"bold"},{tag:p.keyword,color:t?"#fbbf24":"#d97706"},{tag:p.string,color:t?"#34d399":"#059669"},{tag:p.comment,color:t?"#60a5fa":"#2563eb"},{tag:p.meta,color:t?"#9ca3af":"#64748b"},{tag:p.number,color:t?"#22d3ee":"#0891b2"}]}),de=t=>{const n=t?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",j=t?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)";return T.theme({"&":{fontSize:"12px",fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace',height:"100%",backgroundColor:t?"#111827":"#f8fafc"},"&.cm-editor":{height:"100%"},".cm-scroller":{overflow:"auto",height:"100%"},".cm-content":{padding:"12px 0",lineHeight:"20px"},".cm-line":{padding:"0 12px"},".cm-gutters":{backgroundColor:j,borderRight:`1px solid ${n}`,paddingRight:"4px"},".cm-gutter":{minWidth:"48px"},".cm-gutterElement":{padding:"0 8px 0 12px",lineHeight:"20px"},"&.cm-focused":{outline:"none"},".cm-activeLine":{backgroundColor:t?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"},".cm-activeLineGutter":{backgroundColor:t?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.03)"}})};function ge({value:t,className:n="",height:j="500px",followTail:d=!1,reverseOrder:g=!1}){const{mode:l,appMode:b}=W(),o=l==="dark"||b==="analyzer",u=r.useRef(null),N=r.useRef(0),m=r.useRef(!1),S=r.useRef(t),f=r.useMemo(()=>!g||!t?t:t.split(`
`).reverse().join(`
`),[t,g]),v=r.useMemo(()=>[ce,ie(o),de(o),T.lineWrapping,T.editable.of(!1)],[o]),h=r.useCallback(()=>{const c=u.current?.view;if(c){const a=c.scrollDOM;N.current=a.scrollTop;const x=a.scrollHeight-a.scrollTop-a.clientHeight<50;m.current=!x}},[]);return r.useEffect(()=>{const c=u.current?.view;if(!c)return;const a=c.scrollDOM;return a.addEventListener("scroll",h),()=>{a.removeEventListener("scroll",h)}},[h]),r.useEffect(()=>{f!==S.current&&(S.current=f,requestAnimationFrame(()=>{const c=u.current?.view;if(!c)return;const a=c.scrollDOM;g?m.current||(a.scrollTop=0):d&&!m.current?a.scrollTop=a.scrollHeight:m.current&&(a.scrollTop=N.current)}))},[f,d,g]),e.jsx("div",{className:`rounded-lg overflow-hidden ${n}`,children:e.jsx(Q,{ref:u,value:f,extensions:v,readOnly:!0,height:j,theme:o?"dark":"light",basicSetup:{lineNumbers:!0,highlightActiveLineGutter:!0,highlightActiveLine:!0,foldGutter:!1,dropCursor:!1,allowMultipleSelections:!1,indentOnInput:!1,bracketMatching:!1,closeBrackets:!1,autocompletion:!1,rectangularSelection:!1,crosshairCursor:!1,highlightSelectionMatches:!0,searchKeymap:!0,tabSize:2}})})}function we(){const{strategyId:t}=le(),[n,j]=r.useState(null),[d,g]=r.useState([]),[l,b]=r.useState(null),[o,u]=r.useState(null),[N,m]=r.useState(!0),[S,f]=r.useState(!1),[v,h]=r.useState(!1),[c,a]=r.useState(!1),[x,w]=r.useState(!0),D=async()=>{if(t)try{m(!0);const[s,i]=await Promise.all([L.getStrategy(t),L.getLogFiles(t)]);j(s),g(i),i.length>0&&!l&&b(i[0].name)}catch{C.error("Failed to load logs","pythonStrategy")}finally{m(!1)}},R=async(s,i=!0)=>{if(t)try{i&&f(!0);const A=await L.getLogContent(t,s);u(A)}catch{i&&C.error("Failed to load log content","pythonStrategy")}finally{i&&f(!1)}};r.useEffect(()=>{D()},[]),r.useEffect(()=>{l&&R(l)},[l]),r.useEffect(()=>{if(n?.status==="running"&&l&&x){const s=setInterval(()=>{R(l,!1)},3e3);return()=>clearInterval(s)}},[n?.status,l,x]);const H=async()=>{if(t)try{w(!1),h(!0);const s=await L.clearLogs(t);s.status==="success"?(C.success("Logs cleared","pythonStrategy"),g([]),b(null),u(null)):C.error(s.message||"Failed to clear logs","pythonStrategy")}catch{C.error("Failed to clear logs","pythonStrategy")}finally{h(!1),a(!1),w(!0)}},z=s=>{const i=s.split("_");return i.length>1?i.slice(1).join("_").replace(".log",""):s.replace(".log","")};return N?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(F,{className:"h-8 w-32"}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsx(F,{className:"h-[600px]"}),e.jsx(F,{className:"h-[600px] col-span-3"})]})]}):n?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(y,{variant:"ghost",asChild:!0,children:e.jsxs(oe,{to:"/python",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Strategy Logs"}),e.jsx("p",{className:"text-muted-foreground",children:n.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"auto-refresh",checked:x,onCheckedChange:s=>w(s)}),e.jsx(J,{htmlFor:"auto-refresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(y,{variant:"outline",size:"sm",onClick:()=>l&&R(l),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>a(!0),disabled:d.length===0||n.status==="running",title:n.status==="running"?"Stop strategy first to clear logs":void 0,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(M,{className:"lg:col-span-1",children:[e.jsxs(E,{children:[e.jsxs(k,{className:"text-sm flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Log Files"]}),e.jsxs(B,{children:[d.length," file(s)"]})]}),e.jsx(I,{children:d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No log files found"}):e.jsx(Z,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2",children:d.map(s=>e.jsxs("button",{onClick:()=>b(s.name),className:`w-full text-left p-3 rounded-lg transition-colors ${l===s.name?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:z(s.name)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(re,{className:"h-3 w-3"}),new Date(s.last_modified).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(ae,{className:"h-3 w-3"}),s.size_kb.toFixed(2)," KB"]})]},s.name))})})})]}),e.jsxs(M,{className:"lg:col-span-3",children:[e.jsxs(E,{children:[e.jsxs(k,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Log Content"]}),n.status==="running"&&e.jsx(_,{className:"bg-green-500 animate-pulse",children:"Live"})]}),o&&e.jsxs(B,{children:[o.lines," lines • ",o.size_kb.toFixed(2)," KB • Last updated:"," ",new Date(o.last_updated).toLocaleString()]})]}),e.jsx(I,{children:l?S?e.jsx("div",{className:"flex items-center justify-center h-[500px]",children:e.jsx(O,{className:"h-6 w-6 animate-spin"})}):o?e.jsx(ge,{value:o.content,height:"500px",followTail:n?.status==="running"&&x}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"No content available"}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"Select a log file to view its contents"})})]})]}),e.jsx(P,{open:c,onOpenChange:a,children:e.jsxs(V,{children:[e.jsxs(K,{children:[e.jsx(U,{children:"Clear All Logs"}),e.jsxs($,{children:['Are you sure you want to clear all log files for "',n.name,'"? This action cannot be undone.']})]}),e.jsxs(q,{children:[e.jsx(y,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsx(y,{variant:"destructive",onClick:H,disabled:v,children:v?"Clearing...":"Clear All Logs"})]})]})})]}):null}export{we as default};
