import{j as e,r as g}from"./vendor-react-Df-MYEHc.js";import{C as S,d as M,a as R,b as B}from"./card-CC-hOcpD.js";import{w as P,B as N,e as H,s as w}from"./index-Bd6js41n.js";import{s as z}from"./strategy-D1On98u6.js";import{d as W}from"./strategy-dashboard-BdMkqh6u.js";import{n as J,b6 as Q,aJ as Z}from"./vendor-icons-nFj7rtAi.js";import{I as E}from"./input-DJQENBZF.js";import{L as u}from"./label-DqJSyuUm.js";import{S as h,a as y,b as _,c as j,d as c}from"./select-B7fGBsLz.js";import{S as ee}from"./switch-Dl2l4F2m.js";import{T as te,a as se,b as V,c as K}from"./tabs-Ct44Qaax.js";import{C as ae}from"./checkbox-7ANSFFPM.js";import{a as le,d as ne}from"./vendor-router-4BT-EZah.js";import"./vendor-charts-DPXZ0pfV.js";import"./vendor-radix-IoylIoim.js";const re={saveStrategy:async t=>(await P.post("/strategy/api/builder/save",t)).data,executeStrategy:async t=>(await P.post(`/strategy/api/builder/${t}/execute`)).data},ie={name:"",exchange:"NFO",underlying:"NIFTY",expiry_type:"current_week",product_type:"MIS",is_intraday:!0,trading_mode:"BOTH"},Y={risk_mode:"combined",combined_stoploss_type:null,combined_stoploss_value:null,combined_target_type:null,combined_target_value:null,combined_trailstop_type:null,combined_trailstop_value:null,default_stoploss_type:null,default_stoploss_value:null,default_target_type:null,default_target_value:null,default_trailstop_type:null,default_trailstop_value:null,default_breakeven_type:null,default_breakeven_threshold:null},$=[{key:"basics",label:"Basics",num:1},{key:"legs",label:"Legs",num:2},{key:"risk",label:"Risk",num:3},{key:"review",label:"Review",num:4}],ce=["basics","legs","risk","review"];function de({currentStep:t,onStepClick:i}){const r=ce.indexOf(t);return e.jsx("nav",{className:"flex items-center justify-center gap-2",children:$.map((o,n)=>{const s=n<r,x=n===r,p=n<=r;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("button",{type:"button",onClick:()=>p&&i(o.key),disabled:!p,className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-colors ${x?"bg-primary text-primary-foreground":s?"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 cursor-pointer":"bg-muted text-muted-foreground"}`,children:[s?e.jsx(J,{className:"h-3 w-3"}):e.jsx("span",{className:"w-4 text-center",children:o.num}),o.label]}),n<$.length-1&&e.jsx("div",{className:`w-8 h-0.5 mx-1 ${n<r?"bg-green-400":"bg-muted"}`})]},o.key)})})}const oe=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"},{value:"CDS",label:"CDS"},{value:"BCD",label:"BCD"},{value:"MCX",label:"MCX"}],A={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX","SENSEX50"],CDS:["USDINR","EURINR","GBPINR","JPYINR"],BCD:["USDINR","EURINR"],MCX:["CRUDEOIL","GOLD","SILVER","NATURALGAS"]};function pe({basics:t,onChange:i,onNext:r}){const[o,n]=g.useState(A[t.exchange]||[]),[s,x]=g.useState(!1),p=(l,a)=>i({...t,[l]:a});g.useEffect(()=>{let l=!1;return(async()=>{x(!0);try{const m=await P.get(`/search/api/underlyings?exchange=${t.exchange}`);!l&&m.data.underlyings?.length>0?n(m.data.underlyings):l||n(A[t.exchange]||[])}catch{l||n(A[t.exchange]||[])}finally{l||x(!1)}})(),()=>{l=!0}},[t.exchange]);const v=l=>{const a=l,m=A[a]||[];i({...t,exchange:a,underlying:m[0]||""})},d=t.name.trim().length>0;return e.jsxs("div",{className:"max-w-lg mx-auto space-y-5",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Strategy Name"}),e.jsx(E,{placeholder:"e.g., NIFTY Short Straddle",value:t.name,onChange:l=>p("name",l.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Exchange"}),e.jsxs(h,{value:t.exchange,onValueChange:v,children:[e.jsx(y,{children:e.jsx(_,{})}),e.jsx(j,{children:oe.map(l=>e.jsx(c,{value:l.value,children:l.label},l.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Underlying"}),e.jsxs(h,{value:t.underlying,onValueChange:l=>p("underlying",l),disabled:s,children:[e.jsx(y,{children:e.jsx(_,{placeholder:s?"Loading...":"Select"})}),e.jsx(j,{children:o.map(l=>e.jsx(c,{value:l,children:l},l))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Expiry"}),e.jsxs(h,{value:t.expiry_type,onValueChange:l=>p("expiry_type",l),children:[e.jsx(y,{children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"current_week",children:"Current Week"}),e.jsx(c,{value:"next_week",children:"Next Week"}),e.jsx(c,{value:"current_month",children:"Current Month"}),e.jsx(c,{value:"next_month",children:"Next Month"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Product Type"}),e.jsxs(h,{value:t.product_type,onValueChange:l=>p("product_type",l),children:[e.jsx(y,{children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"MIS",children:"MIS (Intraday)"}),e.jsx(c,{value:"NRML",children:"NRML (Positional)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{children:"Trading Mode"}),e.jsxs(h,{value:t.trading_mode,onValueChange:l=>p("trading_mode",l),children:[e.jsx(y,{children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"BOTH",children:"Both"}),e.jsx(c,{value:"LONG",children:"Long Only"}),e.jsx(c,{value:"SHORT",children:"Short Only"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-6",children:[e.jsx(ee,{checked:t.is_intraday,onCheckedChange:l=>p("is_intraday",l)}),e.jsx(u,{className:"text-sm",children:t.is_intraday?"Intraday":"Positional"})]})]}),e.jsx("div",{className:"pt-4 flex justify-end",children:e.jsx(N,{onClick:r,disabled:!d,children:"Next: Add Legs"})})]})}const ue=[{value:"ATM",label:"ATM"},{value:"ITM",label:"ITM"},{value:"OTM",label:"OTM"},{value:"specific",label:"Specific Strike"},{value:"premium_near",label:"Premium Near"}];function xe(t){switch(t){case"ATM":return["ATM"];case"ITM":return Array.from({length:20},(i,r)=>`ITM${r+1}`);case"OTM":return Array.from({length:20},(i,r)=>`OTM${r+1}`);default:return["ATM"]}}function me({leg:t,index:i,onChange:r,onRemove:o,frozen:n}){const s=(a,m)=>r({...t,[a]:m}),x=xe(t.strike_type),p=t.strike_type==="ITM"||t.strike_type==="OTM",v=t.strike_type==="specific",d=t.strike_type==="premium_near",l=a=>{const m=a;let b=t.offset;m==="ATM"?b="ATM":m==="ITM"?b="ITM1":m==="OTM"?b="OTM1":b="ATM",r({...t,strike_type:m,offset:b})};return e.jsxs(S,{className:n?"relative overflow-hidden opacity-75 pointer-events-none":"",children:[n&&e.jsx(he,{}),e.jsxs(M,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("span",{className:"text-xs font-medium",children:["Leg ",i+1,e.jsxs("span",{className:`ml-2 ${t.action==="BUY"?"text-green-600":"text-red-600"}`,children:[t.action," ",t.option_type||"FUT",t.offset!=="ATM"?` ${t.offset}`:" ATM"]})]}),e.jsx(N,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:o,disabled:n,children:e.jsx(Q,{className:"h-3.5 w-3.5 text-muted-foreground"})})]}),e.jsxs("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Action"}),e.jsxs(h,{value:t.action,onValueChange:a=>s("action",a),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"BUY",children:"BUY"}),e.jsx(c,{value:"SELL",children:"SELL"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Type"}),e.jsxs(h,{value:t.option_type||"FUT",onValueChange:a=>s("option_type",a==="FUT"?null:a),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"CE",children:"CE"}),e.jsx(c,{value:"PE",children:"PE"}),e.jsx(c,{value:"FUT",children:"Future"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Strike Type"}),e.jsxs(h,{value:t.strike_type,onValueChange:l,children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsx(j,{children:ue.map(a=>e.jsx(c,{value:a.value,children:a.label},a.value))})]})]}),p&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Offset"}),e.jsxs(h,{value:t.offset,onValueChange:a=>s("offset",a),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsx(j,{children:x.map(a=>e.jsx(c,{value:a,children:a},a))})]})]}),v&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Strike Price"}),e.jsx(E,{type:"number",step:"0.05",className:"h-8 text-xs",value:t.offset==="ATM"?"":t.offset,placeholder:"e.g., 24000",onChange:a=>s("offset",a.target.value||"ATM")})]}),d&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Premium Near"}),e.jsx(E,{type:"number",step:"0.05",className:"h-8 text-xs",value:t.offset==="ATM"?"":t.offset,placeholder:"e.g., 100",onChange:a=>s("offset",a.target.value?`P${a.target.value}`:"ATM")})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Lots"}),e.jsx(E,{type:"number",min:1,className:"h-8 text-xs",value:t.quantity_lots,onChange:a=>s("quantity_lots",Math.max(1,Number(a.target.value)))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Expiry"}),e.jsxs(h,{value:t.expiry_type,onValueChange:a=>s("expiry_type",a),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"current_week",children:"Curr Week"}),e.jsx(c,{value:"next_week",children:"Next Week"}),e.jsx(c,{value:"current_month",children:"Curr Month"}),e.jsx(c,{value:"next_month",children:"Next Month"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Product"}),e.jsxs(h,{value:t.product_type,onValueChange:a=>s("product_type",a),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"MIS",children:"MIS"}),e.jsx(c,{value:"NRML",children:"NRML"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(u,{className:"text-[10px]",children:"Order"}),e.jsxs(h,{value:t.order_type,onValueChange:a=>s("order_type",a),children:[e.jsx(y,{className:"h-8 text-xs",children:e.jsx(_,{})}),e.jsxs(j,{children:[e.jsx(c,{value:"MARKET",children:"Market"}),e.jsx(c,{value:"LIMIT",children:"Limit"})]})]})]})]})]})]})}function he(){return e.jsx("div",{className:"absolute inset-0 z-10",style:{background:`repeating-linear-gradient(
          -45deg,
          transparent,
          transparent 6px,
          rgba(128, 128, 128, 0.08) 6px,
          rgba(128, 128, 128, 0.08) 12px
        )`}})}const ye=[{id:"short_straddle",name:"Short Straddle",description:"Sell ATM CE + ATM PE",category:"neutral",legs:[{leg_type:"option",action:"SELL",option_type:"CE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"SELL",option_type:"PE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"}]},{id:"short_strangle",name:"Short Strangle",description:"Sell OTM3 CE + OTM3 PE",category:"neutral",legs:[{leg_type:"option",action:"SELL",option_type:"CE",strike_type:"OTM",offset:"OTM3",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"SELL",option_type:"PE",strike_type:"OTM",offset:"OTM3",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"}]},{id:"iron_condor",name:"Iron Condor",description:"Short strangle with protective wings",category:"neutral",legs:[{leg_type:"option",action:"SELL",option_type:"CE",strike_type:"OTM",offset:"OTM3",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"BUY",option_type:"CE",strike_type:"OTM",offset:"OTM6",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"SELL",option_type:"PE",strike_type:"OTM",offset:"OTM3",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"BUY",option_type:"PE",strike_type:"OTM",offset:"OTM6",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"}]},{id:"bull_call_spread",name:"Bull Call Spread",description:"Buy ATM CE + Sell OTM3 CE",category:"bullish",legs:[{leg_type:"option",action:"BUY",option_type:"CE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"SELL",option_type:"CE",strike_type:"OTM",offset:"OTM3",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"}]},{id:"bear_put_spread",name:"Bear Put Spread",description:"Buy ATM PE + Sell OTM3 PE",category:"bearish",legs:[{leg_type:"option",action:"BUY",option_type:"PE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"SELL",option_type:"PE",strike_type:"OTM",offset:"OTM3",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"}]},{id:"long_straddle",name:"Long Straddle",description:"Buy ATM CE + ATM PE",category:"neutral",legs:[{leg_type:"option",action:"BUY",option_type:"CE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"},{leg_type:"option",action:"BUY",option_type:"PE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"}]}];function _e({onSelect:t}){return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:ye.map(i=>e.jsx(S,{className:"cursor-pointer hover:border-primary transition-colors",onClick:()=>t(i.legs,i.id),children:e.jsxs(M,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:i.name}),e.jsx("span",{className:`text-[10px] px-1.5 py-0.5 rounded-full ${i.category==="neutral"?"bg-gray-100 text-gray-600":i.category==="bullish"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:i.category})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:i.description}),e.jsxs("p",{className:"text-[10px] text-muted-foreground mt-1",children:[i.legs.length," legs"]})]})},i.id))})}function q(){return Math.random().toString(36).substring(2,10)}const je={leg_type:"option",action:"SELL",option_type:"CE",strike_type:"ATM",offset:"ATM",expiry_type:"current_week",product_type:"MIS",quantity_lots:1,order_type:"MARKET"};function ge({legs:t,onChange:i,onPresetSelect:r,onBack:o,onNext:n}){const s=()=>{i([...t,{...je,id:q()}])},x=(d,l)=>{const a=[...t];a[d]=l,i(a)},p=d=>{i(t.filter((l,a)=>a!==d))},v=(d,l)=>{const a=d.map(m=>({...m,id:q()}));i(a),r(l)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Quick Start with Presets"}),e.jsx(_e,{onSelect:v})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h3",{className:"text-sm font-medium",children:["Legs ",t.length>0&&`(${t.length})`]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:s,children:[e.jsx(Z,{className:"h-3.5 w-3.5 mr-1"}),"Add Leg"]})]}),t.length===0?e.jsx("div",{className:"text-center py-8 text-sm text-muted-foreground border border-dashed rounded-lg",children:"Select a preset above or add legs manually"}):e.jsx("div",{className:"space-y-2",children:t.map((d,l)=>e.jsx(me,{leg:d,index:l,onChange:a=>x(l,a),onRemove:()=>p(l)},d.id))})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(N,{variant:"outline",onClick:o,children:"Back"}),e.jsx(N,{onClick:n,disabled:t.length===0,children:"Next: Risk Config"})]})]})}const fe=[{value:"",label:"Disabled"},{value:"percentage",label:"Percentage"},{value:"points",label:"Points"}];function T({label:t,typeValue:i,numValue:r,onTypeChange:o,onNumChange:n}){return e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(u,{className:"text-xs",children:t}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{value:i||"",onValueChange:s=>o(s||null),children:[e.jsx(y,{className:"w-[130px] h-8 text-xs",children:e.jsx(_,{placeholder:"Disabled"})}),e.jsx(j,{children:fe.map(s=>e.jsx(c,{value:s.value,children:s.label},s.value))})]}),e.jsx(E,{type:"number",step:"0.01",className:"h-8 text-xs",value:r??"",disabled:!i,onChange:s=>n(s.target.value?Number(s.target.value):null)})]})]})}function ve({config:t,onChange:i,onBack:r,onNext:o}){const n=(s,x)=>i({...t,[s]:x});return e.jsxs("div",{className:"max-w-lg mx-auto space-y-5",children:[e.jsxs(te,{value:t.risk_mode,onValueChange:s=>n("risk_mode",s),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Risk Mode"}),e.jsxs(se,{children:[e.jsx(V,{value:"combined",className:"text-xs",children:"Combined"}),e.jsx(V,{value:"per_leg",className:"text-xs",children:"Per Leg"})]})]}),e.jsxs(K,{value:"combined",className:"space-y-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Combined risk applies to the net premium of all legs together."}),e.jsx(T,{label:"Combined Stop Loss",typeValue:t.combined_stoploss_type,numValue:t.combined_stoploss_value,onTypeChange:s=>n("combined_stoploss_type",s),onNumChange:s=>n("combined_stoploss_value",s)}),e.jsx(T,{label:"Combined Target",typeValue:t.combined_target_type,numValue:t.combined_target_value,onTypeChange:s=>n("combined_target_type",s),onNumChange:s=>n("combined_target_value",s)}),e.jsx(T,{label:"Combined Trailing Stop",typeValue:t.combined_trailstop_type,numValue:t.combined_trailstop_value,onTypeChange:s=>n("combined_trailstop_type",s),onNumChange:s=>n("combined_trailstop_value",s)})]}),e.jsxs(K,{value:"per_leg",className:"space-y-4",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per-leg risk applies to each leg individually. Configure defaults here â€” override per leg in the Legs step."}),e.jsx(T,{label:"Default Stop Loss",typeValue:t.default_stoploss_type,numValue:t.default_stoploss_value,onTypeChange:s=>n("default_stoploss_type",s),onNumChange:s=>n("default_stoploss_value",s)}),e.jsx(T,{label:"Default Target",typeValue:t.default_target_type,numValue:t.default_target_value,onTypeChange:s=>n("default_target_type",s),onNumChange:s=>n("default_target_value",s)}),e.jsx(T,{label:"Default Trailing Stop",typeValue:t.default_trailstop_type,numValue:t.default_trailstop_value,onTypeChange:s=>n("default_trailstop_type",s),onNumChange:s=>n("default_trailstop_value",s)}),e.jsx(T,{label:"Breakeven Threshold",typeValue:t.default_breakeven_type,numValue:t.default_breakeven_threshold,onTypeChange:s=>n("default_breakeven_type",s),onNumChange:s=>n("default_breakeven_threshold",s)})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(N,{variant:"outline",onClick:r,children:"Back"}),e.jsx(N,{onClick:o,children:"Next: Review"})]})]})}function Ne({basics:t,legs:i,riskConfig:r,preset:o,saving:n,onBack:s,onSave:x}){const[p,v]=g.useState(!1);return e.jsxs("div",{className:"max-w-lg mx-auto space-y-4",children:[e.jsxs(S,{children:[e.jsx(R,{className:"pb-2",children:e.jsx(B,{className:"text-sm",children:"Strategy Basics"})}),e.jsxs(M,{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Name"}),e.jsx("span",{className:"font-medium",children:t.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Exchange"}),e.jsx("span",{children:t.exchange})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Underlying"}),e.jsx("span",{children:t.underlying})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Expiry"}),e.jsx("span",{className:"capitalize",children:t.expiry_type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Product"}),e.jsx("span",{children:t.product_type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Type"}),e.jsx("span",{children:t.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mode"}),e.jsx("span",{children:t.trading_mode})]})]})]}),e.jsxs(S,{children:[e.jsx(R,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(B,{className:"text-sm",children:["Legs (",i.length,")"]}),o&&e.jsx(H,{variant:"secondary",className:"text-[10px]",children:o.replace("_"," ")})]})}),e.jsx(M,{children:e.jsx("div",{className:"space-y-1.5",children:i.map((d,l)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsxs("span",{className:"text-muted-foreground w-8",children:["L",l+1]}),e.jsx("span",{className:d.action==="BUY"?"text-green-600":"text-red-600",children:d.action}),e.jsx("span",{children:d.option_type||"FUT"}),e.jsx("span",{className:"text-muted-foreground",children:d.offset}),e.jsxs("span",{children:["x",d.quantity_lots]}),e.jsx("span",{className:"text-muted-foreground",children:d.expiry_type.replace("_"," ")})]},d.id))})})]}),e.jsxs(S,{children:[e.jsx(R,{className:"pb-2",children:e.jsx(B,{className:"text-sm",children:"Risk Configuration"})}),e.jsxs(M,{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Mode"}),e.jsx("span",{className:"capitalize",children:r.risk_mode.replace("_"," ")})]}),r.risk_mode==="combined"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"SL"}),e.jsx("span",{children:r.combined_stoploss_type?`${r.combined_stoploss_value} ${r.combined_stoploss_type}`:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"TGT"}),e.jsx("span",{children:r.combined_target_type?`${r.combined_target_value} ${r.combined_target_type}`:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"TSL"}),e.jsx("span",{children:r.combined_trailstop_type?`${r.combined_trailstop_value} ${r.combined_trailstop_type}`:"Disabled"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Default SL"}),e.jsx("span",{children:r.default_stoploss_type?`${r.default_stoploss_value} ${r.default_stoploss_type}`:"Disabled"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Default TGT"}),e.jsx("span",{children:r.default_target_type?`${r.default_target_value} ${r.default_target_type}`:"Disabled"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-1",children:[e.jsx(ae,{id:"save-as-template",checked:p,onCheckedChange:d=>v(d===!0)}),e.jsx(u,{htmlFor:"save-as-template",className:"text-xs cursor-pointer",children:"Also save as reusable template"})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(N,{variant:"outline",onClick:s,children:"Back"}),e.jsx(N,{onClick:()=>x({saveAsTemplate:p}),disabled:n,children:n?"Saving...":"Save Strategy"})]})]})}function Fe(){const t=le(),{id:i}=ne(),r=!!i,[o,n]=g.useState("basics"),[s,x]=g.useState({...ie}),[p,v]=g.useState([]),[d,l]=g.useState({...Y}),[a,m]=g.useState(null),[b,F]=g.useState(!1),[G,D]=g.useState(!1);g.useEffect(()=>{if(!i)return;let k=!1;return(async()=>{D(!0);try{const C=Number(i),[L,f]=await Promise.all([z.getStrategy(C),W.getRiskConfig(C,"builder").catch(()=>null)]);if(k)return;const I=L.strategy,O=L.mappings[0];x({name:I.name||"",exchange:O?.exchange||"NFO",underlying:O?.symbol||"NIFTY",expiry_type:"current_week",product_type:O?.product_type||"MIS",is_intraday:I.is_intraday??!0,trading_mode:I.trading_mode||"BOTH"}),f&&l({...Y,default_stoploss_type:f.default_stoploss_type,default_stoploss_value:f.default_stoploss_value,default_target_type:f.default_target_type,default_target_value:f.default_target_value,default_trailstop_type:f.default_trailstop_type,default_trailstop_value:f.default_trailstop_value,default_breakeven_type:f.default_breakeven_type,default_breakeven_threshold:f.default_breakeven_threshold})}catch{w.error("Failed to load strategy")}finally{k||D(!1)}})(),()=>{k=!0}},[i]);const X=async k=>{F(!0);try{const U={basics:s,legs:p.map(({id:L,...f})=>f),riskConfig:d,preset:a,saveAsTemplate:k?.saveAsTemplate,...r?{strategy_id:Number(i)}:{}},C=await re.saveStrategy(U);C.status==="success"?(w.success(r?"Strategy updated":"Strategy saved successfully"),t("/strategy/hub")):w.error(C.message||"Failed to save strategy")}catch{w.error("Failed to save strategy")}finally{F(!1)}};return G?e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading strategy..."})}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold mb-1",children:r?"Edit Strategy":"Strategy Builder"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r?"Modify your F&O multi-leg strategy":"Build F&O multi-leg strategies with a visual wizard"})]}),e.jsx(de,{currentStep:o,onStepClick:n}),e.jsx(S,{children:e.jsxs(M,{className:"p-6",children:[o==="basics"&&e.jsx(pe,{basics:s,onChange:x,onNext:()=>n("legs")}),o==="legs"&&e.jsx(ge,{legs:p,onChange:v,onPresetSelect:m,onBack:()=>n("basics"),onNext:()=>n("risk")}),o==="risk"&&e.jsx(ve,{config:d,onChange:l,onBack:()=>n("legs"),onNext:()=>n("review")}),o==="review"&&e.jsx(Ne,{basics:s,legs:p,riskConfig:d,preset:a,saving:b,onBack:()=>n("risk"),onSave:X})]})})]})}export{Fe as default};
