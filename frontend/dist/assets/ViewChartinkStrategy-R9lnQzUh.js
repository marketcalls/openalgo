import{r as i,j as e}from"./vendor-react-RhKMXzW9.js";import{B as r,e as x,t as a}from"./index-54Xd3snV.js";import{c as n}from"./chartink-CWUfXsN-.js";import{A,a as E,b as z}from"./alert-Ce19E-5v.js";import{C as m,b as g,c as j,d as u,a as p}from"./card-Dy_bRET-.js";import{D as V,b as $,c as G,d as J,e as Q,f as Y}from"./dialog-kjQtuhB8.js";import{S as K}from"./separator-DUumubN2.js";import{S as f}from"./skeleton-PGwEmY0m.js";import{T as X,a as Z,b as L,c,d as ee,e as d}from"./table-D2yEDvPt.js";import{A as se,aJ as te,ac as O,P as ae,aH as re,s as ie,a2 as le,I as ne,T as ce,i as de}from"./vendor-icons-Ca5eNZvr.js";import{c as oe,a as he,L as y}from"./vendor-router-DdyOoyPF.js";import"./vendor-radix-gKv__6YA.js";function Se(){const{strategyId:N}=oe(),v=he(),[s,b]=i.useState(null),[o,C]=i.useState([]),[I,S]=i.useState(!0),[k,w]=i.useState(!1),[D,_]=i.useState(!1),[B,h]=i.useState(!1),[U,T]=i.useState(null),H=async()=>{if(N)try{S(!0);const t=await n.getStrategy(Number(N));b(t.strategy),C(t.mappings||[])}catch(t){console.error("Failed to fetch strategy:",t),a.error("Failed to load strategy"),v("/chartink")}finally{S(!1)}};i.useEffect(()=>{H()},[]);const R=async(t,l)=>{try{await navigator.clipboard.writeText(t),T(l),a.success("Copied to clipboard"),setTimeout(()=>T(null),2e3)}catch{a.error("Failed to copy")}},M=async()=>{if(s)try{w(!0);const t=await n.toggleStrategy(s.id);t.status==="success"?(b({...s,is_active:t.data?.is_active??!s.is_active}),a.success(t.data?.is_active?"Strategy activated":"Strategy deactivated")):a.error(t.message||"Failed to toggle strategy")}catch(t){console.error("Failed to toggle strategy:",t),a.error("Failed to toggle strategy")}finally{w(!1)}},P=async()=>{if(s)try{_(!0);const t=await n.deleteStrategy(s.id);t.status==="success"?(a.success("Strategy deleted successfully"),v("/chartink")):a.error(t.message||"Failed to delete strategy")}catch(t){console.error("Failed to delete strategy:",t),a.error("Failed to delete strategy")}finally{_(!1),h(!1)}},W=async t=>{if(s)try{const l=await n.deleteSymbolMapping(s.id,t);l.status==="success"?(C(o.filter(q=>q.id!==t)),a.success("Symbol mapping deleted")):a.error(l.message||"Failed to delete mapping")}catch(l){console.error("Failed to delete mapping:",l),a.error("Failed to delete mapping")}};if(I)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(f,{className:"h-8 w-32"}),e.jsx(f,{className:"h-48"}),e.jsx(f,{className:"h-64"})]});if(!s)return null;const F=n.getWebhookUrl(s.webhook_id);return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(r,{variant:"ghost",asChild:!0,children:e.jsxs(y,{to:"/chartink",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Chartink Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[s.name,e.jsx(x,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-muted-foreground",children:["Chartink â€¢ Created ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:s.is_active?"outline":"default",onClick:M,disabled:k,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),k?"Updating...":s.is_active?"Deactivate":"Activate"]}),e.jsxs(r,{variant:"destructive",onClick:()=>h(!0),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"Strategy Details"}),e.jsx(u,{children:"Configuration and settings"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(x,{variant:s.is_active?"default":"secondary",className:"mt-1",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(x,{variant:"outline",className:"mt-1",children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Exchanges"}),e.jsx("p",{className:"mt-1",children:"NSE, BSE only"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Products"}),e.jsx("p",{className:"mt-1",children:"MIS, CNC only"})]})]}),s.is_intraday&&s.start_time&&e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Trading Hours"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("p",{className:"font-mono",children:s.start_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("p",{className:"font-mono",children:s.end_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Square Off"}),e.jsx("p",{className:"font-mono",children:s.squareoff_time})]})]})]})]})]})]}),e.jsxs(m,{children:[e.jsxs(g,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Webhook Configuration"]}),e.jsx(u,{children:"Use this URL in your Chartink screener"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono break-all",children:F}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>R(F,"url"),children:U==="url"?e.jsx(ie,{className:"h-4 w-4 text-green-500"}):e.jsx(le,{className:"h-4 w-4"})})]})]}),e.jsxs(A,{children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsxs(E,{children:[e.jsx("p",{className:"font-medium mb-2",children:"Chartink Setup:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm",children:[e.jsx("li",{children:"Go to your Chartink screener settings"}),e.jsx("li",{children:"Add this webhook URL"}),e.jsx("li",{children:"Include BUY/SELL/SHORT/COVER in alert name"}),e.jsx("li",{children:"Save and enable alerts"})]})]})]})]})]})]}),e.jsxs(A,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(z,{children:"Important Notes"}),e.jsx(E,{children:e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsxs("li",{children:["Orders are processed only when the strategy is ",e.jsx("strong",{children:"active"})]}),s.is_intraday&&e.jsxs("li",{children:["Orders are processed only during trading hours (",s.start_time," -"," ",s.end_time,")"]}),e.jsx("li",{children:"Chartink symbol must be configured in the mappings below"}),e.jsx("li",{children:"Only NSE and BSE exchanges are supported"}),e.jsx("li",{children:"Only MIS and CNC product types are supported"})]})})]}),e.jsxs(m,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"Symbol Mappings"}),e.jsxs(u,{children:["Chartink symbols configured for this strategy (",o.length," total)"]})]}),e.jsx(r,{asChild:!0,children:e.jsxs(y,{to:`/chartink/${s.id}/configure`,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Configure Symbols"]})})]}),e.jsx(p,{children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx(r,{variant:"link",asChild:!0,children:e.jsx(y,{to:`/chartink/${s.id}/configure`,children:"Add your first symbol"})})]}):e.jsxs(X,{children:[e.jsx(Z,{children:e.jsxs(L,{children:[e.jsx(c,{children:"Chartink Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{className:"text-right",children:"Quantity"}),e.jsx(c,{children:"Product"}),e.jsx(c,{className:"w-16"})]})}),e.jsx(ee,{children:o.map(t=>e.jsxs(L,{children:[e.jsx(d,{className:"font-medium",children:t.chartink_symbol}),e.jsx(d,{children:t.exchange}),e.jsx(d,{className:"text-right",children:t.quantity}),e.jsx(d,{children:e.jsx(x,{variant:"outline",children:t.product_type})}),e.jsx(d,{children:e.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>W(t.id),children:e.jsx(O,{className:"h-4 w-4"})})})]},t.id))})]})})]}),e.jsx(V,{open:B,onOpenChange:h,children:e.jsxs($,{children:[e.jsxs(G,{children:[e.jsx(J,{children:"Delete Strategy"}),e.jsxs(Q,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All symbol mappings will also be deleted.']})]}),e.jsxs(Y,{children:[e.jsx(r,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:P,disabled:D,children:D?"Deleting...":"Delete Strategy"})]})]})})]})}export{Se as default};
