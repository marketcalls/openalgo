import{r as c,j as e}from"./vendor-react--vsXx8_n.js";import{u as sa,d as it,n as ot,e as x,c as z,B as i,D as dt,h as ht,i as mt,p as xt,j as ts,k as ut,t as n,m as pt}from"./index-49nn54hy.js";import{A as jt,b as gt,c as ft,d as vt,e as yt,f as Nt,g as bt,h as wt}from"./alert-dialog-y6Rh3Ppm.js";import{C as M,a as W,b as ls,c as rs}from"./card-D1RtKz0S.js";import{D as ye,b as Ne,c as be,d as we,e as Se,f as Ce}from"./dialog-Dpgje7oQ.js";import{I as T}from"./input-DaNo7pbt.js";import{L as h}from"./label-ConMOV-j.js";import{P as St}from"./progress-BBt0kbVl.js";import{S as _e}from"./scroll-area-CXGmUKNf.js";import{S as g,a as f,b as v,c as y,d as o}from"./select-DBruSYGM.js";import{T as ns,a as cs,b as P,c as N,d as is,e as p}from"./table-BdU9rFJu.js";import{T as Ct,a as _t,b as ke,c as De}from"./tabs-_k6KSdNi.js";import{T as kt}from"./textarea-DbH0Yq4a.js";import{C as Y}from"./checkbox-Dj_dgep_.js";import{S as aa}from"./switch-0np-3E4z.js";import{D as ta,aD as Dt,g as Ee,c as Et,Z as os,L as q,l as Tt,m as $t,ah as ds,N as Ft,n as At,o as zt,aE as la,R as Te,aF as hs,aC as $e,aG as ra,aH as It,aI as Ot,ag as ms,i as na,X as xs,w as Mt,a1 as Pt,aJ as ca,aK as ia,aL as oa}from"./vendor-icons-N1cWsVu6.js";import{a as Lt,L as Fe}from"./vendor-router-CiBIGs7t.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DIebA-qg.js";async function b(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}const Rt=[{label:"1M",months:1},{label:"3M",months:3},{label:"6M",months:6},{label:"1Y",months:12},{label:"2Y",months:24},{label:"5Y",months:60}];function us(k){const X=new Date;return X.setMonth(X.getMonth()-k),X.toISOString().split("T")[0]}function cl(){const{appMode:k,toggleAppMode:X,mode:ps,toggleMode:da,isTogglingMode:js}=sa(),{user:Ae,logout:gs}=it(),ze=Lt(),[u,ha]=c.useState([]),[Ie,ma]=c.useState([]),[Jt,xa]=c.useState(null),[Oe,ua]=c.useState(null),[te,pa]=c.useState(["NSE","BSE","NFO","BFO","MCX","CDS","BCD","NSE_INDEX","BSE_INDEX"]),[Me,ja]=c.useState({database_size_mb:0,total_records:0,total_symbols:0,watchlist_count:0}),[ga,fs]=c.useState("watchlist"),[L,Q]=c.useState(""),[Z,le]=c.useState("NSE"),[re,Pe]=c.useState([]),[vs,G]=c.useState(!1),ne=c.useRef(null),[ys,fa]=c.useState("D"),[Le,Ns]=c.useState(()=>us(1)),[bs,ws]=c.useState(()=>new Date().toISOString().split("T")[0]),[Ss,va]=c.useState(!1),[ce,ie]=c.useState([]),[ya,Na]=c.useState(null),[ba,Re]=c.useState({}),[Cs,_s]=c.useState(!1),[oe,wa]=c.useState([]),[Sa,ks]=c.useState(!1),[Ca,de]=c.useState(!1),[R,Ds]=c.useState(null),[Je,_a]=c.useState({}),[B,Es]=c.useState(null),[Ve,Ue]=c.useState(""),[Ts,We]=c.useState(""),[he,Xe]=c.useState("daily"),[$s,Be]=c.useState(5),[Fs,He]=c.useState("minutes"),[J,K]=c.useState("09:15"),[As,Ye]=c.useState("D"),[zs,qe]=c.useState(1),[Is,Os]=c.useState(!1),[ka,ee]=c.useState(!1),[Ms,Ps]=c.useState(""),[Ls,Rs]=c.useState(!1),[Da,me]=c.useState(!1),[Qe,Js]=c.useState(""),[Vs,Ea]=c.useState("NSE"),[Us,Ta]=c.useState("D"),[xe,Ws]=c.useState(null),[Xs,Bs]=c.useState(!1),Ze=c.useRef(null),[$a,Ge]=c.useState(!1),[ue,Hs]=c.useState(null),[Fa,pe]=c.useState(!1),[Ke,Aa]=c.useState("csv"),[I,za]=c.useState("all"),[$,je]=c.useState(new Set(["D"])),[O,V]=c.useState(new Set),[Ys,qs]=c.useState(!1),[es,Ia]=c.useState("25"),[se,Oa]=c.useState("m"),[C,H]=c.useState(new Set),[_,ss]=c.useState({exchange:"",interval:"",search:""}),{socket:m}=ot(),F=c.useMemo(()=>{const s=new Map;for(const a of Ie){const t=`${a.symbol}:${a.exchange}`;s.has(t)||s.set(t,{symbol:a.symbol,exchange:a.exchange,intervals:[],total_records:0,earliest_date:a.first_date,latest_date:a.last_date});const l=s.get(t);l.intervals.push({interval:a.interval,record_count:a.record_count,first_date:a.first_date,last_date:a.last_date}),l.total_records+=a.record_count,a.first_date&&(!l.earliest_date||a.first_date<l.earliest_date)&&(l.earliest_date=a.first_date),a.last_date&&(!l.latest_date||a.last_date>l.latest_date)&&(l.latest_date=a.last_date)}for(const a of s.values())a.intervals.sort((t,l)=>{const r=["1m","5m","15m","30m","1h","D","W","M"];return r.indexOf(t.interval)-r.indexOf(l.interval)});return Array.from(s.values()).sort((a,t)=>a.symbol.localeCompare(t.symbol))},[Ie]),ae=c.useMemo(()=>F.filter(s=>!(_.exchange&&_.exchange!=="__all__"&&s.exchange!==_.exchange||_.interval&&_.interval!=="__all__"&&!s.intervals.some(a=>a.interval===_.interval)||_.search&&!s.symbol.toLowerCase().includes(_.search.toLowerCase()))),[F,_]);c.useEffect(()=>{ge(),fe(),Ma(),Pa(),U(),La(),D(),A()},[]),c.useEffect(()=>{if(!m)return;const s=d=>{Re(E=>({...E,[d.job_id]:d})),ie(E=>E.map(j=>j.id===d.job_id?{...j,completed_symbols:d.current,status:"running"}:j))},a=d=>{Re(E=>{const j={...E};return delete j[d.job_id],j}),D(),fe(),U(),n.success(`Job completed: ${d.completed} success, ${d.failed} failed`)},t=d=>{ie(E=>E.map(j=>j.id===d.job_id?{...j,status:"paused"}:j))},l=d=>{ie(E=>E.map(j=>j.id===d.job_id?{...j,status:"cancelled"}:j)),Re(E=>{const j={...E};return delete j[d.job_id],j}),n.info("Job cancelled")};m.on("historify_progress",s),m.on("historify_job_complete",a),m.on("historify_job_paused",t),m.on("historify_job_cancelled",l);const r=()=>{A()},w=d=>{n.info("Schedule execution started"),A(),D(),B===d.schedule_id&&as(d.schedule_id)},S=d=>{A(),B===d.schedule_id&&as(d.schedule_id)};return m.on("historify_schedule_created",r),m.on("historify_schedule_updated",r),m.on("historify_schedule_deleted",r),m.on("historify_schedule_execution_started",w),m.on("historify_schedule_execution_complete",S),()=>{m.off("historify_progress",s),m.off("historify_job_complete",a),m.off("historify_job_paused",t),m.off("historify_job_cancelled",l),m.off("historify_schedule_created",r),m.off("historify_schedule_updated",r),m.off("historify_schedule_deleted",r),m.off("historify_schedule_execution_started",w),m.off("historify_schedule_execution_complete",S)}},[m,B]),c.useEffect(()=>{const s=a=>{ne.current&&!ne.current.contains(a.target)&&G(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]),c.useEffect(()=>{const s=setTimeout(()=>{L.length>=2?Ha(L):(Pe([]),G(!1))},300);return()=>clearTimeout(s)},[L]);const ge=async()=>{try{const a=await(await fetch("/historify/api/watchlist",{credentials:"include"})).json();a.status==="success"&&ha(a.data||[])}catch(s){console.error("Error loading watchlist:",s)}},fe=async()=>{try{const a=await(await fetch("/historify/api/catalog",{credentials:"include"})).json();a.status==="success"&&ma(a.data||[])}catch(s){console.error("Error loading catalog:",s)}},Ma=async()=>{try{const a=await(await fetch("/historify/api/intervals",{credentials:"include"})).json();a.status==="success"&&xa(a.data)}catch(s){console.error("Error loading intervals:",s)}},Pa=async()=>{try{const a=await(await fetch("/historify/api/historify-intervals",{credentials:"include"})).json();a.status==="success"&&ua({storage_intervals:a.storage_intervals,computed_intervals:a.computed_intervals,all_intervals:a.all_intervals})}catch(s){console.error("Error loading historify intervals:",s)}},U=async()=>{try{const a=await(await fetch("/historify/api/stats",{credentials:"include"})).json();a.status==="success"&&ja(a.data)}catch(s){console.error("Error loading stats:",s)}},La=async()=>{try{const a=await(await fetch("/historify/api/exchanges",{credentials:"include"})).json();a.status==="success"&&a.data?.length>0&&pa(a.data)}catch(s){console.error("Error loading exchanges:",s)}},D=async()=>{_s(!0);try{const a=await(await fetch("/historify/api/jobs?limit=50",{credentials:"include"})).json();a.status==="success"&&ie(a.data||[])}catch(s){console.error("Error loading jobs:",s)}finally{_s(!1)}},A=async()=>{ks(!0);try{const a=await(await fetch("/historify/api/schedules",{credentials:"include"})).json();a.status==="success"&&wa(a.data||[])}catch(s){console.error("Error loading schedules:",s)}finally{ks(!1)}},as=async s=>{try{const t=await(await fetch(`/historify/api/schedules/${s}/executions?limit=10`,{credentials:"include"})).json();t.status==="success"&&_a(l=>({...l,[s]:t.data||[]}))}catch(a){console.error("Error loading schedule executions:",a)}},ve=()=>{Ue(""),We(""),Xe("daily"),Be(5),He("minutes"),K("09:15"),Ye("D"),qe(1),Ds(null)},Qs=s=>{s?(Ds(s),Ue(s.name),We(s.description||""),Xe(s.schedule_type),Be(s.interval_value||5),He(s.interval_unit||"minutes"),K(s.time_of_day||"09:15"),Ye(s.data_interval),qe(s.lookback_days)):ve(),de(!0)},Ra=async()=>{if(!Ve.trim()){n.warning("Please enter a schedule name");return}Os(!0);try{const s=await b(),a={name:Ve.trim(),description:Ts.trim()||void 0,schedule_type:he,data_interval:As,lookback_days:zs};he==="interval"?(a.interval_value=$s,a.interval_unit=Fs):a.time_of_day=J;const t=R?`/historify/api/schedules/${R.id}`:"/historify/api/schedules",w=await(await fetch(t,{method:R?"PUT":"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify(a)})).json();w.status==="success"?(n.success(R?"Schedule updated":"Schedule created"),de(!1),ve(),A()):n.error(w.message||"Failed to save schedule")}catch(s){console.error("Error saving schedule:",s),n.error("Failed to save schedule")}finally{Os(!1)}},Ja=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/schedules/${s}`,{method:"DELETE",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success("Schedule deleted"),A()):n.error(l.message||"Failed to delete schedule")}catch(a){console.error("Error deleting schedule:",a),n.error("Failed to delete schedule")}},Va=async s=>{try{const a=await b(),t=s.is_enabled?"disable":"enable",r=await(await fetch(`/historify/api/schedules/${s.id}/${t}`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success(`Schedule ${s.is_enabled?"disabled":"enabled"}`),A()):n.error(r.message||"Failed to toggle schedule")}catch(a){console.error("Error toggling schedule:",a),n.error("Failed to toggle schedule")}},Ua=async s=>{try{const a=await b(),t=s.is_paused?"resume":"pause",r=await(await fetch(`/historify/api/schedules/${s.id}/${t}`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();r.status==="success"?(n.success(`Schedule ${s.is_paused?"resumed":"paused"}`),A()):n.error(r.message||"Failed to pause/resume schedule")}catch(a){console.error("Error pausing/resuming schedule:",a),n.error("Failed to pause/resume schedule")}},Wa=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/schedules/${s}/trigger`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success("Schedule triggered"),A(),D()):n.error(l.message||"Failed to trigger schedule")}catch(a){console.error("Error triggering schedule:",a),n.error("Failed to trigger schedule")}},Xa=s=>s.is_enabled?s.is_paused?e.jsx(x,{variant:"outline",className:"border-yellow-500 text-yellow-600",children:"Paused"}):s.status==="running"?e.jsx(x,{variant:"default",className:"bg-blue-500",children:"Running"}):e.jsx(x,{variant:"default",className:"bg-green-500",children:"Active"}):e.jsx(x,{variant:"secondary",children:"Disabled"}),Ba=s=>{if(s.schedule_type==="interval")return`Every ${s.interval_value} ${s.interval_unit}`;const[a,t]=(s.time_of_day||"09:15").split(":").map(Number),l=a===0?12:a>12?a-12:a,r=a>=12?"PM":"AM";return`Daily at ${l}:${t.toString().padStart(2,"0")} ${r} IST`},Ha=async s=>{if(!(s.length<2))try{const a=new URLSearchParams({q:s});Z&&a.append("exchange",Z);const l=await(await fetch(`/search/api/search?${a}`,{credentials:"include"})).json();Pe((l.results||[]).slice(0,10)),G(!0)}catch(a){console.error("Error searching symbols:",a),Pe([])}},Zs=async()=>{if(!L.trim()){n.warning("Please enter a symbol");return}try{const s=await b(),t=await(await fetch("/historify/api/watchlist",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify({symbol:L.trim().toUpperCase(),exchange:Z})})).json();t.status==="success"?(n.success(t.message),Q(""),ge(),U()):n.error(t.message||"Failed to add symbol")}catch(s){console.error("Error adding to watchlist:",s),n.error("Failed to add symbol")}},Ya=async(s,a)=>{try{const t=await b(),r=await(await fetch("/historify/api/watchlist",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({symbol:s,exchange:a})})).json();r.status==="success"?(n.success(r.message),ge(),U()):n.error(r.message||"Failed to remove symbol")}catch(t){console.error("Error removing from watchlist:",t),n.error("Failed to remove symbol")}},qa=async()=>{const a=Ms.trim().split(`
`).map(t=>{const[l,r]=t.split(",").map(w=>w.trim().toUpperCase());return{symbol:l,exchange:r||"NSE"}}).filter(t=>t.symbol);if(a.length===0){n.warning("No valid symbols found");return}Rs(!0);try{const t=await b(),r=await(await fetch("/historify/api/watchlist/bulk",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({symbols:a})})).json();r.status==="success"?(n.success(`Added ${r.added} symbols`),ee(!1),Ps(""),ge(),U()):n.error(r.message||"Failed to bulk add symbols")}catch(t){console.error("Error bulk adding:",t),n.error("Failed to bulk add symbols")}finally{Rs(!1)}},Gs=async(s,a="custom")=>{if(s.length===0){n.warning("No symbols selected");return}try{const t=await b(),r=await(await fetch("/historify/api/jobs",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({job_type:a,symbols:s,interval:ys,start_date:Le,end_date:bs,incremental:Ss})})).json();r.status==="success"?(n.success(`Job started: ${r.total_symbols} symbols`),D(),fs("jobs")):n.error(r.message||"Failed to create job")}catch(t){console.error("Error creating job:",t),n.error("Failed to create job")}},Qa=async()=>{if(u.length===0){n.warning("Watchlist is empty");return}const s=u.map(a=>({symbol:a.symbol,exchange:a.exchange}));await Gs(s,"watchlist")},Za=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/jobs/${s}/pause`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success("Job paused"),D()):n.error(l.message||"Failed to pause job")}catch(a){console.error("Error pausing job:",a),n.error("Failed to pause job")}},Ga=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/jobs/${s}/resume`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success("Job resumed"),D()):n.error(l.message||"Failed to resume job")}catch(a){console.error("Error resuming job:",a),n.error("Failed to resume job")}},Ks=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/jobs/${s}/cancel`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success("Job cancellation requested"),D()):n.error(l.message||"Failed to cancel job")}catch(a){console.error("Error cancelling job:",a),n.error("Failed to cancel job")}},Ka=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/jobs/${s}/retry`,{method:"POST",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success(`Retrying ${l.retry_count} failed items`),D()):n.error(l.message||"Failed to retry job")}catch(a){console.error("Error retrying job:",a),n.error("Failed to retry job")}},et=async s=>{try{const a=await b(),l=await(await fetch(`/historify/api/jobs/${s}`,{method:"DELETE",headers:{"X-CSRFToken":a},credentials:"include"})).json();l.status==="success"?(n.success("Job deleted"),D(),ya?.id===s&&Na(null)):n.error(l.message||"Failed to delete job")}catch(a){console.error("Error deleting job:",a),n.error("Failed to delete job")}},st=async()=>{if(ue)try{const s=await b(),t=await(await fetch("/historify/api/delete",{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify(ue)})).json();t.status==="success"?(n.success(t.message),fe(),U()):n.error(t.message||"Failed to delete data")}catch(s){console.error("Error deleting data:",s),n.error("Failed to delete data")}finally{Ge(!1),Hs(null)}},at=s=>{const a=s.target.files?.[0];if(a){const t=a.name.toLowerCase();if(!t.endsWith(".csv")&&!t.endsWith(".parquet")){n.error("Please select a CSV or Parquet file");return}Ws(a)}},tt=async()=>{if(!xe){n.warning("Please select a CSV or Parquet file");return}if(!Qe.trim()){n.warning("Please enter a symbol");return}Bs(!0);try{const s=await b(),a=new FormData;a.append("file",xe),a.append("symbol",Qe.trim().toUpperCase()),a.append("exchange",Vs),a.append("interval",Us);const l=await(await fetch("/historify/api/upload",{method:"POST",headers:{"X-CSRFToken":s},credentials:"include",body:a})).json();l.status==="success"?(n.success(`${l.message}`),me(!1),Ws(null),Js(""),Ze.current&&(Ze.current.value=""),fe(),U()):n.error(l.message||"Failed to upload data")}catch(s){console.error("Error uploading CSV:",s),n.error("Failed to upload CSV")}finally{Bs(!1)}},lt=async()=>{qs(!0);try{const s=await b(),a=I==="selected"?Array.from(O).map(w=>{const[S,d]=w.split(":");return{symbol:S,exchange:d}}):null,t=Array.from($),r=await(await fetch("/historify/api/export/bulk",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include",body:JSON.stringify({format:Ke==="csv"&&t.length>1?"zip":Ke,symbols:a,intervals:t,compression:"zstd"})})).json();r.status==="success"?(n.success(`${r.message}`),window.location.href="/historify/api/export/bulk/download",pe(!1)):n.error(r.message||"Failed to export data")}catch(s){console.error("Error exporting data:",s),n.error("Failed to export data")}finally{qs(!1)}},rt=(s,a)=>{const t=`${s}:${a}`;V(l=>{const r=new Set(l);return r.has(t)?r.delete(t):r.add(t),r})},nt=s=>{switch(s){case"running":return"bg-blue-500";case"paused":return"bg-yellow-500";case"completed":return"bg-green-500";case"completed_with_errors":return"bg-orange-500";case"failed":return"bg-red-500";case"cancelled":return"bg-gray-500";default:return"bg-gray-400"}},ea=async()=>{const s=await X();if(s.success){const a=sa.getState().appMode;n.success(`Switched to ${a==="live"?"Live":"Analyze"} mode`)}else n.error(s.message||"Failed to toggle mode")},ct=async()=>{try{await pt.logout(),gs(),ze("/login"),n.success("Logged out successfully")}catch{gs(),ze("/login")}};return e.jsxs("div",{className:"h-full flex flex-col bg-background",children:[e.jsx("div",{className:"border-b border-border bg-card/50",children:e.jsxs("div",{className:"px-4 py-3 flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ta,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Historify"}),e.jsx("p",{className:"text-xs text-muted-foreground hidden sm:block",children:"Historical Data Management"})]})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Dt,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm font-medium",children:[Me.database_size_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:Me.total_records.toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-muted/50 rounded-lg",children:[e.jsx(Et,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:Me.total_symbols})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Ae?.broker&&e.jsx(x,{variant:"outline",className:"text-xs font-medium",children:Ae.broker.toUpperCase()}),e.jsxs(x,{variant:k==="live"?"default":"secondary",className:z("text-xs cursor-pointer",k==="analyzer"&&"bg-purple-500 hover:bg-purple-600 text-white"),onClick:ea,children:[k==="live"?e.jsx(os,{className:"h-3 w-3 mr-1"}):e.jsx(Ee,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:k==="live"?"Live Mode":"Analyze Mode"}),e.jsx("span",{className:"sm:hidden",children:k==="live"?"Live":"Analyze"})]}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ea,disabled:js,title:`Switch to ${k==="live"?"Analyze":"Live"} mode`,children:js?e.jsx(q,{className:"h-4 w-4 animate-spin"}):k==="live"?e.jsx(os,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:da,disabled:k!=="live",title:ps==="light"?"Switch to dark mode":"Switch to light mode",children:ps==="light"?e.jsx(Tt,{className:"h-4 w-4"}):e.jsx($t,{className:"h-4 w-4"})}),e.jsx(Fe,{to:u.length>0?`/historify/charts/${u[0].symbol}?exchange=${u[0].exchange}&interval=D`:F.length>0?`/historify/charts/${F[0].symbol}?exchange=${F[0].exchange}&interval=D`:"/historify/charts",children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(ds,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Charts"})]})}),e.jsx(Fe,{to:"/dashboard",children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(Ft,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Dashboard"})]})}),e.jsxs(dt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full bg-primary text-primary-foreground",children:e.jsx("span",{className:"text-sm font-medium",children:Ae?.username?.[0]?.toUpperCase()||"O"})})}),e.jsxs(mt,{align:"end",className:"w-56",children:[xt.map(s=>e.jsxs(ts,{onSelect:()=>ze(s.href),className:"cursor-pointer",children:[e.jsx(s.icon,{className:"h-4 w-4 mr-2"}),s.label]},s.href)),e.jsx(ts,{asChild:!0,children:e.jsxs("a",{href:"https://docs.openalgo.in",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-4 w-4"}),"Docs"]})}),e.jsx(ut,{}),e.jsxs(ts,{onClick:ct,className:"text-destructive focus:text-destructive",children:[e.jsx(zt,{className:"h-4 w-4 mr-2"}),"Logout"]})]})]})]})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(Ct,{value:ga,onValueChange:fs,className:"h-full flex flex-col",children:[e.jsx("div",{className:"border-b border-border px-4 overflow-x-auto",children:e.jsxs(_t,{className:"h-10 bg-transparent w-max min-w-full sm:w-auto",children:[e.jsxs(ke,{value:"watchlist",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(la,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Watchlist"}),e.jsx("span",{className:"sm:hidden",children:"Watch"}),u.length>0&&e.jsx(x,{variant:"secondary",className:"ml-1 h-5 min-w-5 text-xs",children:u.length})]}),e.jsxs(ke,{value:"scheduler",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Scheduler"}),e.jsx("span",{className:"sm:hidden",children:"Sched"}),oe.filter(s=>s.is_enabled&&!s.is_paused).length>0&&e.jsx(x,{variant:"default",className:"ml-1 h-5 min-w-5 text-xs bg-green-500",children:oe.filter(s=>s.is_enabled&&!s.is_paused).length})]}),e.jsxs(ke,{value:"jobs",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(hs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Download Jobs"}),e.jsx("span",{className:"sm:hidden",children:"Jobs"}),ce.filter(s=>s.status==="running"||s.status==="paused").length>0&&e.jsx(x,{variant:"default",className:"ml-1 h-5 min-w-5 text-xs bg-blue-500",children:ce.filter(s=>s.status==="running"||s.status==="paused").length})]}),e.jsxs(ke,{value:"catalog",className:"gap-1.5 data-[state=active]:bg-muted",children:[e.jsx(ta,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Export/Import"}),e.jsx("span",{className:"sm:hidden",children:"Export"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx(De,{value:"catalog",className:"h-full m-0 p-4 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(M,{children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",ref:ne,children:[e.jsx(T,{placeholder:"Quick add symbol to watchlist...",value:L,onChange:s=>Q(s.target.value.toUpperCase()),className:"h-9"}),vs&&re.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-50 max-h-60 overflow-auto",children:re.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-muted cursor-pointer",onClick:()=>{Q(s.symbol),le(s.exchange),G(!1)},children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.name," - ",s.exchange]})]},`${s.symbol}-${s.exchange}`))})]}),e.jsxs(g,{value:Z,onValueChange:le,children:[e.jsx(f,{className:"w-full sm:w-28 h-9",children:e.jsx(v,{})}),e.jsx(y,{children:te.map(s=>e.jsx(o,{value:s,children:s},s))})]}),e.jsxs(i,{onClick:Zs,className:"h-9",size:"sm",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Add to Watchlist"]}),e.jsxs(i,{variant:"outline",onClick:()=>ee(!0),className:"h-9",size:"sm",children:[e.jsx(ra,{className:"h-4 w-4 mr-1"}),"Bulk"]})]})})}),e.jsx(M,{children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx(T,{placeholder:"Filter symbols...",value:_.search,onChange:s=>ss(a=>({...a,search:s.target.value})),className:"h-9"})}),e.jsxs(g,{value:_.exchange||"__all__",onValueChange:s=>ss(a=>({...a,exchange:s})),children:[e.jsx(f,{className:"w-full sm:w-32 h-9",children:e.jsx(v,{placeholder:"Exchange"})}),e.jsxs(y,{children:[e.jsx(o,{value:"__all__",children:"All"}),te.map(s=>e.jsx(o,{value:s,children:s},s))]})]}),e.jsxs(g,{value:_.interval||"__all__",onValueChange:s=>ss(a=>({...a,interval:s})),children:[e.jsx(f,{className:"w-full sm:w-32 h-9",title:"Filter symbols that have this interval",children:e.jsx(v,{placeholder:"Has Interval"})}),e.jsxs(y,{children:[e.jsx(o,{value:"__all__",children:"All Intervals"}),(Oe?.storage_intervals||["1m","D"]).map(s=>e.jsxs(o,{value:s,children:["Has ",s]},s))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>pe(!0),disabled:Ie.length===0,className:"h-9",children:[e.jsx(It,{className:"h-4 w-4 mr-1"}),"Export"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>me(!0),className:"h-9",children:[e.jsx(Ot,{className:"h-4 w-4 mr-1"}),"Import"]})]})]})})}),e.jsx(M,{children:e.jsx(_e,{className:"h-[calc(100vh-380px)]",children:e.jsxs(ns,{children:[e.jsx(cs,{children:e.jsxs(P,{children:[e.jsx(N,{className:"w-10",children:e.jsx(Y,{checked:O.size===ae.length&&ae.length>0,onCheckedChange:s=>{V(s?new Set(ae.map(a=>`${a.symbol}:${a.exchange}`)):new Set)}})}),e.jsx(N,{children:"Symbol"}),e.jsx(N,{className:"hidden sm:table-cell",children:"Exchange"}),e.jsx(N,{children:"Available Intervals"}),e.jsx(N,{className:"text-right hidden sm:table-cell",children:"Total Records"}),e.jsx(N,{className:"hidden md:table-cell",children:"Date Range"}),e.jsx(N,{className:"w-20"})]})}),e.jsx(is,{children:ae.length===0?e.jsx(P,{children:e.jsx(p,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No data available. Add symbols to watchlist and download data."})}):ae.map(s=>e.jsxs(P,{children:[e.jsx(p,{children:e.jsx(Y,{checked:O.has(`${s.symbol}:${s.exchange}`),onCheckedChange:()=>rt(s.symbol,s.exchange)})}),e.jsx(p,{className:"font-medium",children:e.jsxs("div",{children:[s.symbol,e.jsxs("span",{className:"sm:hidden text-xs text-muted-foreground ml-1",children:["(",s.exchange,")"]})]})}),e.jsx(p,{className:"hidden sm:table-cell",children:e.jsx(x,{variant:"outline",children:s.exchange})}),e.jsx(p,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.intervals.map(a=>e.jsxs(x,{variant:a.interval==="1m"?"default":a.interval==="D"?"secondary":"outline",className:"text-xs cursor-pointer hover:bg-primary/80",title:`${a.record_count.toLocaleString()} records (${a.first_date} - ${a.last_date})`,onClick:()=>{window.location.href=`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=${a.interval}`},children:[a.interval,e.jsx("span",{className:"ml-1 opacity-70",children:a.record_count>1e3?`${Math.round(a.record_count/1e3)}k`:a.record_count})]},a.interval))})}),e.jsx(p,{className:"text-right hidden sm:table-cell",children:s.total_records.toLocaleString()}),e.jsxs(p,{className:"hidden md:table-cell text-muted-foreground text-sm",children:[s.earliest_date," - ",s.latest_date]}),e.jsx(p,{children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,children:e.jsx(Fe,{to:`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=${s.intervals[0]?.interval||"D"}`,children:e.jsx(ds,{className:"h-3.5 w-3.5"})})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>{Hs({symbol:s.symbol,exchange:s.exchange}),Ge(!0)},children:e.jsx(ms,{className:"h-3.5 w-3.5"})})]})})]},`${s.symbol}-${s.exchange}`))})]})})})]})}),e.jsxs(De,{value:"watchlist",className:"h-full m-0 p-4 overflow-auto",children:[e.jsx(M,{className:"mb-4",children:e.jsx(W,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex-1 relative",ref:ne,children:[e.jsx(T,{placeholder:"Search symbol to add...",value:L,onChange:s=>Q(s.target.value.toUpperCase()),className:"h-9"}),vs&&re.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-popover border border-border rounded-md shadow-lg z-50 max-h-60 overflow-auto",children:re.map(s=>e.jsxs("div",{className:"px-3 py-2 hover:bg-muted cursor-pointer",onClick:()=>{Q(s.symbol),le(s.exchange),G(!1)},children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.name," - ",s.exchange]})]},`${s.symbol}-${s.exchange}`))})]}),e.jsxs(g,{value:Z,onValueChange:le,children:[e.jsx(f,{className:"w-full sm:w-28 h-9",children:e.jsx(v,{})}),e.jsx(y,{children:te.map(s=>e.jsx(o,{value:s,children:s},s))})]}),e.jsxs(i,{onClick:Zs,className:"h-9",children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Add"]}),e.jsxs(i,{variant:"outline",onClick:()=>ee(!0),className:"h-9",children:[e.jsx(ra,{className:"h-4 w-4 mr-1"}),"Bulk"]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-[calc(100vh-240px)]",children:[e.jsxs(M,{className:"flex flex-col",children:[e.jsx(ls,{className:"pb-3",children:e.jsxs(rs,{className:"text-base flex items-center gap-2",children:[e.jsx(na,{className:"h-4 w-4"}),"Download Settings"]})}),e.jsx(W,{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-sm text-muted-foreground mb-2 block",children:"Quick Date Range"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Rt.map(s=>{const a=Le===us(s.months);return e.jsx(i,{variant:a?"default":"outline",size:"sm",className:z("h-8 min-w-[3rem]",a&&"ring-2 ring-primary ring-offset-2 ring-offset-background"),onClick:()=>{Ns(us(s.months)),ws(new Date().toISOString().split("T")[0])},children:s.label},s.label)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-sm text-muted-foreground",children:"From"}),e.jsx(T,{type:"date",value:Le,onChange:s=>Ns(s.target.value),className:"h-9 mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm text-muted-foreground",children:"To"}),e.jsx(T,{type:"date",value:bs,onChange:s=>ws(s.target.value),className:"h-9 mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm text-muted-foreground",children:"Interval"}),e.jsxs(g,{value:ys,onValueChange:fa,children:[e.jsx(f,{className:"h-9 mt-1",children:e.jsx(v,{})}),e.jsx(y,{children:(Oe?.storage_intervals||["1m","D"]).map(s=>e.jsx(o,{value:s,children:s==="1m"?"1 Minute":s==="D"?"Daily":s},s))})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"Other timeframes (5m, 15m, 30m, 1h) computed from 1m data"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx(h,{className:"font-medium",children:"Incremental Download"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Only download new data after last timestamp"})]}),e.jsx(aa,{checked:Ss,onCheckedChange:va})]}),e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs(i,{className:"w-full h-10",onClick:()=>{if(C.size===0)Qa();else{const s=u.filter(a=>C.has(`${a.symbol}:${a.exchange}`)).map(a=>({symbol:a.symbol,exchange:a.exchange}));Gs(s,"watchlist")}},disabled:u.length===0,children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),C.size>0?`Download Selected (${C.size})`:`Download All (${u.length})`]}),C.size>0&&e.jsx(i,{variant:"outline",className:"w-full h-9",onClick:()=>H(new Set),children:"Clear Selection"})]})]})})]}),e.jsxs(M,{className:"flex flex-col",children:[e.jsx(ls,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(rs,{className:"text-base",children:["Symbols (",u.length,")",C.size>0&&e.jsxs(x,{className:"ml-2",children:[C.size," selected"]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(i,{variant:"outline",size:"sm",onClick:()=>{C.size===u.length?H(new Set):H(new Set(u.map(s=>`${s.symbol}:${s.exchange}`)))},children:C.size===u.length?"Deselect All":"Select All"})})]})}),e.jsx(W,{className:"flex-1 p-0 overflow-hidden",children:e.jsx(_e,{className:"h-full",children:e.jsxs(ns,{children:[e.jsx(cs,{children:e.jsxs(P,{children:[e.jsx(N,{className:"w-10",children:e.jsx(Y,{checked:C.size===u.length&&u.length>0,onCheckedChange:s=>{H(s?new Set(u.map(a=>`${a.symbol}:${a.exchange}`)):new Set)}})}),e.jsx(N,{children:"Symbol"}),e.jsx(N,{className:"hidden sm:table-cell",children:"Exchange"}),e.jsx(N,{className:"hidden md:table-cell",children:"Added"}),e.jsx(N,{className:"w-20 text-right",children:"Actions"})]})}),e.jsx(is,{children:u.length===0?e.jsx(P,{children:e.jsxs(p,{colSpan:5,className:"text-center py-12 text-muted-foreground",children:[e.jsx(la,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No symbols in watchlist"}),e.jsx("p",{className:"text-sm mt-1",children:"Add symbols using the search above"})]})}):u.map(s=>e.jsxs(P,{className:z(C.has(`${s.symbol}:${s.exchange}`)&&"bg-muted/50"),children:[e.jsx(p,{children:e.jsx(Y,{checked:C.has(`${s.symbol}:${s.exchange}`),onCheckedChange:()=>{H(a=>{const t=new Set(a),l=`${s.symbol}:${s.exchange}`;return t.has(l)?t.delete(l):t.add(l),t})}})}),e.jsxs(p,{className:"font-medium",children:[s.symbol,e.jsxs("span",{className:"sm:hidden text-xs text-muted-foreground ml-1",children:["(",s.exchange,")"]})]}),e.jsx(p,{className:"hidden sm:table-cell",children:e.jsx(x,{variant:"outline",children:s.exchange})}),e.jsx(p,{className:"hidden md:table-cell text-muted-foreground text-sm",children:new Date(s.added_at).toLocaleDateString()}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7",asChild:!0,title:"View chart",children:e.jsx(Fe,{to:`/historify/charts/${s.symbol}?exchange=${s.exchange}&interval=D`,children:e.jsx(ds,{className:"h-4 w-4"})})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:()=>Ya(s.symbol,s.exchange),title:"Remove from watchlist",children:e.jsx(xs,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})]})]}),e.jsx(De,{value:"jobs",className:"h-full m-0 p-4 overflow-auto",children:e.jsx("div",{className:"space-y-4",children:e.jsxs(M,{children:[e.jsx(ls,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(rs,{className:"text-base",children:"Download Jobs"}),e.jsxs(i,{variant:"outline",size:"sm",onClick:D,disabled:Cs,children:[e.jsx(Te,{className:z("h-4 w-4 mr-1",Cs&&"animate-spin")}),"Refresh"]})]})}),e.jsx(W,{className:"p-0",children:e.jsx(_e,{className:"h-[calc(100vh-280px)]",children:ce.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(hs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No download jobs yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Start a download from the Watchlist tab"})]}):e.jsx("div",{className:"divide-y divide-border",children:ce.map(s=>{const a=ba[s.id],t=a?.percent||(s.total_symbols>0?Math.round(s.completed_symbols/s.total_symbols*100):0);return e.jsx("div",{className:"p-4 hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:z("w-2 h-2 rounded-full",nt(s.status))}),e.jsxs("span",{className:"font-medium truncate",children:["Job ",s.id]}),e.jsx(x,{variant:"outline",className:"text-xs",children:s.job_type}),e.jsx(x,{variant:s.status==="running"?"default":s.status==="paused"?"secondary":"outline",className:"text-xs",children:s.status})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.interval," | ",s.start_date," to ",s.end_date]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Mt,{className:"h-3.5 w-3.5 text-green-500"}),s.completed_symbols]}),s.failed_symbols>0&&e.jsxs("span",{className:"flex items-center gap-1 text-red-500",children:[e.jsx(Pt,{className:"h-3.5 w-3.5"}),s.failed_symbols]}),e.jsxs("span",{className:"text-muted-foreground",children:["/ ",s.total_symbols," total"]})]}),(s.status==="running"||s.status==="paused")&&e.jsxs("div",{className:"mt-2",children:[e.jsx(St,{value:t,className:"h-1.5"}),a&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Downloading: ",a.symbol," (",t,"%)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="running"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>Za(s.id),children:e.jsx(ca,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>Ks(s.id),children:e.jsx(ia,{className:"h-4 w-4"})})]}),s.status==="paused"&&e.jsxs(e.Fragment,{children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>Ga(s.id),children:e.jsx(oa,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",className:"text-destructive",onClick:()=>Ks(s.id),children:e.jsx(ia,{className:"h-4 w-4"})})]}),(s.status==="completed_with_errors"||s.status==="failed")&&s.failed_symbols>0&&e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>Ka(s.id),children:[e.jsx(Te,{className:"h-4 w-4 mr-1"}),"Retry"]}),s.status!=="running"&&s.status!=="paused"&&e.jsx(i,{variant:"ghost",size:"sm",className:"text-destructive",onClick:()=>et(s.id),children:e.jsx(ms,{className:"h-4 w-4"})})]})]})},s.id)})})})})]})})}),e.jsx(De,{value:"scheduler",className:"h-full m-0 p-4 overflow-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Scheduled Downloads"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automate data downloads on a schedule"})]}),e.jsxs(i,{onClick:()=>Qs(),children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Create Schedule"]})]}),e.jsx(M,{children:e.jsx(W,{className:"p-0",children:Sa?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(q,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):oe.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No schedules created yet"}),e.jsx("p",{className:"text-sm",children:"Create a schedule to automate data downloads"})]}):e.jsx("div",{className:"divide-y divide-border",children:oe.map(s=>e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium",children:s.name}),Xa(s),e.jsx(x,{variant:"outline",children:s.data_interval==="1m"?"1 Min":"Daily"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Ba(s),s.description&&` - ${s.description}`]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[s.next_run_at&&e.jsxs("span",{children:["Next: ",new Date(s.next_run_at).toLocaleString()]}),s.last_run_at&&e.jsxs("span",{children:["Last: ",new Date(s.last_run_at).toLocaleString()]}),e.jsxs("span",{children:["Runs: ",s.total_runs," (",s.successful_runs," ok, ",s.failed_runs," failed)"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(aa,{checked:s.is_enabled,onCheckedChange:()=>Va(s),title:s.is_enabled?"Disable schedule":"Enable schedule"}),s.is_enabled&&e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Ua(s),title:s.is_paused?"Resume":"Pause",children:s.is_paused?e.jsx(oa,{className:"h-4 w-4"}):e.jsx(ca,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Wa(s.id),disabled:!s.is_enabled||s.status==="running",title:"Run now",children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Qs(s),title:"Edit",children:e.jsx(na,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{B===s.id?Es(null):(Es(s.id),as(s.id))},title:"View history",children:B===s.id?e.jsx(xs,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>Ja(s.id),title:"Delete",children:e.jsx(ms,{className:"h-4 w-4"})})]})]}),B===s.id&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Recent Executions"}),!Je[s.id]||Je[s.id].length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No executions yet"}):e.jsxs(ns,{children:[e.jsx(cs,{children:e.jsxs(P,{children:[e.jsx(N,{children:"Time"}),e.jsx(N,{children:"Status"}),e.jsx(N,{className:"text-right",children:"Symbols"}),e.jsx(N,{className:"text-right",children:"Records"}),e.jsx(N,{children:"Error"})]})}),e.jsx(is,{children:Je[s.id].map(a=>e.jsxs(P,{children:[e.jsx(p,{className:"text-sm",children:new Date(a.started_at).toLocaleString()}),e.jsx(p,{children:e.jsx(x,{variant:a.status==="completed"?"default":a.status==="running"?"secondary":"destructive",className:a.status==="completed"?"bg-green-500":a.status==="running"?"bg-blue-500":"",children:a.status})}),e.jsxs(p,{className:"text-right text-sm",children:[a.symbols_success,"/",a.symbols_processed,a.symbols_failed>0&&e.jsxs("span",{className:"text-destructive ml-1",children:["(",a.symbols_failed," failed)"]})]}),e.jsx(p,{className:"text-right text-sm",children:a.records_downloaded.toLocaleString()}),e.jsx(p,{className:"text-sm text-destructive max-w-[200px] truncate",children:a.error_message})]},a.id))})]})]})]},s.id))})})})]})})]})]})}),e.jsx(ye,{open:Ca,onOpenChange:s=>{de(s),s||ve()},children:e.jsxs(Ne,{className:"sm:max-w-lg",children:[e.jsxs(be,{children:[e.jsx(we,{children:R?"Edit Schedule":"Create Schedule"}),e.jsx(Se,{children:R?"Update schedule configuration":"Set up automated data downloads"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Name"}),e.jsx(T,{value:Ve,onChange:s=>Ue(s.target.value),placeholder:"Daily Watchlist Update",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Description (optional)"}),e.jsx(T,{value:Ts,onChange:s=>We(s.target.value),placeholder:"Downloads daily data for all watchlist symbols",className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Schedule Type"}),e.jsxs(g,{value:he,onValueChange:s=>Xe(s),children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"interval",children:"Interval"}),e.jsx(o,{value:"daily",children:"Daily"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Data Interval"}),e.jsxs(g,{value:As,onValueChange:s=>Ye(s),children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"1m",children:"1 Minute"}),e.jsx(o,{value:"D",children:"Daily"})]})]})]})]}),he==="interval"?e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Every"}),e.jsxs(g,{value:String($s),onValueChange:s=>Be(parseInt(s)),children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"1",children:"1"}),e.jsx(o,{value:"5",children:"5"}),e.jsx(o,{value:"15",children:"15"}),e.jsx(o,{value:"30",children:"30"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Unit"}),e.jsxs(g,{value:Fs,onValueChange:s=>He(s),children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"minutes",children:"Minutes"}),e.jsx(o,{value:"hours",children:"Hours"})]})]})]})]}):e.jsxs("div",{children:[e.jsx(h,{children:"Time of Day (IST)"}),e.jsxs("div",{className:"flex gap-2 mt-1",children:[e.jsxs(g,{value:(()=>{const[s]=J.split(":").map(Number);return(s===0?12:s>12?s-12:s).toString()})(),onValueChange:s=>{const[a,t]=J.split(":").map(Number),l=a>=12;let r=parseInt(s);l?r=r===12?12:r+12:r=r===12?0:r,K(`${r.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`)},children:[e.jsx(f,{className:"w-20",children:e.jsx(v,{})}),e.jsx(y,{children:[12,1,2,3,4,5,6,7,8,9,10,11].map(s=>e.jsx(o,{value:s.toString(),children:s},s))})]}),e.jsx("span",{className:"flex items-center",children:":"}),e.jsxs(g,{value:J.split(":")[1]||"00",onValueChange:s=>{const[a]=J.split(":").map(Number);K(`${a.toString().padStart(2,"0")}:${s}`)},children:[e.jsx(f,{className:"w-20",children:e.jsx(v,{})}),e.jsx(y,{children:["00","15","30","45"].map(s=>e.jsx(o,{value:s,children:s},s))})]}),e.jsxs(g,{value:parseInt(J.split(":")[0])>=12?"PM":"AM",onValueChange:s=>{const[a,t]=J.split(":").map(Number),l=a===0?12:a>12?a-12:a;let r;s==="PM"?r=l===12?12:l+12:r=l===12?0:l,K(`${r.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`)},children:[e.jsx(f,{className:"w-20",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"AM",children:"AM"}),e.jsx(o,{value:"PM",children:"PM"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Lookback Days"}),e.jsx(T,{type:"number",min:"1",max:"30",value:zs,onChange:s=>qe(parseInt(s.target.value)||1),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Incremental download from watchlist. Lookback used only for new symbols."})]})]}),e.jsxs(Ce,{children:[e.jsx(i,{variant:"outline",onClick:()=>{de(!1),ve()},children:"Cancel"}),e.jsxs(i,{onClick:Ra,disabled:Is,children:[Is&&e.jsx(q,{className:"h-4 w-4 animate-spin mr-1"}),R?"Update":"Create"]})]})]})}),e.jsx(ye,{open:ka,onOpenChange:ee,children:e.jsxs(Ne,{className:"sm:max-w-md",children:[e.jsxs(be,{children:[e.jsx(we,{children:"Bulk Add Symbols"}),e.jsx(Se,{children:"Add multiple symbols at once. One per line: SYMBOL,EXCHANGE"})]}),e.jsx(kt,{placeholder:`RELIANCE,NSE
INFY,NSE
NIFTY24DEC25000CE,NFO`,value:Ms,onChange:s=>Ps(s.target.value),rows:8}),e.jsxs(Ce,{children:[e.jsx(i,{variant:"outline",onClick:()=>ee(!1),children:"Cancel"}),e.jsxs(i,{onClick:qa,disabled:Ls,children:[Ls&&e.jsx(q,{className:"h-4 w-4 animate-spin mr-1"}),"Add Symbols"]})]})]})}),e.jsx(ye,{open:Da,onOpenChange:me,children:e.jsxs(Ne,{className:"sm:max-w-md",children:[e.jsxs(be,{children:[e.jsx(we,{children:"Import Data"}),e.jsx(Se,{children:"Upload a CSV or Parquet file with OHLCV data"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Symbol"}),e.jsx(T,{value:Qe,onChange:s=>Js(s.target.value.toUpperCase()),placeholder:"RELIANCE",className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Exchange"}),e.jsxs(g,{value:Vs,onValueChange:Ea,children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsx(y,{children:te.map(s=>e.jsx(o,{value:s,children:s},s))})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Interval"}),e.jsxs(g,{value:Us,onValueChange:Ta,children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsx(y,{children:(Oe?.storage_intervals||["1m","D"]).map(s=>e.jsx(o,{value:s,children:s==="1m"?"1 Minute":s==="D"?"Daily":s},s))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Only 1min and Daily data can be stored"})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Data File"}),e.jsx(T,{ref:Ze,type:"file",accept:".csv,.parquet",onChange:at,className:"mt-1"}),xe&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Selected: ",xe.name]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Download sample: "," ",e.jsx("a",{href:"/historify/api/sample/csv",className:"text-primary hover:underline",children:"CSV"})," | ",e.jsx("a",{href:"/historify/api/sample/parquet",className:"text-primary hover:underline",children:"Parquet"})]})]})]}),e.jsxs(Ce,{children:[e.jsx(i,{variant:"outline",onClick:()=>me(!1),children:"Cancel"}),e.jsxs(i,{onClick:tt,disabled:Xs,children:[Xs&&e.jsx(q,{className:"h-4 w-4 animate-spin mr-1"}),"Upload"]})]})]})}),e.jsx(ye,{open:Fa,onOpenChange:pe,children:e.jsxs(Ne,{className:"sm:max-w-xl",children:[e.jsxs(be,{children:[e.jsx(we,{children:"Export Data"}),e.jsx(Se,{children:"Export historical data with multiple timeframes"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{children:"Export Format"}),e.jsxs(g,{value:Ke,onValueChange:s=>Aa(s),children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"zip",children:"ZIP Archive (Recommended)"}),e.jsx(o,{value:"csv",children:"CSV (Single file)"}),e.jsx(o,{value:"parquet",children:"Parquet (ZSTD)"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{children:"Symbols to Export"}),e.jsxs(g,{value:I,onValueChange:s=>za(s),children:[e.jsx(f,{className:"mt-1",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsxs(o,{value:"all",children:["All (",F.length," symbols)"]}),e.jsxs(o,{value:"selected",children:["Selected (",O.size,")"]})]})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"mb-2 block",children:"Select Timeframes to Export"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Intraday computed from 1m data. W/M/Q/Y computed from Daily data."}),e.jsx("div",{className:"grid grid-cols-5 sm:grid-cols-10 gap-2",children:["1m","5m","15m","30m","1h","D","W","M","Q","Y"].map(s=>{const a=["5m","15m","30m","1h"].includes(s),t=["W","M","Q","Y"].includes(s),l=a||t,r=$.has(s);return e.jsxs("div",{className:z("flex flex-col items-center p-2 rounded-lg border cursor-pointer transition-colors",r?"bg-primary text-primary-foreground border-primary":"bg-muted/50 hover:bg-muted"),onClick:()=>{je(w=>{const S=new Set(w);return S.has(s)?S.delete(s):S.add(s),S})},children:[e.jsx(Y,{checked:r,className:z("mb-1",r&&"border-primary-foreground"),onClick:w=>w.stopPropagation(),onCheckedChange:()=>{je(w=>{const S=new Set(w);return S.has(s)?S.delete(s):S.add(s),S})}}),e.jsx("span",{className:"font-medium text-sm",children:s}),e.jsx("span",{className:z("text-[10px]",r?"opacity-80":"text-muted-foreground"),children:l?"Computed":"Stored"})]},s)})}),e.jsxs("div",{className:"mt-3 pt-3 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Custom:"}),e.jsx(T,{type:"number",min:"1",max:"999",value:es,onChange:s=>Ia(s.target.value),className:"h-8 w-14 text-center",placeholder:"1"}),e.jsxs(g,{value:se,onValueChange:s=>Oa(s),children:[e.jsx(f,{className:"w-20 h-8",children:e.jsx(v,{})}),e.jsxs(y,{children:[e.jsx(o,{value:"m",children:"min"}),e.jsx(o,{value:"h",children:"hr"}),e.jsx(o,{value:"W",children:"Week"}),e.jsx(o,{value:"M",children:"Month"}),e.jsx(o,{value:"Q",children:"Qtr"}),e.jsx(o,{value:"Y",children:"Year"})]})]}),e.jsxs(i,{variant:"outline",size:"sm",className:"h-8",onClick:()=>{const s=parseInt(es)||1;let a;["W","M","Q","Y"].includes(se)?a=s===1?se:`${s}${se}`:a=`${es}${se}`,s>0&&je(t=>new Set([...t,a]))},children:[e.jsx($e,{className:"h-4 w-4 mr-1"}),"Add"]})]}),Array.from($).filter(s=>!["1m","5m","15m","30m","1h","D","W","M","Q","Y"].includes(s)).length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:Array.from($).filter(s=>!["1m","5m","15m","30m","1h","D","W","M","Q","Y"].includes(s)).map(s=>e.jsxs(x,{variant:"secondary",className:"cursor-pointer hover:bg-destructive hover:text-destructive-foreground",onClick:()=>{je(a=>{const t=new Set(a);return t.delete(s),t})},children:[s," ",e.jsx(xs,{className:"h-3 w-3 ml-1"})]},s))})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(h,{className:"text-sm",children:[I==="selected"?"Selected Symbols":"All Symbols"," (",I==="selected"?O.size:F.length,")"]}),I==="selected"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 text-xs",onClick:()=>{const s=F.map(a=>`${a.symbol}:${a.exchange}`);V(new Set(s))},children:"Select All"}),e.jsx(i,{variant:"ghost",size:"sm",className:"h-6 text-xs",onClick:()=>V(new Set),children:"Clear"})]})]}),e.jsx(_e,{className:"h-40 border rounded-md p-2",children:e.jsx("div",{className:"space-y-1",children:F.map(s=>{const a=`${s.symbol}:${s.exchange}`,t=O.has(a);return I==="all"?e.jsxs("div",{className:"flex items-center justify-between text-sm py-1 border-b border-border/50 last:border-0",children:[e.jsx("span",{className:"font-medium",children:s.symbol}),e.jsx(x,{variant:"outline",className:"text-xs",children:s.exchange})]},a):e.jsxs("div",{className:z("flex items-center gap-2 text-sm py-1.5 px-2 rounded cursor-pointer transition-colors border-b border-border/50 last:border-0",t?"bg-primary/10":"hover:bg-muted/50"),onClick:()=>{V(l=>{const r=new Set(l);return r.has(a)?r.delete(a):r.add(a),r})},children:[e.jsx(Y,{checked:t,onCheckedChange:()=>{V(l=>{const r=new Set(l);return r.has(a)?r.delete(a):r.add(a),r})},onClick:l=>l.stopPropagation()}),e.jsx("span",{className:"font-medium flex-1",children:s.symbol}),e.jsx(x,{variant:"outline",className:"text-xs",children:s.exchange})]},a)})})})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Export Summary:"}),e.jsxs("span",{className:"font-medium",children:[I==="selected"?O.size:F.length," symbols x ",$.size," timeframe",$.size!==1?"s":""]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Files: ",Array.from($).sort().join(", ")]})]})]}),e.jsxs(Ce,{children:[e.jsx(i,{variant:"outline",onClick:()=>pe(!1),children:"Cancel"}),e.jsxs(i,{onClick:lt,disabled:Ys||$.size===0||I==="selected"&&O.size===0,children:[Ys&&e.jsx(q,{className:"h-4 w-4 animate-spin mr-1"}),"Export (",$.size," timeframe",$.size!==1?"s":"",")"]})]})]})}),e.jsx(jt,{open:$a,onOpenChange:Ge,children:e.jsxs(gt,{children:[e.jsxs(ft,{children:[e.jsx(vt,{children:"Delete Data"}),e.jsxs(yt,{children:["Are you sure you want to delete all data for ",ue?.symbol," (",ue?.exchange,")? This action cannot be undone."]})]}),e.jsxs(Nt,{children:[e.jsx(bt,{children:"Cancel"}),e.jsx(wt,{onClick:st,className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})})]})}export{cl as default};
