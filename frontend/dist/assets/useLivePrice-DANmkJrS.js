import{r as p}from"./vendor-react--vsXx8_n.js";import{t as T}from"./trading-CYt6IuMe.js";import{a as V,u as F,b as U}from"./useMarketStatus-DWFRwrtR.js";import{d as W}from"./index-6sWrLAWs.js";function X(t,g={}){const{enabled:n=!0,staleThreshold:c=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:i=3e4,pauseWhenHidden:l=!0,pauseDelay:y=5e3}=g,{apiKey:d}=W(),{isMarketOpen:M,isAnyMarketOpen:A}=V(),{isVisible:b,wasHidden:q,timeSinceHidden:Q}=F(),S=A(),[k,C]=p.useState(new Map),D=p.useRef(Date.now()),H=p.useMemo(()=>t.map(e=>({symbol:e.symbol,exchange:e.exchange})),[t]),{data:m,isConnected:E,isPaused:L}=U({symbols:H,mode:"LTP",enabled:n&&t.length>0,pauseWhenHidden:l,pauseDelay:y}),I=E&&S&&!L,f=p.useCallback(async()=>{if(!(!d||t.length===0||!s))try{const e=t.map(a=>({symbol:a.symbol,exchange:a.exchange})),h=await T.getMultiQuotes(d,e);if(h.status==="success"&&h.results){const a=new Map;h.results.forEach(o=>{const r=`${o.exchange}:${o.symbol}`;o.data&&a.set(r,o.data)}),C(a)}}catch{console.debug("MultiQuotes fetch failed, using cached/REST data")}},[d,t,s]);return p.useEffect(()=>{if(!n||t.length===0||!s||l&&!b)return;f(),D.current=Date.now();const e=setInterval(()=>{f(),D.current=Date.now()},i);return()=>clearInterval(e)},[n,t.length,s,f,i,l,b]),p.useEffect(()=>{!q||!b||!s||!n||Q>i&&(f(),D.current=Date.now())},[q,b,Q,i,s,n,f]),{data:p.useMemo(()=>t.map(e=>{const h=`${e.exchange}:${e.symbol}`,a=m.get(h),o=k.get(h),r=e.quantity||0,v=e.average_price||0,O=M(e.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<c,$=!O&&o?.ltp;let u,P="rest";if(O&&a?.data?.ltp?(u=a.data.ltp,P="websocket"):$&&o?.ltp?(u=o.ltp,P="multiquotes"):(u=e.ltp,P="rest"),r===0)return{...e,_dataSource:"rest"};let w=e.pnl||0,_=e.pnlpercent||0;const z=e.today_realized_pnl||0;if(u&&v>0){let x;r>0?x=(u-v)*r:x=(v-u)*Math.abs(r),w=z+x;const R=Math.abs(v*r);_=R>0?w/R*100:0}return{...e,ltp:u,pnl:w,pnlpercent:_,_dataSource:P}}),[t,m,k,M,c]),isLive:I,isConnected:E,isPaused:L,isAnyMarketOpen:S,multiQuotes:k,refreshMultiQuotes:f}}function Y(t,g){if(!g)return null;let n=0,c=0,s=0;t.forEach(l=>{n+=l.pnl||0;const y=l.average_price||0,d=l.quantity||0,M=l.ltp||y;c+=y*d,s+=M*d});const i=c>0?n/c*100:0;return{...g,totalholdingvalue:s,totalinvvalue:c,totalprofitandloss:n,totalpnlpercentage:i}}export{Y as c,X as u};
