import{r as a,j as e}from"./vendor-react-CCyQGCED.js";import{s as f,B as v,e as E}from"./index-NHrG-O_Z.js";import{C as R,d as F}from"./card-Cn20bp_v.js";import{S as $,a as K,b as O,c as U,d as G}from"./select-DcHsBqkV.js";import{T as Q,a as Z,b as w,d as J,e as l,c as W}from"./table-Crau903Y.js";import{S as X,a7 as Y,a8 as ee,n as se,a4 as te}from"./vendor-icons-CCn_k3dF.js";import{c as ae,L as le}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const re=[25,50,100,250,500,"all"];function pe(){const[i]=ae(),[d,b]=a.useState([]),[L,P]=a.useState(!0),[z,y]=a.useState(null),[m,M]=a.useState(null),[S,T]=a.useState("asc"),[o,C]=a.useState(1),[t,B]=a.useState(25);a.useEffect(()=>{q()},[]);const q=async()=>{P(!0),y(null);try{const s=new URLSearchParams,c=i.get("symbol"),x=i.get("exchange"),h=i.get("underlying"),u=i.get("expiry"),p=i.get("instrumenttype"),g=i.get("strike_min"),j=i.get("strike_max");c&&s.append("q",c),x&&s.append("exchange",x),h&&s.append("underlying",h),u&&s.append("expiry",u),p&&s.append("instrumenttype",p),g&&s.append("strike_min",g),j&&s.append("strike_max",j);const N=await fetch(`/search/api/search?${s.toString()}`,{credentials:"include"});if(N.ok){const H=await N.json();b(H.results||[])}else N.status===401||N.status===403?(y("Session expired. Please log in again."),f.error("Session expired. Please log in again.","system"),b([])):(y("Search failed. Please try again."),f.error("Failed to search symbols","system"),b([]))}catch{y("Failed to search symbols. Please check your connection."),f.error("Failed to search symbols","system"),b([])}finally{P(!1)}},I=s=>{navigator.clipboard.writeText(s).then(()=>{f.success("Symbol copied to clipboard","clipboard")}).catch(()=>{f.error("Failed to copy symbol","clipboard")})},V=s=>{m===s?T(S==="asc"?"desc":"asc"):(M(s),T("asc"))},r=a.useMemo(()=>m?[...d].sort((s,c)=>{const x=s[m],h=c[m];if(["lotsize","token","freeze_qty"].includes(m)){const g=parseFloat(String(x??0).replace(/[^0-9.-]/g,""))||0,j=parseFloat(String(h??0).replace(/[^0-9.-]/g,""))||0;return S==="asc"?g-j:j-g}const u=String(x??""),p=String(h??"");return S==="asc"?u.localeCompare(p):p.localeCompare(u)}):d,[d,m,S]),_=a.useMemo(()=>{if(t==="all")return r;const s=(o-1)*t;return r.slice(s,s+t)},[r,o,t]),k=a.useMemo(()=>t==="all"?1:Math.ceil(r.length/t),[r.length,t]),A=t==="all"?1:(o-1)*t+1,D=t==="all"?r.length:Math.min(o*t,r.length),n=({column:s,label:c})=>e.jsx(W,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>V(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[c,e.jsx(te,{className:"h-4 w-4 opacity-50"})]})});return L?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsx(R,{children:e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Results"}),e.jsx(v,{asChild:!0,children:e.jsxs(le,{to:"/search/token",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"New Search"]})})]}),e.jsxs("div",{className:"inline-flex flex-col items-center bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Found"}),e.jsx("div",{className:"text-3xl font-bold text-primary",children:d.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"matching symbols"})]})]})}),e.jsx(R,{children:e.jsx(F,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Q,{children:[e.jsx(Z,{children:e.jsxs(w,{children:[e.jsx(n,{column:"symbol",label:"Symbol"}),e.jsx(n,{column:"brsymbol",label:"Broker Symbol"}),e.jsx(n,{column:"name",label:"Name"}),e.jsx(n,{column:"exchange",label:"Exchange"}),e.jsx(n,{column:"brexchange",label:"Broker Exch"}),e.jsx(n,{column:"token",label:"Token"}),e.jsx(n,{column:"lotsize",label:"Lot Size"}),e.jsx(n,{column:"freeze_qty",label:"Freeze Qty"})]})}),e.jsx(J,{children:_.length===0?e.jsx(w,{children:e.jsx(l,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:z?e.jsx("span",{className:"text-destructive",children:z}):"No results found"})}):_.map((s,c)=>e.jsxs(w,{className:"hover:bg-muted/50",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:s.symbol}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-60 hover:opacity-100",onClick:()=>I(s.symbol),title:"Copy symbol",children:e.jsx(Y,{className:"h-3 w-3"})})]})}),e.jsx(l,{children:s.brsymbol}),e.jsx(l,{className:"text-muted-foreground max-w-[200px] truncate",children:s.name}),e.jsx(l,{children:e.jsx(E,{variant:"outline",children:s.exchange})}),e.jsx(l,{children:e.jsx(E,{variant:"secondary",children:s.brexchange})}),e.jsx(l,{className:"font-mono text-sm",children:s.token}),e.jsx(l,{children:s.lotsize??"-"}),e.jsx(l,{children:s.freeze_qty??"-"})]},c))})]})})})}),d.length>25&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",A," to ",D," of ",r.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>C(s=>Math.max(1,s-1)),disabled:o===1,children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",o," of ",k]}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>C(s=>Math.min(k,s+1)),disabled:o>=k,children:e.jsx(se,{className:"h-4 w-4"})})]}),e.jsxs($,{value:String(t),onValueChange:s=>{B(s==="all"?"all":Number(s)),C(1)},children:[e.jsx(K,{className:"w-36",children:e.jsx(O,{})}),e.jsx(U,{children:re.map(s=>e.jsx(G,{value:String(s),children:s==="all"?"Show All":`${s} per page`},s))})]})]})]})}export{pe as default};
