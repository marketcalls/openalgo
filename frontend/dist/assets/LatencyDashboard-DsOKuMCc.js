import{r as j,j as e}from"./vendor-react-CCyQGCED.js";import{w as _,s as k,B as b,e as i}from"./index-D0023jFM.js";import{C as c,d as o,a as f,b as p,c as g}from"./card-CDguRyHx.js";import{D as G,b as U,c as Z,d as z,e as W}from"./dialog-ZgnPSmJp.js";import{P as C}from"./progress-BcnjzSlC.js";import{T,a as S,b as u,c as r,d as D,e as a}from"./table-BKP8E0nV.js";import{N as q,bo as F,Y as K,u as V,Z as X,z as Y,a5 as J}from"./vendor-icons-CCn_k3dF.js";import{L as Q}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function oe(){const[L,A]=j.useState(!0),[m,O]=j.useState([]),[n,P]=j.useState(null),[d,v]=j.useState(null),[y,w]=j.useState(!1);j.useEffect(()=>{N();const s=setInterval(N,3e4);return()=>clearInterval(s)},[]);const N=async()=>{try{const[s,l]=await Promise.all([_.get("/latency/api/logs"),_.get("/latency/api/stats")]);O(Array.isArray(s.data)?s.data:[]),P(l.data)}catch{k.error("Failed to load latency data","monitoring")}finally{A(!1)}},R=async()=>{w(!0),await N(),w(!1),k.success("Data refreshed","monitoring")},B=()=>{window.open("/latency/export","_blank")},h=s=>s<150?{label:"Excellent",color:"text-green-500",variant:"secondary"}:s<250?{label:"Good",color:"text-yellow-500",variant:"outline"}:s<400?{label:"Acceptable",color:"text-orange-500",variant:"outline"}:{label:"Slow",color:"text-red-500",variant:"destructive"},E=s=>{try{return new Date(s).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}catch{return s}},$=()=>{const s=m.filter(x=>(x.total_latency_ms||0)<150).length,l=m.filter(x=>(x.total_latency_ms||0)>=150&&(x.total_latency_ms||0)<250).length,I=m.filter(x=>(x.total_latency_ms||0)>=250&&(x.total_latency_ms||0)<400).length,M=m.filter(x=>(x.total_latency_ms||0)>=400).length,H=m.length||1;return{excellent:s,good:l,acceptable:I,slow:M,total:H}};if(L)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const t=$();return e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Q,{to:"/dashboard",className:"text-muted-foreground hover:text-foreground",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(F,{className:"h-6 w-6"}),"Order Latency Monitor"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Track how fast brokers confirm your orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(b,{variant:"outline",onClick:R,disabled:y,children:[e.jsx(K,{className:`h-4 w-4 mr-2 ${y?"animate-spin":""}`}),"Refresh"]}),e.jsxs(b,{onClick:B,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Export to CSV"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Orders Tracked"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:n?.total_orders||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"All time"})]}),e.jsx(X,{className:"h-8 w-8 text-primary opacity-20"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Success Rate"}),e.jsxs("p",{className:"text-2xl font-bold text-green-500",children:[(n?.success_rate||0).toFixed(1),"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[n?.failed_orders||0," failed"]})]}),e.jsx(Y,{className:"h-8 w-8 text-green-500 opacity-20"})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Confirmation Time"}),e.jsxs("p",{className:`text-2xl font-bold ${h(n?.avg_total||0).color}`,children:[(n?.avg_total||0).toFixed(2),"ms"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"End-to-end order confirmation"})]}),e.jsx(F,{className:`h-8 w-8 ${h(n?.avg_total||0).color} opacity-20`})]})})}),e.jsx(c,{children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Fast Orders"}),e.jsxs("p",{className:`text-2xl font-bold ${(n?.sla_150ms||0)>=95?"text-green-500":(n?.sla_150ms||0)>=85?"text-yellow-500":"text-red-500"}`,children:[(n?.sla_150ms||0).toFixed(1),"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Under 150ms (Target: 95%)"})]}),e.jsxs("div",{className:"relative h-16 w-16",children:[e.jsx(C,{value:n?.sla_150ms||0,className:"h-16 w-16 rounded-full"}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold",children:[Math.round(n?.sla_150ms||0),"%"]})]})]})})})]}),e.jsxs(c,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"Performance Levels"}),e.jsx(g,{children:"Total end-to-end time from order submission to confirmation"})]}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"bg-green-500",children:"Excellent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Under 150ms"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"bg-yellow-500",children:"Good"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"150-250ms"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{className:"bg-orange-500",children:"Acceptable"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"250-400ms"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(i,{variant:"destructive",children:"Slow"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Over 400ms"})]})]})})]}),e.jsxs(c,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"Latency Distribution"}),e.jsx(g,{children:"Breakdown of order speeds"})]}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Excellent (<150ms)"}),e.jsx("span",{className:"font-bold",children:t.excellent})]}),e.jsx("div",{className:"h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500",style:{width:`${t.excellent/t.total*100}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.excellent/t.total*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Good (150-250ms)"}),e.jsx("span",{className:"font-bold",children:t.good})]}),e.jsx("div",{className:"h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-500",style:{width:`${t.good/t.total*100}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.good/t.total*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Acceptable (250-400ms)"}),e.jsx("span",{className:"font-bold",children:t.acceptable})]}),e.jsx("div",{className:"h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500",style:{width:`${t.acceptable/t.total*100}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.acceptable/t.total*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Slow (>400ms)"}),e.jsx("span",{className:"font-bold",children:t.slow})]}),e.jsx("div",{className:"h-4 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-red-500",style:{width:`${t.slow/t.total*100}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(t.slow/t.total*100).toFixed(1),"%"]})]})]})})]}),n?.broker_stats&&Object.keys(n.broker_stats).length>0&&e.jsxs(c,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"Broker Performance Comparison"}),e.jsx(g,{children:"Latency breakdown by broker"})]}),e.jsx(o,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(u,{children:[e.jsx(r,{children:"Broker"}),e.jsx(r,{children:"Avg Latency"}),e.jsx(r,{children:"Median (P50)"}),e.jsx(r,{children:"Worst 1% (P99)"}),e.jsx(r,{children:"Fast Orders %"}),e.jsx(r,{children:"Total Orders"}),e.jsx(r,{children:"Performance"})]})}),e.jsx(D,{children:Object.entries(n.broker_stats).map(([s,l])=>e.jsxs(u,{children:[e.jsx(a,{className:"font-semibold",children:s}),e.jsx(a,{children:e.jsxs(i,{variant:h(l.avg_total).variant,children:[l.avg_total?.toFixed(2),"ms"]})}),e.jsxs(a,{children:[l.p50_total?.toFixed(2),"ms"]}),e.jsxs(a,{children:[l.p99_total?.toFixed(2),"ms"]}),e.jsxs(a,{children:[l.sla_150ms?.toFixed(1),"%"]}),e.jsx(a,{children:l.total_orders}),e.jsx(a,{children:e.jsx("div",{className:"w-24 h-2 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${l.avg_total<150?"bg-green-500":l.avg_total<250?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.max(0,Math.min(100,(400-l.avg_total)/400*100))}%`}})})})]},s))})]})})})]}),e.jsxs(c,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"Recent Orders"}),e.jsxs(g,{children:[m.length," orders tracked"]})]}),e.jsx(o,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(u,{children:[e.jsx(r,{children:"Time"}),e.jsx(r,{children:"Order ID"}),e.jsx(r,{children:"Broker"}),e.jsx(r,{children:"Symbol"}),e.jsx(r,{children:"Type"}),e.jsx(r,{children:"Latency"}),e.jsx(r,{children:"Status"}),e.jsx(r,{className:"w-[80px]"})]})}),e.jsx(D,{children:m.length===0?e.jsx(u,{children:e.jsx(a,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"No order latency data available"})}):m.map(s=>{const l=h(s.total_latency_ms||0);return e.jsxs(u,{children:[e.jsx(a,{className:"text-sm",children:E(s.timestamp)}),e.jsx(a,{className:"font-mono text-sm",children:s.order_id}),e.jsx(a,{children:s.broker||"N/A"}),e.jsx(a,{className:"font-semibold",children:s.symbol||"N/A"}),e.jsx(a,{children:e.jsx(i,{variant:"outline",children:s.order_type})}),e.jsx(a,{children:e.jsxs(i,{variant:l.variant,children:[(s.total_latency_ms||0).toFixed(2),"ms"]})}),e.jsx(a,{children:s.status==="SUCCESS"?e.jsx(i,{className:"bg-green-500",children:"SUCCESS"}):e.jsx(i,{variant:"destructive",children:s.status})}),e.jsx(a,{children:e.jsx(b,{size:"sm",variant:"ghost",onClick:()=>v(s),children:"Details"})})]},s.id)})})]})})})]}),e.jsx(G,{open:!!d,onOpenChange:()=>v(null),children:e.jsxs(U,{className:"max-w-2xl",children:[e.jsxs(Z,{children:[e.jsx(z,{children:"Order Latency Breakdown"}),e.jsxs(W,{children:["Detailed latency analysis for order ",d?.order_id]})]}),d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{children:e.jsxs(o,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Order ID"}),e.jsx("p",{className:"font-mono font-semibold",children:d.order_id})]})}),e.jsx(c,{children:e.jsxs(o,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Performance"}),e.jsx("p",{className:`text-lg font-bold ${h(d.total_latency_ms).color}`,children:h(d.total_latency_ms).label})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Latency Breakdown"}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Total Confirmation Time"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"What you experience end-to-end"})]}),e.jsxs("span",{className:"text-lg font-bold",children:[(d.total_latency_ms||0).toFixed(2),"ms"]})]}),e.jsx(C,{value:Math.min(100,(d.total_latency_ms||0)/500*100)})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This consists of:"}),e.jsxs("div",{className:"bg-secondary/50 p-3 rounded-lg ml-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-sm",children:"Broker API Call"}),e.jsx(i,{variant:"outline",className:"ml-2 text-xs",children:"HTTP"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Network latency + broker processing"})]}),e.jsxs("span",{className:"font-bold",children:[(d.rtt_ms||0).toFixed(2),"ms"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 space-y-0.5",children:[e.jsx("p",{children:"Network round-trip time"}),e.jsx("p",{children:"Broker risk checks & validation"}),e.jsx("p",{children:"Exchange order submission"})]})]}),e.jsxs("div",{className:"bg-secondary/50 p-3 rounded-lg ml-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-sm",children:"Platform Processing"}),e.jsx(i,{variant:"outline",className:"ml-2 text-xs",children:"OpenAlgo"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Authentication, validation & logging"})]}),e.jsxs("span",{className:"font-bold",children:[(d.overhead_ms||0).toFixed(2),"ms"]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-2 space-y-0.5",children:[e.jsx("p",{children:"API key authentication (~5-10ms)"}),e.jsx("p",{children:"Request validation (~3-5ms)"}),e.jsx("p",{children:"Symbol lookup & transformation (~5-10ms)"}),e.jsx("p",{children:"Latency database logging (~10-15ms)"}),e.jsx("p",{children:"Response formatting (~5-10ms)"})]})]}),e.jsx("div",{className:"bg-primary/10 p-4 rounded-lg border-2 border-primary",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-bold",children:"Total Latency"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:[(d.total_latency_ms||0).toFixed(2),"ms"]})]})}),d.error&&e.jsxs("div",{className:"bg-destructive/10 p-4 rounded-lg border border-destructive flex items-center gap-3",children:[e.jsx(J,{className:"h-5 w-5 text-destructive"}),e.jsx("span",{className:"text-sm",children:d.error})]})]})]})]})})]})}export{oe as default};
