import{r as o,j as e,a as at}from"./vendor-react--vsXx8_n.js";import{v as Te,D as Ve,i as qe,B as R,j as Ae,y as ve,z as Pe,A as je,m as _e,C as Ie,c as j,e as ze,d as Ye,s as ce}from"./index-ISylyP_4.js";import{u as rt,a as $e}from"./useMarketData-LIMTcZ3_.js";import{g as nt,$ as lt,ac as it,aR as ct,aS as ot,R as Me,c as dt,az as ut,aB as mt}from"./vendor-icons-C0P7QAK9.js";import{D as Qe,a as xt,b as Xe,c as We,d as He,e as pt,f as Ke,g as ht}from"./dialog-DPB_50U6.js";import{S as Fe}from"./scroll-area-DgCj0aGV.js";import{I as Se}from"./input-Bopr5WDg.js";import{L as ae}from"./label-BFhc2lBI.js";import{S as ue,a as me,b as xe,c as pe,d as he}from"./select-Bz0NbqB8.js";import{t as we}from"./trading-ByTPhnX5.js";import{C as ft,b as gt,a as bt}from"./collapsible-BJ9rSfA8.js";import{C as re,d as ne}from"./card-C3uzSxQU.js";import{T as jt,a as yt,b as Ee,c as le,d as Nt,e as De}from"./table-DjbZSh69.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DkDlinVE.js";function vt(s,t,a,r,d,u={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:l,refreshInterval:h=3e4,pauseWhenHidden:y=!0}=u,{isVisible:C}=rt(),[i,n]=o.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),x=o.useRef(null),N=o.useRef(null),f=l&&(!y||C),O=o.useCallback(async()=>{if(!(!s||!t||!a||!r)&&!N.current){n(D=>({...D,isLoading:!0}));try{const D=new AbortController;N.current=D;const k=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:a,expiry_date:r,strike_count:d}),signal:D.signal});if(!k.ok)throw new Error(`HTTP error! status: ${k.status}`);const m=await k.json();m.status==="success"?n(w=>({...w,data:m,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):n(w=>({...w,isLoading:!1,error:m.message||"Failed to fetch option chain"}))}catch(D){D instanceof Error&&(D.name==="AbortError"?N.current===null&&n(k=>({...k,isLoading:!1})):n(k=>({...k,isLoading:!1,error:D.message||"Connection error",isConnected:!1})))}finally{N.current=null}}},[s,t,a,r,d]);o.useEffect(()=>{if(!f){x.current&&(clearInterval(x.current),x.current=null),n(D=>({...D,isPaused:!!l}));return}return n(D=>({...D,isConnected:!0,isPaused:!1})),O(),x.current=setInterval(O,h),()=>{x.current&&(clearInterval(x.current),x.current=null),N.current&&(N.current.abort(),N.current=null)}},[f,O,h,l]);const M=o.useCallback(()=>{O()},[O]);return{...i,refetch:M}}function ie(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function Ct(s,t,a,r,d,u,l={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:h,oiRefreshInterval:y=3e4,pauseWhenHidden:C=!0}=l,[i,n]=o.useState(null),[x,N]=o.useState(null),{data:f,isLoading:O,isConnected:M,isPaused:D,error:k,lastUpdate:m,refetch:w}=vt(s,t,a,d,u,{enabled:h,refreshInterval:y,pauseWhenHidden:C}),E=o.useMemo(()=>{const v=[],q=r==="BFO"?"BSE_INDEX":"NSE_INDEX";if(v.push({symbol:t,exchange:q}),f?.chain)for(const H of f.chain)H.ce?.symbol&&v.push({symbol:H.ce.symbol,exchange:r}),H.pe?.symbol&&v.push({symbol:H.pe.symbol,exchange:r});return v},[f?.chain,r,t]),{data:L,isConnected:P,isAuthenticated:g,isPaused:U}=$e({symbols:E,mode:"Depth",enabled:h&&E.length>0,pauseWhenHidden:C}),$=o.useRef(0);o.useEffect(()=>{if(!f){n(null);return}if(L.size===0){n(f);return}const v=f.chain.map(b=>{const Z={...b};if(b.ce?.symbol){const A=`${r}:${b.ce.symbol}`,T=L.get(A);if(T?.data){const Q=T.data.depth?.buy?.[0],z=T.data.depth?.sell?.[0],c=b.ce.tick_size;Z.ce={...b.ce,ltp:ie(T.data.ltp,c)??b.ce.ltp,bid:ie(Q?.price??T.data.bid_price,c)??b.ce.bid,ask:ie(z?.price??T.data.ask_price,c)??b.ce.ask,bid_qty:Q?.quantity??T.data.bid_size??b.ce.bid_qty??0,ask_qty:z?.quantity??T.data.ask_size??b.ce.ask_qty??0}}}if(b.pe?.symbol){const A=`${r}:${b.pe.symbol}`,T=L.get(A);if(T?.data){const Q=T.data.depth?.buy?.[0],z=T.data.depth?.sell?.[0],c=b.pe.tick_size;Z.pe={...b.pe,ltp:ie(T.data.ltp,c)??b.pe.ltp,bid:ie(Q?.price??T.data.bid_price,c)??b.pe.bid,ask:ie(z?.price??T.data.ask_price,c)??b.pe.ask,bid_qty:Q?.quantity??T.data.bid_size??b.pe.bid_qty??0,ask_qty:z?.quantity??T.data.ask_size??b.pe.ask_qty??0}}}return Z});let q=!1;for(const[,b]of L)if(b.lastUpdate&&b.lastUpdate>$.current){q=!0,$.current=b.lastUpdate;break}q&&N(new Date);const S=`${r==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${t}`,J=L.get(S)?.data?.ltp??f.underlying_ltp;n({...f,underlying_ltp:J,chain:v})},[f,L,r,t]);const se=P&&g&&E.length>0,G=D||U,te=o.useMemo(()=>!m&&!x?null:m?x&&x>m?x:m:x,[m,x]);return{data:i,isLoading:O,isConnected:M,isStreaming:se,isPaused:G,error:k,lastUpdate:te,streamingSymbols:E.length,refetch:w}}const V=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],St=V.map(s=>s.key),wt=V.filter(s=>s.defaultVisible).map(s=>s.key),K={visibleColumns:wt,columnOrder:St,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Ge="openalgo_option_chain_prefs";function Dt(){if(typeof window>"u")return K;try{const s=localStorage.getItem(Ge);if(!s)return K;const t=JSON.parse(s),a=new Set(V.map(l=>l.key)),r=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(l=>a.has(l)):K.visibleColumns;r.includes("strike")||r.push("strike");const d=Array.isArray(t.columnOrder)?t.columnOrder.filter(l=>a.has(l)):K.columnOrder,u=new Set(d);return K.columnOrder.forEach(l=>{u.has(l)||d.push(l)}),{visibleColumns:r,columnOrder:d,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:K.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:K.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:K.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:K.barStyle}}catch{return K}}function kt(s){if(!(typeof window>"u"))try{localStorage.setItem(Ge,JSON.stringify(s))}catch{}}function _t(){const[s,t]=o.useState(()=>Dt());o.useEffect(()=>{kt(s)},[s]);const a=o.useCallback(n=>{n!=="strike"&&t(x=>{const f=x.visibleColumns.includes(n)?x.visibleColumns.filter(O=>O!==n):[...x.visibleColumns,n];return{...x,visibleColumns:f}})},[]),r=o.useCallback(n=>{t(x=>({...x,columnOrder:n}))},[]),d=o.useCallback(n=>{t(x=>({...x,strikeCount:n}))},[]),u=o.useCallback(n=>{t(x=>({...x,selectedUnderlying:n}))},[]),l=o.useCallback(n=>{t(x=>({...x,barDataSource:n}))},[]),h=o.useCallback(n=>{t(x=>({...x,barStyle:n}))},[]),y=o.useCallback(()=>{t(K)},[]),C=o.useCallback(n=>s.visibleColumns.includes(n),[s.visibleColumns]),i=o.useCallback(()=>s.columnOrder.filter(n=>s.visibleColumns.includes(n)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:a,reorderColumns:r,setStrikeCount:d,setSelectedUnderlying:u,setBarDataSource:l,setBarStyle:h,resetToDefaults:y,isColumnVisible:C,getOrderedVisibleColumns:i}}const Et={getOptionChain:async(s,t,a,r,d)=>(await Te.post("/optionchain",{apikey:s,underlying:t,exchange:a,expiry_date:r,strike_count:d??20})).data,getExpiries:async(s,t,a,r="options")=>(await Te.post("/expiry",{apikey:s,symbol:t,exchange:a,instrumenttype:r})).data};function Ot({barDataSource:s,barStyle:t,onBarDataSourceChange:a,onBarStyleChange:r}){return e.jsxs(Ve,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(R,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(nt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Ae,{align:"end",className:"w-48",children:[e.jsx(ve,{children:"Bar Data"}),e.jsxs(Pe,{value:s,onValueChange:d=>a(d),children:[e.jsx(je,{value:"oi",children:"Open Interest"}),e.jsx(je,{value:"volume",children:"Volume"})]}),e.jsx(_e,{}),e.jsx(ve,{children:"Bar Style"}),e.jsxs(Pe,{value:t,onValueChange:d=>r(d),children:[e.jsx(je,{value:"gradient",children:"Gradient"}),e.jsx(je,{value:"solid",children:"Solid"})]})]})]})}function Lt({visibleColumns:s,onToggleColumn:t,onResetToDefaults:a}){const r=V.filter(l=>l.side==="ce"),d=V.filter(l=>l.side==="pe"),u=l=>s.includes(l);return e.jsxs(Ve,{children:[e.jsx(qe,{asChild:!0,children:e.jsxs(R,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(lt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Ae,{align:"end",className:"w-48",children:[e.jsx(ve,{children:"CALLS Columns"}),r.map(l=>e.jsx(Ie,{checked:u(l.key),onCheckedChange:()=>t(l.key),children:l.label},l.key)),e.jsx(_e,{}),e.jsx(ve,{children:"PUTS Columns"}),d.map(l=>e.jsx(Ie,{checked:u(l.key),onCheckedChange:()=>t(l.key),children:l.label},l.key)),e.jsx(_e,{}),e.jsxs(R,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:a,children:[e.jsx(it,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Be({columnKey:s,label:t,side:a,isVisible:r,isDragging:d,onDragStart:u,onDragOver:l,onDrop:h,onDragEnd:y}){return e.jsxs("div",{draggable:!0,onDragStart:C=>u(C,s),onDragOver:l,onDrop:C=>h(C,s),onDragEnd:y,className:j("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",d&&"opacity-50 border-dashed",r?"bg-card":"bg-muted/50 opacity-60",a==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(ot,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:j("text-xs px-1.5 py-0.5 rounded",a==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:a==="ce"?"CE":"PE"})]})}function Tt({columnOrder:s,visibleColumns:t,onReorderColumns:a}){const[r,d]=o.useState(s),[u,l]=o.useState(null),[h,y]=o.useState(!1),C=r.filter(m=>V.find(E=>E.key===m)?.side==="ce"),i=r.filter(m=>V.find(E=>E.key===m)?.side==="pe"),n=m=>V.find(E=>E.key===m)?.label??m,x=m=>V.find(E=>E.key===m)?.side==="pe"?"pe":"ce",N=(m,w)=>{l(w),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain",w)},f=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},O=(m,w)=>{if(m.preventDefault(),!u||u===w)return;const E=x(u),L=x(w);if(E!==L)return;const P=[...r],g=P.indexOf(u),U=P.indexOf(w);P.splice(g,1),P.splice(U,0,u),d(P)},M=()=>{l(null)},D=()=>{a(r),y(!1)},k=m=>{y(m),m&&d(s)};return e.jsxs(Qe,{open:h,onOpenChange:k,children:[e.jsx(xt,{asChild:!0,children:e.jsxs(R,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(ct,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Xe,{className:"sm:max-w-md",children:[e.jsxs(We,{children:[e.jsx(He,{children:"Reorder Columns"}),e.jsx(pt,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Fe,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:C.map(m=>e.jsx(Be,{columnKey:m,label:n(m),side:"ce",isVisible:t.includes(m),isDragging:u===m,onDragStart:N,onDragOver:f,onDrop:O,onDragEnd:M},m))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Fe,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:i.map(m=>e.jsx(Be,{columnKey:m,label:n(m),side:"pe",isVisible:t.includes(m),isDragging:u===m,onDragStart:N,onDragOver:f,onDrop:O,onDragEnd:M},m))})})]})]}),e.jsxs(Ke,{className:"gap-2 sm:gap-0",children:[e.jsx(ht,{asChild:!0,children:e.jsx(R,{variant:"outline",children:"Cancel"})}),e.jsx(R,{onClick:D,children:"Save Order"})]})]})]})}function Pt(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function It({exchange:s,ltp:t,prevClose:a,change:r,changePercent:d,bidPrice:u,askPrice:l,bidSize:h,askSize:y,isLoading:C}){const i=r??(t&&a?t-a:void 0),n=d??(i&&a?i/a*100:void 0),x=i!==void 0&&i>=0;return C?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ze,{className:j("text-[10px] px-1.5 py-0",Pt(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),i!==void 0&&e.jsxs("span",{className:j("text-sm font-medium",x?"text-green-500":"text-red-500"),children:[x?"+":"",i.toFixed(2),n!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",x?"+":"",n.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:u!==void 0&&u>0?u.toFixed(2):"-"}),h!==void 0&&h>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",h.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:l!==void 0&&l>0?l.toFixed(2):"-"}),y!==void 0&&y>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",y.toLocaleString()]})]})]})]})}function Re({price:s,quantity:t,maxQty:a,side:r}){const d=a>0?Math.min(t/a*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:j("absolute top-0 bottom-0 transition-all duration-300",r==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${d}%`}})}),e.jsx("span",{className:j("relative z-10 flex-1 font-mono text-xs",r==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function Mt({depth:s,isExpanded:t,onToggle:a,maxLevels:r=5}){const d=s?.buy?.slice(0,r)??[],u=s?.sell?.slice(0,r)??[],l=Math.max(...d.map(i=>i.quantity),1),h=Math.max(...u.map(i=>i.quantity),1),y=Math.max(l,h),C=d.length>0||u.length>0;return e.jsxs(ft,{open:t,onOpenChange:a,children:[e.jsxs(gt,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(bt,{children:C?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:d.length>0?d.map((i,n)=>e.jsx(Re,{price:i.price,quantity:i.quantity,maxQty:y,side:"buy"},`buy-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:u.length>0?u.map((i,n)=>e.jsx(Re,{price:i.price,quantity:i.quantity,maxQty:y,side:"sell"},`sell-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:d.reduce((i,n)=>i+n.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:u.reduce((i,n)=>i+n.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}const Ft=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Bt=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Rt=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function Ne(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function ye(s,t,a){const r=Ne(s,t);return a==="up"?Number((r+t).toFixed(2)):Math.max(0,Number((r-t).toFixed(2)))}function Ue(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function Ut({open:s,onOpenChange:t,symbol:a="",exchange:r="",action:d="BUY",quantity:u,lotSize:l=1,tickSize:h=.05,product:y="NRML",priceType:C="MARKET",strategy:i="OptionChain",onSuccess:n,onError:x}){const{apiKey:N}=Ye(),[f,O]=o.useState(d),[M,D]=o.useState(u??l),[k,m]=o.useState(C),[w,E]=o.useState(y),[L,P]=o.useState(0),[g,U]=o.useState(0),[$,se]=o.useState(!1),[G,te]=o.useState(!1),[v,q]=o.useState("lots"),[H,S]=o.useState(1),[F,J]=o.useState(null),[b,Z]=o.useState(null),[A,T]=o.useState(!1),Q=Ue(r)?Bt:Rt,z=o.useCallback(async()=>{if(!(!N||!a||!r)){T(!0);try{const p=await we.getQuotes(N,a,r);p.status==="success"&&p.data&&J(p.data)}catch{console.debug("REST quotes fetch failed")}finally{T(!1)}}},[N,a,r]),c=o.useCallback(async()=>{if(!(!N||!a||!r))try{const p=await we.getDepth(N,a,r);p.status==="success"&&p.data&&Z(p.data)}catch{console.debug("REST depth fetch failed")}},[N,a,r]);o.useEffect(()=>{if(s){O(d),D(u??l),m(C);const p=Ue(r),X=p?"NRML":"CNC",be=y&&(p?["NRML","MIS"]:["CNC","MIS"]).includes(y)?y:X;E(be),P(0),U(0),te(!1),q("lots"),S(1),J(null),Z(null),z(),c()}},[s,d,u,l,C,y,r,z,c]);const{data:_,isConnected:B}=$e({symbols:a&&r?[{symbol:a,exchange:r}]:[],mode:"Depth",enabled:s&&!!a&&!!r}),Y=_.get(`${r}:${a}`)?.data,de=b?{buy:b.bids.map(p=>({price:p.price,quantity:p.quantity})),sell:b.asks.map(p=>({price:p.price,quantity:p.quantity}))}:void 0,I={ltp:Y?.ltp??b?.ltp??F?.ltp,close:Y?.close??b?.prev_close??F?.prev_close,change:Y?.change,change_percent:Y?.change_percent,bidPrice:Y?.depth?.buy?.[0]?.price??de?.buy?.[0]?.price??Y?.bid_price??F?.bid,askPrice:Y?.depth?.sell?.[0]?.price??de?.sell?.[0]?.price??Y?.ask_price??F?.ask,bidSize:Y?.depth?.buy?.[0]?.quantity??de?.buy?.[0]?.quantity??Y?.bid_size,askSize:Y?.depth?.sell?.[0]?.quantity??de?.sell?.[0]?.quantity??Y?.ask_size,depth:Y?.depth??de},Ce=I.change??(I.ltp&&I.close?I.ltp-I.close:void 0),Je=I.change_percent??(Ce&&I.close?Ce/I.close*100:void 0);o.useEffect(()=>{k!=="MARKET"&&I.ltp&&L===0&&P(Ne(I.ltp,h))},[k,I.ltp,L,h]);const fe=k==="LIMIT"||k==="SL",ge=k==="SL-M"||k==="SL",Oe=o.useCallback(()=>!(!a||!r||!N||M<=0||fe&&L<=0||ge&&g<=0),[a,r,N,M,fe,L,ge,g]),Ze=async()=>{if(!Oe()){ce.error("Please fill all required fields");return}if(!N){ce.error("API key not found. Please set up your API key."),x?.("API key not found");return}se(!0);try{const X={apikey:N,strategy:i,exchange:r,symbol:a,action:f,quantity:M,pricetype:k,product:w,...fe&&{price:L},...ge&&{trigger_price:g}},W=await we.placeOrder(X),be=W.orderid;if(W.status==="success"&&be)n?.(be),t(!1);else{const Le=W.message||"Order placement failed";ce.error(Le,"orders"),x?.(Le)}}catch(p){let X="Order placement failed";if(p&&typeof p=="object"){const W=p;W.response?.data?.message?X=W.response.data.message:W.message&&(X=W.message)}ce.error(X,"orders"),x?.(X)}finally{se(!1)}},et=p=>{const X=parseInt(p)||0;if(v==="lots")D(X*l),S(X);else{const W=Math.max(l,Math.round(X/l)*l);D(W),S(W/l)}},tt=v==="lots"?H:M,st=A&&!I.ltp&&!B;return e.jsx(Qe,{open:s,onOpenChange:t,children:e.jsxs(Xe,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(We,{children:e.jsxs(He,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:f==="BUY"?"text-green-500":"text-red-500",children:f}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:a})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(It,{exchange:r,ltp:I.ltp,prevClose:I.close,change:Ce,changePercent:Je,bidPrice:I.bidPrice,askPrice:I.askPrice,bidSize:I.bidSize,askSize:I.askSize,isLoading:st}),e.jsx(Mt,{depth:I.depth,isExpanded:G,onToggle:()=>te(!G),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{type:"button",variant:f==="BUY"?"default":"outline",className:j("flex-1",f==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>O("BUY"),children:"BUY"}),e.jsx(R,{type:"button",variant:f==="SELL"?"default":"outline",className:j("flex-1",f==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>O("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ae,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>q("lots"),className:j("px-2 py-0.5 text-[10px] rounded",v==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>q("shares"),className:j("px-2 py-0.5 text-[10px] rounded",v==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(Se,{type:"number",value:tt,onChange:p=>et(p.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",l]}),e.jsxs("span",{children:["Total qty: ",M]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Price Type"}),e.jsxs(ue,{value:k,onValueChange:p=>m(p),children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsx(pe,{children:Ft.map(p=>e.jsx(he,{value:p.value,children:p.label},p.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Product"}),e.jsxs(ue,{value:w,onValueChange:p=>E(p),children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsx(pe,{children:Q.map(p=>e.jsx(he,{value:p.value,children:p.label},p.value))})]})]})]}),fe&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(ye(L,h,"down")),children:"-"}),e.jsx(Se,{type:"number",value:L,onChange:p=>P(parseFloat(p.target.value)||0),onBlur:()=>P(Ne(L,h)),className:"flex-1 text-center",step:h,min:0}),e.jsx(R,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(ye(L,h,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",h]})]}),ge&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>U(ye(g,h,"down")),children:"-"}),e.jsx(Se,{type:"number",value:g,onChange:p=>U(parseFloat(p.target.value)||0),onBlur:()=>U(Ne(g,h)),className:"flex-1 text-center",step:h,min:0}),e.jsx(R,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>U(ye(g,h,"up")),children:"+"})]})]})]}),e.jsxs(Ke,{className:"gap-2 sm:gap-0",children:[e.jsx(R,{variant:"outline",onClick:()=>t(!1),disabled:$,children:"Cancel"}),e.jsx(R,{onClick:Ze,disabled:!Oe()||$,className:j(f==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:$?"Placing...":`Place ${f} Order`})]})]})})}const ke=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],Vt=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function oe(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const a=s/1e3;return a>=1?a.toFixed(1)+"K":s.toLocaleString()}}function ee(s){return s==null?"0.00":s.toFixed(2)}function qt(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function At(s){let t=0,a=0;return s.forEach(r=>{r.ce?.oi&&(t+=r.ce.oi),r.pe?.oi&&(a+=r.pe?.oi??0)}),t===0?0:a/t}function zt(s){let t=0,a=0,r=0,d=0;return s.forEach(u=>{u.ce&&(t+=u.ce.volume??0,r+=u.ce.oi??0),u.pe&&(a+=u.pe.volume??0,d+=u.pe.oi??0)}),{ceVolume:t,peVolume:a,ceOi:r,peOi:d}}function Yt(s,t){let a=0;return s.forEach(r=>{const d=t==="oi"?r.ce?.oi:r.ce?.volume,u=t==="oi"?r.pe?.oi:r.pe?.volume;d&&d>a&&(a=d),u&&u>a&&(a=u)}),a||1}const $t=at.memo(function({strike:t,previousStrike:a,maxBarValue:r,visibleCeColumns:d,visiblePeColumns:u,barDataSource:l,barStyle:h,optionExchange:y,onPlaceOrder:C}){const i=t.ce,n=t.pe,x=i?.label??n?.label??"",N=x==="ATM",f=x.startsWith("OTM"),O=x.startsWith("ITM"),M=a?.ce?.ltp!==void 0&&a.ce.ltp!==i?.ltp,D=a?.pe?.ltp!==void 0&&a.pe.ltp!==n?.ltp,k=M?i&&a?.ce&&i.ltp>a.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",m=D?n&&a?.pe&&n.ltp>a.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",w=i&&i.bid>0&&i.ask>0?i.ask-i.bid:0,E=n&&n.bid>0&&n.ask>0?n.ask-n.bid:0,L=w<=1?"text-green-500":w<=2?"text-yellow-500":"text-red-500",P=E<=1?"text-green-500":E<=2?"text-yellow-500":"text-red-500",g=l==="oi"?i?.oi:i?.volume,U=l==="oi"?n?.oi:n?.volume,$=g?Math.min(g/r*100,100):0,se=U?Math.min(U/r*100,100):0,G=h==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",te=h==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",v="font-mono tabular-nums text-xs",q=S=>{switch(S){case"ce_oi":return e.jsx("span",{className:v,children:oe(i?.oi)});case"ce_volume":return e.jsx("span",{className:v,children:oe(i?.volume)});case"ce_bid_qty":return e.jsx("span",{className:v,children:i?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:j(v,"text-red-500"),children:ee(i?.bid)});case"ce_ltp":return e.jsx("span",{className:j(v,"font-semibold",k),children:ee(i?.ltp)});case"ce_ask":return e.jsx("span",{className:j(v,"text-green-500"),children:ee(i?.ask)});case"ce_ask_qty":return e.jsx("span",{className:v,children:i?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:j(v,L),children:ee(w)});default:return null}},H=S=>{switch(S){case"pe_oi":return e.jsx("span",{className:v,children:oe(n?.oi)});case"pe_volume":return e.jsx("span",{className:v,children:oe(n?.volume)});case"pe_bid_qty":return e.jsx("span",{className:v,children:n?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:j(v,"text-red-500"),children:ee(n?.bid)});case"pe_ltp":return e.jsx("span",{className:j(v,"font-semibold",m),children:ee(n?.ltp)});case"pe_ask":return e.jsx("span",{className:j(v,"text-green-500"),children:ee(n?.ask)});case"pe_ask_qty":return e.jsx("span",{className:v,children:n?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:j(v,P),children:ee(E)});default:return null}};return e.jsxs(Ee,{className:j("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":x,children:[d.length>0&&e.jsxs(De,{className:j("p-0 relative",f&&!N&&"bg-amber-500/5"),children:[e.jsx("div",{className:j("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",G),style:{width:`${$}%`}}),i&&e.jsxs("div",{className:j("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),C({symbol:i.symbol,exchange:y,action:"BUY",lotSize:i.lotsize??1,tickSize:i.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:S=>{S.stopPropagation(),C({symbol:i.symbol,exchange:y,action:"SELL",lotSize:i.lotsize??1,tickSize:i.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:d.map(S=>{const F=V.find(J=>J.key===S);return e.jsx("div",{className:j("flex-1 px-2 py-1.5 min-w-0",F?.align==="right"&&"text-right",F?.align==="center"&&"text-center",F?.align==="left"&&"text-left"),children:q(S)},S)})})]}),e.jsx(De,{className:j("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",N?"bg-primary/15":"bg-muted/30"),children:t.strike}),u.length>0&&e.jsxs(De,{className:j("p-0 relative",O&&!N&&"bg-amber-500/5"),children:[e.jsx("div",{className:j("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",te),style:{width:`${se}%`}}),n&&e.jsxs("div",{className:j("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),C({symbol:n.symbol,exchange:y,action:"BUY",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:S=>{S.stopPropagation(),C({symbol:n.symbol,exchange:y,action:"SELL",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:u.map(S=>{const F=V.find(J=>J.key===S);return e.jsx("div",{className:j("flex-1 px-2 py-1.5 min-w-0",F?.align==="right"&&"text-right",F?.align==="center"&&"text-center",F?.align==="left"&&"text-left"),children:H(S)},S)})})]})]})});function cs(){const{apiKey:s}=Ye(),{visibleColumns:t,columnOrder:a,strikeCount:r,selectedUnderlying:d,barDataSource:u,barStyle:l,toggleColumn:h,reorderColumns:y,setStrikeCount:C,setSelectedUnderlying:i,setBarDataSource:n,setBarStyle:x,resetToDefaults:N}=_t(),[f,O]=o.useState(""),[M,D]=o.useState([]),k=o.useRef(new Map),[m,w]=o.useState(null),E=ke.find(c=>c.value===d),L=E?.brokerExchange??"NSE_INDEX",P=E?.exchange??"NFO",{data:g,isConnected:U,isStreaming:$,isPaused:se,error:G,lastUpdate:te,refetch:v,isLoading:q,streamingSymbols:H}=Ct(s,d,L,P,qt(f),r,{enabled:!!f,oiRefreshInterval:3e4,pauseWhenHidden:!0});o.useEffect(()=>{(async()=>{if(!(!s||!d))try{const _=await Et.getExpiries(s,d,P);_.status==="success"&&_.data.length>0?(D(_.data),O(B=>B||_.data[0])):ce.error(_.message||"Failed to load expiries")}catch(_){console.error("Error loading expiries:",_),ce.error("Failed to load expiry dates")}})()},[s,d,P]),o.useEffect(()=>{if(g?.chain){const c=setTimeout(()=>{const _=new Map;g.chain.forEach(B=>{_.set(B.strike,B)}),k.current=_},100);return()=>clearTimeout(c)}},[g?.chain]);const S=c=>{ke.find(B=>B.value===c)&&(i(c),O(""),D([]))},F=()=>{v()},J=o.useCallback(c=>{w({open:!0,symbol:c.symbol,exchange:c.exchange,action:c.action,quantity:c.lotSize,lotSize:c.lotSize,tickSize:c.tickSize})},[]),b=o.useCallback(c=>{c||w(null)},[]),Z=o.useMemo(()=>g?.chain?At(g.chain):0,[g?.chain]),A=o.useMemo(()=>g?.chain?zt(g.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[g?.chain]),T=o.useMemo(()=>g?.chain?Yt(g.chain,u):1,[g?.chain,u]),Q=o.useMemo(()=>a.filter(c=>V.find(B=>B.key===c)?.side==="ce"&&t.includes(c)),[a,t]),z=o.useMemo(()=>a.filter(c=>V.find(B=>B.key===c)?.side==="pe"&&t.includes(c)),[a,t]);return G?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(re,{className:"max-w-md",children:e.jsx(ne,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:G}),e.jsxs(R,{onClick:F,className:"mt-4",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(dt,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ue,{value:d,onValueChange:S,children:[e.jsx(me,{className:"w-36",children:e.jsx(xe,{placeholder:"Select Underlying"})}),e.jsx(pe,{children:ke.map(c=>e.jsx(he,{value:c.value,children:c.label},c.value))})]}),e.jsxs(ue,{value:f,onValueChange:O,disabled:M.length===0,children:[e.jsx(me,{className:"w-36",children:e.jsx(xe,{placeholder:"Select Expiry"})}),e.jsx(pe,{children:M.map(c=>e.jsx(he,{value:c,children:c},c))})]}),e.jsxs(ue,{value:String(r),onValueChange:c=>C(Number(c)),children:[e.jsx(me,{className:"w-36",children:e.jsx(xe,{placeholder:"Strike Count"})}),e.jsx(pe,{children:Vt.map(c=>e.jsx(he,{value:String(c.value),children:c.label},c.value))})]}),e.jsx(Ot,{barDataSource:u,barStyle:l,onBarDataSourceChange:n,onBarStyleChange:x}),e.jsx(Lt,{visibleColumns:t,onToggleColumn:h,onResetToDefaults:N}),e.jsx(Tt,{columnOrder:a,visibleColumns:t,onReorderColumns:y}),e.jsxs(R,{onClick:F,disabled:!f||q,children:[e.jsx(Me,{className:`h-4 w-4 mr-2 ${q?"animate-spin":""}`}),"Refresh"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(re,{children:e.jsxs(ne,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:ee(g.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",ee(g.underlying_prev_close)]})]})}),e.jsx(re,{children:e.jsxs(ne,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:g.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",g.expiry_date]})]})}),e.jsx(re,{children:e.jsxs(ne,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${Z>1?"text-green-500":"text-yellow-500"}`,children:Z.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(re,{children:e.jsxs(ne,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:oe(A.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:oe(A.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:A.ceOi+A.peOi>0?`${A.ceOi/(A.ceOi+A.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",Z.toFixed(2)]})})]})})]}),e.jsx(re,{children:e.jsx(ne,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(jt,{className:"w-full table-fixed",children:[e.jsxs(yt,{children:[e.jsxs(Ee,{className:"bg-muted/30 border-b-0",children:[Q.length>0&&e.jsx(le,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(le,{className:"text-center w-20 min-w-20"}),z.length>0&&e.jsx(le,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Ee,{className:"bg-muted/50",children:[Q.length>0&&e.jsx(le,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:Q.map(c=>{const _=V.find(B=>B.key===c);return e.jsx("div",{className:j("flex-1 px-2 py-2 text-xs font-medium min-w-0",_?.align==="right"&&"text-right",_?.align==="center"&&"text-center",_?.align==="left"&&"text-left"),children:_?.label},c)})})}),e.jsx(le,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),z.length>0&&e.jsx(le,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:z.map(c=>{const _=V.find(B=>B.key===c);return e.jsx("div",{className:j("flex-1 px-2 py-2 text-xs font-medium min-w-0",_?.align==="right"&&"text-right",_?.align==="center"&&"text-center",_?.align==="left"&&"text-left"),children:_?.label},c)})})})]})]}),e.jsx(Nt,{children:g.chain.map(c=>e.jsx($t,{strike:c,previousStrike:k.current.get(c.strike),maxBarValue:T,visibleCeColumns:Q,visiblePeColumns:z,barDataSource:u,barStyle:l,optionExchange:P,onPlaceOrder:J},c.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$?e.jsx(ut,{className:"h-4 w-4 text-green-500"}):e.jsx(mt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(ze,{variant:$?"default":U?"secondary":"destructive",children:se?"Paused":$?`Streaming ${H} symbols`:U?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",u==="oi"?"OI":"Volume"," (",l,")"]})]}),e.jsxs("div",{children:["Last Update: ",te?te.toLocaleTimeString():"-"]})]})]}),!g&&!G&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Ut,{open:m?.open??!1,onOpenChange:b,symbol:m?.symbol,exchange:m?.exchange,action:m?.action,quantity:m?.quantity,lotSize:m?.lotSize,tickSize:m?.tickSize,strategy:"OptionChain"})]})}export{cs as default};
