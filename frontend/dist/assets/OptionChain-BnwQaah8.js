import{r as d,j as e}from"./vendor-react--vsXx8_n.js";import{v as ve,D as Ee,i as Oe,B as F,j as Te,y as he,z as Ce,A as xe,m as je,C as Se,c as k,d as Ie,s as ee,e as Ae}from"./index-Dw85LluC.js";import{u as qe,a as Pe}from"./useMarketData-BkCpnkL6.js";import{g as ze,$ as Ye,ac as $e,aR as We,aS as Qe,R as we,c as Xe,az as He,aB as Ke}from"./vendor-icons-C0P7QAK9.js";import{D as Me,a as Ge,b as Fe,c as Be,d as Ve,e as Je,f as Ue,g as Ze}from"./dialog-CUaNssgV.js";import{S as ke}from"./scroll-area-BlMflaUo.js";import{I as fe}from"./input-7Zj300RO.js";import{L as te}from"./label-4FRXGsMT.js";import{S as ie,a as oe,b as ce,c as de,d as ue}from"./select-HhR74pWF.js";import{t as es}from"./trading-BrXDPD1_.js";import{C as ss,b as ts,a as as}from"./collapsible-BJ9rSfA8.js";import{C as ae,d as re}from"./card-CZ3H9NDG.js";import{T as rs,a as ns,b as ye,c as ne,d as ls,e as ge}from"./table-BybT3JLu.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DkDlinVE.js";function is(t,s,n,a,i,o={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:l,refreshInterval:p=3e4,pauseWhenHidden:N=!0}=o,{isVisible:b}=qe(),[c,r]=d.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),u=d.useRef(null),v=d.useRef(null),h=l&&(!N||b),O=d.useCallback(async()=>{if(!(!t||!s||!n||!a)&&!v.current){r(S=>({...S,isLoading:!0}));try{const S=new AbortController;v.current=S;const w=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:t,underlying:s,exchange:n,expiry_date:a,strike_count:i}),signal:S.signal});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const x=await w.json();x.status==="success"?r(j=>({...j,data:x,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):r(j=>({...j,isLoading:!1,error:x.message||"Failed to fetch option chain"}))}catch(S){S instanceof Error&&(S.name==="AbortError"?v.current===null&&r(w=>({...w,isLoading:!1})):r(w=>({...w,isLoading:!1,error:S.message||"Connection error",isConnected:!1})))}finally{v.current=null}}},[t,s,n,a,i]);d.useEffect(()=>{if(!h){u.current&&(clearInterval(u.current),u.current=null),r(S=>({...S,isPaused:!!l}));return}return r(S=>({...S,isConnected:!0,isPaused:!1})),O(),u.current=setInterval(O,p),()=>{u.current&&(clearInterval(u.current),u.current=null),v.current&&(v.current.abort(),v.current=null)}},[h,O,p,l]);const M=d.useCallback(()=>{O()},[O]);return{...c,refetch:M}}function os(t,s,n,a,i,o,l={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:p,oiRefreshInterval:N=3e4,pauseWhenHidden:b=!0}=l,[c,r]=d.useState(null),[u,v]=d.useState(null),{data:h,isLoading:O,isConnected:M,isPaused:S,error:w,lastUpdate:x,refetch:j}=is(t,s,n,i,o,{enabled:p,refreshInterval:N,pauseWhenHidden:b}),L=d.useMemo(()=>{const B=[],R=a==="BFO"?"BSE_INDEX":"NSE_INDEX";if(B.push({symbol:s,exchange:R}),h?.chain)for(const A of h.chain)A.ce?.symbol&&B.push({symbol:A.ce.symbol,exchange:a}),A.pe?.symbol&&B.push({symbol:A.pe.symbol,exchange:a});return B},[h?.chain,a,s]),{data:E,isConnected:P,isAuthenticated:I,isPaused:g}=Pe({symbols:L,mode:"Depth",enabled:p&&L.length>0,pauseWhenHidden:b});d.useEffect(()=>{if(!h){r(null);return}if(E.size===0){r(h);return}const B=h.chain.map(D=>{const Z={...D};if(D.ce?.symbol){const T=`${a}:${D.ce.symbol}`,y=E.get(T);if(y?.data){const z=y.data.depth?.buy?.[0],q=y.data.depth?.sell?.[0];Z.ce={...D.ce,ltp:y.data.ltp??D.ce.ltp,bid:z?.price??y.data.bid_price??D.ce.bid,ask:q?.price??y.data.ask_price??D.ce.ask,bid_qty:z?.quantity??y.data.bid_size??D.ce.bid_qty??0,ask_qty:q?.quantity??y.data.ask_size??D.ce.ask_qty??0}}}if(D.pe?.symbol){const T=`${a}:${D.pe.symbol}`,y=E.get(T);if(y?.data){const z=y.data.depth?.buy?.[0],q=y.data.depth?.sell?.[0];Z.pe={...D.pe,ltp:y.data.ltp??D.pe.ltp,bid:z?.price??y.data.bid_price??D.pe.bid,ask:q?.price??y.data.ask_price??D.pe.ask,bid_qty:z?.quantity??y.data.bid_size??D.pe.bid_qty??0,ask_qty:q?.quantity??y.data.ask_size??D.pe.ask_qty??0}}}return Z});let R=!1;for(const[,D]of E)if(D.lastUpdate&&(!u||D.lastUpdate>u.getTime())){R=!0;break}R&&v(new Date);const C=`${a==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${s}`,H=E.get(C)?.data?.ltp??h.underlying_ltp;r({...h,underlying_ltp:H,chain:B})},[h,E,a,s,u]);const W=P&&I&&L.length>0,Q=S||g,K=d.useMemo(()=>!x&&!u?null:x?u&&u>x?u:x:u,[x,u]);return{data:c,isLoading:O,isConnected:M,isStreaming:W,isPaused:Q,error:w,lastUpdate:K,streamingSymbols:L.length,refetch:j}}const U=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],cs=U.map(t=>t.key),ds=U.filter(t=>t.defaultVisible).map(t=>t.key),$={visibleColumns:ds,columnOrder:cs,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Re="openalgo_option_chain_prefs";function us(){if(typeof window>"u")return $;try{const t=localStorage.getItem(Re);if(!t)return $;const s=JSON.parse(t),n=new Set(U.map(l=>l.key)),a=Array.isArray(s.visibleColumns)?s.visibleColumns.filter(l=>n.has(l)):$.visibleColumns;a.includes("strike")||a.push("strike");const i=Array.isArray(s.columnOrder)?s.columnOrder.filter(l=>n.has(l)):$.columnOrder,o=new Set(i);return $.columnOrder.forEach(l=>{o.has(l)||i.push(l)}),{visibleColumns:a,columnOrder:i,strikeCount:typeof s.strikeCount=="number"&&s.strikeCount>0?s.strikeCount:$.strikeCount,selectedUnderlying:typeof s.selectedUnderlying=="string"&&s.selectedUnderlying?s.selectedUnderlying:$.selectedUnderlying,barDataSource:s.barDataSource==="oi"||s.barDataSource==="volume"?s.barDataSource:$.barDataSource,barStyle:s.barStyle==="gradient"||s.barStyle==="solid"?s.barStyle:$.barStyle}}catch{return $}}function xs(t){if(!(typeof window>"u"))try{localStorage.setItem(Re,JSON.stringify(t))}catch{}}function ms(){const[t,s]=d.useState(()=>us());d.useEffect(()=>{xs(t)},[t]);const n=d.useCallback(r=>{r!=="strike"&&s(u=>{const h=u.visibleColumns.includes(r)?u.visibleColumns.filter(O=>O!==r):[...u.visibleColumns,r];return{...u,visibleColumns:h}})},[]),a=d.useCallback(r=>{s(u=>({...u,columnOrder:r}))},[]),i=d.useCallback(r=>{s(u=>({...u,strikeCount:r}))},[]),o=d.useCallback(r=>{s(u=>({...u,selectedUnderlying:r}))},[]),l=d.useCallback(r=>{s(u=>({...u,barDataSource:r}))},[]),p=d.useCallback(r=>{s(u=>({...u,barStyle:r}))},[]),N=d.useCallback(()=>{s($)},[]),b=d.useCallback(r=>t.visibleColumns.includes(r),[t.visibleColumns]),c=d.useCallback(()=>t.columnOrder.filter(r=>t.visibleColumns.includes(r)),[t.columnOrder,t.visibleColumns]);return{preferences:t,visibleColumns:t.visibleColumns,columnOrder:t.columnOrder,strikeCount:t.strikeCount,selectedUnderlying:t.selectedUnderlying,barDataSource:t.barDataSource,barStyle:t.barStyle,toggleColumn:n,reorderColumns:a,setStrikeCount:i,setSelectedUnderlying:o,setBarDataSource:l,setBarStyle:p,resetToDefaults:N,isColumnVisible:b,getOrderedVisibleColumns:c}}const ps={getOptionChain:async(t,s,n,a,i)=>(await ve.post("/optionchain",{apikey:t,underlying:s,exchange:n,expiry_date:a,strike_count:i??20})).data,getExpiries:async(t,s,n,a="options")=>(await ve.post("/expiry",{apikey:t,symbol:s,exchange:n,instrumenttype:a})).data};function hs({barDataSource:t,barStyle:s,onBarDataSourceChange:n,onBarStyleChange:a}){return e.jsxs(Ee,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Te,{align:"end",className:"w-48",children:[e.jsx(he,{children:"Bar Data"}),e.jsxs(Ce,{value:t,onValueChange:i=>n(i),children:[e.jsx(xe,{value:"oi",children:"Open Interest"}),e.jsx(xe,{value:"volume",children:"Volume"})]}),e.jsx(je,{}),e.jsx(he,{children:"Bar Style"}),e.jsxs(Ce,{value:s,onValueChange:i=>a(i),children:[e.jsx(xe,{value:"gradient",children:"Gradient"}),e.jsx(xe,{value:"solid",children:"Solid"})]})]})]})}function fs({visibleColumns:t,onToggleColumn:s,onResetToDefaults:n}){const a=U.filter(l=>l.side==="ce"),i=U.filter(l=>l.side==="pe"),o=l=>t.includes(l);return e.jsxs(Ee,{children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Te,{align:"end",className:"w-48",children:[e.jsx(he,{children:"CALLS Columns"}),a.map(l=>e.jsx(Se,{checked:o(l.key),onCheckedChange:()=>s(l.key),children:l.label},l.key)),e.jsx(je,{}),e.jsx(he,{children:"PUTS Columns"}),i.map(l=>e.jsx(Se,{checked:o(l.key),onCheckedChange:()=>s(l.key),children:l.label},l.key)),e.jsx(je,{}),e.jsxs(F,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:n,children:[e.jsx($e,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function De({columnKey:t,label:s,side:n,isVisible:a,isDragging:i,onDragStart:o,onDragOver:l,onDrop:p,onDragEnd:N}){return e.jsxs("div",{draggable:!0,onDragStart:b=>o(b,t),onDragOver:l,onDrop:b=>p(b,t),onDragEnd:N,className:k("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",i&&"opacity-50 border-dashed",a?"bg-card":"bg-muted/50 opacity-60",n==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:s}),e.jsx("span",{className:k("text-xs px-1.5 py-0.5 rounded",n==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:n==="ce"?"CE":"PE"})]})}function gs({columnOrder:t,visibleColumns:s,onReorderColumns:n}){const[a,i]=d.useState(t),[o,l]=d.useState(null),[p,N]=d.useState(!1),b=a.filter(x=>U.find(L=>L.key===x)?.side==="ce"),c=a.filter(x=>U.find(L=>L.key===x)?.side==="pe"),r=x=>U.find(L=>L.key===x)?.label??x,u=x=>U.find(L=>L.key===x)?.side==="pe"?"pe":"ce",v=(x,j)=>{l(j),x.dataTransfer.effectAllowed="move",x.dataTransfer.setData("text/plain",j)},h=x=>{x.preventDefault(),x.dataTransfer.dropEffect="move"},O=(x,j)=>{if(x.preventDefault(),!o||o===j)return;const L=u(o),E=u(j);if(L!==E)return;const P=[...a],I=P.indexOf(o),g=P.indexOf(j);P.splice(I,1),P.splice(g,0,o),i(P)},M=()=>{l(null)},S=()=>{n(a),N(!1)},w=x=>{N(x),x&&i(t)};return e.jsxs(Me,{open:p,onOpenChange:w,children:[e.jsx(Ge,{asChild:!0,children:e.jsxs(F,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(We,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Fe,{className:"sm:max-w-md",children:[e.jsxs(Be,{children:[e.jsx(Ve,{children:"Reorder Columns"}),e.jsx(Je,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(ke,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:b.map(x=>e.jsx(De,{columnKey:x,label:r(x),side:"ce",isVisible:s.includes(x),isDragging:o===x,onDragStart:v,onDragOver:h,onDrop:O,onDragEnd:M},x))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(ke,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:c.map(x=>e.jsx(De,{columnKey:x,label:r(x),side:"pe",isVisible:s.includes(x),isDragging:o===x,onDragStart:v,onDragOver:h,onDrop:O,onDragEnd:M},x))})})]})]}),e.jsxs(Ue,{className:"gap-2 sm:gap-0",children:[e.jsx(Ze,{asChild:!0,children:e.jsx(F,{variant:"outline",children:"Cancel"})}),e.jsx(F,{onClick:S,children:"Save Order"})]})]})]})}function bs({symbol:t,exchange:s,ltp:n,prevClose:a,change:i,changePercent:o,bidPrice:l,askPrice:p,bidSize:N,askSize:b,isLoading:c}){const r=i??(n&&a?n-a:void 0),u=o??(r&&a?r/a*100:void 0),v=r!==void 0&&r>=0;return c?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px]",children:t}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",s,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:n!==void 0?n.toFixed(2):"-"}),r!==void 0&&e.jsxs("span",{className:k("text-sm font-medium",v?"text-green-500":"text-red-500"),children:[v?"+":"",r.toFixed(2),u!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",v?"+":"",u.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-red-500 font-medium font-mono",children:l!==void 0&&l>0?l.toFixed(2):"-"}),N!==void 0&&N>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x ",N.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-green-500 font-medium font-mono",children:p!==void 0&&p>0?p.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x ",b.toLocaleString()]})]})]})]})}function _e({price:t,quantity:s,maxQty:n,side:a}){const i=n>0?Math.min(s/n*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:k("absolute top-0 bottom-0 transition-all duration-300",a==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${i}%`}})}),e.jsx("span",{className:k("relative z-10 flex-1 font-mono text-xs",a==="buy"?"text-emerald-400":"text-rose-400"),children:t.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:s.toLocaleString()})]})}function js({depth:t,isExpanded:s,onToggle:n,maxLevels:a=5}){const i=t?.buy?.slice(0,a)??[],o=t?.sell?.slice(0,a)??[],l=Math.max(...i.map(c=>c.quantity),1),p=Math.max(...o.map(c=>c.quantity),1),N=Math.max(l,p),b=i.length>0||o.length>0;return e.jsxs(ss,{open:s,onOpenChange:n,children:[e.jsxs(ts,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s?"[-]":"[+]"})]}),e.jsx(as,{children:b?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:i.length>0?i.map((c,r)=>e.jsx(_e,{price:c.price,quantity:c.quantity,maxQty:N,side:"buy"},`buy-${r}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:o.length>0?o.map((c,r)=>e.jsx(_e,{price:c.price,quantity:c.quantity,maxQty:N,side:"sell"},`sell-${r}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:i.reduce((c,r)=>c+r.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:o.reduce((c,r)=>c+r.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}const ys=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL",label:"SL"},{value:"SL-LIMIT",label:"SL-Limit"}],Ns=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],vs=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function pe(t,s){return s<=0?t:Math.round(t/s)*s}function me(t,s,n){const a=pe(t,s);return n==="up"?Number((a+s).toFixed(2)):Math.max(0,Number((a-s).toFixed(2)))}function Le(t){return["NFO","BFO","MCX","CDS","BCD"].includes(t)}function Cs({open:t,onOpenChange:s,symbol:n="",exchange:a="",action:i="BUY",quantity:o,lotSize:l=1,tickSize:p=.05,product:N="NRML",priceType:b="MARKET",strategy:c="OptionChain",onSuccess:r,onError:u}){const{apiKey:v}=Ie(),[h,O]=d.useState(i),[M,S]=d.useState(o??l),[w,x]=d.useState(b),[j,L]=d.useState(N),[E,P]=d.useState(0),[I,g]=d.useState(0),[W,Q]=d.useState(!1),[K,B]=d.useState(!1),[R,A]=d.useState("lots"),[C,V]=d.useState(1),H=Le(a)?Ns:vs;d.useEffect(()=>{if(t){O(i),S(o??l),x(b);const f=Le(a)?"NRML":"CNC";L(N||f),P(0),g(0),B(!1),A("lots"),V(1)}},[t,i,o,l,b,N,a]);const{data:D,isConnected:Z}=Pe({symbols:n&&a?[{symbol:n,exchange:a}]:[],mode:"Depth",enabled:t&&!!n&&!!a}),T=D.get(`${a}:${n}`)?.data;d.useEffect(()=>{w!=="MARKET"&&T?.ltp&&E===0&&P(pe(T.ltp,p))},[w,T?.ltp,E,p]);const y=w==="LIMIT"||w==="SL"||w==="SL-LIMIT",z=w==="SL"||w==="SL-LIMIT",q=d.useCallback(()=>!(!n||!a||!v||M<=0||y&&E<=0||z&&I<=0),[n,a,v,M,y,E,z,I]),se=async()=>{if(!q()){ee.error("Please fill all required fields");return}if(!v){ee.error("API key not found. Please set up your API key."),u?.("API key not found");return}Q(!0);try{const G={apikey:v,strategy:c,exchange:a,symbol:n,action:h,quantity:M,pricetype:w==="SL-LIMIT"?"SL-M":w,product:j,...y&&{price:E},...z&&{trigger_price:I}},J=await es.placeOrder(G);if(J.status==="success"&&J.data?.orderid)ee.success(`Order placed: ${J.data.orderid}`,"orders"),r?.(J.data.orderid),s(!1);else{const Ne=J.message||"Order placement failed";ee.error(Ne,"orders"),u?.(Ne)}}catch(f){const G=f instanceof Error?f.message:"Order placement failed";ee.error(G,"orders"),u?.(G)}finally{Q(!1)}},m=f=>{V(f),S(l*f)},_=f=>{const G=parseInt(f)||0;if(R==="lots")S(G*l),V(G);else{const J=Math.max(l,Math.round(G/l)*l);S(J),V(J/l)}},Y=R==="lots"?C:M;return e.jsx(Me,{open:t,onOpenChange:s,children:e.jsxs(Fe,{className:"sm:max-w-[420px]",children:[e.jsx(Be,{children:e.jsxs(Ve,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:h==="BUY"?"text-green-500":"text-red-500",children:h}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:n})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(bs,{symbol:n,exchange:a,ltp:T?.ltp,prevClose:T?.close,change:T?.change,changePercent:T?.change_percent,bidPrice:T?.bid_price,askPrice:T?.ask_price,bidSize:T?.bid_size,askSize:T?.ask_size,isLoading:!Z&&!T}),e.jsx(js,{depth:T?.depth,isExpanded:K,onToggle:()=>B(!K),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:h==="BUY"?"default":"outline",className:k("flex-1",h==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>O("BUY"),children:"BUY"}),e.jsx(F,{type:"button",variant:h==="SELL"?"default":"outline",className:k("flex-1",h==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>O("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>A("lots"),className:k("px-2 py-0.5 text-[10px] rounded",R==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>A("shares"),className:k("px-2 py-0.5 text-[10px] rounded",R==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex gap-1",children:[1,2,3].map(f=>e.jsxs(F,{type:"button",variant:C===f?"default":"outline",size:"sm",className:"px-2 text-xs",onClick:()=>m(f),children:[f,"x"]},f))}),e.jsx(fe,{type:"number",value:Y,onChange:f=>_(f.target.value),className:"flex-1",min:1})]}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",l]}),e.jsxs("span",{children:["Total qty: ",M]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price Type"}),e.jsxs(ie,{value:w,onValueChange:f=>x(f),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsx(de,{children:ys.map(f=>e.jsx(ue,{value:f.value,children:f.label},f.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Product"}),e.jsxs(ie,{value:j,onValueChange:f=>L(f),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsx(de,{children:H.map(f=>e.jsx(ue,{value:f.value,children:f.label},f.value))})]})]})]}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(me(E,p,"down")),children:"-"}),e.jsx(fe,{type:"number",value:E,onChange:f=>P(parseFloat(f.target.value)||0),onBlur:()=>P(pe(E,p)),className:"flex-1 text-center",step:p,min:0}),e.jsx(F,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(me(E,p,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",p]})]}),z&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>g(me(I,p,"down")),children:"-"}),e.jsx(fe,{type:"number",value:I,onChange:f=>g(parseFloat(f.target.value)||0),onBlur:()=>g(pe(I,p)),className:"flex-1 text-center",step:p,min:0}),e.jsx(F,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>g(me(I,p,"up")),children:"+"})]})]})]}),e.jsxs(Ue,{className:"gap-2 sm:gap-0",children:[e.jsx(F,{variant:"outline",onClick:()=>s(!1),disabled:W,children:"Cancel"}),e.jsx(F,{onClick:se,disabled:!q()||W,className:k(h==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:W?"Placing...":`Place ${h} Order`})]})]})})}const be=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],Ss=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function le(t){if(t==null||t===0)return"0";const s=t/1e5;if(s>=100)return s.toFixed(0)+"L";if(s>=10)return s.toFixed(1)+"L";if(s>=1)return s.toFixed(2)+"L";{const n=t/1e3;return n>=1?n.toFixed(1)+"K":t.toLocaleString()}}function X(t){return t==null?"0.00":t.toFixed(2)}function ws(t){if(!t)return"";const s=t.split("-");return s.length===3?`${s[0]}${s[1].toUpperCase()}${s[2].slice(-2)}`:t.replace(/-/g,"").toUpperCase()}function ks(t){let s=0,n=0;return t.forEach(a=>{a.ce?.oi&&(s+=a.ce.oi),a.pe?.oi&&(n+=a.pe?.oi??0)}),s===0?0:n/s}function Ds(t){let s=0,n=0,a=0,i=0;return t.forEach(o=>{o.ce&&(s+=o.ce.volume??0,a+=o.ce.oi??0),o.pe&&(n+=o.pe.volume??0,i+=o.pe.oi??0)}),{ceVolume:s,peVolume:n,ceOi:a,peOi:i}}function _s(t,s){let n=0;return t.forEach(a=>{const i=s==="oi"?a.ce?.oi:a.ce?.volume,o=s==="oi"?a.pe?.oi:a.pe?.volume;i&&i>n&&(n=i),o&&o>n&&(n=o)}),n||1}function Ls({strike:t,previousData:s,maxBarValue:n,visibleCeColumns:a,visiblePeColumns:i,barDataSource:o,barStyle:l,optionExchange:p,onPlaceOrder:N}){const b=s.get(t.strike),c=t.ce,r=t.pe,u=c?.label??r?.label??"",v=u==="ATM",h=u.startsWith("OTM"),O=u.startsWith("ITM"),M=b?.ce?.ltp!==c?.ltp,S=b?.pe?.ltp!==r?.ltp,w=M?c&&b?.ce&&c.ltp>b.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",x=S?r&&b?.pe&&r.ltp>b.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",j=c&&c.bid>0&&c.ask>0?c.ask-c.bid:0,L=r&&r.bid>0&&r.ask>0?r.ask-r.bid:0,E=j<=1?"text-green-500":j<=2?"text-yellow-500":"text-red-500",P=L<=1?"text-green-500":L<=2?"text-yellow-500":"text-red-500",I=o==="oi"?c?.oi:c?.volume,g=o==="oi"?r?.oi:r?.volume,W=I?Math.min(I/n*100,100):0,Q=g?Math.min(g/n*100,100):0,K=l==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",B=l==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",R=C=>{switch(C){case"ce_oi":return e.jsx("span",{className:"font-mono text-xs",children:le(c?.oi)});case"ce_volume":return e.jsx("span",{className:"font-mono text-xs",children:le(c?.volume)});case"ce_bid_qty":return e.jsx("span",{className:"text-xs",children:c?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:"text-red-500 text-xs",children:X(c?.bid)});case"ce_ltp":return e.jsx("span",{className:k("font-semibold text-xs",w),children:X(c?.ltp)});case"ce_ask":return e.jsx("span",{className:"text-green-500 text-xs",children:X(c?.ask)});case"ce_ask_qty":return e.jsx("span",{className:"text-xs",children:c?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:k("text-xs",E),children:X(j)});default:return null}},A=C=>{switch(C){case"pe_oi":return e.jsx("span",{className:"font-mono text-xs",children:le(r?.oi)});case"pe_volume":return e.jsx("span",{className:"font-mono text-xs",children:le(r?.volume)});case"pe_bid_qty":return e.jsx("span",{className:"text-xs",children:r?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:"text-red-500 text-xs",children:X(r?.bid)});case"pe_ltp":return e.jsx("span",{className:k("font-semibold text-xs",x),children:X(r?.ltp)});case"pe_ask":return e.jsx("span",{className:"text-green-500 text-xs",children:X(r?.ask)});case"pe_ask_qty":return e.jsx("span",{className:"text-xs",children:r?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:k("text-xs",P),children:X(L)});default:return null}};return e.jsxs(ye,{className:k("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":u,children:[a.length>0&&e.jsxs(ge,{className:k("p-0 relative",h&&!v&&"bg-amber-500/5"),children:[e.jsx("div",{className:k("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",K),style:{width:`${W}%`}}),c&&e.jsxs("div",{className:k("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),N({symbol:c.symbol,exchange:p,action:"BUY",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:C=>{C.stopPropagation(),N({symbol:c.symbol,exchange:p,action:"SELL",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:a.map(C=>{const V=U.find(H=>H.key===C);return e.jsx("div",{className:k("flex-1 px-2 py-1.5 min-w-0",V?.align==="right"&&"text-right",V?.align==="center"&&"text-center",V?.align==="left"&&"text-left"),children:R(C)},C)})})]}),e.jsx(ge,{className:k("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",v?"bg-primary/15":"bg-muted/30"),children:t.strike}),i.length>0&&e.jsxs(ge,{className:k("p-0 relative",O&&!v&&"bg-amber-500/5"),children:[e.jsx("div",{className:k("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",B),style:{width:`${Q}%`}}),r&&e.jsxs("div",{className:k("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:C=>{C.stopPropagation(),N({symbol:r.symbol,exchange:p,action:"BUY",lotSize:r.lotsize??1,tickSize:r.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:C=>{C.stopPropagation(),N({symbol:r.symbol,exchange:p,action:"SELL",lotSize:r.lotsize??1,tickSize:r.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:i.map(C=>{const V=U.find(H=>H.key===C);return e.jsx("div",{className:k("flex-1 px-2 py-1.5 min-w-0",V?.align==="right"&&"text-right",V?.align==="center"&&"text-center",V?.align==="left"&&"text-left"),children:A(C)},C)})})]})]})}function Ws(){const{apiKey:t}=Ie(),{visibleColumns:s,columnOrder:n,strikeCount:a,selectedUnderlying:i,barDataSource:o,barStyle:l,toggleColumn:p,reorderColumns:N,setStrikeCount:b,setSelectedUnderlying:c,setBarDataSource:r,setBarStyle:u,resetToDefaults:v}=ms(),[h,O]=d.useState(""),[M,S]=d.useState([]),[w,x]=d.useState(new Map),[j,L]=d.useState(null),E=be.find(m=>m.value===i),P=E?.brokerExchange??"NSE_INDEX",I=E?.exchange??"NFO",{data:g,isConnected:W,isStreaming:Q,isPaused:K,error:B,lastUpdate:R,refetch:A,isLoading:C,streamingSymbols:V}=os(t,i,P,I,ws(h),a,{enabled:!!h,oiRefreshInterval:3e4,pauseWhenHidden:!0});d.useEffect(()=>{(async()=>{if(!(!t||!i))try{const _=await ps.getExpiries(t,i,I);_.status==="success"&&_.data.length>0?(S(_.data),h||O(_.data[0])):ee.error(_.message||"Failed to load expiries","orders")}catch(_){console.error("Error loading expiries:",_),ee.error("Failed to load expiry dates","orders")}})()},[t,i,I,h]),d.useEffect(()=>{if(g?.chain){const m=new Map;g.chain.forEach(_=>{m.set(_.strike,_)}),x(m)}},[g?.chain]);const H=m=>{be.find(Y=>Y.value===m)&&(c(m),O(""),S([]))},D=()=>{A()},Z=d.useCallback(m=>{L({open:!0,symbol:m.symbol,exchange:m.exchange,action:m.action,quantity:m.lotSize,lotSize:m.lotSize,tickSize:m.tickSize})},[]),T=d.useMemo(()=>g?.chain?ks(g.chain):0,[g?.chain]),y=d.useMemo(()=>g?.chain?Ds(g.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[g?.chain]),z=d.useMemo(()=>g?.chain?_s(g.chain,o):1,[g?.chain,o]),q=d.useMemo(()=>n.filter(m=>U.find(Y=>Y.key===m)?.side==="ce"&&s.includes(m)),[n,s]),se=d.useMemo(()=>n.filter(m=>U.find(Y=>Y.key===m)?.side==="pe"&&s.includes(m)),[n,s]);return B?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(ae,{className:"max-w-md",children:e.jsx(re,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:B}),e.jsxs(F,{onClick:D,className:"mt-4",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ie,{value:i,onValueChange:H,children:[e.jsx(oe,{className:"w-36",children:e.jsx(ce,{placeholder:"Select Underlying"})}),e.jsx(de,{children:be.map(m=>e.jsx(ue,{value:m.value,children:m.label},m.value))})]}),e.jsxs(ie,{value:h,onValueChange:O,disabled:M.length===0,children:[e.jsx(oe,{className:"w-36",children:e.jsx(ce,{placeholder:"Select Expiry"})}),e.jsx(de,{children:M.map(m=>e.jsx(ue,{value:m,children:m},m))})]}),e.jsxs(ie,{value:String(a),onValueChange:m=>b(Number(m)),children:[e.jsx(oe,{className:"w-36",children:e.jsx(ce,{placeholder:"Strike Count"})}),e.jsx(de,{children:Ss.map(m=>e.jsx(ue,{value:String(m.value),children:m.label},m.value))})]}),e.jsx(hs,{barDataSource:o,barStyle:l,onBarDataSourceChange:r,onBarStyleChange:u}),e.jsx(fs,{visibleColumns:s,onToggleColumn:p,onResetToDefaults:v}),e.jsx(gs,{columnOrder:n,visibleColumns:s,onReorderColumns:N}),e.jsxs(F,{onClick:D,disabled:!h||C,children:[e.jsx(we,{className:`h-4 w-4 mr-2 ${C?"animate-spin":""}`}),"Refresh"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[i," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:X(g.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",X(g.underlying_prev_close)]})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:g.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",g.expiry_date]})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${T>1?"text-green-500":"text-yellow-500"}`,children:T.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono",children:le(y.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono",children:le(y.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:y.ceOi+y.peOi>0?`${y.ceOi/(y.ceOi+y.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",T.toFixed(2)]})})]})})]}),e.jsx(ae,{children:e.jsx(re,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(rs,{className:"w-full",children:[e.jsxs(ns,{children:[e.jsxs(ye,{className:"bg-muted/30 border-b-0",children:[q.length>0&&e.jsx(ne,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(ne,{className:"text-center w-20 min-w-20"}),se.length>0&&e.jsx(ne,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(ye,{className:"bg-muted/50",children:[q.length>0&&e.jsx(ne,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:q.map(m=>{const _=U.find(Y=>Y.key===m);return e.jsx("div",{className:k("flex-1 px-2 py-2 text-xs font-medium min-w-0",_?.align==="right"&&"text-right",_?.align==="center"&&"text-center",_?.align==="left"&&"text-left"),children:_?.label},m)})})}),e.jsx(ne,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),se.length>0&&e.jsx(ne,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:se.map(m=>{const _=U.find(Y=>Y.key===m);return e.jsx("div",{className:k("flex-1 px-2 py-2 text-xs font-medium min-w-0",_?.align==="right"&&"text-right",_?.align==="center"&&"text-center",_?.align==="left"&&"text-left"),children:_?.label},m)})})})]})]}),e.jsx(ls,{children:g.chain.map(m=>e.jsx(Ls,{strike:m,previousData:w,maxBarValue:z,visibleCeColumns:q,visiblePeColumns:se,barDataSource:o,barStyle:l,optionExchange:I,onPlaceOrder:Z},m.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Q?e.jsx(He,{className:"h-4 w-4 text-green-500"}):e.jsx(Ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Ae,{variant:Q?"default":W?"secondary":"destructive",children:K?"Paused":Q?`Streaming ${V} symbols`:W?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",o==="oi"?"OI":"Volume"," (",l,")"]})]}),e.jsxs("div",{children:["Last Update: ",R?R.toLocaleTimeString():"-"]})]})]}),!g&&!B&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Cs,{open:j?.open??!1,onOpenChange:m=>{m||L(null)},symbol:j?.symbol,exchange:j?.exchange,action:j?.action,quantity:j?.quantity,lotSize:j?.lotSize,tickSize:j?.tickSize,strategy:"OptionChain"})]})}export{Ws as default};
