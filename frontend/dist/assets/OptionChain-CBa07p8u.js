import{r as l,j as e,a as We}from"./vendor-react-CCyQGCED.js";import{g as Xe,D as Te,j as Ie,B as z,k as Me,A as ge,C as De,E as pe,n as Ne,G as ke,c as S,e as Fe,d as Se,s as le}from"./index-BdWlx98l.js";import{a as Re,u as He}from"./useMarketStatus-rpvQ4SLW.js";import{o as Ke}from"./option-chain-BxuVfDPC.js";import{i as Ge,a1 as Je,ae as Ze,aT as et,aU as tt,Y as _e,c as st,aB as at,aD as rt}from"./vendor-icons-Ys8lBJ3m.js";import{D as Be,a as nt,b as Ue,c as Ve,d as qe,e as lt,f as Ae,g as it}from"./dialog-CTDS0ag2.js";import{S as Ee}from"./scroll-area-C3DNWhAn.js";import{I as be}from"./input-Czjmyujy.js";import{L as te}from"./label-rALFgWCK.js";import{S as ce,a as oe,b as de,c as ue,d as me}from"./select-CHGfSVeS.js";import{t as ve}from"./trading-CWBoxfuN.js";import{C as ct,b as ot,a as dt}from"./collapsible-DcfHjv7p.js";import{C as se,d as ae}from"./card-BtyxT_5a.js";import{T as ut,a as mt,b as Ce,c as re,d as xt,e as je}from"./table-CSGdtHsN.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";function pt(s,t,n,r,d,u={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:i,refreshInterval:b=3e4,pauseWhenHidden:N=!0}=u,{isVisible:C}=Xe(),[c,a]=l.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),p=l.useRef(null),h=l.useRef(null),f=i&&(!N||C),T=l.useCallback(async()=>{if(!(!s||!t||!n||!r)&&!h.current){a(k=>({...k,isLoading:!0}));try{const k=new AbortController;h.current=k;const j=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:n,expiry_date:r,strike_count:d}),signal:k.signal});if(!j.ok)throw new Error(`HTTP error! status: ${j.status}`);const m=await j.json();m.status==="success"?a(w=>({...w,data:m,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):a(w=>({...w,isLoading:!1,error:m.message||"Failed to fetch option chain"}))}catch(k){k instanceof Error&&(k.name==="AbortError"?h.current===null&&a(j=>({...j,isLoading:!1})):a(j=>({...j,isLoading:!1,error:k.message||"Connection error",isConnected:!1})))}finally{h.current=null}}},[s,t,n,r,d]);l.useEffect(()=>{if(!f){p.current&&(clearInterval(p.current),p.current=null),a(k=>({...k,isPaused:!!i}));return}return a(k=>({...k,isConnected:!0,isPaused:!1})),T(),p.current=setInterval(T,b),()=>{p.current&&(clearInterval(p.current),p.current=null),h.current&&(h.current.abort(),h.current=null)}},[f,T,b,i]);const R=l.useCallback(()=>{T()},[T]);return{...c,refetch:R}}function ne(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function ht(s,t,n,r,d,u,i={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:b,oiRefreshInterval:N=3e4,pauseWhenHidden:C=!0}=i,[c,a]=l.useState(null),[p,h]=l.useState(null),{data:f,isLoading:T,isConnected:R,isPaused:k,error:j,lastUpdate:m,refetch:w}=pt(s,t,n,d,u,{enabled:b,refreshInterval:N,pauseWhenHidden:C}),_=l.useMemo(()=>{const v=[],q=r==="BFO"?"BSE_INDEX":"NSE_INDEX";if(v.push({symbol:t,exchange:q}),f?.chain)for(const Y of f.chain)Y.ce?.symbol&&v.push({symbol:Y.ce.symbol,exchange:r}),Y.pe?.symbol&&v.push({symbol:Y.pe.symbol,exchange:r});return v},[f?.chain,r,t]),{data:O,isConnected:M,isAuthenticated:x,isPaused:U}=Re({symbols:_,mode:"Depth",enabled:b&&_.length>0}),Q=l.useRef(0);l.useEffect(()=>{if(!f){a(null);return}if(O.size===0){a(f);return}const v=f.chain.map(D=>{const E={...D};if(D.ce?.symbol){const g=`${r}:${D.ce.symbol}`,F=O.get(g);if(F?.data){const X=F.data.depth?.buy?.[0],V=F.data.depth?.sell?.[0],o=D.ce.tick_size;E.ce={...D.ce,ltp:ne(F.data.ltp,o)??D.ce.ltp,bid:ne(X?.price??F.data.bid_price,o)??D.ce.bid,ask:ne(V?.price??F.data.ask_price,o)??D.ce.ask,bid_qty:X?.quantity??F.data.bid_size??D.ce.bid_qty??0,ask_qty:V?.quantity??F.data.ask_size??D.ce.ask_qty??0}}}if(D.pe?.symbol){const g=`${r}:${D.pe.symbol}`,F=O.get(g);if(F?.data){const X=F.data.depth?.buy?.[0],V=F.data.depth?.sell?.[0],o=D.pe.tick_size;E.pe={...D.pe,ltp:ne(F.data.ltp,o)??D.pe.ltp,bid:ne(X?.price??F.data.bid_price,o)??D.pe.bid,ask:ne(V?.price??F.data.ask_price,o)??D.pe.ask,bid_qty:X?.quantity??F.data.bid_size??D.pe.bid_qty??0,ask_qty:V?.quantity??F.data.ask_size??D.pe.ask_qty??0}}}return E});let q=!1;for(const[,D]of O)if(D.lastUpdate&&D.lastUpdate>Q.current){q=!0,Q.current=D.lastUpdate;break}q&&h(new Date);const y=`${r==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${t}`,B=O.get(y)?.data?.ltp??f.underlying_ltp;a({...f,underlying_ltp:B,chain:v})},[f,O,r,t]);const H=M&&x&&_.length>0,K=k||U,W=l.useMemo(()=>!m&&!p?null:m?p&&p>m?p:m:p,[m,p]);return{data:c,isLoading:T,isConnected:R,isStreaming:H,isPaused:K,error:j,lastUpdate:W,streamingSymbols:_.length,refetch:w}}const $=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],ft=$.map(s=>s.key),gt=$.filter(s=>s.defaultVisible).map(s=>s.key),Z={visibleColumns:gt,columnOrder:ft,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},ze="openalgo_option_chain_prefs";function bt(){if(typeof window>"u")return Z;try{const s=localStorage.getItem(ze);if(!s)return Z;const t=JSON.parse(s),n=new Set($.map(i=>i.key)),r=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(i=>n.has(i)):Z.visibleColumns;r.includes("strike")||r.push("strike");const d=Array.isArray(t.columnOrder)?t.columnOrder.filter(i=>n.has(i)):Z.columnOrder,u=new Set(d);return Z.columnOrder.forEach(i=>{u.has(i)||d.push(i)}),{visibleColumns:r,columnOrder:d,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:Z.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:Z.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:Z.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:Z.barStyle}}catch{return Z}}function jt(s){if(!(typeof window>"u"))try{localStorage.setItem(ze,JSON.stringify(s))}catch{}}function yt(){const[s,t]=l.useState(()=>bt());l.useEffect(()=>{jt(s)},[s]);const n=l.useCallback(a=>{a!=="strike"&&t(p=>{const f=p.visibleColumns.includes(a)?p.visibleColumns.filter(T=>T!==a):[...p.visibleColumns,a];return{...p,visibleColumns:f}})},[]),r=l.useCallback(a=>{t(p=>({...p,columnOrder:a}))},[]),d=l.useCallback(a=>{t(p=>({...p,strikeCount:a}))},[]),u=l.useCallback(a=>{t(p=>({...p,selectedUnderlying:a}))},[]),i=l.useCallback(a=>{t(p=>({...p,barDataSource:a}))},[]),b=l.useCallback(a=>{t(p=>({...p,barStyle:a}))},[]),N=l.useCallback(()=>{t(Z)},[]),C=l.useCallback(a=>s.visibleColumns.includes(a),[s.visibleColumns]),c=l.useCallback(()=>s.columnOrder.filter(a=>s.visibleColumns.includes(a)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:n,reorderColumns:r,setStrikeCount:d,setSelectedUnderlying:u,setBarDataSource:i,setBarStyle:b,resetToDefaults:N,isColumnVisible:C,getOrderedVisibleColumns:c}}function Nt({barDataSource:s,barStyle:t,onBarDataSourceChange:n,onBarStyleChange:r}){return e.jsxs(Te,{children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Me,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"Bar Data"}),e.jsxs(De,{value:s,onValueChange:d=>n(d),children:[e.jsx(pe,{value:"oi",children:"Open Interest"}),e.jsx(pe,{value:"volume",children:"Volume"})]}),e.jsx(Ne,{}),e.jsx(ge,{children:"Bar Style"}),e.jsxs(De,{value:t,onValueChange:d=>r(d),children:[e.jsx(pe,{value:"gradient",children:"Gradient"}),e.jsx(pe,{value:"solid",children:"Solid"})]})]})]})}function vt({visibleColumns:s,onToggleColumn:t,onResetToDefaults:n}){const r=$.filter(i=>i.side==="ce"),d=$.filter(i=>i.side==="pe"),u=i=>s.includes(i);return e.jsxs(Te,{children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Me,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"CALLS Columns"}),r.map(i=>e.jsx(ke,{checked:u(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ne,{}),e.jsx(ge,{children:"PUTS Columns"}),d.map(i=>e.jsx(ke,{checked:u(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ne,{}),e.jsxs(z,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:n,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Pe({columnKey:s,label:t,side:n,isVisible:r,isDragging:d,onDragStart:u,onDragOver:i,onDrop:b,onDragEnd:N}){return e.jsxs("div",{draggable:!0,onDragStart:C=>u(C,s),onDragOver:i,onDrop:C=>b(C,s),onDragEnd:N,className:S("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",d&&"opacity-50 border-dashed",r?"bg-card":"bg-muted/50 opacity-60",n==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(tt,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:S("text-xs px-1.5 py-0.5 rounded",n==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:n==="ce"?"CE":"PE"})]})}function Ct({columnOrder:s,visibleColumns:t,onReorderColumns:n}){const[r,d]=l.useState(s),[u,i]=l.useState(null),[b,N]=l.useState(!1),C=r.filter(m=>$.find(_=>_.key===m)?.side==="ce"),c=r.filter(m=>$.find(_=>_.key===m)?.side==="pe"),a=m=>$.find(_=>_.key===m)?.label??m,p=m=>$.find(_=>_.key===m)?.side==="pe"?"pe":"ce",h=(m,w)=>{i(w),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain",w)},f=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},T=(m,w)=>{if(m.preventDefault(),!u||u===w)return;const _=p(u),O=p(w);if(_!==O)return;const M=[...r],x=M.indexOf(u),U=M.indexOf(w);M.splice(x,1),M.splice(U,0,u),d(M)},R=()=>{i(null)},k=()=>{n(r),N(!1)},j=m=>{N(m),m&&d(s)};return e.jsxs(Be,{open:b,onOpenChange:j,children:[e.jsx(nt,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Ue,{className:"sm:max-w-md",children:[e.jsxs(Ve,{children:[e.jsx(qe,{children:"Reorder Columns"}),e.jsx(lt,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Ee,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:C.map(m=>e.jsx(Pe,{columnKey:m,label:a(m),side:"ce",isVisible:t.includes(m),isDragging:u===m,onDragStart:h,onDragOver:f,onDrop:T,onDragEnd:R},m))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Ee,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:c.map(m=>e.jsx(Pe,{columnKey:m,label:a(m),side:"pe",isVisible:t.includes(m),isDragging:u===m,onDragStart:h,onDragOver:f,onDrop:T,onDragEnd:R},m))})})]})]}),e.jsxs(Ae,{className:"gap-2 sm:gap-0",children:[e.jsx(it,{asChild:!0,children:e.jsx(z,{variant:"outline",children:"Cancel"})}),e.jsx(z,{onClick:k,children:"Save Order"})]})]})]})}function St(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function wt({exchange:s,ltp:t,prevClose:n,change:r,changePercent:d,bidPrice:u,askPrice:i,bidSize:b,askSize:N,isLoading:C}){const c=r??(t&&n?t-n:void 0),a=d??(c&&n?c/n*100:void 0),p=c!==void 0&&c>=0;return C?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Fe,{className:S("text-[10px] px-1.5 py-0",St(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),c!==void 0&&e.jsxs("span",{className:S("text-sm font-medium",p?"text-green-500":"text-red-500"),children:[p?"+":"",c.toFixed(2),a!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",p?"+":"",a.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:u!==void 0&&u>0?u.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",b.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:i!==void 0&&i>0?i.toFixed(2):"-"}),N!==void 0&&N>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",N.toLocaleString()]})]})]})]})}function Le({price:s,quantity:t,maxQty:n,side:r}){const d=n>0?Math.min(t/n*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:S("absolute top-0 bottom-0 transition-all duration-300",r==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${d}%`}})}),e.jsx("span",{className:S("relative z-10 flex-1 font-mono text-xs",r==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function Dt({depth:s,isExpanded:t,onToggle:n,maxLevels:r=5}){const d=s?.buy?.slice(0,r)??[],u=s?.sell?.slice(0,r)??[],i=Math.max(...d.map(c=>c.quantity),1),b=Math.max(...u.map(c=>c.quantity),1),N=Math.max(i,b),C=d.length>0||u.length>0;return e.jsxs(ct,{open:t,onOpenChange:n,children:[e.jsxs(ot,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(dt,{children:C?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:d.length>0?d.map((c,a)=>e.jsx(Le,{price:c.price,quantity:c.quantity,maxQty:N,side:"buy"},`buy-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:u.length>0?u.map((c,a)=>e.jsx(Le,{price:c.price,quantity:c.quantity,maxQty:N,side:"sell"},`sell-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:d.reduce((c,a)=>c+a.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:u.reduce((c,a)=>c+a.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}function kt(s,t,n={}){const{enabled:r=!0,mode:d="Depth",useQuotesFallback:u=!0,useDepthFallback:i=!0,staleThreshold:b=5e3,refreshInterval:N=3e4}=n,{apiKey:C}=Se(),{isMarketOpen:c}=He(),[a,p]=l.useState(null),[h,f]=l.useState(null),[T,R]=l.useState(!1),k=l.useRef(0),j=!!s&&!!t,m=l.useMemo(()=>j?[{symbol:s,exchange:t}]:[],[s,t,j]),{data:w,isConnected:_,isPaused:O,isFallbackMode:M}=Re({symbols:m,mode:d,enabled:r&&j}),x=w.get(`${t}:${s}`)?.data,U=w.get(`${t}:${s}`)?.lastUpdate,Q=c(t),H=!!(_&&x&&U&&Date.now()-U<b),K=H&&Q&&!O,W=l.useCallback(async()=>{if(!(!C||!j)){R(!0);try{const E=[];u&&E.push(ve.getQuotes(C,s,t).then(g=>{g.status==="success"&&g.data&&p(g.data)}).catch(()=>{console.debug("REST quotes fetch failed")})),i&&d==="Depth"&&E.push(ve.getDepth(C,s,t).then(g=>{g.status==="success"&&g.data&&f(g.data)}).catch(()=>{console.debug("REST depth fetch failed")})),await Promise.all(E),k.current=Date.now()}finally{R(!1)}}},[C,s,t,j,u,i,d]),v=l.useRef(r),q=l.useRef(j),Y=l.useRef(W);l.useEffect(()=>{v.current=r,q.current=j,Y.current=W},[r,j,W]),l.useEffect(()=>{if(!r||!j)return;Y.current();const E=setInterval(()=>{v.current&&q.current&&Y.current()},N);return()=>clearInterval(E)},[r,j,s,t,N]),l.useEffect(()=>{p(null),f(null)},[s,t]);const y=l.useMemo(()=>{if(h)return{buy:h.bids.map(E=>({price:E.price,quantity:E.quantity})),sell:h.asks.map(E=>({price:E.price,quantity:E.quantity}))}},[h]),I=l.useMemo(()=>{const E=x?.depth??y,g=x?.depth?.buy?.[0]?.price??y?.buy?.[0]?.price??x?.bid_price??a?.bid,F=x?.depth?.sell?.[0]?.price??y?.sell?.[0]?.price??x?.ask_price??a?.ask,X=x?.depth?.buy?.[0]?.quantity??y?.buy?.[0]?.quantity??x?.bid_size,V=x?.depth?.sell?.[0]?.quantity??y?.sell?.[0]?.quantity??x?.ask_size;return{ltp:x?.ltp??h?.ltp??a?.ltp,open:x?.open??h?.open??a?.open,high:x?.high??h?.high??a?.high,low:x?.low??h?.low??a?.low,close:x?.close??h?.prev_close??a?.prev_close,volume:x?.volume??h?.volume??a?.volume,oi:h?.oi??a?.oi,change:x?.change,changePercent:x?.change_percent,bidPrice:g,askPrice:F,bidSize:X,askSize:V,depth:E}},[x,a,h,y]),B=l.useMemo(()=>{if(I.change!==void 0)return I;const E=I.ltp&&I.close?I.ltp-I.close:void 0,g=E&&I.close?E/I.close*100:void 0;return{...I,change:E,changePercent:g}},[I]),D=l.useMemo(()=>H?"websocket":a||h?"rest":"none",[H,a,h]);return{data:B,isLive:K,isConnected:_,isLoading:T&&!a&&!h,isPaused:O,isFallbackMode:M,dataSource:D,refresh:W}}const _t=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Et=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Pt=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function fe(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function he(s,t,n){const r=fe(s,t);return n==="up"?Number((r+t).toFixed(2)):Math.max(0,Number((r-t).toFixed(2)))}function Oe(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function Lt({open:s,onOpenChange:t,symbol:n="",exchange:r="",action:d="BUY",quantity:u,lotSize:i=1,tickSize:b=.05,product:N="NRML",priceType:C="MARKET",strategy:c="OptionChain",onSuccess:a,onError:p}){const{apiKey:h}=Se(),[f,T]=l.useState(d),[R,k]=l.useState(u??i),[j,m]=l.useState(C),[w,_]=l.useState(N),[O,M]=l.useState(0),[x,U]=l.useState(0),[Q,H]=l.useState(!1),[K,W]=l.useState(!1),[v,q]=l.useState("lots"),[Y,y]=l.useState(1),I=Oe(r)?Et:Pt,{data:B,isLoading:D,isConnected:E}=kt(n,r,{enabled:s&&!!n&&!!r,mode:"Depth",useQuotesFallback:!0,useDepthFallback:!0});l.useEffect(()=>{if(s){T(d),k(u??i),m(C);const P=Oe(r),G=P?"NRML":"CNC",xe=N&&(P?["NRML","MIS"]:["CNC","MIS"]).includes(N)?N:G;_(xe),M(0),U(0),W(!1),q("lots"),y(1)}},[s,d,u,i,C,N,r]);const g={ltp:B.ltp,close:B.close,change:B.change,change_percent:B.changePercent,bidPrice:B.bidPrice,askPrice:B.askPrice,bidSize:B.bidSize,askSize:B.askSize,depth:B.depth},F=g.change,X=g.change_percent;l.useEffect(()=>{j!=="MARKET"&&g.ltp&&O===0&&M(fe(g.ltp,b))},[j,g.ltp,O,b]);const V=j==="LIMIT"||j==="SL",o=j==="SL-M"||j==="SL",L=l.useCallback(()=>!(!n||!r||!h||R<=0||V&&O<=0||o&&x<=0),[n,r,h,R,V,O,o,x]),A=async()=>{if(!L()){le.error("Please fill all required fields");return}if(!h){le.error("API key not found. Please set up your API key."),p?.("API key not found");return}H(!0);try{const G={apikey:h,strategy:c,exchange:r,symbol:n,action:f,quantity:R,pricetype:j,product:w,...V&&{price:O},...o&&{trigger_price:x}},J=await ve.placeOrder(G),xe=J.orderid;if(J.status==="success"&&xe)a?.(xe),t(!1);else{const we=J.message||"Order placement failed";le.error(we,"orders"),p?.(we)}}catch(P){let G="Order placement failed";if(P&&typeof P=="object"){const J=P;J.response?.data?.message?G=J.response.data.message:J.message&&(G=J.message)}le.error(G,"orders"),p?.(G)}finally{H(!1)}},Ye=P=>{const G=parseInt(P)||0;if(v==="lots")k(G*i),y(G);else{const J=Math.max(i,Math.round(G/i)*i);k(J),y(J/i)}},$e=v==="lots"?Y:R,Qe=D&&!g.ltp&&!E;return e.jsx(Be,{open:s,onOpenChange:t,children:e.jsxs(Ue,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(Ve,{children:e.jsxs(qe,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:f==="BUY"?"text-green-500":"text-red-500",children:f}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:n})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(wt,{exchange:r,ltp:g.ltp,prevClose:g.close,change:F,changePercent:X,bidPrice:g.bidPrice,askPrice:g.askPrice,bidSize:g.bidSize,askSize:g.askSize,isLoading:Qe}),e.jsx(Dt,{depth:g.depth,isExpanded:K,onToggle:()=>W(!K),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",variant:f==="BUY"?"default":"outline",className:S("flex-1",f==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>T("BUY"),children:"BUY"}),e.jsx(z,{type:"button",variant:f==="SELL"?"default":"outline",className:S("flex-1",f==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>T("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>q("lots"),className:S("px-2 py-0.5 text-[10px] rounded",v==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>q("shares"),className:S("px-2 py-0.5 text-[10px] rounded",v==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(be,{type:"number",value:$e,onChange:P=>Ye(P.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",i]}),e.jsxs("span",{children:["Total qty: ",R]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price Type"}),e.jsxs(ce,{value:j,onValueChange:P=>m(P),children:[e.jsx(oe,{children:e.jsx(de,{})}),e.jsx(ue,{children:_t.map(P=>e.jsx(me,{value:P.value,children:P.label},P.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Product"}),e.jsxs(ce,{value:w,onValueChange:P=>_(P),children:[e.jsx(oe,{children:e.jsx(de,{})}),e.jsx(ue,{children:I.map(P=>e.jsx(me,{value:P.value,children:P.label},P.value))})]})]})]}),V&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>M(he(O,b,"down")),children:"-"}),e.jsx(be,{type:"number",value:O,onChange:P=>M(parseFloat(P.target.value)||0),onBlur:()=>M(fe(O,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>M(he(O,b,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",b]})]}),o&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>U(he(x,b,"down")),children:"-"}),e.jsx(be,{type:"number",value:x,onChange:P=>U(parseFloat(P.target.value)||0),onBlur:()=>U(fe(x,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx(z,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>U(he(x,b,"up")),children:"+"})]})]})]}),e.jsxs(Ae,{className:"gap-2 sm:gap-0",children:[e.jsx(z,{variant:"outline",onClick:()=>t(!1),disabled:Q,children:"Cancel"}),e.jsx(z,{onClick:A,disabled:!L()||Q,className:S(f==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:Q?"Placing...":`Place ${f} Order`})]})]})})}const ye=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],Ot=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function ie(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const n=s/1e3;return n>=1?n.toFixed(1)+"K":s.toLocaleString()}}function ee(s){return s==null?"0.00":s.toFixed(2)}function Tt(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function It(s){let t=0,n=0;return s.forEach(r=>{r.ce?.oi&&(t+=r.ce.oi),r.pe?.oi&&(n+=r.pe?.oi??0)}),t===0?0:n/t}function Mt(s){let t=0,n=0,r=0,d=0;return s.forEach(u=>{u.ce&&(t+=u.ce.volume??0,r+=u.ce.oi??0),u.pe&&(n+=u.pe.volume??0,d+=u.pe.oi??0)}),{ceVolume:t,peVolume:n,ceOi:r,peOi:d}}function Ft(s,t){let n=0;return s.forEach(r=>{const d=t==="oi"?r.ce?.oi:r.ce?.volume,u=t==="oi"?r.pe?.oi:r.pe?.volume;d&&d>n&&(n=d),u&&u>n&&(n=u)}),n||1}const Rt=We.memo(function({strike:t,previousStrike:n,maxBarValue:r,visibleCeColumns:d,visiblePeColumns:u,barDataSource:i,barStyle:b,optionExchange:N,onPlaceOrder:C}){const c=t.ce,a=t.pe,p=c?.label??a?.label??"",h=p==="ATM",f=p.startsWith("OTM"),T=p.startsWith("ITM"),R=n?.ce?.ltp!==void 0&&n.ce.ltp!==c?.ltp,k=n?.pe?.ltp!==void 0&&n.pe.ltp!==a?.ltp,j=R?c&&n?.ce&&c.ltp>n.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",m=k?a&&n?.pe&&a.ltp>n.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",w=c&&c.bid>0&&c.ask>0?c.ask-c.bid:0,_=a&&a.bid>0&&a.ask>0?a.ask-a.bid:0,O=w<=1?"text-green-500":w<=2?"text-yellow-500":"text-red-500",M=_<=1?"text-green-500":_<=2?"text-yellow-500":"text-red-500",x=i==="oi"?c?.oi:c?.volume,U=i==="oi"?a?.oi:a?.volume,Q=x?Math.min(x/r*100,100):0,H=U?Math.min(U/r*100,100):0,K=b==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",W=b==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",v="font-mono tabular-nums text-xs",q=y=>{switch(y){case"ce_oi":return e.jsx("span",{className:v,children:ie(c?.oi)});case"ce_volume":return e.jsx("span",{className:v,children:ie(c?.volume)});case"ce_bid_qty":return e.jsx("span",{className:v,children:c?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:S(v,"text-red-500"),children:ee(c?.bid)});case"ce_ltp":return e.jsx("span",{className:S(v,"font-semibold",j),children:ee(c?.ltp)});case"ce_ask":return e.jsx("span",{className:S(v,"text-green-500"),children:ee(c?.ask)});case"ce_ask_qty":return e.jsx("span",{className:v,children:c?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:S(v,O),children:ee(w)});default:return null}},Y=y=>{switch(y){case"pe_oi":return e.jsx("span",{className:v,children:ie(a?.oi)});case"pe_volume":return e.jsx("span",{className:v,children:ie(a?.volume)});case"pe_bid_qty":return e.jsx("span",{className:v,children:a?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:S(v,"text-red-500"),children:ee(a?.bid)});case"pe_ltp":return e.jsx("span",{className:S(v,"font-semibold",m),children:ee(a?.ltp)});case"pe_ask":return e.jsx("span",{className:S(v,"text-green-500"),children:ee(a?.ask)});case"pe_ask_qty":return e.jsx("span",{className:v,children:a?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:S(v,M),children:ee(_)});default:return null}};return e.jsxs(Ce,{className:S("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":p,children:[d.length>0&&e.jsxs(je,{className:S("p-0 relative",f&&!h&&"bg-amber-500/5"),children:[e.jsx("div",{className:S("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",K),style:{width:`${Q}%`}}),c&&e.jsxs("div",{className:S("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:c.symbol,exchange:N,action:"BUY",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:c.symbol,exchange:N,action:"SELL",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:d.map(y=>{const I=$.find(B=>B.key===y);return e.jsx("div",{className:S("flex-1 px-2 py-1.5 min-w-0",I?.align==="right"&&"text-right",I?.align==="center"&&"text-center",I?.align==="left"&&"text-left"),children:q(y)},y)})})]}),e.jsx(je,{className:S("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",h?"bg-primary/15":"bg-muted/30"),children:t.strike}),u.length>0&&e.jsxs(je,{className:S("p-0 relative",T&&!h&&"bg-amber-500/5"),children:[e.jsx("div",{className:S("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",W),style:{width:`${H}%`}}),a&&e.jsxs("div",{className:S("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:a.symbol,exchange:N,action:"BUY",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),C({symbol:a.symbol,exchange:N,action:"SELL",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:u.map(y=>{const I=$.find(B=>B.key===y);return e.jsx("div",{className:S("flex-1 px-2 py-1.5 min-w-0",I?.align==="right"&&"text-right",I?.align==="center"&&"text-center",I?.align==="left"&&"text-left"),children:Y(y)},y)})})]})]})});function ts(){const{apiKey:s}=Se(),{visibleColumns:t,columnOrder:n,strikeCount:r,selectedUnderlying:d,barDataSource:u,barStyle:i,toggleColumn:b,reorderColumns:N,setStrikeCount:C,setSelectedUnderlying:c,setBarDataSource:a,setBarStyle:p,resetToDefaults:h}=yt(),[f,T]=l.useState(""),[R,k]=l.useState([]),j=l.useRef(new Map),[m,w]=l.useState(null),_=ye.find(o=>o.value===d),O=_?.brokerExchange??"NSE_INDEX",M=_?.exchange??"NFO",{data:x,isConnected:U,isStreaming:Q,isPaused:H,error:K,lastUpdate:W,refetch:v,isLoading:q,streamingSymbols:Y}=ht(s,d,O,M,Tt(f),r,{enabled:!!f,oiRefreshInterval:3e4,pauseWhenHidden:!0});l.useEffect(()=>{(async()=>{if(!(!s||!d))try{const L=await Ke.getExpiries(s,d,M);L.status==="success"&&L.data.length>0?(k(L.data),T(A=>A||L.data[0])):le.error(L.message||"Failed to load expiries")}catch(L){console.error("Error loading expiries:",L),le.error("Failed to load expiry dates")}})()},[s,d,M]),l.useEffect(()=>{if(x?.chain){const o=setTimeout(()=>{const L=new Map;x.chain.forEach(A=>{L.set(A.strike,A)}),j.current=L},100);return()=>clearTimeout(o)}},[x?.chain]);const y=o=>{ye.find(A=>A.value===o)&&(c(o),T(""),k([]))},I=()=>{v()},B=l.useCallback(o=>{w({open:!0,symbol:o.symbol,exchange:o.exchange,action:o.action,quantity:o.lotSize,lotSize:o.lotSize,tickSize:o.tickSize})},[]),D=l.useCallback(o=>{o||w(null)},[]),E=l.useMemo(()=>x?.chain?It(x.chain):0,[x?.chain]),g=l.useMemo(()=>x?.chain?Mt(x.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[x?.chain]),F=l.useMemo(()=>x?.chain?Ft(x.chain,u):1,[x?.chain,u]),X=l.useMemo(()=>n.filter(o=>$.find(A=>A.key===o)?.side==="ce"&&t.includes(o)),[n,t]),V=l.useMemo(()=>n.filter(o=>$.find(A=>A.key===o)?.side==="pe"&&t.includes(o)),[n,t]);return K?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(se,{className:"max-w-md",children:e.jsx(ae,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:K}),e.jsxs(z,{onClick:I,className:"mt-4",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ce,{value:d,onValueChange:y,children:[e.jsx(oe,{className:"w-36",children:e.jsx(de,{placeholder:"Select Underlying"})}),e.jsx(ue,{children:ye.map(o=>e.jsx(me,{value:o.value,children:o.label},o.value))})]}),e.jsxs(ce,{value:f,onValueChange:T,disabled:R.length===0,children:[e.jsx(oe,{className:"w-36",children:e.jsx(de,{placeholder:"Select Expiry"})}),e.jsx(ue,{children:R.map(o=>e.jsx(me,{value:o,children:o},o))})]}),e.jsxs(ce,{value:String(r),onValueChange:o=>C(Number(o)),children:[e.jsx(oe,{className:"w-36",children:e.jsx(de,{placeholder:"Strike Count"})}),e.jsx(ue,{children:Ot.map(o=>e.jsx(me,{value:String(o.value),children:o.label},o.value))})]}),e.jsx(Nt,{barDataSource:u,barStyle:i,onBarDataSourceChange:a,onBarStyleChange:p}),e.jsx(vt,{visibleColumns:t,onToggleColumn:b,onResetToDefaults:h}),e.jsx(Ct,{columnOrder:n,visibleColumns:t,onReorderColumns:N}),e.jsxs(z,{onClick:I,disabled:!f||q,children:[e.jsx(_e,{className:`h-4 w-4 mr-2 ${q?"animate-spin":""}`}),"Refresh"]})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:ee(x.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",ee(x.underlying_prev_close)]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:x.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",x.expiry_date]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${E>1?"text-green-500":"text-yellow-500"}`,children:E.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:ie(g.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:ie(g.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:g.ceOi+g.peOi>0?`${g.ceOi/(g.ceOi+g.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",E.toFixed(2)]})})]})})]}),e.jsx(se,{children:e.jsx(ae,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ut,{className:"w-full table-fixed",children:[e.jsxs(mt,{children:[e.jsxs(Ce,{className:"bg-muted/30 border-b-0",children:[X.length>0&&e.jsx(re,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(re,{className:"text-center w-20 min-w-20"}),V.length>0&&e.jsx(re,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Ce,{className:"bg-muted/50",children:[X.length>0&&e.jsx(re,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:X.map(o=>{const L=$.find(A=>A.key===o);return e.jsx("div",{className:S("flex-1 px-2 py-2 text-xs font-medium min-w-0",L?.align==="right"&&"text-right",L?.align==="center"&&"text-center",L?.align==="left"&&"text-left"),children:L?.label},o)})})}),e.jsx(re,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),V.length>0&&e.jsx(re,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:V.map(o=>{const L=$.find(A=>A.key===o);return e.jsx("div",{className:S("flex-1 px-2 py-2 text-xs font-medium min-w-0",L?.align==="right"&&"text-right",L?.align==="center"&&"text-center",L?.align==="left"&&"text-left"),children:L?.label},o)})})})]})]}),e.jsx(xt,{children:x.chain.map(o=>e.jsx(Rt,{strike:o,previousStrike:j.current.get(o.strike),maxBarValue:F,visibleCeColumns:X,visiblePeColumns:V,barDataSource:u,barStyle:i,optionExchange:M,onPlaceOrder:B},o.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Q?e.jsx(at,{className:"h-4 w-4 text-green-500"}):e.jsx(rt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Fe,{variant:Q?"default":U?"secondary":"destructive",children:H?"Paused":Q?`Streaming ${Y} symbols`:U?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",u==="oi"?"OI":"Volume"," (",i,")"]})]}),e.jsxs("div",{children:["Last Update: ",W?W.toLocaleTimeString():"-"]})]})]}),!x&&!K&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Lt,{open:m?.open??!1,onOpenChange:D,symbol:m?.symbol,exchange:m?.exchange,action:m?.action,quantity:m?.quantity,lotSize:m?.lotSize,tickSize:m?.tickSize,strategy:"OptionChain"})]})}export{ts as default};
