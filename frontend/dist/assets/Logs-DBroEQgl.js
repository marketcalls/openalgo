import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{w as F,t as y,B as m,e as u}from"./index-DIYLftG1.js";import{C as x,b as I,c as J,a as g}from"./card-QZ1-djoA.js";import{C as Y,b as $,a as z}from"./collapsible-CVvMrHJf.js";import{I as f}from"./input-BHNumB0b.js";import{J as w}from"./json-editor-D48tyMHD.js";import{A as M,F as S,R as Q,p as H,ai as C,S as X,Z,a9 as W,aa as G,ab as K,Y as ee,a3 as se,x as ae}from"./vendor-icons-Ca5eNZvr.js";import{L as te}from"./vendor-router-DdyOoyPF.js";import"./vendor-radix-gKv__6YA.js";function he(){const[j,L]=r.useState([]),[d,R]=r.useState(1),[l,h]=r.useState(1),[p,D]=r.useState(!0),[N,b]=r.useState(!1),[i,P]=r.useState(""),[c,E]=r.useState(""),[o,_]=r.useState(""),[q,B]=r.useState(new Set),n=r.useCallback(async(s=1)=>{try{const a=new URLSearchParams;a.append("page",s.toString()),i&&a.append("start_date",i),c&&a.append("end_date",c),o&&a.append("search",o);const t=await F.get(`/logs/?${a.toString()}`,{headers:{"X-Requested-With":"XMLHttpRequest"}});L(Array.isArray(t.data.logs)?t.data.logs:[]),R(t.data.total_pages||1),h(t.data.current_page||1)}catch(a){console.error("Error fetching logs:",a),y.error("Failed to load logs")}finally{D(!1),b(!1)}},[i,c,o]);r.useEffect(()=>{n()},[n]),r.useEffect(()=>{const s=setTimeout(()=>{p||(h(1),n(1))},300);return()=>clearTimeout(s)},[n,p]);const T=async()=>{b(!0),await n(l),y.success("Logs refreshed")},k=()=>{const s=new URLSearchParams;i&&s.append("start_date",i),c&&s.append("end_date",c),o&&s.append("search",o),window.open(`/logs/export?${s.toString()}`,"_blank")},v=()=>{h(1),n(1)},A=s=>{B(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},U=s=>{switch(s){case"placeorder":return"bg-blue-500 hover:bg-blue-600";case"placesmartorder":return"bg-purple-500 hover:bg-purple-600";case"modifyorder":return"bg-yellow-500 hover:bg-yellow-600";case"cancelorder":return"bg-red-500 hover:bg-red-600";case"closeposition":return"bg-green-500 hover:bg-green-600";default:return"bg-gray-500 hover:bg-gray-600"}},O=()=>{if(d<=1)return null;const s=[];if(d<=5)for(let t=1;t<=d;t++)s.push(t);else{s.push(1),l>3&&s.push("...");for(let t=Math.max(2,l-1);t<=Math.min(d-1,l+1);t++)s.includes(t)||s.push(t);l<d-2&&s.push("..."),s.includes(d)||s.push(d)}return e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-6",children:[e.jsx(m,{variant:"outline",size:"icon",onClick:()=>n(l-1),disabled:l<=1,children:e.jsx(se,{className:"h-4 w-4"})}),s.map((t,V)=>e.jsx(m,{variant:t===l?"default":"outline",size:"sm",onClick:()=>typeof t=="number"&&n(t),disabled:typeof t!="number",children:t},V)),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>n(l+1),disabled:l>=d,children:e.jsx(ae,{className:"h-4 w-4"})})]})};return p?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(te,{to:"/logs",className:"text-muted-foreground hover:text-foreground",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6"}),"Live Trading Logs"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"View and search your real-time API trading logs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:T,disabled:N,children:[e.jsx(Q,{className:`h-4 w-4 mr-2 ${N?"animate-spin":""}`}),"Refresh"]}),e.jsxs(m,{onClick:k,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Export to CSV"]})]})]}),e.jsxs(x,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(J,{className:"text-lg",children:"Filters"})}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{type:"date",value:i,onChange:s=>P(s.target.value),onBlur:v,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{type:"date",value:c,onChange:s=>E(s.target.value),onBlur:v,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(f,{type:"text",placeholder:"Search logs...",value:o,onChange:s=>_(s.target.value),className:"pl-10"})]})]})]})})]}),e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsx(x,{children:e.jsxs(g,{className:"py-16 text-center text-muted-foreground",children:[e.jsx(S,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No logs found for the selected date range"})]})}):j.map(s=>{const a=s.request_data||{},t=q.has(s.id);return e.jsx(x,{className:"hover:shadow-md transition-shadow",children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(u,{className:U(s.api_type),children:s.api_type}),e.jsxs(u,{variant:"outline",className:"gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),s.strategy]}),a.action?e.jsxs(u,{variant:String(a.action)==="BUY"?"default":"destructive",className:`gap-1 ${String(a.action)==="BUY"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:[String(a.action)==="BUY"?e.jsx(W,{className:"h-3 w-3"}):e.jsx(G,{className:"h-3 w-3"}),String(a.action)]}):null,a.exchange?e.jsx(u,{variant:"secondary",children:String(a.exchange)}):null,e.jsx(u,{variant:"outline",className:"text-muted-foreground",children:s.created_at})]}),a.symbol||a.quantity||a.price||a.product?e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 mb-4",children:[a.symbol?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Symbol"}),e.jsx("p",{className:"font-semibold",children:String(a.symbol)})]}):null,a.quantity?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Quantity"}),e.jsx("p",{className:"font-semibold",children:String(a.quantity)})]}):null,a.price&&String(a.price)!=="0"?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Price"}),e.jsx("p",{className:"font-semibold",children:String(a.price)})]}):null,a.product?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Product"}),e.jsx("p",{className:"font-semibold",children:String(a.product)})]}):null,a.pricetype?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Price Type"}),e.jsx("p",{className:"font-semibold",children:String(a.pricetype)})]}):null,a.orderid?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Order ID"}),e.jsx("p",{className:"font-semibold text-sm truncate",children:String(a.orderid)})]}):null]}):null,e.jsxs(Y,{open:t,onOpenChange:()=>A(s.id),children:[e.jsx($,{asChild:!0,children:e.jsxs(m,{variant:"ghost",className:"w-full justify-between bg-muted hover:bg-muted/80",children:["View Request/Response Data",t?e.jsx(K,{className:"h-4 w-4"}):e.jsx(ee,{className:"h-4 w-4"})]})}),e.jsxs(z,{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Request Data"}),e.jsx("div",{className:"rounded-lg overflow-hidden border bg-card/50 h-[250px]",children:e.jsx(w,{value:JSON.stringify(a,null,2),readOnly:!0})})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Response Data"}),e.jsx("div",{className:"rounded-lg overflow-hidden border bg-card/50 h-[250px]",children:e.jsx(w,{value:JSON.stringify(s.response_data,null,2),readOnly:!0})})]})]})]})]})},s.id)})}),O()]})}export{he as default};
