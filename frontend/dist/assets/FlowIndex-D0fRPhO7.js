import{r as j,j as e}from"./vendor-react-CCyQGCED.js";import{u as q,a as u,b as V,f as c,d as Y,c as H,e as G,g as X,r as Z,h as ee,i as se,j as ae,k as te,l as re}from"./flow-DPCFdzwf.js";import{H as Q,B as n,s as o,c as S,D as oe,j as ne,k as ie,m as C,n as le}from"./index-D0023jFM.js";import{C as K,a as ce,b as de,c as me,d as ue}from"./card-CDguRyHx.js";import{D as L,b as P,c as D,d as M,e as R,f as U}from"./dialog-ZgnPSmJp.js";import{I as w}from"./input-D8_g_dg9.js";import{L as d}from"./label-BgxgrBuS.js";import{T as he}from"./textarea-Cdbakixx.js";import{S as xe}from"./switch-ByXWOYiO.js";import{L as y,aO as pe,aI as O,a$ as je,aW as T,$ as fe,aQ as ge,an as Ne,a7 as F,E as we,x as ye,Y as be,y as ve,V as ke,a5 as Ce,C as _e}from"./vendor-icons-CCn_k3dF.js";import{a as $}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function We({status:a}){switch(a){case"completed":return e.jsx(_e,{className:"h-4 w-4 text-green-500"});case"failed":return e.jsx(Ce,{className:"h-4 w-4 text-red-500"});case"running":return e.jsx(y,{className:"h-4 w-4 animate-spin text-primary"});case"pending":return e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"});default:return e.jsx(ve,{className:"h-4 w-4 text-muted-foreground"})}}function Se({workflow:a}){const b=$(),m=Q(),[h,_]=j.useState(!1),[i,f]=j.useState(!1),W=u({mutationFn:()=>V(a.id),onSuccess:()=>{m.invalidateQueries({queryKey:c.workflows()}),o.success("Workflow activated","flow")},onError:s=>{o.error(s.message,"flow")}}),v=u({mutationFn:()=>Y(a.id),onSuccess:()=>{m.invalidateQueries({queryKey:c.workflows()}),o.success("Workflow deactivated","flow")},onError:s=>{o.error(s.message,"flow")}}),g=u({mutationFn:()=>H(a.id),onSuccess:()=>{m.invalidateQueries({queryKey:c.workflows()}),o.success("Workflow deleted","flow")},onError:s=>{o.error(s.message,"flow")}}),r=q({queryKey:c.webhook(a.id),queryFn:()=>te(a.id),enabled:h}),l=u({mutationFn:()=>G(a.id),onSuccess:()=>{m.invalidateQueries({queryKey:c.webhook(a.id)}),o.success("Webhook enabled","flow")},onError:s=>{o.error(s.message,"flow")}}),N=u({mutationFn:()=>X(a.id),onSuccess:()=>{m.invalidateQueries({queryKey:c.webhook(a.id)}),o.success("Webhook disabled","flow")},onError:s=>{o.error(s.message,"flow")}}),k=u({mutationFn:()=>Z(a.id),onSuccess:()=>{m.invalidateQueries({queryKey:c.webhook(a.id)}),o.success("Webhook URL and secret regenerated","flow")},onError:s=>{o.error(s.message,"flow")}}),x=u({mutationFn:s=>ee(a.id,s),onSuccess:()=>{m.invalidateQueries({queryKey:c.webhook(a.id)}),o.success("Authentication type updated","flow")},onError:s=>{o.error(s.message,"flow")}}),p=(s,E)=>{navigator.clipboard.writeText(s),o.success(`${E} copied to clipboard`,"clipboard")};return e.jsxs(e.Fragment,{children:[e.jsxs(K,{className:S("group cursor-pointer transition-all duration-200 hover:border-primary/50",a.is_active&&"border-green-500/30"),onClick:()=>b(`/flow/editor/${a.id}`),children:[e.jsxs(ce,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:S("h-2 w-2 rounded-full",a.is_active?"bg-green-500":"bg-muted-foreground")}),e.jsx(de,{className:"text-base",children:a.name})]}),e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,onClick:s=>s.stopPropagation(),children:e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(ie,{align:"end",children:[e.jsx(C,{onClick:s=>{s.stopPropagation(),b(`/flow/editor/${a.id}`)},children:"Edit"}),e.jsxs(C,{onClick:s=>{s.stopPropagation(),_(!0)},children:[e.jsx(T,{className:"mr-2 h-4 w-4"}),"Webhook"]}),a.is_active?e.jsxs(C,{onClick:s=>{s.stopPropagation(),v.mutate()},children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Deactivate"]}):e.jsxs(C,{onClick:s=>{s.stopPropagation(),W.mutate()},children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Activate"]}),e.jsx(le,{}),e.jsxs(C,{className:"text-destructive",onClick:s=>{s.stopPropagation(),g.mutate()},children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),a.description&&e.jsx(me,{className:"line-clamp-2",children:a.description})]}),e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(We,{status:a.last_execution_status}),e.jsx("span",{children:a.last_execution_status?`Last: ${a.last_execution_status}`:"No executions"})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:new Date(a.updated_at).toLocaleDateString()})]})})]}),e.jsx(L,{open:h,onOpenChange:_,children:e.jsxs(P,{className:"max-w-2xl max-h-[90vh] flex flex-col",children:[e.jsxs(D,{children:[e.jsxs(M,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Webhook Settings"]}),e.jsxs(R,{children:['Configure webhook for "',a.name,'"']})]}),r.isLoading?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(y,{className:"h-6 w-6 animate-spin"})}):r.data?e.jsxs("div",{className:"space-y-6 py-4 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-base",children:"Enable Webhook"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Allow external systems to trigger this workflow"})]}),e.jsx(xe,{checked:r.data.webhook_enabled,onCheckedChange:s=>{s?l.mutate():N.mutate()},disabled:l.isPending||N.isPending})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(d,{children:"Authentication Method"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",className:S("rounded-lg border p-4 text-left transition-all",r.data.webhook_auth_type==="payload"?"border-primary bg-primary/5":"border-border hover:border-primary/50"),onClick:()=>x.mutate("payload"),disabled:x.isPending,children:[e.jsx("div",{className:"font-medium",children:"Secret in Payload"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"For TradingView, custom scripts"})]}),e.jsxs("button",{type:"button",className:S("rounded-lg border p-4 text-left transition-all",r.data.webhook_auth_type==="url"?"border-primary bg-primary/5":"border-border hover:border-primary/50"),onClick:()=>x.mutate("url"),disabled:x.isPending,children:[e.jsx("div",{className:"font-medium",children:"Secret in URL"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"For Chartink, fixed-format services"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{readOnly:!0,value:r.data.webhook_url,className:"font-mono text-sm"}),e.jsx(n,{variant:"outline",size:"icon",onClick:()=>p(r.data.webhook_url,"URL"),children:e.jsx(F,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Webhook URL (with symbol)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{readOnly:!0,value:r.data.webhook_url_with_symbol,className:"font-mono text-sm"}),e.jsx(n,{variant:"outline",size:"icon",onClick:()=>p(r.data.webhook_url_with_symbol,"URL"),children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Replace ","{symbol}"," with actual symbol like RELIANCE, INFY, etc."]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Webhook Secret"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(w,{readOnly:!0,type:i?"text":"password",value:r.data.webhook_secret,className:"font-mono text-sm pr-10"}),e.jsx(n,{variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full",onClick:()=>f(!i),children:i?e.jsx(we,{className:"h-4 w-4"}):e.jsx(ye,{className:"h-4 w-4"})})]}),e.jsx(n,{variant:"outline",size:"icon",onClick:()=>p(r.data.webhook_secret,"Secret"),children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.data.webhook_auth_type==="url"?"Append this secret to URL as ?secret=...":'Include this secret in your webhook payload as "secret" field'})]}),r.data.webhook_auth_type==="url"&&r.data.webhook_url_with_secret&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Webhook URL (with secret)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{readOnly:!0,value:i?r.data.webhook_url_with_secret:r.data.webhook_url+"?secret=........",className:"font-mono text-sm"}),e.jsx(n,{variant:"outline",size:"icon",onClick:()=>p(r.data.webhook_url_with_secret,"URL with secret"),children:e.jsx(F,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use this URL for Chartink and other services with fixed payloads"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Example Usage"}),e.jsx("div",{className:"rounded-lg bg-muted p-4",children:r.data.webhook_auth_type==="url"?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"For Chartink (secret in URL):"}),e.jsx("pre",{className:"text-xs font-mono overflow-x-auto",children:`POST ${r.data.webhook_url}?secret=${i?r.data.webhook_secret:"........"}

Chartink payload (sent as-is):
{
  "stocks": "RELIANCE,INFY,TCS",
  "trigger_prices": "2500.50,1800.25,3500.00",
  "triggered_at": "9:30 am",
  "scan_name": "My Scanner",
  "alert_name": "Buy Alert"
}`})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"For TradingView (secret in payload):"}),e.jsx("pre",{className:"text-xs font-mono overflow-x-auto",children:`POST ${r.data.webhook_url}

{
  "secret": "${i?r.data.webhook_secret:"................"}",
  "symbol": "RELIANCE",
  "action": "BUY",
  "quantity": 10,
  "price": 2500.50
}`})]})})]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs(n,{variant:"outline",onClick:()=>k.mutate(),disabled:k.isPending,children:[k.isPending?e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(be,{className:"mr-2 h-4 w-4"}),"Regenerate URL & Secret"]})})]}):null]})})]})}function Qe(){const a=$(),b=Q(),[m,h]=j.useState(!1),[_,i]=j.useState(!1),[f,W]=j.useState(""),[v,g]=j.useState(""),[r,l]=j.useState(null),{data:N,isLoading:k}=q({queryKey:c.workflows(),queryFn:re}),x=u({mutationFn:se,onSuccess:t=>{b.invalidateQueries({queryKey:c.workflows()}),h(!1),W(""),a(`/flow/editor/${t.id}`)},onError:t=>{o.error(t.message,"flow")}}),p=u({mutationFn:ae,onSuccess:t=>{b.invalidateQueries({queryKey:c.workflows()}),i(!1),g(""),l(null),o.success(`Workflow "${t.name}" imported`,"flow"),a(`/flow/editor/${t.id}`)},onError:t=>{o.error(t.message,"flow")}}),s=()=>{f.trim()&&x.mutate({name:f.trim()})},E=()=>{l(null);try{const t=JSON.parse(v);if(!t.name||!Array.isArray(t.nodes)||!Array.isArray(t.edges)){l("Invalid workflow format. Must have name, nodes, and edges.");return}p.mutate(t)}catch{l("Invalid JSON format. Please check the workflow data.")}},J=t=>{const A=t.target.files?.[0];if(!A)return;const I=new FileReader;I.onload=z=>{const B=z.target?.result;g(B),l(null)},I.onerror=()=>{l("Failed to read file")},I.readAsText(A)};return k?e.jsx("div",{className:"flex h-[calc(100vh-3.5rem)] items-center justify-center",children:e.jsx(y,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"mx-auto max-w-6xl px-6 py-8",children:[e.jsxs("div",{className:"mb-8 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Flow Editor"}),e.jsx("p",{className:"text-muted-foreground",children:"Create and manage your trading automations"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>i(!0),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Import"]}),e.jsxs(n,{onClick:()=>h(!0),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"New Workflow"]})]})]}),N&&N.length>0?e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:N.map(t=>e.jsx(Se,{workflow:t},t.id))}):e.jsxs(K,{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"mb-4 rounded-full bg-muted p-4",children:e.jsx(O,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"mb-2 text-lg font-medium",children:"No workflows yet"}),e.jsx("p",{className:"mb-6 text-center text-sm text-muted-foreground",children:"Create your first workflow to automate your trading"}),e.jsxs(n,{onClick:()=>h(!0),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Create Workflow"]})]}),e.jsx(L,{open:m,onOpenChange:h,children:e.jsxs(P,{children:[e.jsxs(D,{children:[e.jsx(M,{children:"Create New Workflow"}),e.jsx(R,{children:"Give your workflow a name to get started"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Workflow Name"}),e.jsx(w,{id:"name",placeholder:"e.g., Morning Order Automation",value:f,onChange:t=>W(t.target.value),onKeyDown:t=>t.key==="Enter"&&s(),autoFocus:!0})]})}),e.jsxs(U,{children:[e.jsx(n,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(n,{onClick:s,disabled:!f.trim()||x.isPending,children:[x.isPending&&e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Create"]})]})]})}),e.jsx(L,{open:_,onOpenChange:t=>{i(t),t||(g(""),l(null))},children:e.jsxs(P,{className:"max-w-lg",children:[e.jsxs(D,{children:[e.jsx(M,{children:"Import Workflow"}),e.jsx(R,{children:"Import a workflow from a JSON file or paste the JSON data"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"file",children:"Upload File"}),e.jsx(w,{id:"file",type:"file",accept:".json",onChange:J,className:"cursor-pointer"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"or paste JSON"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"json",children:"Workflow JSON"}),e.jsx(he,{id:"json",placeholder:'{"name": "My Workflow", "nodes": [...], "edges": [...]}',value:v,onChange:t=>{g(t.target.value),l(null)},className:"h-40 font-mono text-sm"}),r&&e.jsx("p",{className:"text-sm text-destructive",children:r})]})]}),e.jsxs(U,{children:[e.jsx(n,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),e.jsxs(n,{onClick:E,disabled:!v.trim()||p.isPending,children:[p.isPending&&e.jsx(y,{className:"mr-2 h-4 w-4 animate-spin"}),"Import"]})]})]})})]})}export{Qe as default};
