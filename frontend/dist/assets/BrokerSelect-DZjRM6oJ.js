import{r as n,j as e}from"./vendor-react-RhKMXzW9.js";import{A as x,a as g,b as N}from"./alert-D4WCu52O.js";import{d as S,B as y}from"./index-5A0f6rqh.js";import{C,b as _,c as v,d as A,a as B}from"./card-DQ3ML41e.js";import{L as $}from"./label-B4a3RivY.js";import{S as F,a as L,b as I,c as D,d as E}from"./select-DicHn7uN.js";import{L as b,N as M,m as k}from"./vendor-icons-DEeYHfOp.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-router-DdyOoyPF.js";import"./vendor-radix-hRiDuY7W.js";const P=[{id:"fivepaisa",name:"5 Paisa",authType:"totp"},{id:"fivepaisaxts",name:"5 Paisa (XTS)",authType:"totp"},{id:"aliceblue",name:"Alice Blue",authType:"totp"},{id:"angel",name:"Angel One",authType:"totp"},{id:"compositedge",name:"CompositEdge",authType:"oauth"},{id:"dhan",name:"Dhan",authType:"oauth"},{id:"indmoney",name:"IndMoney",authType:"totp"},{id:"dhan_sandbox",name:"Dhan (Sandbox)",authType:"totp"},{id:"definedge",name:"Definedge",authType:"totp"},{id:"firstock",name:"Firstock",authType:"totp"},{id:"flattrade",name:"Flattrade",authType:"oauth"},{id:"motilal",name:"Motilal Oswal",authType:"totp"},{id:"fyers",name:"Fyers",authType:"oauth"},{id:"groww",name:"Groww",authType:"totp"},{id:"ibulls",name:"Ibulls",authType:"totp"},{id:"iifl",name:"IIFL",authType:"totp"},{id:"jainamxts",name:"JainamXts",authType:"totp"},{id:"kotak",name:"Kotak Securities",authType:"totp"},{id:"mstock",name:"mStock by Mirae Asset",authType:"totp"},{id:"nubra",name:"Nubra",authType:"totp"},{id:"paytm",name:"Paytm Money",authType:"oauth"},{id:"pocketful",name:"Pocketful",authType:"oauth"},{id:"samco",name:"Samco",authType:"totp"},{id:"shoonya",name:"Shoonya",authType:"totp"},{id:"tradejini",name:"Tradejini",authType:"totp"},{id:"upstox",name:"Upstox",authType:"oauth"},{id:"wisdom",name:"Wisdom Capital",authType:"totp"},{id:"zebu",name:"Zebu",authType:"totp"},{id:"zerodha",name:"Zerodha",authType:"oauth"}];function R(o){if(!o)return"";const a=o.split(":::");return a.length>1?a[1]:o}function U(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let d=0;d<16;d++)i+=a.charAt(Math.floor(Math.random()*a.length));return i}function q(){const{user:o}=S(),[a,i]=n.useState(""),[d,j]=n.useState(!0),[p,h]=n.useState(!1),[f,c]=n.useState(null),[m,T]=n.useState(null);n.useEffect(()=>{(async()=>{try{const s=await(await fetch("/auth/broker-config",{credentials:"include"})).json();s.status==="success"?(T(s),i(s.broker_name)):c(s.message||"Failed to load broker configuration")}catch(t){console.error("Error fetching broker config:",t),c("Failed to load broker configuration")}finally{j(!1)}})()},[]);const w=r=>{if(r.preventDefault(),console.log("Form submitted, selectedBroker:",a,"brokerConfig:",m),!a){c("Please select a broker");return}if(!m){c("Broker configuration not loaded");return}h(!0);let t="";const{broker_api_key:s,redirect_url:l}=m;switch(console.log("broker_api_key:",s,"redirect_url:",l),a){case"fivepaisa":case"fivepaisaxts":case"aliceblue":case"angel":case"mstock":case"indmoney":case"jainamxts":case"dhan_sandbox":case"definedge":case"firstock":case"samco":case"motilal":case"nubra":case"groww":case"ibulls":case"iifl":case"kotak":case"shoonya":case"tradejini":case"wisdom":case"zebu":t=`/${a}/callback`;break;case"dhan":t="/dhan/initiate-oauth";break;case"compositedge":t=`https://xts.compositedge.com/interactive/thirdparty?appKey=${s}&returnURL=${l}`;break;case"flattrade":{t=`https://auth.flattrade.in/?app_key=${R(s)}`;break}case"fyers":t=`https://api-t1.fyers.in/api/v3/generate-authcode?client_id=${s}&redirect_uri=${l}&response_type=code&state=2e9b44629ebb28226224d09db3ffb47c`;break;case"upstox":t=`https://api.upstox.com/v2/login/authorization/dialog?response_type=code&client_id=${s}&redirect_uri=${l}`;break;case"zerodha":t=`https://kite.trade/connect/login?api_key=${s}`;break;case"paytm":t=`https://login.paytmmoney.com/merchant-login?apiKey=${s}&state={default}`;break;case"pocketful":{const u=U();localStorage.setItem("pocketful_oauth_state",u),t=`https://trade.pocketful.in/oauth2/auth?client_id=${s}&redirect_uri=${l}&response_type=code&scope=${encodeURIComponent("orders holdings")}&state=${encodeURIComponent(u)}`;break}default:console.log("Unknown broker:",a),c("Please select a broker"),h(!1);return}console.log("Redirecting to:",t),setTimeout(()=>{window.location.href=t},100)};return d?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(b,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center py-8 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-16",children:[e.jsxs(C,{className:"w-full max-w-md shadow-xl order-1 lg:order-2",children:[e.jsxs(_,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/logo.png",alt:"OpenAlgo",className:"h-20 w-20"})}),e.jsx(v,{className:"text-2xl",children:"Connect Your Trading Account"}),e.jsxs(A,{children:["Welcome, ",e.jsx("span",{className:"font-medium",children:o?.username}),"!"]})]}),e.jsxs(B,{children:[f&&e.jsx(x,{variant:"destructive",className:"mb-4",children:e.jsx(g,{children:f})}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{htmlFor:"broker-select",className:"block text-center",children:"Login with your Broker"}),e.jsxs(F,{value:a,onValueChange:i,disabled:p,children:[e.jsx(L,{id:"broker-select",className:"w-full",children:e.jsx(I,{placeholder:"Select a Broker"})}),e.jsx(D,{children:P.map(r=>{const t=r.id===m?.broker_name;return e.jsxs(E,{value:r.id,disabled:!t,children:[r.name," ",!t&&"(Disabled)"]},r.id)})})]})]}),e.jsx(y,{type:"submit",className:"w-full",disabled:!a||p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Connect Account"]})})]})]})]}),e.jsxs("div",{className:"flex-1 max-w-xl text-center lg:text-left order-2 lg:order-1",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["Connect Your ",e.jsx("span",{className:"text-primary",children:"Broker"})]}),e.jsx("p",{className:"text-lg lg:text-xl mb-8 text-muted-foreground",children:"Link your trading account to start executing trades through OpenAlgo's algorithmic trading platform."}),e.jsxs(x,{className:"mb-6",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(N,{children:"Need Help?"}),e.jsx(g,{children:"Check our documentation for broker setup guides."})]}),e.jsx("div",{className:"flex justify-center lg:justify-start gap-4",children:e.jsx(y,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://docs.openalgo.in",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Documentation"]})})})]})]})})})}export{q as default};
