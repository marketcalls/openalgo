import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{u as W,B as m,e as _,t as u}from"./index-DFVBs71w.js";import{p as x}from"./python-strategy-B_oVpen2.js";import{C as w,b as F,c as A,d as R,a as k}from"./card-D1rkWteK.js";import{C as G}from"./checkbox-BwAQYeS-.js";import{D as P,b as D,c as K,d as $,e as U,f as V}from"./dialog-D62z4jEH.js";import{L as q}from"./label-DKzlWPpc.js";import{S as J,E as C,R as Q,d as X,t as c}from"./index-C_7DtrgT.js";import{S as Y}from"./scroll-area-f-ToWSrS.js";import{S as b}from"./skeleton-C_H4UnbA.js";import{A as Z,R as T,ac as ee,F as te,P as se,aw as ae,aO as re}from"./vendor-icons-D08EYFn4.js";import{c as ne,L as oe}from"./vendor-router-DdyOoyPF.js";import"./vendor-radix-Cue1hf3Z.js";const le=J.define({token(t){return t.match(/ERROR|error|Error|CRITICAL|critical|FATAL|fatal/)?"invalid":t.match(/WARNING|warning|Warning|WARN|warn/)?"keyword":t.match(/SUCCESS|success|Success/)?"string":t.match(/INFO|info|Info/)?"comment":t.match(/DEBUG|debug|Debug/)?"meta":t.match(/\d{4}-\d{2}-\d{2}[\sT]\d{2}:\d{2}:\d{2}/)||t.match(/\d{2}:\d{2}:\d{2}/)?"number":(t.next(),null)}}),ie=t=>X({theme:t?"dark":"light",settings:{background:t?"#111827":"#f8fafc",foreground:t?"#d1d5db":"#334155",caret:t?"#38bdf8":"#0284c7",selection:t?"rgba(56, 189, 248, 0.2)":"rgba(2, 132, 199, 0.2)",selectionMatch:t?"rgba(56, 189, 248, 0.1)":"rgba(2, 132, 199, 0.1)",lineHighlight:t?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)",gutterBackground:"transparent",gutterForeground:t?"rgba(255, 255, 255, 0.3)":"rgba(0, 0, 0, 0.3)",gutterBorder:"transparent"},styles:[{tag:c.invalid,color:t?"#f87171":"#dc2626",fontWeight:"bold"},{tag:c.keyword,color:t?"#fbbf24":"#d97706"},{tag:c.string,color:t?"#34d399":"#059669"},{tag:c.comment,color:t?"#60a5fa":"#2563eb"},{tag:c.meta,color:t?"#9ca3af":"#64748b"},{tag:c.number,color:t?"#22d3ee":"#0891b2"}]}),ce=t=>{const n=t?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",d=t?"rgba(255, 255, 255, 0.02)":"rgba(0, 0, 0, 0.02)";return C.theme({"&":{fontSize:"12px",fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, monospace',height:"100%",backgroundColor:t?"#111827":"#f8fafc"},"&.cm-editor":{height:"100%"},".cm-scroller":{overflow:"auto",height:"100%"},".cm-content":{padding:"12px 0",lineHeight:"20px"},".cm-line":{padding:"0 12px"},".cm-gutters":{backgroundColor:d,borderRight:`1px solid ${n}`,paddingRight:"4px"},".cm-gutter":{minWidth:"48px"},".cm-gutterElement":{padding:"0 8px 0 12px",lineHeight:"20px"},"&.cm-focused":{outline:"none"},".cm-activeLine":{backgroundColor:t?"rgba(255, 255, 255, 0.03)":"rgba(0, 0, 0, 0.02)"},".cm-activeLineGutter":{backgroundColor:t?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.03)"}})};function de({value:t,className:n="",height:d="500px"}){const{mode:l,appMode:h}=W(),a=l==="dark"||h==="analyzer",g=r.useMemo(()=>[le,ie(a),ce(a),C.lineWrapping,C.editable.of(!1)],[a]);return e.jsx("div",{className:`rounded-lg overflow-hidden ${n}`,children:e.jsx(Q,{value:t,extensions:g,readOnly:!0,height:d,theme:a?"dark":"light",basicSetup:{lineNumbers:!0,highlightActiveLineGutter:!0,highlightActiveLine:!0,foldGutter:!1,dropCursor:!1,allowMultipleSelections:!1,indentOnInput:!1,bracketMatching:!1,closeBrackets:!1,autocompletion:!1,rectangularSelection:!1,crosshairCursor:!1,highlightSelectionMatches:!0,searchKeymap:!0,tabSize:2}})})}function Se(){const{strategyId:t}=ne(),[n,d]=r.useState(null),[l,h]=r.useState([]),[a,g]=r.useState(null),[i,N]=r.useState(null),[B,y]=r.useState(!0),[E,v]=r.useState(!1),[S,L]=r.useState(!1),[M,f]=r.useState(!1),[p,I]=r.useState(!0),O=async()=>{if(t)try{y(!0);const[s,o]=await Promise.all([x.getStrategy(t),x.getLogFiles(t)]);d(s),h(o),o.length>0&&!a&&g(o[0].name)}catch(s){console.error("Failed to fetch data:",s),u.error("Failed to load logs")}finally{y(!1)}},j=async s=>{if(t)try{v(!0);const o=await x.getLogContent(t,s);N(o)}catch(o){console.error("Failed to fetch log content:",o),u.error("Failed to load log content")}finally{v(!1)}};r.useEffect(()=>{O()},[]),r.useEffect(()=>{a&&j(a)},[a]),r.useEffect(()=>{if(n?.status==="running"&&a&&p){const s=setInterval(()=>{j(a)},3e3);return()=>clearInterval(s)}},[n?.status,a,p]);const z=async()=>{if(t)try{L(!0);const s=await x.clearLogs(t);s.status==="success"?(u.success("Logs cleared"),h([]),g(null),N(null)):u.error(s.message||"Failed to clear logs")}catch(s){console.error("Failed to clear logs:",s),u.error("Failed to clear logs")}finally{L(!1),f(!1)}},H=s=>{const o=s.split("_");return o.length>1?o.slice(1).join("_").replace(".log",""):s.replace(".log","")};return B?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(b,{className:"h-8 w-32"}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsx(b,{className:"h-[600px]"}),e.jsx(b,{className:"h-[600px] col-span-3"})]})]}):n?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(m,{variant:"ghost",asChild:!0,children:e.jsxs(oe,{to:"/python",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Strategy Logs"}),e.jsx("p",{className:"text-muted-foreground",children:n.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{id:"auto-refresh",checked:p,onCheckedChange:s=>I(s)}),e.jsx(q,{htmlFor:"auto-refresh",className:"text-sm",children:"Auto-refresh"})]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>a&&j(a),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(m,{variant:"destructive",size:"sm",onClick:()=>f(!0),disabled:l.length===0,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(w,{className:"lg:col-span-1",children:[e.jsxs(F,{children:[e.jsxs(A,{className:"text-sm flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Log Files"]}),e.jsxs(R,{children:[l.length," file(s)"]})]}),e.jsx(k,{children:l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No log files found"}):e.jsx(Y,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2",children:l.map(s=>e.jsxs("button",{onClick:()=>g(s.name),className:`w-full text-left p-3 rounded-lg transition-colors ${a===s.name?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:H(s.name)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(se,{className:"h-3 w-3"}),new Date(s.last_modified).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(ae,{className:"h-3 w-3"}),s.size_kb.toFixed(2)," KB"]})]},s.name))})})})]}),e.jsxs(w,{className:"lg:col-span-3",children:[e.jsxs(F,{children:[e.jsxs(A,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Log Content"]}),n.status==="running"&&e.jsx(_,{className:"bg-green-500 animate-pulse",children:"Live"})]}),i&&e.jsxs(R,{children:[i.lines," lines • ",i.size_kb.toFixed(2)," KB • Last updated:"," ",new Date(i.last_updated).toLocaleString()]})]}),e.jsx(k,{children:a?E?e.jsx("div",{className:"flex items-center justify-center h-[500px]",children:e.jsx(T,{className:"h-6 w-6 animate-spin"})}):i?e.jsx(de,{value:i.content,height:"500px"}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"No content available"}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"Select a log file to view its contents"})})]})]}),e.jsx(P,{open:M,onOpenChange:f,children:e.jsxs(D,{children:[e.jsxs(K,{children:[e.jsx($,{children:"Clear All Logs"}),e.jsxs(U,{children:['Are you sure you want to clear all log files for "',n.name,'"? This action cannot be undone.']})]}),e.jsxs(V,{children:[e.jsx(m,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:z,disabled:S,children:S?"Clearing...":"Clear All Logs"})]})]})})]}):null}export{Se as default};
