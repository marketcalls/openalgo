import{r as a,j as e}from"./vendor-react--vsXx8_n.js";import{w as S,B as A,c as k,e as Y,t as b}from"./index-T3KpoLCj.js";import{C as l,a as x,b as h,c as E,d as c}from"./card-Dw0gGMKk.js";import{T as Z,a as ee,b as $,c as f,d as se,e as j}from"./table-B5ByKXjW.js";import{W as te,q as O,n as U}from"./lightweight-charts.production-EcMg1Lek.js";import{L as I,R as re,ap as ae,q as ne,aD as ie,bj as le,D as ce,bk as de,aW as oe,v as P,w as me,a1 as ue,ax as xe}from"./vendor-icons-CZtcNCrV.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DnptSSCf.js";async function he(){return(await S.get("/health/api/current")).data}async function fe(s=24){return(await S.get("/health/api/history",{params:{hours:s}})).data}async function je(s=24){return(await S.get("/health/api/stats",{params:{hours:s}})).data}async function ge(){return(await S.get("/health/api/alerts")).data}async function pe(s){await S.post(`/health/api/alerts/${s}/acknowledge`)}function Ne(s=24){return`/health/export?hours=${s}`}const we=1e4;function C({title:s,icon:N,value:d,subtitle:M,status:r,loading:L}){const w={pass:"text-green-500",warn:"text-yellow-500",fail:"text-red-500",unknown:"text-primary"},T={pass:"text-green-500 opacity-20",warn:"text-yellow-500 opacity-20",fail:"text-red-500 opacity-20",unknown:"text-primary opacity-20"};return e.jsx(l,{children:e.jsx(c,{className:"p-4",children:L?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(I,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:s}),e.jsx("p",{className:k("text-2xl font-bold",w[r]),children:d}),M&&e.jsx("p",{className:"text-xs text-muted-foreground",children:M})]}),e.jsx(N,{className:k("h-8 w-8",T[r])})]})})})}function q({status:s}){return s==="pass"?e.jsx(me,{className:"h-4 w-4 text-green-500"}):s==="warn"?e.jsx(P,{className:"h-4 w-4 text-yellow-500"}):s==="fail"?e.jsx(ue,{className:"h-4 w-4 text-red-500"}):e.jsx(xe,{className:"h-4 w-4 text-muted-foreground"})}function ye(){return document.documentElement.classList.contains("dark")}function Fe(){const[s,N]=a.useState(null),[d,M]=a.useState([]),[r,L]=a.useState(null),[w,T]=a.useState([]),[X,G]=a.useState(!0),[H,V]=a.useState(!1),[y,J]=a.useState(!0),g=a.useRef(null),p=a.useRef(null),o=a.useRef(null),m=a.useRef(null),W=a.useRef(null),B=a.useRef(null),_=async(t=!1)=>{try{V(!0);const[n,D,R,F]=await Promise.all([he(),fe(24),je(24),ge()]);N(n),M(D),L(R),T(F),t&&b.success("Metrics refreshed")}catch(n){console.error("Error fetching health metrics:",n),b.error("Failed to fetch health metrics")}finally{G(!1),V(!1)}};a.useEffect(()=>{_()},[]),a.useEffect(()=>{if(!y)return;const t=setInterval(()=>{_()},we);return()=>clearInterval(t)},[y]),a.useEffect(()=>{if(!d.length)return;const t=ye(),n=t?"#9ca3af":"#6b7280",D=t?"#374151":"#e5e7eb",R=t?"#4b5563":"#d1d5db",F={height:300,layout:{background:{type:te.Solid,color:"transparent"},textColor:n},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{borderColor:R,timeVisible:!0},rightPriceScale:{borderColor:R},crosshair:{vertLine:{color:D},horzLine:{color:D}}};if(g.current&&!o.current){const u=O(g.current,{...F,width:g.current.clientWidth,localization:{priceFormatter:i=>Math.round(i).toString()}}),v=u.addSeries(U,{color:"#3b82f6",lineWidth:2,priceLineVisible:!1,lastValueVisible:!0,priceFormat:{type:"custom",formatter:i=>Math.round(i).toString()}});o.current=u,W.current=v}if(p.current&&!m.current){const u=O(p.current,{...F,width:p.current.clientWidth}),v=u.addSeries(U,{color:"#10b981",lineWidth:2,priceLineVisible:!1,lastValueVisible:!0});m.current=u,B.current=v}if(W.current&&B.current){const u=d.map(i=>({time:Math.floor(new Date(i.timestamp).getTime()/1e3),value:i.fd_count})),v=d.map(i=>({time:Math.floor(new Date(i.timestamp).getTime()/1e3),value:i.memory_rss_mb}));W.current.setData(u),B.current.setData(v)}const z=()=>{o.current&&g.current&&o.current.applyOptions({width:g.current.clientWidth}),m.current&&p.current&&m.current.applyOptions({width:p.current.clientWidth})};return window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[d]),a.useEffect(()=>()=>{o.current&&(o.current.remove(),o.current=null),m.current&&(m.current.remove(),m.current=null)},[]);const K=async t=>{try{await pe(t),b.success("Alert acknowledged"),_()}catch(n){console.error("Error acknowledging alert:",n),b.error("Failed to acknowledge alert")}},Q=()=>{window.open(Ne(24),"_blank"),b.success("Exporting metrics to CSV")};return X?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"System Health Monitor"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Real-time infrastructure monitoring â€¢ Updates every 10 seconds"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>_(!0),disabled:H,children:[e.jsx(re,{className:k("h-4 w-4 mr-2",H&&"animate-spin")}),"Refresh"]}),e.jsxs(A,{variant:y?"default":"outline",size:"sm",onClick:()=>J(!y),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Auto: ",y?"ON":"OFF"]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:Q,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]}),s&&e.jsxs("div",{className:k("rounded-lg border p-4 flex items-center gap-4",s.overall_status==="pass"&&"border-green-500/50 bg-green-500/10",s.overall_status==="warn"&&"border-yellow-500/50 bg-yellow-500/10",s.overall_status==="fail"&&"border-red-500/50 bg-red-500/10"),children:[e.jsx(q,{status:s.overall_status}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold",children:["System Status: ",s.overall_status.toUpperCase()]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Last updated: ",new Date(s.timestamp).toLocaleString()]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsx(C,{title:"File Descriptors",icon:ie,value:s?`${s.fd.count} / ${s.fd.limit}`:"-",subtitle:s?`${s.fd.usage_percent.toFixed(1)}% used`:void 0,status:s?.fd.status||"unknown",loading:!s}),e.jsx(C,{title:"Memory Usage",icon:le,value:s?`${s.memory.rss_mb.toFixed(1)} MB`:"-",subtitle:s?`${s.memory.percent.toFixed(1)}% of system`:void 0,status:s?.memory.status||"unknown",loading:!s}),e.jsx(C,{title:"Database Connections",icon:ce,value:s?.database.total||0,subtitle:"Active connections",status:s?.database.status||"unknown",loading:!s}),e.jsx(C,{title:"WebSocket Connections",icon:de,value:s?.websocket.total||0,subtitle:s?`${s.websocket.total_symbols} symbols`:void 0,status:s?.websocket.status||"unknown",loading:!s}),e.jsx(C,{title:"Active Threads",icon:oe,value:s?.threads.count||0,subtitle:s&&s.threads.stuck>0?`${s.threads.stuck} stuck`:"None stuck",status:s?.threads.status||"unknown",loading:!s})]}),w.length>0&&e.jsxs(l,{className:"border-destructive/50",children:[e.jsxs(x,{children:[e.jsxs(h,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(P,{className:"h-5 w-5"}),"Active Alerts (",w.length,")"]}),e.jsx(E,{children:"System health alerts requiring attention"})]}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:w.map(t=>e.jsxs("div",{className:k("rounded-lg border p-3 flex items-start justify-between gap-4",t.severity==="fail"&&"border-red-500/50 bg-red-500/10",t.severity==="warn"&&"border-yellow-500/50 bg-yellow-500/10"),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(q,{status:t.severity}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.alert_type.replace(/_/g," ").toUpperCase()}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.message})]})]}),!t.acknowledged&&e.jsx(A,{variant:"outline",size:"sm",onClick:()=>K(t.id),children:"Acknowledge"})]},t.id))})})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(x,{children:[e.jsx(h,{className:"text-lg",children:"File Descriptors (24h)"}),e.jsx(E,{children:"Historical FD usage over the last 24 hours"})]}),e.jsx(c,{children:e.jsx("div",{ref:g,className:"w-full h-[300px]"})})]}),e.jsxs(l,{children:[e.jsxs(x,{children:[e.jsx(h,{className:"text-lg",children:"Memory Usage (24h)"}),e.jsx(E,{children:"Historical memory consumption in MB"})]}),e.jsx(c,{children:e.jsx("div",{ref:p,className:"w-full h-[300px]"})})]})]}),r&&e.jsxs("div",{className:"grid gap-4 lg:grid-cols-3",children:[e.jsxs(l,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-base",children:"File Descriptor Stats"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Current:"}),e.jsx("dd",{className:"font-medium",children:r.fd.current})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Average:"}),e.jsx("dd",{className:"font-medium",children:r.fd.avg.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Min / Max:"}),e.jsxs("dd",{className:"font-medium",children:[r.fd.min," / ",r.fd.max]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Warnings:"}),e.jsx("dd",{className:"font-medium text-yellow-600 dark:text-yellow-400",children:r.fd.warn_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Failures:"}),e.jsx("dd",{className:"font-medium text-red-600 dark:text-red-400",children:r.fd.fail_count})]})]})})]}),e.jsxs(l,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-base",children:"Memory Stats"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Current:"}),e.jsxs("dd",{className:"font-medium",children:[r.memory.current_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Average:"}),e.jsxs("dd",{className:"font-medium",children:[r.memory.avg_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Min / Max:"}),e.jsxs("dd",{className:"font-medium",children:[r.memory.min_mb.toFixed(1)," / ",r.memory.max_mb.toFixed(1)," MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Warnings:"}),e.jsx("dd",{className:"font-medium text-yellow-600 dark:text-yellow-400",children:r.memory.warn_count})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Failures:"}),e.jsx("dd",{className:"font-medium text-red-600 dark:text-red-400",children:r.memory.fail_count})]})]})})]}),e.jsxs(l,{children:[e.jsx(x,{className:"pb-3",children:e.jsx(h,{className:"text-base",children:"Connection Stats"})}),e.jsx(c,{children:e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"DB Current:"}),e.jsx("dd",{className:"font-medium",children:r.database.current})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"DB Average:"}),e.jsx("dd",{className:"font-medium",children:r.database.avg.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"WS Current:"}),e.jsx("dd",{className:"font-medium",children:r.websocket.current})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"WS Average:"}),e.jsx("dd",{className:"font-medium",children:r.websocket.avg.toFixed(1)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Threads:"}),e.jsx("dd",{className:"font-medium",children:r.threads.current})]})]})})]})]}),e.jsxs(l,{children:[e.jsxs(x,{children:[e.jsx(h,{className:"text-lg",children:"Recent Metrics"}),e.jsx(E,{children:"Last 20 samples from the monitoring system"})]}),e.jsx(c,{children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs($,{children:[e.jsx(f,{children:"Time"}),e.jsx(f,{className:"text-right",children:"FDs"}),e.jsx(f,{className:"text-right",children:"Memory (MB)"}),e.jsx(f,{className:"text-right",children:"DB Conns"}),e.jsx(f,{className:"text-right",children:"WS Conns"}),e.jsx(f,{className:"text-right",children:"Threads"}),e.jsx(f,{children:"Status"})]})}),e.jsx(se,{children:d.slice(0,20).reverse().map((t,n)=>e.jsxs($,{children:[e.jsx(j,{className:"font-mono text-xs",children:new Date(t.timestamp).toLocaleTimeString()}),e.jsx(j,{className:"text-right",children:t.fd_count}),e.jsx(j,{className:"text-right",children:t.memory_rss_mb.toFixed(1)}),e.jsx(j,{className:"text-right",children:t.db_connections}),e.jsx(j,{className:"text-right",children:t.ws_connections}),e.jsx(j,{className:"text-right",children:t.threads}),e.jsx(j,{children:e.jsx(Y,{variant:t.overall_status==="pass"?"default":t.overall_status==="warn"?"secondary":"destructive",children:t.overall_status})})]},n))})]})})]})]})}export{Fe as default};
