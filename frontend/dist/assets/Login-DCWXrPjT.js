import{r as n,j as e}from"./vendor-react--vsXx8_n.js";import{d as F,B as m,t as P}from"./index-BXEB87qf.js";import{A as j,a as w,b as E}from"./alert-DTQ-1Ww3.js";import{C as A,b as I,c as _,d as O,a as R}from"./card-ZqsFNsmA.js";import{I as y}from"./input-DGQCDKqS.js";import{L as N}from"./label-Cx3YY9W7.js";import{E as T,u as B,L as G,s as H,I as U,G as q,r as z}from"./vendor-icons-N1cWsVu6.js";import{a as W,L as J}from"./vendor-router-CiBIGs7t.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DIebA-qg.js";function te(){const a=W(),{login:b}=F(),[p,v]=n.useState(""),[x,S]=n.useState(""),[c,k]=n.useState(!1),[d,u]=n.useState(!1),[C,L]=n.useState(!0),[f,i]=n.useState(null);n.useEffect(()=>{(async()=>{try{if((await(await fetch("/auth/check-setup",{credentials:"include"})).json()).needs_setup){a("/setup",{replace:!0});return}const r=await fetch("/auth/session-status",{credentials:"include"});if(r.ok){const s=await r.json();if(s.status==="success"&&s.logged_in&&s.broker){a("/dashboard",{replace:!0});return}else if(s.status==="success"&&s.authenticated&&!s.logged_in){a("/broker",{replace:!0});return}}}catch(t){console.error("Failed to check setup status:",t)}finally{L(!1)}})()},[a]);const D=async o=>{o.preventDefault(),u(!0),i(null);try{const t=await fetch("/auth/csrf-token",{credentials:"include"});if(!t.ok){console.error("CSRF fetch failed:",t.status,t.statusText),i("Failed to initialize login. Please refresh the page."),u(!1);return}const g=await t.json(),r=new FormData;r.append("username",p),r.append("password",x),r.append("csrf_token",g.csrf_token);const s=await fetch("/auth/login",{method:"POST",body:r,credentials:"include"}),h=s.headers.get("content-type");if(!h||!h.includes("application/json")){console.error("Login response is not JSON:",h),s.url.includes("/setup")?(i("Please complete initial setup first."),a("/setup")):i("Login failed. Please try again."),u(!1);return}const l=await s.json();l.status==="error"?(i(l.message||"Login failed. Please try again."),l.redirect&&a(l.redirect)):(b(p,""),P.success("Login successful"),a(l.redirect||"/broker"))}catch(t){console.error("Login error:",t),i("Login failed. Please try again.")}finally{u(!1)}};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center py-8 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-16",children:[e.jsxs(A,{className:"w-full max-w-md order-1 lg:order-2 shadow-xl",children:[e.jsxs(I,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/logo.png",alt:"OpenAlgo",className:"h-20 w-20"})}),e.jsx(_,{className:"text-2xl",children:"Welcome Back"}),e.jsx(O,{children:"Sign in to your OpenAlgo account"})]}),e.jsx(R,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"username",children:"Username"}),e.jsx(y,{id:"username",type:"text",placeholder:"Enter your username",value:p,onChange:o=>v(o.target.value),required:!0,disabled:d,autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"password",type:c?"text":"password",placeholder:"Enter your password",value:x,onChange:o=>S(o.target.value),required:!0,disabled:d,autoComplete:"current-password",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>k(!c),"aria-label":c?"Hide password":"Show password",children:c?e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(B,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("div",{className:"text-right",children:e.jsx(J,{to:"/reset-password",className:"text-sm text-muted-foreground hover:text-primary",children:"Forgot password?"})})]}),f&&e.jsx(j,{variant:"destructive",children:e.jsx(w,{children:f})}),e.jsx(m,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),"Sign in"]})})]})})]}),e.jsxs("div",{className:"flex-1 max-w-xl text-center lg:text-left order-2 lg:order-1",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["Welcome to ",e.jsx("span",{className:"text-primary",children:"OpenAlgo"})]}),e.jsx("p",{className:"text-lg lg:text-xl mb-8 text-muted-foreground",children:"Sign in to your account to access your trading dashboard and manage your algorithmic trading strategies."}),e.jsxs(j,{className:"mb-6",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(E,{children:"First Time User?"}),e.jsx(w,{children:"Contact your administrator to set up your account."})]}),e.jsxs("div",{className:"flex justify-center lg:justify-start gap-4",children:[e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://github.com/marketcalls/openalgo",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"GitHub"]})}),e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://openalgo.in/discord",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Discord"]})})]})]})]})})})}export{te as default};
