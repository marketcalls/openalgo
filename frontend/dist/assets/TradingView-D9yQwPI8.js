import{r as t,j as e}from"./vendor-react-z89-0JOV.js";import{B as c,t as N}from"./index-BFhQJuAS.js";import{A as W,a as $}from"./alert-C64fJO7X.js";import{C as d,b as h,c as u,d as Q,a as m}from"./card-DyuMrKeN.js";import{I as M}from"./input-Bj-b9VF3.js";import{L as i}from"./label-DeJk-a-g.js";import{S as w,a as S,b as C,c as E,d as x}from"./select-WCGzVEvd.js";import{T as X,a as Z,b as B}from"./tabs-pFCd4o6t.js";import{J as ee}from"./json-editor-DS10zURR.js";import{T as se,a2 as I,R as ae,n as te,Q as re}from"./vendor-icons-CHYcgrp0.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-3k9vkKfj.js";import"./vendor-radix-CPYAX5SR.js";import"./index-CAPLoq5M.js";import"./index-Cp6hhLVC.js";const ne=[{value:"NSE",label:"NSE"},{value:"NFO",label:"NFO"},{value:"BSE",label:"BSE"},{value:"BFO",label:"BFO"},{value:"CDS",label:"CDS"},{value:"MCX",label:"MCX"}],le=[{value:"MIS",label:"MIS - Intraday"},{value:"NRML",label:"NRML - Carry Forward"},{value:"CNC",label:"CNC - Delivery"}];function Ne(){const[p,J]=t.useState("strategy"),[r,T]=t.useState("NHPC"),[n,R]=t.useState("NSE"),[g,D]=t.useState("MIS"),[k,H]=t.useState("BUY"),[L,P]=t.useState("1"),[O,j]=t.useState([]),[Y,l]=t.useState(!1),[G,A]=t.useState(!1),[o,q]=t.useState(""),[f,U]=t.useState(null),y=t.useRef(null);t.useEffect(()=>{(async()=>{try{const _=await(await fetch("/api/config/host",{credentials:"include"})).json();U(_)}catch(a){console.error("Failed to fetch host config:",a),U({host_server:window.location.origin,is_localhost:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"})}})()},[]);const v=f?`${f.host_server}/api/v1/placesmartorder`:`${window.location.origin}/api/v1/placesmartorder`,V=t.useCallback(async s=>{if(s.length<2){j([]),l(!1);return}A(!0);try{const a=new URLSearchParams({q:s});n&&a.append("exchange",n);const K=await(await fetch(`/search/api/search?${a}`,{credentials:"include"})).json();j((K.results||[]).slice(0,10)),l(!0)}catch(a){console.error("Search error:",a),j([])}finally{A(!1)}},[n]);t.useEffect(()=>{const s=setTimeout(()=>{r.length>=2&&V(r)},300);return()=>clearTimeout(s)},[r,V]),t.useEffect(()=>{const s=a=>{y.current&&!y.current.contains(a.target)&&l(!1)};return document.addEventListener("click",s),()=>document.removeEventListener("click",s)},[]);const z=s=>{T(s.symbol),R(s.exchange),l(!1)},b=(s=!0)=>{if(!r||!n){s&&N.error("Please select a symbol and exchange");return}let a;p==="strategy"?a={apikey:"YOUR_API_KEY",strategy:"TradingView Strategy",symbol:r,exchange:n,action:"{{strategy.order.action}}",product:g,pricetype:"MARKET",quantity:"{{strategy.order.contracts}}",position_size:"{{strategy.position_size}}"}:a={apikey:"YOUR_API_KEY",strategy:"TradingView Line Alert",symbol:r,exchange:n,action:k,product:g,pricetype:"MARKET",quantity:L},q(JSON.stringify(a,null,2))};t.useEffect(()=>{b(!1)},[b]);const F=async(s,a)=>{try{await navigator.clipboard.writeText(s),N.success(`${a} copied to clipboard`)}catch{N.error("Copy failed - please copy manually")}};return e.jsxs("div",{className:"container mx-auto py-6 px-4 max-w-6xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"TradingView Configuration"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Generate webhook configuration for TradingView strategy alerts"})]}),f?.is_localhost&&e.jsxs(W,{variant:"destructive",className:"mb-8",children:[e.jsx(se,{className:"h-5 w-5"}),e.jsxs($,{className:"ml-2",children:[e.jsx("strong",{children:"Webhook URL not accessible!"})," TradingView cannot send alerts to localhost. Use ",e.jsx("strong",{children:"ngrok"}),", ",e.jsx("strong",{children:"Cloudflare Tunnel"}),","," ",e.jsx("strong",{children:"VS Code Dev Tunnel"}),", or a ",e.jsx("strong",{children:"custom domain"})," to expose your OpenAlgo instance to the internet. Update ",e.jsx("code",{children:"HOST_SERVER"})," in your ",e.jsx("code",{children:".env"})," file with your external URL."]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsxs(h,{children:[e.jsx(u,{className:"text-primary",children:"Webhook URL"}),e.jsx(Q,{children:"Use this URL in your TradingView alerts"})]}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[e.jsx("code",{className:"flex-1 text-sm font-mono truncate",title:v,children:v}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>F(v,"Webhook URL"),children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Copy"]})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(u,{children:"Configuration"})}),e.jsxs(m,{className:"space-y-4",children:[e.jsx(X,{value:p,onValueChange:s=>J(s),children:e.jsxs(Z,{className:"grid w-full grid-cols-2",children:[e.jsx(B,{value:"strategy",children:"Strategy Alert"}),e.jsx(B,{value:"line",children:"Line Alert"})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"symbol",children:"Symbol"}),e.jsxs("div",{className:"relative",ref:y,children:[e.jsx(M,{id:"symbol",type:"text",placeholder:"Search for symbol...",value:r,onChange:s=>T(s.target.value),onFocus:()=>{r.length>=2&&l(!0)},autoComplete:"off"}),G&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary"})}),Y&&O.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-background border rounded-lg shadow-lg max-h-64 overflow-y-auto",children:O.map((s,a)=>e.jsx("div",{className:"p-3 border-b last:border-b-0 hover:bg-muted cursor-pointer",onClick:()=>z(s),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.symbol}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.name})]}),e.jsx("span",{className:"text-xs bg-primary text-primary-foreground px-2 py-1 rounded",children:s.exchange})]})},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"exchange",children:"Exchange"}),e.jsxs(w,{value:n,onValueChange:R,children:[e.jsx(S,{children:e.jsx(C,{placeholder:"Select Exchange"})}),e.jsx(E,{children:ne.map(s=>e.jsx(x,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"product",children:"Product Type"}),e.jsxs(w,{value:g,onValueChange:D,children:[e.jsx(S,{children:e.jsx(C,{})}),e.jsx(E,{children:le.map(s=>e.jsx(x,{value:s.value,children:s.label},s.value))})]})]}),p==="line"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"action",children:"Action"}),e.jsxs(w,{value:k,onValueChange:H,children:[e.jsx(S,{children:e.jsx(C,{})}),e.jsxs(E,{children:[e.jsx(x,{value:"BUY",children:"BUY"}),e.jsx(x,{value:"SELL",children:"SELL"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"quantity",children:"Quantity"}),e.jsx(M,{id:"quantity",type:"number",min:"1",value:L,onChange:s=>P(s.target.value),placeholder:"Enter quantity"})]})]}),e.jsxs(c,{onClick:()=>b(),className:"w-full",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Generate JSON"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(u,{children:"Generated JSON"}),e.jsxs(c,{variant:"secondary",size:"sm",onClick:()=>F(o,"JSON"),disabled:!o,children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Copy"]})]})}),e.jsx(m,{children:e.jsx("div",{className:"rounded-lg overflow-hidden border bg-background h-64",children:o?e.jsx(ee,{value:o,readOnly:!0,className:"h-full"}):e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:e.jsx("p",{children:'Fill in the form and click "Generate JSON" to see the output'})})})})]}),e.jsxs(d,{className:"bg-accent text-accent-foreground",children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Need Help?"]})}),e.jsxs(m,{className:"space-y-4",children:[e.jsx("p",{children:"Learn how to set up automated trading using TradingView webhooks with our step-by-step guide."}),e.jsx(c,{asChild:!0,variant:"default",children:e.jsxs("a",{href:"https://docs.openalgo.in/trading-platform/tradingview",target:"_blank",rel:"noopener noreferrer",children:["View Documentation",e.jsx(re,{className:"h-4 w-4 ml-2"})]})})]})]})]})]})]})}export{Ne as default};
