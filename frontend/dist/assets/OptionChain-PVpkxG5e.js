import{r as l,j as e,a as He}from"./vendor-react-CCyQGCED.js";import{g as Ke,D as Be,p as Ue,B as $,q as Ve,A as ye,C as _e,E as ge,x as Ce,G as Le,c as w,e as qe,d as De,s as he}from"./index-DLrRZEmO.js";import{a as Ae,u as Ge}from"./useMarketStatus-BxIKad63.js";import{o as Pe}from"./oi-profile-CkxblXa3.js";import{i as Je,a1 as Ze,ae as et,aT as tt,aU as st,Y as Te,c as at,aB as nt,aD as rt}from"./vendor-icons-Ys8lBJ3m.js";import{D as ze,a as lt,b as Ye,c as $e,d as Qe,e as it,f as We,g as ct}from"./dialog-qZmBfu2p.js";import{S as Ee}from"./scroll-area-CCsbhQo0.js";import{I as Ne}from"./input-D6pxZHWn.js";import{L as ne}from"./label-H7e-ALDu.js";import{S as oe,a as de,b as ue,c as me,d as xe}from"./select-CSWw-9Vv.js";import{t as Se}from"./trading-DCRr6etS.js";import{C as ot,b as dt,a as ut}from"./collapsible-DcfHjv7p.js";import{C as re,d as le}from"./card-BHRAREBW.js";import{T as mt,a as xt,b as we,c as ie,d as pt,e as ve}from"./table-Dg3T_HsI.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";function ht(s,t,r,n,d,o={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:i,refreshInterval:b=3e4,pauseWhenHidden:y=!0}=o,{isVisible:C}=Ke(),[c,a]=l.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),x=l.useRef(null),p=l.useRef(null),h=i&&(!y||C),F=l.useCallback(async()=>{if(!(!s||!t||!r||!n)&&!p.current){a(P=>({...P,isLoading:!0}));try{const P=new AbortController;p.current=P;const f=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:r,expiry_date:n,strike_count:d}),signal:P.signal});if(!f.ok)throw new Error(`HTTP error! status: ${f.status}`);const u=await f.json();u.status==="success"?a(_=>({..._,data:u,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):a(_=>({..._,isLoading:!1,error:u.message||"Failed to fetch option chain"}))}catch(P){P instanceof Error&&(P.name==="AbortError"?p.current===null&&a(f=>({...f,isLoading:!1})):a(f=>({...f,isLoading:!1,error:P.message||"Connection error",isConnected:!1})))}finally{p.current=null}}},[s,t,r,n,d]);l.useEffect(()=>{if(!h){x.current&&(clearInterval(x.current),x.current=null),a(P=>({...P,isPaused:!!i}));return}return a(P=>({...P,isConnected:!0,isPaused:!1})),F(),x.current=setInterval(F,b),()=>{x.current&&(clearInterval(x.current),x.current=null),p.current&&(p.current.abort(),p.current=null)}},[h,F,b,i]);const U=l.useCallback(()=>{F()},[F]);return{...c,refetch:U}}const ft=new Set(["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY","NIFTYNXT50","NIFTYIT","NIFTYPHARMA","NIFTYBANK"]),gt=new Set(["SENSEX","BANKEX","SENSEX50"]);function Oe(s,t){return ft.has(s)?"NSE_INDEX":gt.has(s)?"BSE_INDEX":t==="BFO"?"BSE":"NSE"}function ce(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function bt(s,t,r,n,d,o,i={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:b,oiRefreshInterval:y=3e4,pauseWhenHidden:C=!0}=i,[c,a]=l.useState(null),[x,p]=l.useState(null),{data:h,isLoading:F,isConnected:U,isPaused:P,error:f,lastUpdate:u,refetch:_}=ht(s,t,r,d,o,{enabled:b,refreshInterval:y,pauseWhenHidden:C}),D=l.useMemo(()=>{const N=[],z=Oe(t,n);if(N.push({symbol:t,exchange:z}),h?.chain)for(const Y of h.chain)Y.ce?.symbol&&N.push({symbol:Y.ce.symbol,exchange:n}),Y.pe?.symbol&&N.push({symbol:Y.pe.symbol,exchange:n});return N},[h?.chain,n,t]),{data:T,isConnected:E,isAuthenticated:g,isPaused:q}=Ae({symbols:D,mode:"Depth",enabled:b&&D.length>0}),K=l.useRef(0);l.useEffect(()=>{if(!h){a(null);return}if(T.size===0){a(h);return}const N=h.chain.map(L=>{const O={...L};if(L.ce?.symbol){const S=`${n}:${L.ce.symbol}`,I=T.get(S);if(I?.data){const H=I.data.depth?.buy?.[0],R=I.data.depth?.sell?.[0],X=L.ce.tick_size;O.ce={...L.ce,ltp:ce(I.data.ltp,X)??L.ce.ltp,bid:ce(H?.price??I.data.bid_price,X)??L.ce.bid,ask:ce(R?.price??I.data.ask_price,X)??L.ce.ask,bid_qty:H?.quantity??I.data.bid_size??L.ce.bid_qty??0,ask_qty:R?.quantity??I.data.ask_size??L.ce.ask_qty??0}}}if(L.pe?.symbol){const S=`${n}:${L.pe.symbol}`,I=T.get(S);if(I?.data){const H=I.data.depth?.buy?.[0],R=I.data.depth?.sell?.[0],X=L.pe.tick_size;O.pe={...L.pe,ltp:ce(I.data.ltp,X)??L.pe.ltp,bid:ce(H?.price??I.data.bid_price,X)??L.pe.bid,ask:ce(R?.price??I.data.ask_price,X)??L.pe.ask,bid_qty:H?.quantity??I.data.bid_size??L.pe.bid_qty??0,ask_qty:R?.quantity??I.data.ask_size??L.pe.ask_qty??0}}}return O});let z=!1;for(const[,L]of T)if(L.lastUpdate&&L.lastUpdate>K.current){z=!0,K.current=L.lastUpdate;break}z&&p(new Date);const j=`${Oe(t,n)}:${t}`,V=T.get(j)?.data?.ltp??h.underlying_ltp;a({...h,underlying_ltp:V,chain:N})},[h,T,n,t]);const k=E&&g&&D.length>0,Z=P||q,Q=l.useMemo(()=>!u&&!x?null:u?x&&x>u?x:u:x,[u,x]);return{data:c,isLoading:F,isConnected:U,isStreaming:k,isPaused:Z,error:f,lastUpdate:Q,streamingSymbols:D.length,refetch:_}}const W=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],jt=W.map(s=>s.key),yt=W.filter(s=>s.defaultVisible).map(s=>s.key),ee={visibleColumns:yt,columnOrder:jt,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Xe="openalgo_option_chain_prefs";function Nt(){if(typeof window>"u")return ee;try{const s=localStorage.getItem(Xe);if(!s)return ee;const t=JSON.parse(s),r=new Set(W.map(i=>i.key)),n=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(i=>r.has(i)):ee.visibleColumns;n.includes("strike")||n.push("strike");const d=Array.isArray(t.columnOrder)?t.columnOrder.filter(i=>r.has(i)):ee.columnOrder,o=new Set(d);return ee.columnOrder.forEach(i=>{o.has(i)||d.push(i)}),{visibleColumns:n,columnOrder:d,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:ee.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:ee.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:ee.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:ee.barStyle}}catch{return ee}}function vt(s){if(!(typeof window>"u"))try{localStorage.setItem(Xe,JSON.stringify(s))}catch{}}function Ct(){const[s,t]=l.useState(()=>Nt());l.useEffect(()=>{vt(s)},[s]);const r=l.useCallback(a=>{a!=="strike"&&t(x=>{const h=x.visibleColumns.includes(a)?x.visibleColumns.filter(F=>F!==a):[...x.visibleColumns,a];return{...x,visibleColumns:h}})},[]),n=l.useCallback(a=>{t(x=>({...x,columnOrder:a}))},[]),d=l.useCallback(a=>{t(x=>({...x,strikeCount:a}))},[]),o=l.useCallback(a=>{t(x=>({...x,selectedUnderlying:a}))},[]),i=l.useCallback(a=>{t(x=>({...x,barDataSource:a}))},[]),b=l.useCallback(a=>{t(x=>({...x,barStyle:a}))},[]),y=l.useCallback(()=>{t(ee)},[]),C=l.useCallback(a=>s.visibleColumns.includes(a),[s.visibleColumns]),c=l.useCallback(()=>s.columnOrder.filter(a=>s.visibleColumns.includes(a)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:r,reorderColumns:n,setStrikeCount:d,setSelectedUnderlying:o,setBarDataSource:i,setBarStyle:b,resetToDefaults:y,isColumnVisible:C,getOrderedVisibleColumns:c}}function St({barDataSource:s,barStyle:t,onBarDataSourceChange:r,onBarStyleChange:n}){return e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Ve,{align:"end",className:"w-48",children:[e.jsx(ye,{children:"Bar Data"}),e.jsxs(_e,{value:s,onValueChange:d=>r(d),children:[e.jsx(ge,{value:"oi",children:"Open Interest"}),e.jsx(ge,{value:"volume",children:"Volume"})]}),e.jsx(Ce,{}),e.jsx(ye,{children:"Bar Style"}),e.jsxs(_e,{value:t,onValueChange:d=>n(d),children:[e.jsx(ge,{value:"gradient",children:"Gradient"}),e.jsx(ge,{value:"solid",children:"Solid"})]})]})]})}function wt({visibleColumns:s,onToggleColumn:t,onResetToDefaults:r}){const n=W.filter(i=>i.side==="ce"),d=W.filter(i=>i.side==="pe"),o=i=>s.includes(i);return e.jsxs(Be,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Ve,{align:"end",className:"w-48",children:[e.jsx(ye,{children:"CALLS Columns"}),n.map(i=>e.jsx(Le,{checked:o(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ce,{}),e.jsx(ye,{children:"PUTS Columns"}),d.map(i=>e.jsx(Le,{checked:o(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ce,{}),e.jsxs($,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:r,children:[e.jsx(et,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Me({columnKey:s,label:t,side:r,isVisible:n,isDragging:d,onDragStart:o,onDragOver:i,onDrop:b,onDragEnd:y}){return e.jsxs("div",{draggable:!0,onDragStart:C=>o(C,s),onDragOver:i,onDrop:C=>b(C,s),onDragEnd:y,className:w("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",d&&"opacity-50 border-dashed",n?"bg-card":"bg-muted/50 opacity-60",r==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(st,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:w("text-xs px-1.5 py-0.5 rounded",r==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:r==="ce"?"CE":"PE"})]})}function Dt({columnOrder:s,visibleColumns:t,onReorderColumns:r}){const[n,d]=l.useState(s),[o,i]=l.useState(null),[b,y]=l.useState(!1),C=n.filter(u=>W.find(D=>D.key===u)?.side==="ce"),c=n.filter(u=>W.find(D=>D.key===u)?.side==="pe"),a=u=>W.find(D=>D.key===u)?.label??u,x=u=>W.find(D=>D.key===u)?.side==="pe"?"pe":"ce",p=(u,_)=>{i(_),u.dataTransfer.effectAllowed="move",u.dataTransfer.setData("text/plain",_)},h=u=>{u.preventDefault(),u.dataTransfer.dropEffect="move"},F=(u,_)=>{if(u.preventDefault(),!o||o===_)return;const D=x(o),T=x(_);if(D!==T)return;const E=[...n],g=E.indexOf(o),q=E.indexOf(_);E.splice(g,1),E.splice(q,0,o),d(E)},U=()=>{i(null)},P=()=>{r(n),y(!1)},f=u=>{y(u),u&&d(s)};return e.jsxs(ze,{open:b,onOpenChange:f,children:[e.jsx(lt,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Ye,{className:"sm:max-w-md",children:[e.jsxs($e,{children:[e.jsx(Qe,{children:"Reorder Columns"}),e.jsx(it,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Ee,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:C.map(u=>e.jsx(Me,{columnKey:u,label:a(u),side:"ce",isVisible:t.includes(u),isDragging:o===u,onDragStart:p,onDragOver:h,onDrop:F,onDragEnd:U},u))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Ee,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:c.map(u=>e.jsx(Me,{columnKey:u,label:a(u),side:"pe",isVisible:t.includes(u),isDragging:o===u,onDragStart:p,onDragOver:h,onDrop:F,onDragEnd:U},u))})})]})]}),e.jsxs(We,{className:"gap-2 sm:gap-0",children:[e.jsx(ct,{asChild:!0,children:e.jsx($,{variant:"outline",children:"Cancel"})}),e.jsx($,{onClick:P,children:"Save Order"})]})]})]})}function kt(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function _t({exchange:s,ltp:t,prevClose:r,change:n,changePercent:d,bidPrice:o,askPrice:i,bidSize:b,askSize:y,isLoading:C}){const c=n??(t&&r?t-r:void 0),a=d??(c&&r?c/r*100:void 0),x=c!==void 0&&c>=0;return C?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(qe,{className:w("text-[10px] px-1.5 py-0",kt(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),c!==void 0&&e.jsxs("span",{className:w("text-sm font-medium",x?"text-green-500":"text-red-500"),children:[x?"+":"",c.toFixed(2),a!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",x?"+":"",a.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:o!==void 0&&o>0?o.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",b.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:i!==void 0&&i>0?i.toFixed(2):"-"}),y!==void 0&&y>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",y.toLocaleString()]})]})]})]})}function Ie({price:s,quantity:t,maxQty:r,side:n}){const d=r>0?Math.min(t/r*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:w("absolute top-0 bottom-0 transition-all duration-300",n==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${d}%`}})}),e.jsx("span",{className:w("relative z-10 flex-1 font-mono text-xs",n==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function Lt({depth:s,isExpanded:t,onToggle:r,maxLevels:n=5}){const d=s?.buy?.slice(0,n)??[],o=s?.sell?.slice(0,n)??[],i=Math.max(...d.map(c=>c.quantity),1),b=Math.max(...o.map(c=>c.quantity),1),y=Math.max(i,b),C=d.length>0||o.length>0;return e.jsxs(ot,{open:t,onOpenChange:r,children:[e.jsxs(dt,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(ut,{children:C?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:d.length>0?d.map((c,a)=>e.jsx(Ie,{price:c.price,quantity:c.quantity,maxQty:y,side:"buy"},`buy-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:o.length>0?o.map((c,a)=>e.jsx(Ie,{price:c.price,quantity:c.quantity,maxQty:y,side:"sell"},`sell-${a}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:d.reduce((c,a)=>c+a.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:o.reduce((c,a)=>c+a.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}function Pt(s,t,r={}){const{enabled:n=!0,mode:d="Depth",useQuotesFallback:o=!0,useDepthFallback:i=!0,staleThreshold:b=5e3,refreshInterval:y=3e4}=r,{apiKey:C}=De(),{isMarketOpen:c}=Ge(),[a,x]=l.useState(null),[p,h]=l.useState(null),[F,U]=l.useState(!1),P=l.useRef(0),f=!!s&&!!t,u=l.useMemo(()=>f?[{symbol:s,exchange:t}]:[],[s,t,f]),{data:_,isConnected:D,isPaused:T,isFallbackMode:E}=Ae({symbols:u,mode:d,enabled:n&&f}),g=_.get(`${t}:${s}`)?.data,q=_.get(`${t}:${s}`)?.lastUpdate,K=c(t),k=!!(D&&g&&q&&Date.now()-q<b),Z=k&&K&&!T,Q=l.useCallback(async()=>{if(!(!C||!f)){U(!0);try{const O=[];o&&O.push(Se.getQuotes(C,s,t).then(S=>{S.status==="success"&&S.data&&x(S.data)}).catch(()=>{console.debug("REST quotes fetch failed")})),i&&d==="Depth"&&O.push(Se.getDepth(C,s,t).then(S=>{S.status==="success"&&S.data&&h(S.data)}).catch(()=>{console.debug("REST depth fetch failed")})),await Promise.all(O),P.current=Date.now()}finally{U(!1)}}},[C,s,t,f,o,i,d]),N=l.useRef(n),z=l.useRef(f),Y=l.useRef(Q);l.useEffect(()=>{N.current=n,z.current=f,Y.current=Q},[n,f,Q]),l.useEffect(()=>{if(!n||!f)return;Y.current();const O=setInterval(()=>{N.current&&z.current&&Y.current()},y);return()=>clearInterval(O)},[n,f,s,t,y]),l.useEffect(()=>{x(null),h(null)},[s,t]);const j=l.useMemo(()=>{if(p)return{buy:p.bids.map(O=>({price:O.price,quantity:O.quantity})),sell:p.asks.map(O=>({price:O.price,quantity:O.quantity}))}},[p]),M=l.useMemo(()=>{const O=g?.depth??j,S=g?.depth?.buy?.[0]?.price??j?.buy?.[0]?.price??g?.bid_price??a?.bid,I=g?.depth?.sell?.[0]?.price??j?.sell?.[0]?.price??g?.ask_price??a?.ask,H=g?.depth?.buy?.[0]?.quantity??j?.buy?.[0]?.quantity??g?.bid_size,R=g?.depth?.sell?.[0]?.quantity??j?.sell?.[0]?.quantity??g?.ask_size;return{ltp:g?.ltp??p?.ltp??a?.ltp,open:g?.open??p?.open??a?.open,high:g?.high??p?.high??a?.high,low:g?.low??p?.low??a?.low,close:g?.close??p?.prev_close??a?.prev_close,volume:g?.volume??p?.volume??a?.volume,oi:p?.oi??a?.oi,change:g?.change,changePercent:g?.change_percent,bidPrice:S,askPrice:I,bidSize:H,askSize:R,depth:O}},[g,a,p,j]),V=l.useMemo(()=>{if(M.change!==void 0)return M;const O=M.ltp&&M.close?M.ltp-M.close:void 0,S=O&&M.close?O/M.close*100:void 0;return{...M,change:O,changePercent:S}},[M]),L=l.useMemo(()=>k?"websocket":a||p?"rest":"none",[k,a,p]);return{data:V,isLive:Z,isConnected:D,isLoading:F&&!a&&!p,isPaused:T,isFallbackMode:E,dataSource:L,refresh:Q}}const Tt=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Et=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Ot=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function je(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function be(s,t,r){const n=je(s,t);return r==="up"?Number((n+t).toFixed(2)):Math.max(0,Number((n-t).toFixed(2)))}function Fe(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function Mt({open:s,onOpenChange:t,symbol:r="",exchange:n="",action:d="BUY",quantity:o,lotSize:i=1,tickSize:b=.05,product:y="NRML",priceType:C="MARKET",strategy:c="OptionChain",onSuccess:a,onError:x}){const{apiKey:p}=De(),[h,F]=l.useState(d),[U,P]=l.useState(o??i),[f,u]=l.useState(C),[_,D]=l.useState(y),[T,E]=l.useState(0),[g,q]=l.useState(0),[K,k]=l.useState(!1),[Z,Q]=l.useState(!1),[N,z]=l.useState("lots"),[Y,j]=l.useState(1),M=Fe(n)?Et:Ot,{data:V,isLoading:L,isConnected:O}=Pt(r,n,{enabled:s&&!!r&&!!n,mode:"Depth",useQuotesFallback:!0,useDepthFallback:!0});l.useEffect(()=>{if(s){F(d),P(o??i),u(C);const v=Fe(n),G=v?"NRML":"CNC",fe=y&&(v?["NRML","MIS"]:["CNC","MIS"]).includes(y)?y:G;D(fe),E(0),q(0),Q(!1),z("lots"),j(1)}},[s,d,o,i,C,y,n]);const S={ltp:V.ltp,close:V.close,change:V.change,change_percent:V.changePercent,bidPrice:V.bidPrice,askPrice:V.askPrice,bidSize:V.bidSize,askSize:V.askSize,depth:V.depth},I=S.change,H=S.change_percent;l.useEffect(()=>{f!=="MARKET"&&S.ltp&&T===0&&E(je(S.ltp,b))},[f,S.ltp,T,b]);const R=f==="LIMIT"||f==="SL",X=f==="SL-M"||f==="SL",se=l.useCallback(()=>!(!r||!n||!p||U<=0||R&&T<=0||X&&g<=0),[r,n,p,U,R,T,X,g]),ae=async()=>{if(!se()){he.error("Please fill all required fields");return}if(!p){he.error("API key not found. Please set up your API key."),x?.("API key not found");return}k(!0);try{const G={apikey:p,strategy:c,exchange:n,symbol:r,action:h,quantity:U,pricetype:f,product:_,...R&&{price:T},...X&&{trigger_price:g}},J=await Se.placeOrder(G),fe=J.orderid;if(J.status==="success"&&fe)a?.(fe),t(!1);else{const ke=J.message||"Order placement failed";he.error(ke,"orders"),x?.(ke)}}catch(v){let G="Order placement failed";if(v&&typeof v=="object"){const J=v;J.response?.data?.message?G=J.response.data.message:J.message&&(G=J.message)}he.error(G,"orders"),x?.(G)}finally{k(!1)}},m=v=>{const G=parseInt(v)||0;if(N==="lots")P(G*i),j(G);else{const J=Math.max(i,Math.round(G/i)*i);P(J),j(J/i)}},B=N==="lots"?Y:U,A=L&&!S.ltp&&!O;return e.jsx(ze,{open:s,onOpenChange:t,children:e.jsxs(Ye,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx($e,{children:e.jsxs(Qe,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:h==="BUY"?"text-green-500":"text-red-500",children:h}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:r})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(_t,{exchange:n,ltp:S.ltp,prevClose:S.close,change:I,changePercent:H,bidPrice:S.bidPrice,askPrice:S.askPrice,bidSize:S.bidSize,askSize:S.askSize,isLoading:A}),e.jsx(Lt,{depth:S.depth,isExpanded:Z,onToggle:()=>Q(!Z),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",variant:h==="BUY"?"default":"outline",className:w("flex-1",h==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>F("BUY"),children:"BUY"}),e.jsx($,{type:"button",variant:h==="SELL"?"default":"outline",className:w("flex-1",h==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>F("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ne,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>z("lots"),className:w("px-2 py-0.5 text-[10px] rounded",N==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>z("shares"),className:w("px-2 py-0.5 text-[10px] rounded",N==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(Ne,{type:"number",value:B,onChange:v=>m(v.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",i]}),e.jsxs("span",{children:["Total qty: ",U]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-xs",children:"Price Type"}),e.jsxs(oe,{value:f,onValueChange:v=>u(v),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsx(me,{children:Tt.map(v=>e.jsx(xe,{value:v.value,children:v.label},v.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-xs",children:"Product"}),e.jsxs(oe,{value:_,onValueChange:v=>D(v),children:[e.jsx(de,{children:e.jsx(ue,{})}),e.jsx(me,{children:M.map(v=>e.jsx(xe,{value:v.value,children:v.label},v.value))})]})]})]}),R&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>E(be(T,b,"down")),children:"-"}),e.jsx(Ne,{type:"number",value:T,onChange:v=>E(parseFloat(v.target.value)||0),onBlur:()=>E(je(T,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>E(be(T,b,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",b]})]}),X&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>q(be(g,b,"down")),children:"-"}),e.jsx(Ne,{type:"number",value:g,onChange:v=>q(parseFloat(v.target.value)||0),onBlur:()=>q(je(g,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>q(be(g,b,"up")),children:"+"})]})]})]}),e.jsxs(We,{className:"gap-2 sm:gap-0",children:[e.jsx($,{variant:"outline",onClick:()=>t(!1),disabled:K,children:"Cancel"}),e.jsx($,{onClick:ae,disabled:!se()||K,className:w(h==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:K?"Placing...":`Place ${h} Order`})]})]})})}const It=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"}],Re={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX"]},Ft=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function pe(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const r=s/1e3;return r>=1?r.toFixed(1)+"K":s.toLocaleString()}}function te(s){return s==null?"0.00":s.toFixed(2)}function Rt(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function Bt(s){let t=0,r=0;return s.forEach(n=>{n.ce?.oi&&(t+=n.ce.oi),n.pe?.oi&&(r+=n.pe?.oi??0)}),t===0?0:r/t}function Ut(s){let t=0,r=0,n=0,d=0;return s.forEach(o=>{o.ce&&(t+=o.ce.volume??0,n+=o.ce.oi??0),o.pe&&(r+=o.pe.volume??0,d+=o.pe.oi??0)}),{ceVolume:t,peVolume:r,ceOi:n,peOi:d}}function Vt(s,t){let r=0;return s.forEach(n=>{const d=t==="oi"?n.ce?.oi:n.ce?.volume,o=t==="oi"?n.pe?.oi:n.pe?.volume;d&&d>r&&(r=d),o&&o>r&&(r=o)}),r||1}const qt=He.memo(function({strike:t,previousStrike:r,maxBarValue:n,visibleCeColumns:d,visiblePeColumns:o,barDataSource:i,barStyle:b,optionExchange:y,onPlaceOrder:C}){const c=t.ce,a=t.pe,x=c?.label??a?.label??"",p=x==="ATM",h=x.startsWith("OTM"),F=x.startsWith("ITM"),U=r?.ce?.ltp!==void 0&&r.ce.ltp!==c?.ltp,P=r?.pe?.ltp!==void 0&&r.pe.ltp!==a?.ltp,f=U?c&&r?.ce&&c.ltp>r.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",u=P?a&&r?.pe&&a.ltp>r.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",_=c&&c.bid>0&&c.ask>0?c.ask-c.bid:0,D=a&&a.bid>0&&a.ask>0?a.ask-a.bid:0,T=_<=1?"text-green-500":_<=2?"text-yellow-500":"text-red-500",E=D<=1?"text-green-500":D<=2?"text-yellow-500":"text-red-500",g=i==="oi"?c?.oi:c?.volume,q=i==="oi"?a?.oi:a?.volume,K=g?Math.min(g/n*100,100):0,k=q?Math.min(q/n*100,100):0,Z=b==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",Q=b==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",N="font-mono tabular-nums text-xs",z=j=>{switch(j){case"ce_oi":return e.jsx("span",{className:N,children:pe(c?.oi)});case"ce_volume":return e.jsx("span",{className:N,children:pe(c?.volume)});case"ce_bid_qty":return e.jsx("span",{className:N,children:c?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:w(N,"text-red-500"),children:te(c?.bid)});case"ce_ltp":return e.jsx("span",{className:w(N,"font-semibold",f),children:te(c?.ltp)});case"ce_ask":return e.jsx("span",{className:w(N,"text-green-500"),children:te(c?.ask)});case"ce_ask_qty":return e.jsx("span",{className:N,children:c?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:w(N,T),children:te(_)});default:return null}},Y=j=>{switch(j){case"pe_oi":return e.jsx("span",{className:N,children:pe(a?.oi)});case"pe_volume":return e.jsx("span",{className:N,children:pe(a?.volume)});case"pe_bid_qty":return e.jsx("span",{className:N,children:a?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:w(N,"text-red-500"),children:te(a?.bid)});case"pe_ltp":return e.jsx("span",{className:w(N,"font-semibold",u),children:te(a?.ltp)});case"pe_ask":return e.jsx("span",{className:w(N,"text-green-500"),children:te(a?.ask)});case"pe_ask_qty":return e.jsx("span",{className:N,children:a?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:w(N,E),children:te(D)});default:return null}};return e.jsxs(we,{className:w("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":x,children:[d.length>0&&e.jsxs(ve,{className:w("p-0 relative",h&&!p&&"bg-amber-500/5"),children:[e.jsx("div",{className:w("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",Z),style:{width:`${K}%`}}),c&&e.jsxs("div",{className:w("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),C({symbol:c.symbol,exchange:y,action:"BUY",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:j=>{j.stopPropagation(),C({symbol:c.symbol,exchange:y,action:"SELL",lotSize:c.lotsize??1,tickSize:c.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:d.map(j=>{const M=W.find(V=>V.key===j);return e.jsx("div",{className:w("flex-1 px-2 py-1.5 min-w-0",M?.align==="right"&&"text-right",M?.align==="center"&&"text-center",M?.align==="left"&&"text-left"),children:z(j)},j)})})]}),e.jsx(ve,{className:w("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",p?"bg-primary/15":"bg-muted/30"),children:t.strike}),o.length>0&&e.jsxs(ve,{className:w("p-0 relative",F&&!p&&"bg-amber-500/5"),children:[e.jsx("div",{className:w("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",Q),style:{width:`${k}%`}}),a&&e.jsxs("div",{className:w("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),C({symbol:a.symbol,exchange:y,action:"BUY",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:j=>{j.stopPropagation(),C({symbol:a.symbol,exchange:y,action:"SELL",lotSize:a.lotsize??1,tickSize:a.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:o.map(j=>{const M=W.find(V=>V.key===j);return e.jsx("div",{className:w("flex-1 px-2 py-1.5 min-w-0",M?.align==="right"&&"text-right",M?.align==="center"&&"text-center",M?.align==="left"&&"text-left"),children:Y(j)},j)})})]})]})});function rs(){const{apiKey:s}=De(),{visibleColumns:t,columnOrder:r,strikeCount:n,selectedUnderlying:d,barDataSource:o,barStyle:i,toggleColumn:b,reorderColumns:y,setStrikeCount:C,setSelectedUnderlying:c,setBarDataSource:a,setBarStyle:x,resetToDefaults:p}=Ct(),[h,F]=l.useState("NFO"),[U,P]=l.useState(Re.NFO),[f,u]=l.useState(""),[_,D]=l.useState([]),T=l.useRef(new Map),[E,g]=l.useState(null),q=h,K=h,{data:k,isConnected:Z,isStreaming:Q,isPaused:N,error:z,lastUpdate:Y,refetch:j,isLoading:M,streamingSymbols:V}=bt(s,d,K,q,Rt(f),n,{enabled:!!f,oiRefreshInterval:3e4,pauseWhenHidden:!0});l.useEffect(()=>{const m=Re[h]||[];P(m),c(m[0]||""),D([]),u("");let B=!1;return(async()=>{try{const v=await Pe.getUnderlyings(h);if(B)return;v.status==="success"&&v.underlyings.length>0&&(P(v.underlyings),v.underlyings.includes(m[0])||c(v.underlyings[0]))}catch{}})(),()=>{B=!0}},[h]),l.useEffect(()=>{if(!d)return;D([]),u("");let m=!1;return(async()=>{try{const A=await Pe.getExpiries(h,d);if(m)return;A.status==="success"&&A.expiries.length>0?(D(A.expiries),u(A.expiries[0])):(D([]),u(""))}catch{if(m)return;he.error("Failed to load expiry dates")}})(),()=>{m=!0}},[d]),l.useEffect(()=>{if(k?.chain){const m=setTimeout(()=>{const B=new Map;k.chain.forEach(A=>{B.set(A.strike,A)}),T.current=B},100);return()=>clearTimeout(m)}},[k?.chain]);const L=m=>{c(m),u(""),D([])},O=()=>{j()},S=l.useCallback(m=>{g({open:!0,symbol:m.symbol,exchange:m.exchange,action:m.action,quantity:m.lotSize,lotSize:m.lotSize,tickSize:m.tickSize})},[]),I=l.useCallback(m=>{m||g(null)},[]),H=l.useMemo(()=>k?.chain?Bt(k.chain):0,[k?.chain]),R=l.useMemo(()=>k?.chain?Ut(k.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[k?.chain]),X=l.useMemo(()=>k?.chain?Vt(k.chain,o):1,[k?.chain,o]),se=l.useMemo(()=>r.filter(m=>W.find(A=>A.key===m)?.side==="ce"&&t.includes(m)),[r,t]),ae=l.useMemo(()=>r.filter(m=>W.find(A=>A.key===m)?.side==="pe"&&t.includes(m)),[r,t]);return z?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(re,{className:"max-w-md",children:e.jsx(le,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:z}),e.jsxs($,{onClick:O,className:"mt-4",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(oe,{value:h,onValueChange:F,children:[e.jsx(de,{className:"w-24",children:e.jsx(ue,{placeholder:"Exchange"})}),e.jsx(me,{children:It.map(m=>e.jsx(xe,{value:m.value,children:m.label},m.value))})]}),e.jsxs(oe,{value:d,onValueChange:L,children:[e.jsx(de,{className:"w-36",children:e.jsx(ue,{placeholder:"Select Underlying"})}),e.jsx(me,{children:U.map(m=>e.jsx(xe,{value:m,children:m},m))})]}),e.jsxs(oe,{value:f,onValueChange:u,disabled:_.length===0,children:[e.jsx(de,{className:"w-36",children:e.jsx(ue,{placeholder:"Select Expiry"})}),e.jsx(me,{children:_.map(m=>e.jsx(xe,{value:m,children:m},m))})]}),e.jsxs(oe,{value:String(n),onValueChange:m=>C(Number(m)),children:[e.jsx(de,{className:"w-36",children:e.jsx(ue,{placeholder:"Strike Count"})}),e.jsx(me,{children:Ft.map(m=>e.jsx(xe,{value:String(m.value),children:m.label},m.value))})]}),e.jsx(St,{barDataSource:o,barStyle:i,onBarDataSourceChange:a,onBarStyleChange:x}),e.jsx(wt,{visibleColumns:t,onToggleColumn:b,onResetToDefaults:p}),e.jsx(Dt,{columnOrder:r,visibleColumns:t,onReorderColumns:y}),e.jsxs($,{onClick:O,disabled:!f||M,children:[e.jsx(Te,{className:`h-4 w-4 mr-2 ${M?"animate-spin":""}`}),"Refresh"]})]})]}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(re,{children:e.jsxs(le,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[d," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:te(k.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",te(k.underlying_prev_close)]})]})}),e.jsx(re,{children:e.jsxs(le,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:k.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",k.expiry_date]})]})}),e.jsx(re,{children:e.jsxs(le,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${H>1?"text-green-500":"text-yellow-500"}`,children:H.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(re,{children:e.jsxs(le,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:pe(R.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:pe(R.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:R.ceOi+R.peOi>0?`${R.ceOi/(R.ceOi+R.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",H.toFixed(2)]})})]})})]}),e.jsx(re,{children:e.jsx(le,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(mt,{className:"w-full table-fixed",children:[e.jsxs(xt,{children:[e.jsxs(we,{className:"bg-muted/30 border-b-0",children:[se.length>0&&e.jsx(ie,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(ie,{className:"text-center w-20 min-w-20"}),ae.length>0&&e.jsx(ie,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(we,{className:"bg-muted/50",children:[se.length>0&&e.jsx(ie,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:se.map(m=>{const B=W.find(A=>A.key===m);return e.jsx("div",{className:w("flex-1 px-2 py-2 text-xs font-medium min-w-0",B?.align==="right"&&"text-right",B?.align==="center"&&"text-center",B?.align==="left"&&"text-left"),children:B?.label},m)})})}),e.jsx(ie,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),ae.length>0&&e.jsx(ie,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:ae.map(m=>{const B=W.find(A=>A.key===m);return e.jsx("div",{className:w("flex-1 px-2 py-2 text-xs font-medium min-w-0",B?.align==="right"&&"text-right",B?.align==="center"&&"text-center",B?.align==="left"&&"text-left"),children:B?.label},m)})})})]})]}),e.jsx(pt,{children:k.chain.map(m=>e.jsx(qt,{strike:m,previousStrike:T.current.get(m.strike),maxBarValue:X,visibleCeColumns:se,visiblePeColumns:ae,barDataSource:o,barStyle:i,optionExchange:q,onPlaceOrder:S},m.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Q?e.jsx(nt,{className:"h-4 w-4 text-green-500"}):e.jsx(rt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(qe,{variant:Q?"default":Z?"secondary":"destructive",children:N?"Paused":Q?`Streaming ${V} symbols`:Z?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",o==="oi"?"OI":"Volume"," (",i,")"]})]}),e.jsxs("div",{children:["Last Update: ",Y?Y.toLocaleTimeString():"-"]})]})]}),!k&&!z&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Mt,{open:E?.open??!1,onOpenChange:I,symbol:E?.symbol,exchange:E?.exchange,action:E?.action,quantity:E?.quantity,lotSize:E?.lotSize,tickSize:E?.tickSize,strategy:"OptionChain"})]})}export{rs as default};
