import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{u as le,t as c,B as x,c as f,e as J}from"./index-D8iGqEWa.js";import{I as ie}from"./input-4sGuey1N.js";import{S as Pe}from"./scroll-area-BLx4VeJR.js";import{T as de,a as ce,b as M,c as U}from"./tabs-8hOM-Dsv.js";import{j as qe,X as Je,av as Me,Z as Ue,g as Ke,k as De,l as $e,N as Fe,K as W,S as Ge,x as He,Y as We,E as _e,t as Ve,a2 as xe,R as me,a6 as ue,P as Xe,p as Ze,ao as Qe}from"./vendor-icons-Ca5eNZvr.js";import{L as _}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-radix-gKv__6YA.js";async function Ye(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}function es(o){if(o.length>100*1024)return[{text:o,type:"plain"}];const l=[],k=/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g;let g=0,u=k.exec(o);for(;u!==null;){u.index>g&&l.push({text:o.slice(g,u.index),type:"plain"});const d=u[0];let N="number";/^"/.test(d)?N=/:$/.test(d)?"key":"string":/true|false/.test(d)?N="boolean":/null/.test(d)&&(N="null"),l.push({text:d,type:N}),g=k.lastIndex,u=k.exec(o)}return g<o.length&&l.push({text:o.slice(g),type:"plain"}),l}function ss(o){switch(o){case"key":return"text-sky-400";case"string":return"text-emerald-400";case"number":return"text-orange-400";case"boolean":return"text-purple-400";case"null":return"text-red-400";default:return""}}function ts(o){if(o.startsWith("/api/")||o.startsWith("/playground/"))return{valid:!0};try{const l=new URL(o,window.location.origin);return l.origin!==window.location.origin?{valid:!1,error:"Only same-origin requests are allowed"}:!l.pathname.startsWith("/api/")&&!l.pathname.startsWith("/playground/")?{valid:!1,error:"Only /api/ and /playground/ endpoints are allowed"}:{valid:!0}}catch{return{valid:!1,error:"Invalid URL format"}}}function ms(){const{mode:o,appMode:l,toggleMode:k,toggleAppMode:g,isTogglingMode:u}=le(),[d,N]=r.useState(""),[K,he]=r.useState(!1),[L,pe]=r.useState({}),[V,fe]=r.useState(new Set),[B,ge]=r.useState(""),[S,D]=r.useState([]),[C,T]=r.useState(null),[b,O]=r.useState("POST"),[h,z]=r.useState(""),[m,v]=r.useState(""),[$,F]=r.useState(!1),[y,A]=r.useState(null),[X,I]=r.useState(null),[Z,G]=r.useState(null),[w,R]=r.useState(null),[Q,Y]=r.useState({}),[ee,be]=r.useState(!0),je=r.useRef(null);r.useEffect(()=>{Ne(),ve()},[]);const Ne=async()=>{try{const s=await fetch("/playground/api-key",{credentials:"include"});if(s.ok){const t=await s.json();N(t.api_key||"")}}catch{}},ve=async()=>{try{const s=await fetch("/playground/endpoints",{credentials:"include"});if(s.ok){const t=await s.json();pe(t)}}catch{c.error("Failed to load endpoints")}},se=r.useCallback(s=>{let t={};return s.method==="GET"&&s.params?t={...s.params}:s.body&&(t={...s.body}),d&&!t.apikey&&(t.apikey=d),JSON.stringify(t,null,2)},[d]),te=s=>{const t=S.find(a=>a.endpoint.path===s.path);if(t)T(t.id),O(t.endpoint.method),z(t.endpoint.path),v(t.requestBody);else{const a={id:`${s.path}-${Date.now()}`,endpoint:s,requestBody:se(s),modified:!1};D(n=>[...n,a]),T(a.id),O(s.method),z(s.path),v(a.requestBody)}R(null),A(null),I(null),G(null)},ye=(s,t)=>{t.stopPropagation();const a=S.findIndex(i=>i.id===s),n=S.filter(i=>i.id!==s);if(D(n),C===s)if(n.length>0){const i=Math.min(a,n.length-1),p=n[i];T(p.id),O(p.endpoint.method),z(p.endpoint.path),v(p.requestBody)}else T(null),O("POST"),z(""),v("")},we=s=>{T(s.id),O(s.endpoint.method),z(s.endpoint.path),v(s.requestBody),R(null),A(null)},ae=s=>{v(s),C&&D(t=>t.map(a=>a.id===C?{...a,requestBody:s,modified:s!==se(a.endpoint)}:a))},ke=s=>{fe(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},Se=()=>{try{const s=JSON.parse(m),t=JSON.stringify(s,null,2);ae(t),c.success("JSON prettified")}catch{c.error("Invalid JSON - cannot prettify")}},Ce=async()=>{if(!h){c.warning("Please select an endpoint");return}const s=ts(h);if(!s.valid){c.error(s.error);return}F(!0),R(null),A(null),I(null),G(null),Y({});const t=Date.now();try{const a={method:b,credentials:"include",headers:{Accept:"application/json"}};let n=h;if(b==="GET"){if(m.trim())try{const E=JSON.parse(m),P=new URL(h,window.location.origin);Object.entries(E).forEach(([Ie,q])=>{q!=null&&q!==""&&P.searchParams.append(Ie,String(q))}),n=P.toString()}catch{c.error("Invalid JSON for query parameters"),F(!1);return}}else{const E=await Ye();a.headers["Content-Type"]="application/json",a.headers["X-CSRFToken"]=E,m.trim()&&(a.body=m)}const i=await fetch(n,a),p=Date.now()-t,j={};i.headers.forEach((E,P)=>{j[P]=E}),Y(j);let H;const ne=i.headers.get("content-type");ne?.includes("application/json")?H=await i.json():H={text:await i.text(),contentType:ne};const oe=JSON.stringify(H,null,2);A(i.status),I(p),G(new Blob([oe]).size),R(oe)}catch(a){const n=Date.now()-t;A(0),I(n),R(JSON.stringify({error:a instanceof Error?a.message:"Unknown error"},null,2))}finally{F(!1)}},Te=()=>{w&&(navigator.clipboard.writeText(w),c.success("Response copied!"))},Oe=()=>{d&&(navigator.clipboard.writeText(d),c.success("API key copied!"))},ze=async()=>{const s=await g();if(s.success){const t=le.getState().appMode;c.success(`Switched to ${t==="live"?"Live":"Analyze"} mode`),t==="analyzer"&&setTimeout(()=>{c.warning("⚠️ Analyzer (Sandbox) mode is for testing purposes only",{duration:1e4})},2e3)}else c.error(s.message||"Failed to toggle mode")},Ae=()=>{if(!h)return;let s=h;if(b==="GET"&&m.trim())try{const n=JSON.parse(m),i=new URL(h,window.location.origin);Object.entries(n).forEach(([p,j])=>{j!=null&&j!==""&&i.searchParams.append(p,String(j))}),s=i.toString()}catch{c.error("Invalid JSON for query parameters");return}const t=new URL(s,window.location.origin).href;let a=`curl -X ${b} "${t}"`;a+=` \\
  -H "Accept: application/json"`,b!=="GET"&&m.trim()&&(a+=` \\
  -H "Content-Type: application/json"`,a+=` \\
  -d '${m.replace(/'/g,"'\\''")}'`),navigator.clipboard.writeText(a),c.success("Copied as cURL")},Re=Object.entries(L).reduce((s,[t,a])=>{if(!B)s[t]=a;else{const n=a.filter(i=>i.name.toLowerCase().includes(B.toLowerCase())||i.path.toLowerCase().includes(B.toLowerCase()));n.length&&(s[t]=n)}return s},{}),Ee=s=>s?s>=200&&s<300?"text-emerald-500 dark:text-emerald-400":s>=400?"text-red-500 dark:text-red-400":"text-yellow-500 dark:text-yellow-400":"text-muted-foreground",Le=s=>s?s>=200&&s<300?"bg-emerald-500/10":s>=400?"bg-red-500/10":"bg-yellow-500/10":"bg-muted/50",Be=s=>s>=1024?`${(s/1024).toFixed(1)}KB`:`${s}B`,re=S.find(s=>s.id===C);return e.jsxs("div",{className:"h-full flex flex-col bg-background text-foreground",children:[e.jsxs("div",{className:"h-12 border-b border-border flex items-center px-2 bg-card/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground hover:bg-accent",onClick:()=>be(!ee),children:e.jsx(qe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsx("img",{src:"/images/android-chrome-192x192.png",alt:"OpenAlgo",className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold text-sm",children:"openalgo"})]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 px-4 overflow-x-auto",children:[S.map(s=>e.jsxs("div",{className:f("flex items-center gap-2 px-3 py-1.5 rounded-md text-xs cursor-pointer group","hover:bg-accent",s.id===C?"bg-accent text-foreground":"text-muted-foreground"),onClick:()=>we(s),children:[e.jsx(J,{variant:"outline",className:f("text-[9px] px-1 py-0 h-4 border-0 font-semibold",s.endpoint.method==="GET"?"bg-sky-500/20 text-sky-400":"bg-emerald-500/20 text-emerald-400"),children:s.endpoint.method}),e.jsx("span",{className:"truncate max-w-[100px]",children:s.endpoint.name}),s.modified&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),e.jsx("button",{type:"button",className:"opacity-0 group-hover:opacity-100 hover:text-foreground p-0.5 -mr-1",onClick:t=>ye(s.id,t),children:e.jsx(Je,{className:"h-3 w-3"})})]},s.id)),e.jsx(x,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-foreground hover:bg-accent",onClick:()=>{const s=Object.keys(L)[0];s&&L[s]?.[0]&&te(L[s][0])},children:e.jsx(Me,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsxs(J,{variant:l==="live"?"default":"secondary",className:f("text-xs",l==="analyzer"&&"bg-purple-500 hover:bg-purple-600 text-white"),children:[e.jsx("span",{className:"hidden sm:inline",children:l==="live"?"Live Mode":"Analyze Mode"}),e.jsx("span",{className:"sm:hidden",children:l==="live"?"Live":"Analyze"})]}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:ze,disabled:u,title:`Switch to ${l==="live"?"Analyze":"Live"} mode`,children:u?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):l==="live"?e.jsx(Ue,{className:"h-4 w-4"}):e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:k,disabled:l!=="live",title:o==="light"?"Switch to dark mode":"Switch to light mode",children:o==="light"?e.jsx(De,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 text-xs",asChild:!0,children:e.jsxs(_,{to:"/dashboard",children:[e.jsx(Fe,{className:"h-3.5 w-3.5 mr-1.5"}),"Dashboard"]})}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-7 text-xs",asChild:!0,children:e.jsxs(_,{to:"/apikey",children:[e.jsx(W,{className:"h-3.5 w-3.5 mr-1.5"}),"API Keys"]})})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:f("w-56 border-r border-border bg-card/30 flex flex-col overflow-hidden","transition-all duration-200",ee?"translate-x-0":"-translate-x-full absolute h-full z-50"),children:[e.jsx("div",{className:"p-2 border-b border-border shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ge,{className:"h-3.5 w-3.5 absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(ie,{placeholder:"search",className:"h-7 pl-8 text-xs bg-secondary/50 border-border text-foreground placeholder:text-muted-foreground",value:B,onChange:s=>ge(s.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("div",{className:"p-2",children:Object.entries(Re).map(([s,t])=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-1.5 w-full px-2 py-1 rounded text-[11px] font-medium uppercase tracking-wider text-muted-foreground hover:text-foreground hover:bg-accent/50",onClick:()=>ke(s),children:[V.has(s)?e.jsx(He,{className:"h-3 w-3"}):e.jsx(We,{className:"h-3 w-3"}),s]}),!V.has(s)&&e.jsx("div",{className:"mt-0.5 space-y-0.5",children:t.map((a,n)=>e.jsxs("button",{type:"button",className:f("w-full flex items-center gap-2 px-2 py-1 rounded text-left text-xs hover:bg-accent/50",re?.endpoint.path===a.path&&"bg-accent text-foreground"),onClick:()=>te(a),children:[e.jsx(J,{variant:"outline",className:f("text-[9px] px-1 py-0 h-4 border-0 font-semibold shrink-0",a.method==="GET"?"bg-sky-500/20 text-sky-400":"bg-emerald-500/20 text-emerald-400"),children:a.method}),e.jsx("span",{className:"truncate text-foreground/80",children:a.name})]},n))})]},s))})}),e.jsx("div",{className:"p-2 border-t border-border shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded bg-secondary/50",children:[e.jsx(W,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(ie,{type:K?"text":"password",value:d,readOnly:!0,className:"flex-1 h-5 text-[10px] font-mono bg-transparent border-none p-0 text-muted-foreground",placeholder:"No API key"}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-5 w-5 text-muted-foreground hover:text-foreground",onClick:()=>he(!K),children:K?e.jsx(_e,{className:"h-3 w-3"}):e.jsx(Ve,{className:"h-3 w-3"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-5 w-5 text-muted-foreground hover:text-foreground",onClick:Oe,children:e.jsx(xe,{className:"h-3 w-3"})})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:re?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border bg-card/30",children:[e.jsx(J,{variant:"outline",className:f("text-xs px-2 py-0.5 border-0 font-semibold",b==="GET"?"bg-sky-500/20 text-sky-400":"bg-emerald-500/20 text-emerald-400"),children:b}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 px-3 py-1.5 rounded bg-secondary/50 font-mono text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"http://127.0.0.1:5000"}),e.jsx("span",{className:"text-foreground",children:h})]}),e.jsx(x,{size:"sm",className:"h-8 px-4 bg-emerald-600 hover:bg-emerald-700 text-white",onClick:Ce,disabled:$,children:$?e.jsx(me,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3.5 w-3.5 mr-1.5"}),"Send"]})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 flex flex-col border-r border-border min-w-0",children:e.jsxs(de,{defaultValue:"body",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-1.5 border-b border-border bg-card/30",children:[e.jsxs(ce,{className:"h-7 bg-transparent p-0 gap-2",children:[e.jsx(M,{value:"body",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Body"}),e.jsx(M,{value:"headers",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Headers"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mr-2",children:"JSON"}),e.jsx(x,{variant:"ghost",size:"sm",className:"h-6 text-[10px] text-muted-foreground hover:text-foreground hover:bg-accent",onClick:Se,children:"Prettify"})]})]}),e.jsx(U,{value:"body",className:"flex-1 m-0 overflow-hidden",children:e.jsxs("div",{className:"h-full flex bg-background",children:[e.jsx("div",{className:"w-10 bg-card/50 text-muted-foreground/50 text-xs font-mono py-3 px-2 text-right select-none overflow-hidden border-r border-border",children:m.split(`
`).map((s,t)=>e.jsx("div",{className:"leading-5",children:t+1},t))}),e.jsx("textarea",{ref:je,className:"flex-1 p-3 font-mono text-xs bg-transparent border-none outline-none resize-none text-foreground leading-5",placeholder:'{"apikey": ""}',value:m,onChange:s=>ae(s.target.value),spellCheck:!1})]})}),e.jsx(U,{value:"headers",className:"flex-1 m-0 p-4 overflow-auto bg-background",children:e.jsxs("div",{className:"text-xs font-mono space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Content-Type:"}),e.jsx("span",{className:"text-foreground/80",children:"application/json"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Accept:"}),e.jsx("span",{className:"text-foreground/80",children:"application/json"})]})]})})]})}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:e.jsxs(de,{defaultValue:"response",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-1.5 border-b border-border bg-card/30",children:[e.jsxs(ce,{className:"h-7 bg-transparent p-0 gap-2",children:[e.jsx(M,{value:"response",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Response"}),e.jsx(M,{value:"headers",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Headers"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono",children:[y!==null&&e.jsxs("span",{className:f("px-2 py-0.5 rounded",Le(y),Ee(y)),children:[y," ",y>=200&&y<300?"OK":"Error"]}),X!==null&&e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(Xe,{className:"h-3 w-3"}),X,"ms"]}),Z!==null&&e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(Ze,{className:"h-3 w-3"}),Be(Z)]}),e.jsxs(x,{variant:"ghost",size:"sm",className:"h-6 text-[10px] text-muted-foreground hover:text-foreground hover:bg-accent",onClick:Ae,children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),"cURL"]}),w&&e.jsx(x,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-foreground",onClick:Te,children:e.jsx(xe,{className:"h-3 w-3"})})]})]}),e.jsx(U,{value:"response",className:"flex-1 m-0 overflow-hidden",children:e.jsx("div",{className:"h-full flex bg-background",children:w?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 bg-card/50 text-muted-foreground/50 text-xs font-mono py-3 px-2 text-right select-none overflow-hidden border-r border-border",children:w.split(`
`).map((s,t)=>e.jsx("div",{className:"leading-5",children:t+1},t))}),e.jsx(Pe,{className:"flex-1 p-3",children:e.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap break-words leading-5",children:es(w).map((s,t)=>e.jsx("span",{className:ss(s.type),children:s.text},t))})})]}):e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:$?e.jsx(me,{className:"h-8 w-8 text-muted-foreground/50 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-10 w-10 text-muted-foreground/30 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No response yet"}),e.jsx("p",{className:"text-muted-foreground/70 text-xs mt-1",children:"Click Send to make a request"})]})})})}),e.jsx(U,{value:"headers",className:"flex-1 m-0 p-4 overflow-auto bg-background",children:Object.keys(Q).length>0?e.jsx("div",{className:"text-xs font-mono space-y-2",children:Object.entries(Q).map(([s,t])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s,":"]}),e.jsx("span",{className:"text-foreground/80 break-all",children:t})]},s))}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No headers to display"})})]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center bg-background",children:[e.jsx("img",{src:"/images/android-chrome-192x192.png",alt:"OpenAlgo",className:"w-16 h-16 mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground/80 mb-2",children:"API Playground"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Select an endpoint from the sidebar to get started"}),!d&&e.jsx(x,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(_,{to:"/apikey",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Generate API Key"]})})]})})]})]})}export{ms as default};
