import{r as l,j as e}from"./vendor-react-CCyQGCED.js";import{t as $}from"./trading-Cfau_gAi.js";import{d as q,o as Q,B as x,c as T,e as u,h as i}from"./index-NHrG-O_Z.js";import{C as N,a as w,c as S,b as k,d as X}from"./card-Cn20bp_v.js";import{D as K,a as G,b as J,c as W,d as Z,e as ee,f as se}from"./dialog-DA9GnjaJ.js";import{L as D}from"./label-_1WWiomg.js";import{T as ae,a as te,b as A,c,d as re,e as o}from"./table-Crau903Y.js";import{a1 as ne,Y as le,u as ie,c as M,a3 as U,L as ce}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";function z(d){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2}).format(d)}function oe(d){try{return new Date(d).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return d}}function ve(){const{apiKey:d}=q(),[b,Y]=l.useState([]),[P,F]=l.useState(!0),[B,E]=l.useState(!1),[L,v]=l.useState(null),[t,I]=l.useState({action:[],exchange:[],product:[]}),[V,O]=l.useState(!1),j=l.useMemo(()=>b.filter(s=>!(t.action.length>0&&!t.action.includes(s.action)||t.exchange.length>0&&!t.exchange.includes(s.exchange)||t.product.length>0&&!t.product.includes(s.product))),[b,t]),f=t.action.length>0||t.exchange.length>0||t.product.length>0,_=(s,a)=>{I(h=>{const p=h[s];return p.indexOf(a)>-1?{...h,[s]:p.filter(g=>g!==a)}:{...h,[s]:[...p,a]}})},y=()=>{I({action:[],exchange:[],product:[]})},m=l.useCallback(async(s=!1)=>{if(!d){F(!1);return}s&&E(!0);try{const a=await $.getTrades(d);a.status==="success"&&a.data?(Y(a.data),v(null)):v(a.message||"Failed to fetch trades")}catch{v("Failed to fetch trades")}finally{F(!1),E(!1)}},[d]);l.useEffect(()=>{m();const s=setInterval(()=>m(),1e4);return()=>clearInterval(s)},[m]),l.useEffect(()=>{const s=Q(()=>{m()});return()=>s()},[m]);const H=()=>{const s=["Symbol","Exchange","Product","Action","Qty","Price","Trade Value","Order ID","Time"],a=b.map(n=>[i(n.symbol),i(n.exchange),i(n.product),i(n.action),i(n.quantity),i(n.average_price),i(n.trade_value),i(n.orderid),i(n.timestamp)]),h=[s,...a].map(n=>n.join(",")).join(`
`),p=new Blob([h],{type:"text/csv"}),R=URL.createObjectURL(p),g=document.createElement("a");g.href=R,g.download=`tradebook_${new Date().toISOString().split("T")[0]}.csv`,g.click()},C={total:j.length,buyTrades:j.filter(s=>s.action==="BUY").length,sellTrades:j.filter(s=>s.action==="SELL").length},r=({type:s,value:a,label:h})=>e.jsx(x,{variant:t[s].includes(a)?"default":"outline",size:"sm",className:T("rounded-full",t[s].includes(a)&&"bg-pink-500 hover:bg-pink-600"),onClick:()=>_(s,a),children:h});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trade Book"}),e.jsx("p",{className:"text-muted-foreground",children:"View your executed trades"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(K,{open:V,onOpenChange:O,children:[e.jsx(G,{asChild:!0,children:e.jsxs(x,{variant:f?"default":"outline",size:"sm",className:"relative",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Filters",f&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]})}),e.jsxs(J,{className:"max-w-md",children:[e.jsxs(W,{children:[e.jsx(Z,{children:"Trade Filters"}),e.jsx(ee,{children:"Filter trades by action, exchange, or product"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Action"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"action",value:"BUY",label:"Buy"}),e.jsx(r,{type:"action",value:"SELL",label:"Sell"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Exchange"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"exchange",value:"NSE",label:"NSE"}),e.jsx(r,{type:"exchange",value:"BSE",label:"BSE"}),e.jsx(r,{type:"exchange",value:"NFO",label:"NFO"}),e.jsx(r,{type:"exchange",value:"BFO",label:"BFO"}),e.jsx(r,{type:"exchange",value:"MCX",label:"MCX"}),e.jsx(r,{type:"exchange",value:"CDS",label:"CDS"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Product"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"product",value:"CNC",label:"CNC"}),e.jsx(r,{type:"product",value:"MIS",label:"MIS"}),e.jsx(r,{type:"product",value:"NRML",label:"NRML"})]})]})]}),e.jsxs(se,{children:[e.jsx(x,{variant:"ghost",onClick:y,children:"Clear All"}),e.jsx(x,{onClick:()=>O(!1),children:"Done"})]})]})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>m(!0),disabled:B,children:[e.jsx(le,{className:T("h-4 w-4 mr-2",B&&"animate-spin")}),"Refresh"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:H,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),f&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Filters:"}),t.action.map(s=>e.jsx(u,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),t.exchange.map(s=>e.jsx(u,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),t.product.map(s=>e.jsx(u,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),e.jsx(x,{variant:"outline",size:"sm",className:"text-red-500 border-red-500/50 hover:bg-red-500/10",onClick:y,children:"Clear All"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(S,{children:"Total Trades"}),e.jsx(k,{className:"text-2xl",children:C.total})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(S,{children:"Buy Trades"}),e.jsxs(k,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),C.buyTrades]})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(S,{children:"Sell Trades"}),e.jsxs(k,{className:"text-2xl text-red-600 flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),C.sellTrades]})]})})]}),e.jsx(N,{children:e.jsx(X,{className:"p-0",children:P?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ce,{className:"h-8 w-8 animate-spin"})}):L?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:L}):j.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:f?e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:"No trades match your filters"}),e.jsx(x,{variant:"ghost",size:"sm",onClick:y,children:"Clear Filters"})]}):"No trades today"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(A,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Action"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"Price"}),e.jsx(c,{className:"text-right",children:"Trade Value"}),e.jsx(c,{children:"Order ID"}),e.jsx(c,{children:"Time"})]})}),e.jsx(re,{children:j.map((s,a)=>e.jsxs(A,{children:[e.jsx(o,{className:"font-medium",children:s.symbol}),e.jsx(o,{children:e.jsx(u,{variant:"outline",children:s.exchange})}),e.jsx(o,{children:e.jsx(u,{variant:"secondary",children:s.product})}),e.jsx(o,{children:e.jsxs(u,{variant:s.action==="BUY"?"default":"destructive",className:T("gap-1",s.action==="BUY"?"bg-green-500":""),children:[s.action==="BUY"?e.jsx(M,{className:"h-3 w-3"}):e.jsx(U,{className:"h-3 w-3"}),s.action]})}),e.jsx(o,{className:"text-right font-mono",children:s.quantity}),e.jsx(o,{className:"text-right font-mono",children:z(s.average_price)}),e.jsx(o,{className:"text-right font-mono",children:z(s.trade_value)}),e.jsx(o,{className:"font-mono text-xs",children:s.orderid}),e.jsx(o,{className:"text-sm text-muted-foreground",children:oe(s.timestamp)})]},`${s.orderid}-${a}`))})]})})})})]})}export{ve as default};
