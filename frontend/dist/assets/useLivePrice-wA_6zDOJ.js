import{r as p}from"./vendor-react-Df-MYEHc.js";import{t as F}from"./trading-Dx4HyVuF.js";import{u as V}from"./useMarketData-DisiozsI.js";import{u as T}from"./useMarketStatus-B-LZSON4.js";import{d as U,g as W}from"./index-Bd6js41n.js";function Y(e,y={}){const{enabled:n=!0,staleThreshold:o=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:i=3e4,pauseWhenHidden:r=!0}=y,{apiKey:d}=U(),{isMarketOpen:g,isAnyMarketOpen:P}=T(),{isVisible:M,wasHidden:m,timeSinceHidden:q}=W(),Q=P(),[k,C]=p.useState(new Map),w=p.useRef(Date.now()),H=p.useMemo(()=>e.map(t=>({symbol:t.symbol,exchange:t.exchange})),[e]),{data:S,isConnected:L,isPaused:O,isFallbackMode:I}=V({symbols:H,mode:"LTP",enabled:n&&e.length>0}),R=L&&Q&&!O,f=p.useCallback(async()=>{if(!(!d||e.length===0||!s))try{const t=e.map(a=>({symbol:a.symbol,exchange:a.exchange})),h=await F.getMultiQuotes(d,t);if(h.status==="success"&&h.results){const a=new Map;h.results.forEach(l=>{const c=`${l.exchange}:${l.symbol}`;l.data&&a.set(c,l.data)}),C(a)}}catch{}},[d,e,s]);return p.useEffect(()=>{if(!n||e.length===0||!s||r&&!M)return;f(),w.current=Date.now();const t=setInterval(()=>{f(),w.current=Date.now()},i);return()=>clearInterval(t)},[n,e.length,s,f,i,r,M]),p.useEffect(()=>{!m||!M||!s||!n||q>i&&(f(),w.current=Date.now())},[m,M,q,i,s,n,f]),{data:p.useMemo(()=>e.map(t=>{const h=`${t.exchange}:${t.symbol}`,a=S.get(h),l=k.get(h),c=t.quantity||0,b=t.average_price||0,_=g(t.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<o,$=!_&&l?.ltp;let u,v="rest";if(_&&a?.data?.ltp?(u=a.data.ltp,v="websocket"):$&&l?.ltp?(u=l.ltp,v="multiquotes"):(u=t.ltp,v="rest"),c===0)return{...t,_dataSource:"rest"};let D=t.pnl||0,E=t.pnlpercent||0;const z=t.today_realized_pnl||0;if(u&&b>0){let x;c>0?x=(u-b)*c:x=(b-u)*Math.abs(c),D=z+x;const A=Math.abs(b*c);E=A>0?D/A*100:0}return{...t,ltp:u,pnl:D,pnlpercent:E,_dataSource:v}}),[e,S,k,g,o]),isLive:R,isConnected:L,isPaused:O,isFallbackMode:I,isAnyMarketOpen:Q,multiQuotes:k,refreshMultiQuotes:f}}function Z(e,y){if(!y)return null;let n=0,o=0,s=0;e.forEach(r=>{n+=r.pnl||0;const d=r.average_price||0,g=r.quantity||0,P=r.ltp||d;o+=d*g,s+=P*g});const i=o>0?n/o*100:0;return{...y,totalholdingvalue:s,totalinvvalue:o,totalprofitandloss:n,totalpnlpercentage:i}}export{Z as c,Y as u};
