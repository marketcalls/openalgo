import{r as u,j as e}from"./vendor-react--vsXx8_n.js";import{v as ke,D as Me,i as Fe,B as M,j as Be,y as ge,z as De,A as pe,m as ve,C as _e,c as S,e as Ve,d as Ue,s as ee}from"./index-BnnWjtym.js";import{u as Je,a as Re}from"./useMarketData-BkCpnkL6.js";import{g as Ze,$ as et,ac as tt,aR as st,aS as at,R as Ee,c as rt,az as nt,aB as lt}from"./vendor-icons-C0P7QAK9.js";import{D as qe,a as it,b as Ae,c as ze,d as Ye,e as ot,f as $e,g as ct}from"./dialog-BekiegV3.js";import{S as Le}from"./scroll-area-CTroPhR6.js";import{I as je}from"./input-DXYG3qTB.js";import{L as se}from"./label-Dopa5yPV.js";import{S as ie,a as oe,b as ce,c as de,d as ue}from"./select-BVz02pAe.js";import{t as Oe}from"./trading-oHnXHhHw.js";import{C as dt,b as ut,a as xt}from"./collapsible-BJ9rSfA8.js";import{C as ae,d as re}from"./card-D1pafqWx.js";import{T as mt,a as pt,b as Ce,c as ne,d as ht,e as ye}from"./table-CJHQXcic.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DkDlinVE.js";function ft(s,t,n,a,o,c={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:l,refreshInterval:h=3e4,pauseWhenHidden:v=!0}=c,{isVisible:b}=Je(),[d,r]=u.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),x=u.useRef(null),j=u.useRef(null),f=l&&(!v||b),O=u.useCallback(async()=>{if(!(!s||!t||!n||!a)&&!j.current){r(_=>({..._,isLoading:!0}));try{const _=new AbortController;j.current=_;const w=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:n,expiry_date:a,strike_count:o}),signal:_.signal});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const m=await w.json();m.status==="success"?r(y=>({...y,data:m,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):r(y=>({...y,isLoading:!1,error:m.message||"Failed to fetch option chain"}))}catch(_){_ instanceof Error&&(_.name==="AbortError"?j.current===null&&r(w=>({...w,isLoading:!1})):r(w=>({...w,isLoading:!1,error:_.message||"Connection error",isConnected:!1})))}finally{j.current=null}}},[s,t,n,a,o]);u.useEffect(()=>{if(!f){x.current&&(clearInterval(x.current),x.current=null),r(_=>({..._,isPaused:!!l}));return}return r(_=>({..._,isConnected:!0,isPaused:!1})),O(),x.current=setInterval(O,h),()=>{x.current&&(clearInterval(x.current),x.current=null),j.current&&(j.current.abort(),j.current=null)}},[f,O,h,l]);const I=u.useCallback(()=>{O()},[O]);return{...d,refetch:I}}function gt(s,t,n,a,o,c,l={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:h,oiRefreshInterval:v=3e4,pauseWhenHidden:b=!0}=l,[d,r]=u.useState(null),[x,j]=u.useState(null),{data:f,isLoading:O,isConnected:I,isPaused:_,error:w,lastUpdate:m,refetch:y}=ft(s,t,n,o,c,{enabled:h,refreshInterval:v,pauseWhenHidden:b}),E=u.useMemo(()=>{const F=[],V=a==="BFO"?"BSE_INDEX":"NSE_INDEX";if(F.push({symbol:t,exchange:V}),f?.chain)for(const R of f.chain)R.ce?.symbol&&F.push({symbol:R.ce.symbol,exchange:a}),R.pe?.symbol&&F.push({symbol:R.pe.symbol,exchange:a});return F},[f?.chain,a,t]),{data:L,isConnected:P,isAuthenticated:T,isPaused:g}=Re({symbols:E,mode:"Depth",enabled:h&&E.length>0,pauseWhenHidden:b});u.useEffect(()=>{if(!f){r(null);return}if(L.size===0){r(f);return}const F=f.chain.map(D=>{const Z={...D};if(D.ce?.symbol){const X=`${a}:${D.ce.symbol}`,C=L.get(X);if(C?.data){const H=C.data.depth?.buy?.[0],z=C.data.depth?.sell?.[0];Z.ce={...D.ce,ltp:C.data.ltp??D.ce.ltp,bid:H?.price??C.data.bid_price??D.ce.bid,ask:z?.price??C.data.ask_price??D.ce.ask,bid_qty:H?.quantity??C.data.bid_size??D.ce.bid_qty??0,ask_qty:z?.quantity??C.data.ask_size??D.ce.ask_qty??0}}}if(D.pe?.symbol){const X=`${a}:${D.pe.symbol}`,C=L.get(X);if(C?.data){const H=C.data.depth?.buy?.[0],z=C.data.depth?.sell?.[0];Z.pe={...D.pe,ltp:C.data.ltp??D.pe.ltp,bid:H?.price??C.data.bid_price??D.pe.bid,ask:z?.price??C.data.ask_price??D.pe.ask,bid_qty:H?.quantity??C.data.bid_size??D.pe.bid_qty??0,ask_qty:z?.quantity??C.data.ask_size??D.pe.ask_qty??0}}}return Z});let V=!1;for(const[,D]of L)if(D.lastUpdate&&(!x||D.lastUpdate>x.getTime())){V=!0;break}V&&j(new Date);const k=`${a==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${t}`,A=L.get(k)?.data?.ltp??f.underlying_ltp;r({...f,underlying_ltp:A,chain:F})},[f,L,a,t,x]);const Q=P&&T&&E.length>0,W=_||g,J=u.useMemo(()=>!m&&!x?null:m?x&&x>m?x:m:x,[m,x]);return{data:d,isLoading:O,isConnected:I,isStreaming:Q,isPaused:W,error:w,lastUpdate:J,streamingSymbols:E.length,refetch:y}}const B=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],bt=B.map(s=>s.key),jt=B.filter(s=>s.defaultVisible).map(s=>s.key),$={visibleColumns:jt,columnOrder:bt,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Qe="openalgo_option_chain_prefs";function yt(){if(typeof window>"u")return $;try{const s=localStorage.getItem(Qe);if(!s)return $;const t=JSON.parse(s),n=new Set(B.map(l=>l.key)),a=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(l=>n.has(l)):$.visibleColumns;a.includes("strike")||a.push("strike");const o=Array.isArray(t.columnOrder)?t.columnOrder.filter(l=>n.has(l)):$.columnOrder,c=new Set(o);return $.columnOrder.forEach(l=>{c.has(l)||o.push(l)}),{visibleColumns:a,columnOrder:o,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:$.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:$.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:$.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:$.barStyle}}catch{return $}}function Nt(s){if(!(typeof window>"u"))try{localStorage.setItem(Qe,JSON.stringify(s))}catch{}}function vt(){const[s,t]=u.useState(()=>yt());u.useEffect(()=>{Nt(s)},[s]);const n=u.useCallback(r=>{r!=="strike"&&t(x=>{const f=x.visibleColumns.includes(r)?x.visibleColumns.filter(O=>O!==r):[...x.visibleColumns,r];return{...x,visibleColumns:f}})},[]),a=u.useCallback(r=>{t(x=>({...x,columnOrder:r}))},[]),o=u.useCallback(r=>{t(x=>({...x,strikeCount:r}))},[]),c=u.useCallback(r=>{t(x=>({...x,selectedUnderlying:r}))},[]),l=u.useCallback(r=>{t(x=>({...x,barDataSource:r}))},[]),h=u.useCallback(r=>{t(x=>({...x,barStyle:r}))},[]),v=u.useCallback(()=>{t($)},[]),b=u.useCallback(r=>s.visibleColumns.includes(r),[s.visibleColumns]),d=u.useCallback(()=>s.columnOrder.filter(r=>s.visibleColumns.includes(r)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:n,reorderColumns:a,setStrikeCount:o,setSelectedUnderlying:c,setBarDataSource:l,setBarStyle:h,resetToDefaults:v,isColumnVisible:b,getOrderedVisibleColumns:d}}const Ct={getOptionChain:async(s,t,n,a,o)=>(await ke.post("/optionchain",{apikey:s,underlying:t,exchange:n,expiry_date:a,strike_count:o??20})).data,getExpiries:async(s,t,n,a="options")=>(await ke.post("/expiry",{apikey:s,symbol:t,exchange:n,instrumenttype:a})).data};function St({barDataSource:s,barStyle:t,onBarDataSourceChange:n,onBarStyleChange:a}){return e.jsxs(Me,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(M,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Be,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"Bar Data"}),e.jsxs(De,{value:s,onValueChange:o=>n(o),children:[e.jsx(pe,{value:"oi",children:"Open Interest"}),e.jsx(pe,{value:"volume",children:"Volume"})]}),e.jsx(ve,{}),e.jsx(ge,{children:"Bar Style"}),e.jsxs(De,{value:t,onValueChange:o=>a(o),children:[e.jsx(pe,{value:"gradient",children:"Gradient"}),e.jsx(pe,{value:"solid",children:"Solid"})]})]})]})}function wt({visibleColumns:s,onToggleColumn:t,onResetToDefaults:n}){const a=B.filter(l=>l.side==="ce"),o=B.filter(l=>l.side==="pe"),c=l=>s.includes(l);return e.jsxs(Me,{children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(M,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Be,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"CALLS Columns"}),a.map(l=>e.jsx(_e,{checked:c(l.key),onCheckedChange:()=>t(l.key),children:l.label},l.key)),e.jsx(ve,{}),e.jsx(ge,{children:"PUTS Columns"}),o.map(l=>e.jsx(_e,{checked:c(l.key),onCheckedChange:()=>t(l.key),children:l.label},l.key)),e.jsx(ve,{}),e.jsxs(M,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:n,children:[e.jsx(tt,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Te({columnKey:s,label:t,side:n,isVisible:a,isDragging:o,onDragStart:c,onDragOver:l,onDrop:h,onDragEnd:v}){return e.jsxs("div",{draggable:!0,onDragStart:b=>c(b,s),onDragOver:l,onDrop:b=>h(b,s),onDragEnd:v,className:S("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",o&&"opacity-50 border-dashed",a?"bg-card":"bg-muted/50 opacity-60",n==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(at,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:S("text-xs px-1.5 py-0.5 rounded",n==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:n==="ce"?"CE":"PE"})]})}function kt({columnOrder:s,visibleColumns:t,onReorderColumns:n}){const[a,o]=u.useState(s),[c,l]=u.useState(null),[h,v]=u.useState(!1),b=a.filter(m=>B.find(E=>E.key===m)?.side==="ce"),d=a.filter(m=>B.find(E=>E.key===m)?.side==="pe"),r=m=>B.find(E=>E.key===m)?.label??m,x=m=>B.find(E=>E.key===m)?.side==="pe"?"pe":"ce",j=(m,y)=>{l(y),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain",y)},f=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},O=(m,y)=>{if(m.preventDefault(),!c||c===y)return;const E=x(c),L=x(y);if(E!==L)return;const P=[...a],T=P.indexOf(c),g=P.indexOf(y);P.splice(T,1),P.splice(g,0,c),o(P)},I=()=>{l(null)},_=()=>{n(a),v(!1)},w=m=>{v(m),m&&o(s)};return e.jsxs(qe,{open:h,onOpenChange:w,children:[e.jsx(it,{asChild:!0,children:e.jsxs(M,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(Ae,{className:"sm:max-w-md",children:[e.jsxs(ze,{children:[e.jsx(Ye,{children:"Reorder Columns"}),e.jsx(ot,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Le,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:b.map(m=>e.jsx(Te,{columnKey:m,label:r(m),side:"ce",isVisible:t.includes(m),isDragging:c===m,onDragStart:j,onDragOver:f,onDrop:O,onDragEnd:I},m))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Le,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:d.map(m=>e.jsx(Te,{columnKey:m,label:r(m),side:"pe",isVisible:t.includes(m),isDragging:c===m,onDragStart:j,onDragOver:f,onDrop:O,onDragEnd:I},m))})})]})]}),e.jsxs($e,{className:"gap-2 sm:gap-0",children:[e.jsx(ct,{asChild:!0,children:e.jsx(M,{variant:"outline",children:"Cancel"})}),e.jsx(M,{onClick:_,children:"Save Order"})]})]})]})}function Dt(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function _t({symbol:s,exchange:t,ltp:n,prevClose:a,change:o,changePercent:c,bidPrice:l,askPrice:h,bidSize:v,askSize:b,isLoading:d}){const r=o??(n&&a?n-a:void 0),x=c??(r&&a?r/a*100:void 0),j=r!==void 0&&r>=0;return d?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm font-medium truncate max-w-[200px]",children:s}),e.jsx(Ve,{className:S("text-[10px] px-1.5 py-0",Dt(t)),children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:n!==void 0?n.toFixed(2):"-"}),r!==void 0&&e.jsxs("span",{className:S("text-sm font-medium",j?"text-green-500":"text-red-500"),children:[j?"+":"",r.toFixed(2),x!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",j?"+":"",x.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:l!==void 0&&l>0?l.toFixed(2):"-"}),v!==void 0&&v>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",v.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:h!==void 0&&h>0?h.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",b.toLocaleString()]})]})]})]})}function Pe({price:s,quantity:t,maxQty:n,side:a}){const o=n>0?Math.min(t/n*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:S("absolute top-0 bottom-0 transition-all duration-300",a==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${o}%`}})}),e.jsx("span",{className:S("relative z-10 flex-1 font-mono text-xs",a==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function Et({depth:s,isExpanded:t,onToggle:n,maxLevels:a=5}){const o=s?.buy?.slice(0,a)??[],c=s?.sell?.slice(0,a)??[],l=Math.max(...o.map(d=>d.quantity),1),h=Math.max(...c.map(d=>d.quantity),1),v=Math.max(l,h),b=o.length>0||c.length>0;return e.jsxs(dt,{open:t,onOpenChange:n,children:[e.jsxs(ut,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(xt,{children:b?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:o.length>0?o.map((d,r)=>e.jsx(Pe,{price:d.price,quantity:d.quantity,maxQty:v,side:"buy"},`buy-${r}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:c.length>0?c.map((d,r)=>e.jsx(Pe,{price:d.price,quantity:d.quantity,maxQty:v,side:"sell"},`sell-${r}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:o.reduce((d,r)=>d+r.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:c.reduce((d,r)=>d+r.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}const Lt=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL",label:"SL"},{value:"SL-LIMIT",label:"SL-Limit"}],Ot=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Tt=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function fe(s,t){return t<=0?s:Math.round(s/t)*t}function he(s,t,n){const a=fe(s,t);return n==="up"?Number((a+t).toFixed(2)):Math.max(0,Number((a-t).toFixed(2)))}function Ie(s){return["NFO","BFO","MCX","CDS","BCD"].includes(s)}function Pt({open:s,onOpenChange:t,symbol:n="",exchange:a="",action:o="BUY",quantity:c,lotSize:l=1,tickSize:h=.05,product:v="NRML",priceType:b="MARKET",strategy:d="OptionChain",onSuccess:r,onError:x}){const{apiKey:j}=Ue(),[f,O]=u.useState(o),[I,_]=u.useState(c??l),[w,m]=u.useState(b),[y,E]=u.useState(v),[L,P]=u.useState(0),[T,g]=u.useState(0),[Q,W]=u.useState(!1),[J,F]=u.useState(!1),[V,R]=u.useState("lots"),[k,U]=u.useState(1),[A,D]=u.useState(null),[Z,X]=u.useState(!1),C=Ie(a)?Ot:Tt,H=u.useCallback(async()=>{if(!(!j||!n||!a)){X(!0);try{const N=await Oe.getQuotes(j,n,a);N.status==="success"&&N.data&&D(N.data)}catch{console.debug("REST quotes fetch failed")}finally{X(!1)}}},[j,n,a]);u.useEffect(()=>{if(s){O(o),_(c??l),m(b);const N=Ie(a)?"NRML":"CNC";E(v||N),P(0),g(0),F(!1),R("lots"),U(1),D(null),H()}},[s,o,c,l,b,v,a,H]);const{data:z,isConnected:te}=Re({symbols:n&&a?[{symbol:n,exchange:a}]:[],mode:"Depth",enabled:s&&!!n&&!!a}),i=z.get(`${a}:${n}`)?.data,p={ltp:i?.ltp??A?.ltp,close:i?.close??A?.prev_close,change:i?.change,change_percent:i?.change_percent,bidPrice:i?.depth?.buy?.[0]?.price??i?.bid_price??A?.bid,askPrice:i?.depth?.sell?.[0]?.price??i?.ask_price??A?.ask,bidSize:i?.depth?.buy?.[0]?.quantity??i?.bid_size,askSize:i?.depth?.sell?.[0]?.quantity??i?.ask_size,depth:i?.depth},q=p.change??(p.ltp&&p.close?p.ltp-p.close:void 0),We=p.change_percent??(q&&p.close?q/p.close*100:void 0);u.useEffect(()=>{w!=="MARKET"&&p.ltp&&L===0&&P(fe(p.ltp,h))},[w,p.ltp,L,h]);const xe=w==="LIMIT"||w==="SL"||w==="SL-LIMIT",me=w==="SL"||w==="SL-LIMIT",Se=u.useCallback(()=>!(!n||!a||!j||I<=0||xe&&L<=0||me&&T<=0),[n,a,j,I,xe,L,me,T]),Xe=async()=>{if(!Se()){ee.error("Please fill all required fields");return}if(!j){ee.error("API key not found. Please set up your API key."),x?.("API key not found");return}W(!0);try{const K={apikey:j,strategy:d,exchange:a,symbol:n,action:f,quantity:I,pricetype:w==="SL-LIMIT"?"SL-M":w,product:y,...xe&&{price:L},...me&&{trigger_price:T}},Y=await Oe.placeOrder(K),be=Y.orderid;if(Y.status==="success"&&be)ee.success(`Order placed: ${be}`,"orders"),r?.(be),t(!1);else{const we=Y.message||"Order placement failed";ee.error(we,"orders"),x?.(we)}}catch(N){let K="Order placement failed";if(N&&typeof N=="object"){const Y=N;Y.response?.data?.message?K=Y.response.data.message:Y.message&&(K=Y.message)}ee.error(K,"orders"),x?.(K)}finally{W(!1)}},He=N=>{const K=parseInt(N)||0;if(V==="lots")_(K*l),U(K);else{const Y=Math.max(l,Math.round(K/l)*l);_(Y),U(Y/l)}},Ke=V==="lots"?k:I,Ge=Z&&!p.ltp&&!te;return e.jsx(qe,{open:s,onOpenChange:t,children:e.jsxs(Ae,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(ze,{children:e.jsxs(Ye,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:f==="BUY"?"text-green-500":"text-red-500",children:f}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:n})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(_t,{symbol:n,exchange:a,ltp:p.ltp,prevClose:p.close,change:q,changePercent:We,bidPrice:p.bidPrice,askPrice:p.askPrice,bidSize:p.bidSize,askSize:p.askSize,isLoading:Ge}),e.jsx(Et,{depth:p.depth,isExpanded:J,onToggle:()=>F(!J),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"button",variant:f==="BUY"?"default":"outline",className:S("flex-1",f==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>O("BUY"),children:"BUY"}),e.jsx(M,{type:"button",variant:f==="SELL"?"default":"outline",className:S("flex-1",f==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>O("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(se,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>R("lots"),className:S("px-2 py-0.5 text-[10px] rounded",V==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>R("shares"),className:S("px-2 py-0.5 text-[10px] rounded",V==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(je,{type:"number",value:Ke,onChange:N=>He(N.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",l]}),e.jsxs("span",{children:["Total qty: ",I]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs",children:"Price Type"}),e.jsxs(ie,{value:w,onValueChange:N=>m(N),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsx(de,{children:Lt.map(N=>e.jsx(ue,{value:N.value,children:N.label},N.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs",children:"Product"}),e.jsxs(ie,{value:y,onValueChange:N=>E(N),children:[e.jsx(oe,{children:e.jsx(ce,{})}),e.jsx(de,{children:C.map(N=>e.jsx(ue,{value:N.value,children:N.label},N.value))})]})]})]}),xe&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(he(L,h,"down")),children:"-"}),e.jsx(je,{type:"number",value:L,onChange:N=>P(parseFloat(N.target.value)||0),onBlur:()=>P(fe(L,h)),className:"flex-1 text-center",step:h,min:0}),e.jsx(M,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(he(L,h,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",h]})]}),me&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(se,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>g(he(T,h,"down")),children:"-"}),e.jsx(je,{type:"number",value:T,onChange:N=>g(parseFloat(N.target.value)||0),onBlur:()=>g(fe(T,h)),className:"flex-1 text-center",step:h,min:0}),e.jsx(M,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>g(he(T,h,"up")),children:"+"})]})]})]}),e.jsxs($e,{className:"gap-2 sm:gap-0",children:[e.jsx(M,{variant:"outline",onClick:()=>t(!1),disabled:Q,children:"Cancel"}),e.jsx(M,{onClick:Xe,disabled:!Se()||Q,className:S(f==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:Q?"Placing...":`Place ${f} Order`})]})]})})}const Ne=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],It=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function le(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const n=s/1e3;return n>=1?n.toFixed(1)+"K":s.toLocaleString()}}function G(s){return s==null?"0.00":s.toFixed(2)}function Mt(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function Ft(s){let t=0,n=0;return s.forEach(a=>{a.ce?.oi&&(t+=a.ce.oi),a.pe?.oi&&(n+=a.pe?.oi??0)}),t===0?0:n/t}function Bt(s){let t=0,n=0,a=0,o=0;return s.forEach(c=>{c.ce&&(t+=c.ce.volume??0,a+=c.ce.oi??0),c.pe&&(n+=c.pe.volume??0,o+=c.pe.oi??0)}),{ceVolume:t,peVolume:n,ceOi:a,peOi:o}}function Vt(s,t){let n=0;return s.forEach(a=>{const o=t==="oi"?a.ce?.oi:a.ce?.volume,c=t==="oi"?a.pe?.oi:a.pe?.volume;o&&o>n&&(n=o),c&&c>n&&(n=c)}),n||1}function Ut({strike:s,previousData:t,maxBarValue:n,visibleCeColumns:a,visiblePeColumns:o,barDataSource:c,barStyle:l,optionExchange:h,onPlaceOrder:v}){const b=t.get(s.strike),d=s.ce,r=s.pe,x=d?.label??r?.label??"",j=x==="ATM",f=x.startsWith("OTM"),O=x.startsWith("ITM"),I=b?.ce?.ltp!==d?.ltp,_=b?.pe?.ltp!==r?.ltp,w=I?d&&b?.ce&&d.ltp>b.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",m=_?r&&b?.pe&&r.ltp>b.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",y=d&&d.bid>0&&d.ask>0?d.ask-d.bid:0,E=r&&r.bid>0&&r.ask>0?r.ask-r.bid:0,L=y<=1?"text-green-500":y<=2?"text-yellow-500":"text-red-500",P=E<=1?"text-green-500":E<=2?"text-yellow-500":"text-red-500",T=c==="oi"?d?.oi:d?.volume,g=c==="oi"?r?.oi:r?.volume,Q=T?Math.min(T/n*100,100):0,W=g?Math.min(g/n*100,100):0,J=l==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",F=l==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",V=k=>{switch(k){case"ce_oi":return e.jsx("span",{className:"font-mono text-xs",children:le(d?.oi)});case"ce_volume":return e.jsx("span",{className:"font-mono text-xs",children:le(d?.volume)});case"ce_bid_qty":return e.jsx("span",{className:"text-xs",children:d?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:"text-red-500 text-xs",children:G(d?.bid)});case"ce_ltp":return e.jsx("span",{className:S("font-semibold text-xs",w),children:G(d?.ltp)});case"ce_ask":return e.jsx("span",{className:"text-green-500 text-xs",children:G(d?.ask)});case"ce_ask_qty":return e.jsx("span",{className:"text-xs",children:d?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:S("text-xs",L),children:G(y)});default:return null}},R=k=>{switch(k){case"pe_oi":return e.jsx("span",{className:"font-mono text-xs",children:le(r?.oi)});case"pe_volume":return e.jsx("span",{className:"font-mono text-xs",children:le(r?.volume)});case"pe_bid_qty":return e.jsx("span",{className:"text-xs",children:r?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:"text-red-500 text-xs",children:G(r?.bid)});case"pe_ltp":return e.jsx("span",{className:S("font-semibold text-xs",m),children:G(r?.ltp)});case"pe_ask":return e.jsx("span",{className:"text-green-500 text-xs",children:G(r?.ask)});case"pe_ask_qty":return e.jsx("span",{className:"text-xs",children:r?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:S("text-xs",P),children:G(E)});default:return null}};return e.jsxs(Ce,{className:S("hover:bg-muted/50 relative group"),"data-strike":s.strike,"data-label":x,children:[a.length>0&&e.jsxs(ye,{className:S("p-0 relative",f&&!j&&"bg-amber-500/5"),children:[e.jsx("div",{className:S("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",J),style:{width:`${Q}%`}}),d&&e.jsxs("div",{className:S("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:k=>{k.stopPropagation(),v({symbol:d.symbol,exchange:h,action:"BUY",lotSize:d.lotsize??1,tickSize:d.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),v({symbol:d.symbol,exchange:h,action:"SELL",lotSize:d.lotsize??1,tickSize:d.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:a.map(k=>{const U=B.find(A=>A.key===k);return e.jsx("div",{className:S("flex-1 px-2 py-1.5 min-w-0",U?.align==="right"&&"text-right",U?.align==="center"&&"text-center",U?.align==="left"&&"text-left"),children:V(k)},k)})})]}),e.jsx(ye,{className:S("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",j?"bg-primary/15":"bg-muted/30"),children:s.strike}),o.length>0&&e.jsxs(ye,{className:S("p-0 relative",O&&!j&&"bg-amber-500/5"),children:[e.jsx("div",{className:S("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",F),style:{width:`${W}%`}}),r&&e.jsxs("div",{className:S("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:k=>{k.stopPropagation(),v({symbol:r.symbol,exchange:h,action:"BUY",lotSize:r.lotsize??1,tickSize:r.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:k=>{k.stopPropagation(),v({symbol:r.symbol,exchange:h,action:"SELL",lotSize:r.lotsize??1,tickSize:r.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:o.map(k=>{const U=B.find(A=>A.key===k);return e.jsx("div",{className:S("flex-1 px-2 py-1.5 min-w-0",U?.align==="right"&&"text-right",U?.align==="center"&&"text-center",U?.align==="left"&&"text-left"),children:R(k)},k)})})]})]})}function ss(){const{apiKey:s}=Ue(),{visibleColumns:t,columnOrder:n,strikeCount:a,selectedUnderlying:o,barDataSource:c,barStyle:l,toggleColumn:h,reorderColumns:v,setStrikeCount:b,setSelectedUnderlying:d,setBarDataSource:r,setBarStyle:x,resetToDefaults:j}=vt(),[f,O]=u.useState(""),[I,_]=u.useState([]),[w,m]=u.useState(new Map),[y,E]=u.useState(null),L=Ne.find(i=>i.value===o),P=L?.brokerExchange??"NSE_INDEX",T=L?.exchange??"NFO",{data:g,isConnected:Q,isStreaming:W,isPaused:J,error:F,lastUpdate:V,refetch:R,isLoading:k,streamingSymbols:U}=gt(s,o,P,T,Mt(f),a,{enabled:!!f,oiRefreshInterval:3e4,pauseWhenHidden:!0});u.useEffect(()=>{(async()=>{if(!(!s||!o))try{const p=await Ct.getExpiries(s,o,T);p.status==="success"&&p.data.length>0?(_(p.data),f||O(p.data[0])):ee.error(p.message||"Failed to load expiries","orders")}catch(p){console.error("Error loading expiries:",p),ee.error("Failed to load expiry dates","orders")}})()},[s,o,T,f]),u.useEffect(()=>{if(g?.chain){const i=new Map;g.chain.forEach(p=>{i.set(p.strike,p)}),m(i)}},[g?.chain]);const A=i=>{Ne.find(q=>q.value===i)&&(d(i),O(""),_([]))},D=()=>{R()},Z=u.useCallback(i=>{E({open:!0,symbol:i.symbol,exchange:i.exchange,action:i.action,quantity:i.lotSize,lotSize:i.lotSize,tickSize:i.tickSize})},[]),X=u.useMemo(()=>g?.chain?Ft(g.chain):0,[g?.chain]),C=u.useMemo(()=>g?.chain?Bt(g.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[g?.chain]),H=u.useMemo(()=>g?.chain?Vt(g.chain,c):1,[g?.chain,c]),z=u.useMemo(()=>n.filter(i=>B.find(q=>q.key===i)?.side==="ce"&&t.includes(i)),[n,t]),te=u.useMemo(()=>n.filter(i=>B.find(q=>q.key===i)?.side==="pe"&&t.includes(i)),[n,t]);return F?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(ae,{className:"max-w-md",children:e.jsx(re,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:F}),e.jsxs(M,{onClick:D,className:"mt-4",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rt,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(ie,{value:o,onValueChange:A,children:[e.jsx(oe,{className:"w-36",children:e.jsx(ce,{placeholder:"Select Underlying"})}),e.jsx(de,{children:Ne.map(i=>e.jsx(ue,{value:i.value,children:i.label},i.value))})]}),e.jsxs(ie,{value:f,onValueChange:O,disabled:I.length===0,children:[e.jsx(oe,{className:"w-36",children:e.jsx(ce,{placeholder:"Select Expiry"})}),e.jsx(de,{children:I.map(i=>e.jsx(ue,{value:i,children:i},i))})]}),e.jsxs(ie,{value:String(a),onValueChange:i=>b(Number(i)),children:[e.jsx(oe,{className:"w-36",children:e.jsx(ce,{placeholder:"Strike Count"})}),e.jsx(de,{children:It.map(i=>e.jsx(ue,{value:String(i.value),children:i.label},i.value))})]}),e.jsx(St,{barDataSource:c,barStyle:l,onBarDataSourceChange:r,onBarStyleChange:x}),e.jsx(wt,{visibleColumns:t,onToggleColumn:h,onResetToDefaults:j}),e.jsx(kt,{columnOrder:n,visibleColumns:t,onReorderColumns:v}),e.jsxs(M,{onClick:D,disabled:!f||k,children:[e.jsx(Ee,{className:`h-4 w-4 mr-2 ${k?"animate-spin":""}`}),"Refresh"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[o," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:G(g.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",G(g.underlying_prev_close)]})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:g.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",g.expiry_date]})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${X>1?"text-green-500":"text-yellow-500"}`,children:X.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(ae,{children:e.jsxs(re,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono",children:le(C.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono",children:le(C.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:C.ceOi+C.peOi>0?`${C.ceOi/(C.ceOi+C.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",X.toFixed(2)]})})]})})]}),e.jsx(ae,{children:e.jsx(re,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(mt,{className:"w-full",children:[e.jsxs(pt,{children:[e.jsxs(Ce,{className:"bg-muted/30 border-b-0",children:[z.length>0&&e.jsx(ne,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(ne,{className:"text-center w-20 min-w-20"}),te.length>0&&e.jsx(ne,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Ce,{className:"bg-muted/50",children:[z.length>0&&e.jsx(ne,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:z.map(i=>{const p=B.find(q=>q.key===i);return e.jsx("div",{className:S("flex-1 px-2 py-2 text-xs font-medium min-w-0",p?.align==="right"&&"text-right",p?.align==="center"&&"text-center",p?.align==="left"&&"text-left"),children:p?.label},i)})})}),e.jsx(ne,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),te.length>0&&e.jsx(ne,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:te.map(i=>{const p=B.find(q=>q.key===i);return e.jsx("div",{className:S("flex-1 px-2 py-2 text-xs font-medium min-w-0",p?.align==="right"&&"text-right",p?.align==="center"&&"text-center",p?.align==="left"&&"text-left"),children:p?.label},i)})})})]})]}),e.jsx(ht,{children:g.chain.map(i=>e.jsx(Ut,{strike:i,previousData:w,maxBarValue:H,visibleCeColumns:z,visiblePeColumns:te,barDataSource:c,barStyle:l,optionExchange:T,onPlaceOrder:Z},i.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[W?e.jsx(nt,{className:"h-4 w-4 text-green-500"}):e.jsx(lt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Ve,{variant:W?"default":Q?"secondary":"destructive",children:J?"Paused":W?`Streaming ${U} symbols`:Q?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",c==="oi"?"OI":"Volume"," (",l,")"]})]}),e.jsxs("div",{children:["Last Update: ",V?V.toLocaleTimeString():"-"]})]})]}),!g&&!F&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Pt,{open:y?.open??!1,onOpenChange:i=>{i||E(null)},symbol:y?.symbol,exchange:y?.exchange,action:y?.action,quantity:y?.quantity,lotSize:y?.lotSize,tickSize:y?.tickSize,strategy:"OptionChain"})]})}export{ss as default};
