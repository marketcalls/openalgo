import{r as a,j as e}from"./vendor-react-RhKMXzW9.js";import{d as fe,o as Ne,B as c,c as M,e as g,t as h,s as x}from"./index-Dozf8b_9.js";import{t as C}from"./trading-BGB1eh2H.js";import{A as ve,a as ye,b as be,c as Ce,d as we,e as Oe,f as Se,g as Te,h as De}from"./alert-dialog-D6MHaJTO.js";import{C as N,b as w,d as O,c as S,a as ke}from"./card-BO8Izvrs.js";import{D as Y,a as Fe,b as X,c as W,d as G,e as J,f as Z}from"./dialog-D2KVU1lZ.js";import{I as ee}from"./input-CRqgr8Cf.js";import{L as E}from"./label-BQBbLspy.js";import{T as Ae,a as _e,b as se,c as n,d as Ie,e as d}from"./table-D1gGYIfi.js";import{W as Le,R as Me,p as Ee,X as te,L as re,P as Be,a0 as ae,C as Re,a1 as Pe}from"./vendor-icons-Ca5eNZvr.js";import"./vendor-syntax-DzupMptF.js";import"./vendor-router-DdyOoyPF.js";import"./vendor-radix-gKv__6YA.js";function j(m){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2}).format(m)}function qe(m){try{return new Date(m).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return m}}const ie={complete:{icon:Re,color:"text-green-500",label:"complete"},rejected:{icon:ae,color:"text-red-500",label:"rejected"},cancelled:{icon:ae,color:"text-gray-500",label:"cancelled"},open:{icon:Be,color:"text-blue-500",label:"open"}};function es(){const{apiKey:m}=fe(),[v,le]=a.useState([]),[y,ce]=a.useState(null),[ne,B]=a.useState(!0),[R,P]=a.useState(!1),[q,A]=a.useState(null),[f,z]=a.useState([]),[de,Q]=a.useState(!1),[oe,T]=a.useState(!1),[i,xe]=a.useState(null),[u,H]=a.useState(null),[U,$]=a.useState(!1),[r,_]=a.useState({quantity:0,price:0,trigger_price:0,pricetype:"MARKET",product:"MIS"}),K=a.useMemo(()=>f.length===0?v:v.filter(s=>f.includes(s.order_status)),[v,f]),D=f.length>0,me=s=>{z(t=>t.includes(s)?t.filter(o=>o!==s):[...t,s])},I=()=>{z([])},p=a.useCallback(async(s=!1)=>{if(!m){B(!1);return}s&&P(!0);try{const t=await C.getOrders(m);t.status==="success"&&t.data?(le(t.data.orders||[]),ce(t.data.statistics),A(null)):A(t.message||"Failed to fetch orders")}catch{A("Failed to fetch orders")}finally{B(!1),P(!1)}},[m]);a.useEffect(()=>{p();const s=setInterval(()=>p(),1e4);return()=>clearInterval(s)},[p]),a.useEffect(()=>{const s=Ne(()=>{p()});return()=>s()},[p]);const he=async s=>{try{const t=await C.cancelOrder(s);t.status==="success"?(h.success(`Order cancelled: ${s}`),setTimeout(()=>p(!0),1e3)):h.error(t.message||"Failed to cancel order")}catch(t){const b=t.response?.data?.message||"Failed to cancel order";h.error(b)}},ue=async()=>{try{const s=await C.cancelAllOrders();s.status==="success"?(h.success(s.message||"All orders cancelled"),setTimeout(()=>p(!0),2e3)):s.status==="info"?h.info(s.message||"No open orders to cancel"):h.error(s.message||"Failed to cancel all orders")}catch(s){const o=s.response?.data?.message||"Failed to cancel all orders";h.error(o)}},pe=async s=>{if(xe(s),_({quantity:s.quantity,price:s.price,trigger_price:s.trigger_price,pricetype:s.pricetype,product:s.product}),H(null),T(!0),m){$(!0);try{const t=await C.getQuotes(m,s.symbol,s.exchange);t.status==="success"&&t.data&&H(t.data)}catch{}finally{$(!1)}}},je=async()=>{if(i)try{const s=await C.modifyOrder(i.orderid,{symbol:i.symbol,exchange:i.exchange,action:i.action,product:i.product,pricetype:r.pricetype,price:r.price,quantity:r.quantity,trigger_price:r.trigger_price});s.status==="success"?(h.success(`Order modified: ${i.orderid}`),T(!1),setTimeout(()=>p(!0),1e3)):h.error(s.message||"Failed to modify order")}catch(s){const o=s.response?.data?.message||"Failed to modify order";h.error(o)}},ge=()=>{const s=["Symbol","Exchange","Action","Qty","Price","Trigger","Type","Product","Order ID","Status","Time"],t=v.map(l=>[x(l.symbol),x(l.exchange),x(l.action),x(l.quantity),x(l.price),x(l.trigger_price),x(l.pricetype),x(l.product),x(l.orderid),x(l.order_status),x(l.timestamp)]),o=[s,...t].map(l=>l.join(",")).join(`
`),b=new Blob([o],{type:"text/csv"}),F=URL.createObjectURL(b),L=document.createElement("a");L.href=F,L.download=`orderbook_${new Date().toISOString().split("T")[0]}.csv`,L.click()},V=v.filter(s=>s.order_status==="open"),k=({status:s,label:t})=>e.jsx(c,{variant:f.includes(s)?"default":"outline",size:"sm",className:M("rounded-full",f.includes(s)&&"bg-pink-500 hover:bg-pink-600"),onClick:()=>me(s),children:t});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Order Book"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your orders"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(Y,{open:de,onOpenChange:Q,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(c,{variant:D?"default":"outline",size:"sm",className:"relative",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Filters",D&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]})}),e.jsxs(X,{className:"max-w-md",children:[e.jsxs(W,{children:[e.jsx(G,{children:"Order Filters"}),e.jsx(J,{children:"Filter orders by status"})]}),e.jsx("div",{className:"space-y-6 py-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(E,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Order Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(k,{status:"complete",label:"Complete"}),e.jsx(k,{status:"open",label:"Open"}),e.jsx(k,{status:"rejected",label:"Rejected"}),e.jsx(k,{status:"cancelled",label:"Cancelled"})]})]})}),e.jsxs(Z,{children:[e.jsx(c,{variant:"ghost",onClick:I,children:"Clear All"}),e.jsx(c,{onClick:()=>Q(!1),children:"Done"})]})]})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>p(!0),disabled:R,children:[e.jsx(Me,{className:M("h-4 w-4 mr-2",R&&"animate-spin")}),"Refresh"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:ge,children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(ve,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(c,{variant:"destructive",size:"sm",disabled:V.length===0,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Cancel All"]})}),e.jsxs(be,{children:[e.jsxs(Ce,{children:[e.jsx(we,{children:"Cancel All Orders?"}),e.jsxs(Oe,{children:["This will cancel all ",V.length," open orders. This action cannot be undone."]})]}),e.jsxs(Se,{children:[e.jsx(Te,{children:"Keep Orders"}),e.jsx(De,{onClick:ue,children:"Cancel All"})]})]})]})]})]}),D&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Filters:"}),f.map(s=>e.jsx(g,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),e.jsx(c,{variant:"outline",size:"sm",className:"text-red-500 border-red-500/50 hover:bg-red-500/10",onClick:I,children:"Clear All"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Buy Orders"}),e.jsx(S,{className:"text-2xl text-green-600",children:y?.total_buy_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Sell Orders"}),e.jsx(S,{className:"text-2xl text-red-600",children:y?.total_sell_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Completed"}),e.jsx(S,{className:"text-2xl",children:y?.total_completed_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Open"}),e.jsx(S,{className:"text-2xl text-blue-600",children:y?.total_open_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Rejected"}),e.jsx(S,{className:"text-2xl text-red-600",children:y?.total_rejected_orders??0})]})})]}),e.jsx(N,{children:e.jsx(ke,{className:"p-0",children:ne?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):q?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:q}):K.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:D?e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:"No orders match your filters"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:I,children:"Clear Filters"})]}):"No orders today"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ae,{children:[e.jsx(_e,{children:e.jsxs(se,{children:[e.jsx(n,{className:"w-[120px]",children:"Symbol"}),e.jsx(n,{className:"w-[80px]",children:"Exchange"}),e.jsx(n,{className:"w-[70px]",children:"Action"}),e.jsx(n,{className:"w-[70px] text-right",children:"Qty"}),e.jsx(n,{className:"w-[100px] text-right",children:"Price"}),e.jsx(n,{className:"w-[100px] text-right",children:"Trigger"}),e.jsx(n,{className:"w-[80px]",children:"Type"}),e.jsx(n,{className:"w-[70px]",children:"Product"}),e.jsx(n,{className:"w-[140px]",children:"Order ID"}),e.jsx(n,{className:"w-[100px]",children:"Status"}),e.jsx(n,{className:"w-[100px]",children:"Time"}),e.jsx(n,{className:"w-[60px]",children:"Cancel"}),e.jsx(n,{className:"w-[60px]",children:"Modify"})]})}),e.jsx(Ie,{children:K.map((s,t)=>{const o=ie[s.order_status]||ie.open,b=o.icon,F=s.order_status==="open";return e.jsxs(se,{children:[e.jsx(d,{className:"font-medium",children:s.symbol}),e.jsx(d,{children:e.jsx(g,{variant:"outline",children:s.exchange})}),e.jsx(d,{children:e.jsx(g,{variant:s.action==="BUY"?"default":"destructive",className:s.action==="BUY"?"bg-green-500":"",children:s.action})}),e.jsx(d,{className:"text-right font-mono",children:s.quantity}),e.jsx(d,{className:"text-right font-mono",children:j(s.price)}),e.jsx(d,{className:"text-right font-mono",children:j(s.trigger_price)}),e.jsx(d,{children:e.jsx(g,{variant:"secondary",children:s.pricetype})}),e.jsx(d,{children:e.jsx(g,{variant:"outline",children:s.product})}),e.jsx(d,{className:"font-mono text-xs",children:s.orderid}),e.jsx(d,{children:e.jsxs("div",{className:M("flex items-center gap-1",o.color),children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:o.label})]})}),e.jsx(d,{className:"text-sm text-muted-foreground",children:qe(s.timestamp)}),e.jsx(d,{children:F&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>he(s.orderid),children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(d,{children:F&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>pe(s),children:e.jsx(Pe,{className:"h-4 w-4"})})})]},`${s.orderid}-${t}`)})})]})})})}),e.jsx(Y,{open:oe,onOpenChange:T,children:e.jsxs(X,{className:"sm:max-w-[550px]",children:[e.jsxs(W,{children:[e.jsxs(G,{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Modify Order"}),e.jsx(g,{variant:i?.action==="BUY"?"default":"destructive",className:i?.action==="BUY"?"bg-green-500":"",children:i?.action})]}),e.jsx(J,{className:"sr-only",children:"Modify order details"})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:i?.symbol}),e.jsx("div",{className:"text-sm text-muted-foreground",children:i?.exchange})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Order ID"}),e.jsx("div",{className:"font-mono text-sm",children:i?.orderid})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Type:"}),e.jsx(g,{variant:"secondary",className:"text-xs",children:r.pricetype})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Product:"}),e.jsx(g,{variant:"outline",className:"text-xs",children:r.product})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Qty:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:r.quantity})]})]})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Market Data"}),U&&e.jsx(re,{className:"h-4 w-4 animate-spin"})]}),u?e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"LTP"}),e.jsx("div",{className:"font-mono font-semibold",children:j(u.ltp)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Bid"}),e.jsx("div",{className:"font-mono text-green-600",children:j(u.bid)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Ask"}),e.jsx("div",{className:"font-mono text-red-600",children:j(u.ask)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Prev Close"}),e.jsx("div",{className:"font-mono",children:j(u.prev_close)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Open"}),e.jsx("div",{className:"font-mono",children:j(u.open)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"High"}),e.jsx("div",{className:"font-mono text-green-600",children:j(u.high)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Low"}),e.jsx("div",{className:"font-mono text-red-600",children:j(u.low)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Volume"}),e.jsx("div",{className:"font-mono",children:u.volume.toLocaleString("en-IN")})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:U?"Loading quotes...":"Quotes not available"})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[(r.pricetype==="LIMIT"||r.pricetype==="SL")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(E,{htmlFor:"price",className:"text-right",children:"Price"}),e.jsx(ee,{id:"price",type:"number",step:"0.05",value:r.price,onChange:s=>_({...r,price:parseFloat(s.target.value)||0}),className:"col-span-3"})]}),(r.pricetype==="SL"||r.pricetype==="SL-M")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(E,{htmlFor:"trigger_price",className:"text-right",children:"Trigger Price"}),e.jsx(ee,{id:"trigger_price",type:"number",step:"0.05",value:r.trigger_price,onChange:s=>_({...r,trigger_price:parseFloat(s.target.value)||0}),className:"col-span-3"})]}),r.pricetype==="MARKET"&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-2",children:"Market orders cannot be modified. Cancel and place a new order."})]}),e.jsxs(Z,{children:[e.jsx(c,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),e.jsx(c,{onClick:je,children:"Modify Order"})]})]})})]})}export{es as default};
