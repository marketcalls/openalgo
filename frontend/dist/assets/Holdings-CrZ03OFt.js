import{r,j as e}from"./vendor-react-CCyQGCED.js";import{t as K}from"./trading-L0e-hk9o.js";import{A as Y,a as G}from"./alert-Dlgyh2fF.js";import{d as J,g as X,o as Z,e as N,B as k,c as m,h as d}from"./index-D0023jFM.js";import{C as j,a as b,c as v,b as w,d as ee}from"./card-CDguRyHx.js";import{T as se,a as te,b as P,c as x,d as ae,e as n,f as re}from"./table-BKP8E0nV.js";import{u as ne,c as le}from"./useLivePrice-5EMecDCh.js";import{T as ie,$ as ce,a0 as oe,Y as de,u as xe,c as V,a3 as B,L as me}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";import"./useMarketStatus-B5zaupYn.js";function h(i){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(i)}function C(i){return`${i>=0?"+":""}${i.toFixed(2)}%`}function Le(){const{apiKey:i}=J(),[y,M]=r.useState([]),[u,U]=r.useState(null),[_,R]=r.useState(!0),[D,H]=r.useState(!1),[I,T]=r.useState(null),[Q,A]=r.useState(!1),{isVisible:p,wasHidden:E,timeSinceHidden:F}=X(),g=r.useRef(Date.now()),{data:f,isLive:L,isPaused:z}=ne(y,{enabled:y.length>0,useMultiQuotesFallback:!0,staleThreshold:5e3,multiQuotesRefreshInterval:3e4,pauseWhenHidden:!0}),t=r.useMemo(()=>!u||!f.some(a=>a._dataSource!=="rest")?u:le(f,u),[u,f]),c=r.useCallback(async(s=!1)=>{if(!i){R(!1);return}s&&H(!0);try{const a=await K.getHoldings(i);a.status==="success"&&a.data?(M(a.data.holdings||[]),U(a.data.statistics),T(null)):T(a.message||"Failed to fetch holdings")}catch{T("Failed to fetch holdings")}finally{R(!1),H(!1)}},[i]);r.useEffect(()=>{if(!p)return;c(),g.current=Date.now();const a=setInterval(()=>{c(),g.current=Date.now()},L?3e4:1e4);return()=>clearInterval(a)},[c,L,p]),r.useEffect(()=>{if(!E||!p)return;const s=Date.now()-g.current;if(F>3e4||s>3e4){A(!0),c(),g.current=Date.now();const a=setTimeout(()=>A(!1),5e3);return()=>clearTimeout(a)}},[E,p,F,c]),r.useEffect(()=>{const s=Z(()=>{c()});return()=>s()},[c]);const O=()=>{const s=["Symbol","Exchange","Quantity","Avg Price","LTP","Product","P&L","P&L %"],a=f.map(l=>[d(l.symbol),d(l.exchange),d(l.quantity),d(l.average_price),d(l.ltp),d(l.product),d(l.pnl),d(l.pnlpercent)]),W=[s,...a].map(l=>l.join(",")).join(`
`),q=new Blob([W],{type:"text/csv"}),$=URL.createObjectURL(q),S=document.createElement("a");S.href=$,S.download=`holdings_${new Date().toISOString().split("T")[0]}.csv`,S.click(),URL.revokeObjectURL($)},o=s=>s>=0;return e.jsxs("div",{className:"space-y-6",children:[Q&&e.jsxs(Y,{variant:"default",className:"bg-amber-500/10 border-amber-500/30",children:[e.jsx(ie,{className:"h-4 w-4 text-amber-600"}),e.jsx(G,{className:"text-amber-700 dark:text-amber-400",children:"Data is being refreshed after tab was inactive..."})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Investor Summary"}),z?e.jsxs(N,{variant:"outline",className:"bg-amber-500/10 text-amber-600 border-amber-500/30 gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Paused"]}):L?e.jsxs(N,{variant:"outline",className:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30 gap-1",children:[e.jsx(oe,{className:"h-3 w-3 animate-pulse"}),"Live"]}):null]}),e.jsx("p",{className:"text-muted-foreground",children:"View your holdings portfolio"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>c(!0),disabled:D,children:[e.jsx(de,{className:m("h-4 w-4 mr-2",D&&"animate-spin")}),"Refresh"]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:O,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(j,{children:e.jsxs(b,{className:"pb-2",children:[e.jsx(v,{children:"Total Holding Value"}),e.jsx(w,{className:"text-2xl text-primary",children:t?h(t.totalholdingvalue):"---"})]})}),e.jsx(j,{children:e.jsxs(b,{className:"pb-2",children:[e.jsx(v,{children:"Total Investment Value"}),e.jsx(w,{className:"text-2xl",children:t?h(t.totalinvvalue):"---"})]})}),e.jsx(j,{children:e.jsxs(b,{className:"pb-2",children:[e.jsx(v,{children:"Total Profit and Loss"}),e.jsx(w,{className:m("text-2xl",t&&o(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?e.jsxs("div",{className:"flex items-center gap-1",children:[o(t.totalprofitandloss)?e.jsx(V,{className:"h-5 w-5"}):e.jsx(B,{className:"h-5 w-5"}),h(t.totalprofitandloss)]}):"---"})]})}),e.jsx(j,{children:e.jsxs(b,{className:"pb-2",children:[e.jsx(v,{children:"Total PnL Percentage"}),e.jsx(w,{className:m("text-2xl",t&&o(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?C(t.totalpnlpercentage):"---"})]})})]}),e.jsx(j,{children:e.jsx(ee,{className:"p-0",children:_?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(me,{className:"h-8 w-8 animate-spin"})}):I?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:I}):y.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No holdings found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsxs(P,{children:[e.jsx(x,{children:"Trading Symbol"}),e.jsx(x,{children:"Exchange"}),e.jsx(x,{className:"text-right",children:"Quantity"}),e.jsx(x,{className:"text-right",children:"Avg Price"}),e.jsx(x,{className:"text-right",children:"LTP"}),e.jsx(x,{children:"Product"}),e.jsx(x,{className:"text-right",children:"Profit and Loss"}),e.jsx(x,{className:"text-right",children:"PnL %"})]})}),e.jsx(ae,{children:f.map((s,a)=>e.jsxs(P,{children:[e.jsx(n,{className:"font-medium",children:s.symbol}),e.jsx(n,{children:e.jsx(N,{variant:"outline",children:s.exchange})}),e.jsx(n,{className:"text-right font-mono",children:s.quantity}),e.jsx(n,{className:"text-right font-mono",children:s.average_price!==void 0?h(s.average_price):"-"}),e.jsx(n,{className:"text-right font-mono",children:s.ltp!==void 0?h(s.ltp):"-"}),e.jsx(n,{children:e.jsx(N,{variant:"secondary",children:s.product})}),e.jsx(n,{className:m("text-right font-medium",o(s.pnl)?"text-green-600":"text-red-600"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[o(s.pnl)?e.jsx(V,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"}),h(s.pnl)]})}),e.jsx(n,{className:m("text-right",o(s.pnlpercent)?"text-green-600":"text-red-600"),children:C(s.pnlpercent)})]},`${s.symbol}-${s.exchange}-${a}`))}),e.jsx(re,{children:e.jsxs(P,{className:"bg-muted/50",children:[e.jsx(n,{colSpan:6,className:"text-right text-muted-foreground",children:"Total P&L:"}),e.jsx(n,{className:m("text-right font-bold",t&&o(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?`${t.totalprofitandloss>=0?"+":""}${h(t.totalprofitandloss)}`:"-"}),e.jsx(n,{className:m("text-right font-bold",t&&o(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?C(t.totalpnlpercentage):"-"})]})})]})})})})]})}export{Le as default};
