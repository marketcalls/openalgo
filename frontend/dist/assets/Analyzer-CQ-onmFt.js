import{r as i,j as e}from"./vendor-react-RhKMXzW9.js";import{B as N,e as t}from"./index-DkJQVPSR.js";import{C as c,b as m,c as x,a as d}from"./card-Dz9sxSkS.js";import{D as $,b as P,c as V,d as X}from"./dialog-JL9K7gQR.js";import{I as C}from"./input-BiFbwWbt.js";import{L as _}from"./label-ryv7MV8P.js";import{T as q,a as W,b,c as n,d as G,e as r}from"./table-DxAXctQL.js";import{J as E}from"./json-editor-H54zhw23.js";import{am as R,ai as T,p as Y,al as K,T as L,g as Q,an as Z,v as ee,t as se}from"./vendor-icons-Ca5eNZvr.js";import"./vendor-router-DdyOoyPF.js";import"./vendor-radix-gKv__6YA.js";const ae={NSE:"bg-cyan-500/10 text-cyan-600 border-cyan-500/30",NFO:"bg-purple-500/10 text-purple-600 border-purple-500/30",CDS:"bg-blue-500/10 text-blue-600 border-blue-500/30",BSE:"bg-gray-500/10 text-gray-600 border-gray-500/30",BFO:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",BCD:"bg-red-500/10 text-red-600 border-red-500/30",MCX:"bg-primary/10 text-primary border-primary/30",NCDEX:"bg-green-500/10 text-green-600 border-green-500/30"};function ue(){const[y,z]=i.useState(null),[O,v]=i.useState(!0),[h,A]=i.useState(""),[u,B]=i.useState(""),[j,F]=i.useState(null),[I,w]=i.useState(!1);i.useEffect(()=>{D()},[]);const D=async(s,a)=>{v(!0);try{const l=new URLSearchParams;s&&l.append("start_date",s),a&&l.append("end_date",a);const f=l.toString()?`/analyzer/api/data?${l}`:"/analyzer/api/data",g=await fetch(f,{credentials:"include"});if(g.ok){const o=await g.json();o.status==="success"&&z(o.data)}}catch(l){console.error("Error fetching analyzer data:",l)}finally{v(!1)}},k=s=>{s.preventDefault(),D(h,u)},J=()=>{const s=new URLSearchParams;h&&s.append("start_date",h),u&&s.append("end_date",u);const a=s.toString()?`/analyzer/export?${s}`:"/analyzer/export";window.location.href=a},H=s=>{F(s),w(!0)},M=s=>{if(s.api_type==="cancelorder")return`OrderID: ${s.orderid}`;let a=s.symbol||"";return s.quantity&&(a+=` (${s.quantity})`),s.api_type==="placesmartorder"&&s.position_size&&(a+=` [Size: ${s.position_size}]`),a},U=s=>{const a={...s};return delete a.apikey,a};if(O)return e.jsx("div",{className:"container mx-auto py-8 px-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const p=y?.stats||{total_requests:0,issues:{total:0},symbols:[],sources:[]},S=y?.requests||[];return e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sandbox Request Monitor"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and validate your sandbox API requests before going live"})]}),e.jsxs(c,{className:"mb-6",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(x,{className:"text-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Filters"]})}),e.jsx(d,{children:e.jsxs("form",{onSubmit:k,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"start_date",className:"text-sm font-medium",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(C,{id:"start_date",type:"date",value:h,onChange:s=>A(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"end_date",className:"text-sm font-medium",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(C,{id:"end_date",type:"date",value:u,onChange:s=>B(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-6",children:[e.jsxs(N,{type:"submit",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(N,{type:"button",variant:"secondary",onClick:J,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs(c,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Total Requests"]})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:p.total_requests}),e.jsx(t,{className:"mt-1",children:"Last 24 hours"})]})]}),e.jsxs(c,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Issues Found"]})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-500",children:p.issues.total}),e.jsx(t,{variant:"secondary",className:"mt-1",children:"Needs Attention"})]})]}),e.jsxs(c,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Unique Symbols"]})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold",children:p.symbols.length}),e.jsx(t,{variant:"outline",className:"mt-1",children:"Tracked"})]})]}),e.jsxs(c,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Active Sources"]})}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold",children:p.sources.length}),e.jsx(t,{variant:"outline",className:"mt-1",children:"Connected"})]})]})]}),e.jsx(c,{children:e.jsx(d,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(q,{children:[e.jsx(W,{children:e.jsxs(b,{children:[e.jsx(n,{children:"Timestamp"}),e.jsx(n,{children:"API Type"}),e.jsx(n,{children:"Source"}),e.jsx(n,{children:"Details"}),e.jsx(n,{children:"Exchange"}),e.jsx(n,{children:"Action"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"View"})]})}),e.jsx(G,{children:S.length===0?e.jsx(b,{children:e.jsx(r,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No requests found"})}):S.map((s,a)=>e.jsxs(b,{className:"hover:bg-muted/50",children:[e.jsx(r,{className:"text-sm",children:s.timestamp}),e.jsx(r,{children:e.jsx(t,{variant:"default",children:s.api_type})}),e.jsx(r,{children:e.jsx(t,{variant:"secondary",className:"truncate max-w-[120px]",children:s.source})}),e.jsx(r,{className:"font-medium",children:M(s)}),e.jsx(r,{children:s.exchange&&e.jsx(t,{className:ae[s.exchange]||"",variant:"outline",children:s.exchange})}),e.jsx(r,{children:s.action&&e.jsx(t,{variant:s.action==="BUY"?"default":"destructive",children:s.action})}),e.jsx(r,{children:s.analysis.issues?e.jsxs(t,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Error"]}):e.jsxs(t,{variant:"secondary",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Success"]})}),e.jsx(r,{children:e.jsxs(N,{size:"sm",onClick:()=>H(s),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"View"]})})]},a))})]})})})}),e.jsx($,{open:I,onOpenChange:w,children:e.jsxs(P,{className:"max-w-[98vw] w-[98vw] p-4",children:[e.jsx(V,{children:e.jsx(X,{children:"Request Details"})}),j&&(()=>{const s=JSON.stringify(U(j.request_data),null,2),a=JSON.stringify(j.response_data||j.analysis,null,2),l=s.split(`
`).length,f=a.split(`
`).length,g=Math.max(l,f),o=Math.min(Math.max(g*20+24,150),600);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 max-h-[75vh] overflow-y-auto",children:[e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Request Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50 overflow-auto",style:{height:o},children:e.jsx(E,{value:s,readOnly:!0,lineWrapping:!1})})]}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Response Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50 overflow-auto",style:{height:o},children:e.jsx(E,{value:a,readOnly:!0,lineWrapping:!1})})]})]})})()]})})]})}export{ue as default};
