import{r as n,j as e}from"./vendor-react-RhKMXzW9.js";import{w as m,t as a,B as x,e as N}from"./index-CAFQPGlC.js";import{A as X,b as Z,c as ee,d as se,e as ae,f as te,g as re,h as ne}from"./alert-dialog-BwmjJhe2.js";import{C as l,b as c,c as u,d as y,a as o}from"./card-t6_eU0S_.js";import{T as ie,a as le,b as P,c as w,d as ce,e as v}from"./table-Dy5LZUMX.js";import{T as oe}from"./textarea-BtCqVky6.js";import{M as de,aK as me,ax as xe,i as R,aL as he,a3 as C,am as ge,g as ue,a5 as H,B as je,Q as fe}from"./vendor-icons-Chlwwn8V.js";import{L as j}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-radix-B_grJx4K.js";function Te(){const[i,O]=n.useState(null),[$,q]=n.useState(!0),[S,B]=n.useState(!1),[_,T]=n.useState(!1),[A,D]=n.useState(!1),[h,F]=n.useState(""),[z,f]=n.useState(!1),[M,k]=n.useState(!1);n.useEffect(()=>{p()},[]);const p=async()=>{try{const s=await m.get("/telegram/api/index");O(s.data.data)}catch(s){console.error("Error fetching telegram data:",s),a.error("Failed to load Telegram data")}finally{q(!1)}},K=async()=>{B(!0);try{const s=await m.post("/telegram/bot/start");s.data.status==="success"?(a.success(s.data.message||"Bot started successfully"),p()):a.error(s.data.message||"Failed to start bot")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to start bot")}finally{B(!1)}},Q=async()=>{T(!0);try{const s=await m.post("/telegram/bot/stop");s.data.status==="success"?(a.success(s.data.message||"Bot stopped successfully"),p()):a.error(s.data.message||"Failed to stop bot")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to stop bot")}finally{T(!1)}},V=async()=>{D(!0);try{const s=await m.post("/telegram/test-message");s.data.status==="success"?a.success(s.data.message||"Test message sent"):a.error(s.data.message||"Failed to send test message")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to send test message")}finally{D(!1)}},Y=async()=>{if(!h.trim()){a.error("Please enter a message to broadcast");return}f(!0)},G=async()=>{f(!1),k(!0);try{const s=await m.post("/telegram/broadcast",{message:h});s.data.status==="success"?(a.success(s.data.message||"Broadcast sent successfully"),F("")):a.error(s.data.message||"Failed to send broadcast")}catch(s){const t=s;a.error(t.response?.data?.message||"Failed to send broadcast")}finally{k(!1)}};if($)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!i)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("p",{className:"text-muted-foreground",children:"Failed to load Telegram data"})});const{bot_status:r,config:d,users:L=[],stats:E=[]}=i,b=Array.isArray(L)?L:[],g=Array.isArray(E)?E:[],I=b.filter(s=>s.notifications_enabled).length;return e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(de,{className:"h-6 w-6"}),"Telegram Bot"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage your Telegram bot for trade notifications"})]}),e.jsxs("div",{className:"flex gap-2",children:[r.is_running?e.jsxs(x,{variant:"destructive",onClick:Q,disabled:_,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),_?"Stopping...":"Stop Bot"]}):e.jsxs(x,{onClick:K,disabled:S||!r.is_configured,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),S?"Starting...":"Start Bot"]}),e.jsx(j,{to:"/telegram/config",children:e.jsxs(x,{variant:"outline",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Configuration"]})})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${r.is_running?"bg-green-500":"bg-gray-400"}`,children:e.jsx(he,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx(u,{children:d.bot_username?`@${d.bot_username}`:"Bot Not Configured"}),e.jsx(y,{children:r.is_running?"Bot is running":"Bot is stopped"})]})]}),e.jsx(N,{variant:r.is_running?"default":"secondary",className:r.is_running?"bg-green-500 hover:bg-green-600":"",children:r.is_running?"Online":"Offline"})]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:b.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:I}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Users"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:g.reduce((s,t)=>s+t.count,0)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commands (7d)"})]}),e.jsxs("div",{className:"text-center p-3 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold",children:d.rate_limit_per_minute}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rate Limit/min"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(j,{to:"/telegram/config",children:e.jsxs(l,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer group",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center",children:e.jsx(R,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-semibold group-hover:text-primary transition-colors flex items-center gap-2",children:["Configuration",e.jsx(C,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure bot settings"})]})]})}),e.jsx(j,{to:"/telegram/users",children:e.jsxs(l,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer group",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-500 flex items-center justify-center",children:e.jsx(ge,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-semibold group-hover:text-primary transition-colors flex items-center gap-2",children:["Users",e.jsx(C,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Manage linked users"})]})]})}),e.jsx(j,{to:"/telegram/analytics",children:e.jsxs(l,{className:"h-full hover:shadow-lg transition-shadow cursor-pointer group",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center",children:e.jsx(ue,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsxs("h3",{className:"font-semibold group-hover:text-primary transition-colors flex items-center gap-2",children:["Analytics",e.jsx(C,{className:"h-4 w-4 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"View usage statistics"})]})]})}),e.jsxs(l,{className:"h-full",children:[e.jsx(c,{className:"pb-2",children:e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center",children:e.jsx(H,{className:"h-5 w-5 text-white"})})}),e.jsxs(o,{children:[e.jsx("h3",{className:"font-semibold",children:"Test Message"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Send a test notification"}),e.jsx(x,{size:"sm",variant:"outline",onClick:V,disabled:A||!r.is_running,children:A?"Sending...":"Send Test"})]})]})]}),i.telegram_user&&e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Your Telegram Link"]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["@",i.telegram_user.telegram_username||i.telegram_user.first_name]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Notifications: ",i.telegram_user.notifications_enabled?"Enabled":"Disabled"]})]}),e.jsx(N,{variant:i.telegram_user.notifications_enabled?"default":"secondary",children:i.telegram_user.notifications_enabled?"Active":"Inactive"})]})})]}),g.length>0&&e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsx(u,{children:"Popular Commands (Last 7 Days)"}),e.jsx(y,{children:"Most used bot commands"})]}),e.jsx(o,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(ie,{children:[e.jsx(le,{children:e.jsxs(P,{children:[e.jsx(w,{children:"Command"}),e.jsx(w,{children:"Count"}),e.jsx(w,{children:"Percentage"})]})}),e.jsx(ce,{children:g.map(s=>{const t=g.reduce((J,W)=>J+W.count,0),U=t>0?s.count/t*100:0;return e.jsxs(P,{children:[e.jsx(v,{children:e.jsxs(N,{variant:"outline",children:["/",s.command]})}),e.jsx(v,{children:s.count}),e.jsx(v,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${U}%`}})}),e.jsxs("span",{className:"text-sm text-muted-foreground w-12",children:[U.toFixed(1),"%"]})]})})]},s.command)})})]})})})]}),e.jsxs(l,{children:[e.jsxs(c,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"Broadcast Message"]}),e.jsx(y,{children:"Send a message to all users"})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsx(oe,{placeholder:"Enter your message here...",value:h,onChange:s=>F(s.target.value),rows:4}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{onClick:Y,disabled:M||!r.is_running||!d.broadcast_enabled,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),M?"Broadcasting...":"Send Broadcast"]})}),!d.broadcast_enabled&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Broadcast is disabled. Enable it in Configuration."})]})]}),e.jsx(X,{open:z,onOpenChange:f,children:e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Confirm Broadcast"}),e.jsx(ae,{children:"Are you sure you want to send this message to all users?"})]}),e.jsx("div",{className:"bg-muted p-3 rounded-lg my-4",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:h})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["This will be sent to ",I," active users (",b.length," total users)"]}),e.jsxs(te,{children:[e.jsx(re,{children:"Cancel"}),e.jsx(ne,{onClick:G,children:"Send Broadcast"})]})]})})]})}export{Te as default};
