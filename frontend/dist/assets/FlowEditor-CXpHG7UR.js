import{k as Pe,m as Ae,n as Le,r as u,j as e,H as xe,P as be,p as we,q as We,B as Ge,E as Be,t as Fe,v as Re,w as Ue,C as qe,M as Qe,x as Ve}from"./vendor-react-Z55t3GwI.js";import{u as He,f as z,a as Y,m as Ke,b as _e,d as ze,n as Ye,o as $e,p as Xe}from"./flow-DGdcTuJ3.js";import{R as Ze,c as v,D as ve,h as ke,i as Ce,T as Je,U as et,V as tt,j as Z,B as k,v as st,t as h}from"./index-DkS0A_YW.js";import{I as Oe}from"./input-C1zk1ISa.js";import{av as rt,P as V,B as at,aH as ot,aQ as it,Z as lt,c as le,e as ne,ak as nt,aR as ct,a1 as dt,a0 as J,aD as pt,g as ge,aS as ut,aj as $,ai as mt,aT as xt,ax as bt,b as gt,aU as ht,aV as yt,aW as ft,aX as he,x as Nt,V as jt,aY as wt,at as vt,aZ as kt,a_ as Ct,F as Ot,a6 as St,a$ as Et,b0 as Tt,b1 as Mt,b2 as Dt,b3 as It,W as ce,ac as Pt,X as Se,I as ye,ao as pe,C as fe,v as At,L as X,A as Lt,ah as Wt,aC as Gt,aE as Bt,aM as Ft,q as Rt}from"./vendor-icons-B3sIx3h3.js";import{S as ue}from"./scroll-area-BjOSsWcV.js";import{T as Ut,a as qt,b as A,c as L}from"./tabs-kCqyunWn.js";import{L as de}from"./label-BofpAOMY.js";import{S as Ne}from"./separator-CK58uCxR.js";import{d as Qt,a as Vt}from"./vendor-router-CuCQU4nC.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-D7j7RylB.js";const je={id:null,name:"Untitled Workflow",description:"",nodes:[],edges:[],selectedNodeId:null,selectedEdgeId:null,isModified:!1},me=Ze((t,l)=>({...je,setWorkflow:s=>t({id:s.id,name:s.name,description:s.description,nodes:s.nodes,edges:s.edges,isModified:!1,selectedNodeId:null,selectedEdgeId:null}),setName:s=>t({name:s,isModified:!0}),setDescription:s=>t({description:s,isModified:!0}),resetWorkflow:()=>t(je),markSaved:()=>t({isModified:!1}),setNodes:s=>t({nodes:s,isModified:!0}),onNodesChange:s=>{t({nodes:Le(s,l().nodes),isModified:!0})},addNode:s=>t(i=>({nodes:[...i.nodes,s],isModified:!0})),updateNodeData:(s,i)=>t(n=>({nodes:n.nodes.map(c=>c.id===s?{...c,data:{...c.data,...i}}:c),isModified:!0})),deleteNode:s=>t(i=>({nodes:i.nodes.filter(n=>n.id!==s),edges:i.edges.filter(n=>n.source!==s&&n.target!==s),selectedNodeId:i.selectedNodeId===s?null:i.selectedNodeId,isModified:!0})),setEdges:s=>t({edges:s,isModified:!0}),onEdgesChange:s=>{t({edges:Ae(s,l().edges),isModified:!0})},onConnect:s=>{t({edges:Pe({...s,id:`edge-${Date.now()}`},l().edges),isModified:!0})},deleteEdge:s=>t(i=>({edges:i.edges.filter(n=>n.id!==s),selectedEdgeId:i.selectedEdgeId===s?null:i.selectedEdgeId,isModified:!0})),selectNode:s=>t({selectedNodeId:s,selectedEdgeId:null}),selectEdge:s=>t({selectedEdgeId:s,selectedNodeId:null}),deleteSelected:()=>t(s=>{const{selectedNodeId:i,selectedEdgeId:n,nodes:c,edges:p}=s;return i?{nodes:c.filter(a=>a.id!==i),edges:p.filter(a=>a.source!==i&&a.target!==i),selectedNodeId:null,isModified:!0}:n?{edges:p.filter(a=>a.id!==n),selectedEdgeId:null,isModified:!0}:s})})),Ee={TRIGGERS:[{type:"start",label:"Schedule",description:"Start workflow on schedule",category:"trigger"},{type:"priceAlert",label:"Price Alert",description:"Trigger on price condition",category:"trigger"},{type:"webhookTrigger",label:"Webhook",description:"Trigger from external webhook",category:"trigger"}],ACTIONS:[{type:"placeOrder",label:"Place Order",description:"Place a trading order",category:"action"},{type:"smartOrder",label:"Smart Order",description:"Position-aware order",category:"action"},{type:"optionsOrder",label:"Options Order",description:"Trade ATM/ITM/OTM options",category:"action"},{type:"optionsMultiOrder",label:"Options Strategy",description:"Multi-leg options strategy",category:"action"},{type:"basketOrder",label:"Basket Order",description:"Place multiple orders at once",category:"action"},{type:"splitOrder",label:"Split Order",description:"Split large order into chunks",category:"action"},{type:"modifyOrder",label:"Modify Order",description:"Modify an existing order",category:"action"},{type:"cancelOrder",label:"Cancel Order",description:"Cancel a specific order",category:"action"},{type:"cancelAllOrders",label:"Cancel All",description:"Cancel all open orders",category:"action"},{type:"closePositions",label:"Close Positions",description:"Square off all positions",category:"action"}],CONDITIONS:[{type:"positionCheck",label:"Position Check",description:"Check position status",category:"condition"},{type:"fundCheck",label:"Fund Check",description:"Check available funds",category:"condition"},{type:"priceCondition",label:"Price Check",description:"Check price condition",category:"condition"},{type:"timeWindow",label:"Time Window",description:"Check market hours",category:"condition"},{type:"timeCondition",label:"Time Condition",description:"Check time condition",category:"condition"},{type:"andGate",label:"AND Gate",description:"All conditions must be true",category:"condition"},{type:"orGate",label:"OR Gate",description:"Any condition must be true",category:"condition"},{type:"notGate",label:"NOT Gate",description:"Invert condition result",category:"condition"}],DATA:[{type:"getQuote",label:"Get Quote",description:"Fetch real-time quote",category:"data"},{type:"getDepth",label:"Market Depth",description:"Fetch bid/ask depth",category:"data"},{type:"history",label:"History",description:"Fetch OHLCV data",category:"data"},{type:"openPosition",label:"Open Position",description:"Get position for symbol",category:"data"},{type:"orderBook",label:"Order Book",description:"Get all orders",category:"data"},{type:"tradeBook",label:"Trade Book",description:"Get all trades",category:"data"},{type:"positionBook",label:"Position Book",description:"Get all positions",category:"data"},{type:"holdings",label:"Holdings",description:"Get portfolio holdings",category:"data"},{type:"funds",label:"Funds",description:"Get available funds",category:"data"}],UTILITIES:[{type:"telegramAlert",label:"Telegram Alert",description:"Send Telegram notification",category:"utility"},{type:"delay",label:"Delay",description:"Wait for duration",category:"utility"},{type:"waitUntil",label:"Wait Until",description:"Wait until specific time",category:"utility"},{type:"log",label:"Log",description:"Log a message",category:"utility"},{type:"variable",label:"Variable",description:"Set/calculate variable",category:"utility"},{type:"httpRequest",label:"HTTP Request",description:"Make HTTP request",category:"utility"}]},Te={start:{scheduleType:"daily",time:"09:15",marketHoursOnly:!0},priceAlert:{symbol:"",exchange:"NSE",condition:"above",price:0},webhookTrigger:{label:"",symbol:"",exchange:"NSE"},placeOrder:{symbol:"",exchange:"NSE",action:"BUY",quantity:1,priceType:"MARKET",product:"MIS"},smartOrder:{symbol:"",exchange:"NSE",action:"BUY",quantity:1,positionSize:0,priceType:"MARKET",product:"MIS"},optionsOrder:{underlying:"NIFTY",exchange:"NSE_INDEX",expiryDate:"",offset:"ATM",optionType:"CE",action:"BUY",quantity:75,priceType:"MARKET",product:"MIS"},optionsMultiOrder:{strategy:"straddle",underlying:"NIFTY",exchange:"NSE_INDEX",expiryDate:"",legs:[],priceType:"MARKET",product:"MIS"},cancelOrder:{orderId:""},cancelAllOrders:{},closePositions:{symbol:"",exchange:"NSE",product:"MIS"},modifyOrder:{orderId:"",symbol:"",exchange:"NSE",action:"BUY"},basketOrder:{orders:"",product:"MIS",priceType:"MARKET"},splitOrder:{symbol:"",exchange:"NSE",action:"BUY",quantity:100,splitSize:50,priceType:"MARKET",product:"MIS"},positionCheck:{symbol:"",exchange:"NSE",product:"MIS",operator:"gt",threshold:0},fundCheck:{operator:"gt",threshold:1e4},priceCondition:{symbol:"",exchange:"NSE",operator:"gt",threshold:0},timeWindow:{startTime:"09:15",endTime:"15:30"},timeCondition:{targetTime:"09:30",operator:">="},andGate:{},orGate:{},notGate:{},getQuote:{symbol:"",exchange:"NSE",outputVariable:""},getDepth:{symbol:"",exchange:"NSE",outputVariable:""},history:{symbol:"",exchange:"NSE",interval:"5m",startDate:"",endDate:"",outputVariable:""},openPosition:{symbol:"",exchange:"NSE",product:"MIS",outputVariable:""},orderBook:{outputVariable:""},tradeBook:{outputVariable:""},positionBook:{outputVariable:""},holdings:{outputVariable:""},funds:{outputVariable:""},telegramAlert:{message:"Workflow executed successfully"},delay:{delayValue:1,delayUnit:"seconds"},waitUntil:{targetTime:"09:30"},log:{message:"Log message here",level:"info"},variable:{variableName:"myVar",operation:"set",value:""},httpRequest:{method:"GET",url:"",headers:{},body:"",timeout:30,outputVariable:""}};function Ht(t){for(const l of Object.values(Ee)){const s=l.find(i=>i.type===t);if(s)return s}return null}function Kt(t){return["start","priceAlert","webhookTrigger"].includes(t)?"border-orange-500/50 bg-orange-500/5":["placeOrder","smartOrder","optionsOrder","optionsMultiOrder","basketOrder","splitOrder","modifyOrder"].includes(t)?"border-blue-500/50 bg-blue-500/5":["cancelOrder","cancelAllOrders","closePositions"].includes(t)?"border-red-500/50 bg-red-500/5":["timeCondition","positionCheck","fundCheck","priceCondition","timeWindow","andGate","orGate","notGate"].includes(t)?"border-purple-500/50 bg-purple-500/5":["getQuote","getDepth","history","multiQuotes"].includes(t)?"border-cyan-500/50 bg-cyan-500/5":["optionSymbol","optionChain","syntheticFuture","expiry"].includes(t)?"border-pink-500/50 bg-pink-500/5":["subscribeLtp","subscribeQuote","subscribeDepth","unsubscribe"].includes(t)?"border-green-500/50 bg-green-500/5":"border-border bg-card"}function _t({id:t,type:l,data:s,selected:i}){const n=Ht(l||""),c=s,{selectedNodeId:p}=me(),a=i||p===t,m=Kt(l||""),g=c.label||n?.label||l;return e.jsxs("div",{className:v("min-w-[140px] rounded-lg border-2 px-3 py-2 shadow-sm transition-all",m,a&&"ring-2 ring-primary ring-offset-2 ring-offset-background"),children:[e.jsx(xe,{type:"target",position:be.Top,className:"!bg-primary !border-background !w-3 !h-3"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs font-medium truncate",children:g}),n&&e.jsx("div",{className:"text-[10px] text-muted-foreground truncate mt-0.5",children:n.description})]}),e.jsx(xe,{type:"source",position:be.Bottom,className:"!bg-primary !border-background !w-3 !h-3"})]})}const r=u.memo(_t),zt={start:r,priceAlert:r,webhookTrigger:r,httpRequest:r,placeOrder:r,smartOrder:r,optionsOrder:r,optionsMultiOrder:r,basketOrder:r,splitOrder:r,modifyOrder:r,cancelOrder:r,cancelAllOrders:r,closePositions:r,timeCondition:r,positionCheck:r,fundCheck:r,priceCondition:r,timeWindow:r,andGate:r,orGate:r,notGate:r,getQuote:r,getDepth:r,history:r,multiQuotes:r,symbol:r,expiry:r,optionSymbol:r,optionChain:r,syntheticFuture:r,optionGreeks:r,getOrderStatus:r,openPosition:r,orderBook:r,tradeBook:r,positionBook:r,subscribeLtp:r,subscribeQuote:r,subscribeDepth:r,unsubscribe:r,holdings:r,funds:r,margin:r,holidays:r,timings:r,variable:r,mathExpression:r,log:r,telegramAlert:r,delay:r,waitUntil:r,group:r},Yt={Actions:[{type:"placeOrder",label:"Place Order"},{type:"smartOrder",label:"Smart Order"},{type:"optionsOrder",label:"Options Order"},{type:"optionsMultiOrder",label:"Multi-Leg Options"},{type:"closePositions",label:"Close Positions"},{type:"cancelAllOrders",label:"Cancel All"}],Logic:[{type:"timeCondition",label:"Time Condition"},{type:"positionCheck",label:"Position Check"},{type:"fundCheck",label:"Fund Check"},{type:"priceCondition",label:"Price Check"},{type:"timeWindow",label:"Time Window"}],Data:[{type:"getQuote",label:"Get Quote"},{type:"getDepth",label:"Get Depth"},{type:"openPosition",label:"Open Position"}],Utility:[{type:"waitUntil",label:"Wait Until"},{type:"delay",label:"Delay"},{type:"telegramAlert",label:"Telegram Alert"},{type:"log",label:"Log"},{type:"variable",label:"Variable"}]};let $t=1e3;function Xt({id:t,source:l,target:s,sourceX:i,sourceY:n,targetX:c,targetY:p,sourcePosition:a,targetPosition:m,sourceHandleId:g,targetHandleId:C,style:N={},markerEnd:ee,selected:G,animated:H}){const[D,j]=u.useState(!1),[I,B]=u.useState(!1),{setNodes:K,setEdges:F,getNodes:O,getEdges:P}=we(),[R,U,te]=We({sourceX:i,sourceY:n,sourcePosition:a,targetX:c,targetY:p,targetPosition:m}),q=u.useCallback(S=>{const w=O(),E=P(),x=`node_${Date.now()}_${$t++}`,y=w.find(M=>M.id===l),T=w.find(M=>M.id===s);if(!y||!T)return;const Q=(y.position.x+T.position.x)/2,_=(y.position.y+T.position.y)/2+50,se=Te[S]||{},re={id:x,type:S,position:{x:Q,y:_},data:{...se}},ae=E.filter(M=>M.id!==t),oe={id:`edge-${Date.now()}-1`,source:l,target:x,sourceHandle:g||void 0,type:"insertable",animated:!0},ie={id:`edge-${Date.now()}-2`,source:x,target:s,targetHandle:C||void 0,type:"insertable",animated:!0};K([...w,re]),F([...ae,oe,ie]),B(!1)},[l,s,g,C,t,O,P,K,F]);return e.jsxs(e.Fragment,{children:[e.jsx(Ge,{path:R,markerEnd:ee,style:{...N,strokeWidth:D||G?2:1.5,stroke:D||G?"hsl(var(--primary))":"hsl(var(--muted-foreground))",strokeDasharray:H?"5 5":void 0,animation:H?"dashdraw 0.5s linear infinite":void 0}}),e.jsx(Be,{children:e.jsx("div",{className:"nodrag nopan pointer-events-auto absolute",style:{transform:`translate(-50%, -50%) translate(${U}px, ${te}px)`},onMouseEnter:()=>j(!0),onMouseLeave:()=>!I&&j(!1),children:e.jsxs(ve,{open:I,onOpenChange:B,children:[e.jsx(ke,{asChild:!0,children:e.jsx("button",{className:v("flex h-5 w-5 items-center justify-center rounded-full border bg-background shadow-sm transition-all","hover:scale-110 hover:border-primary hover:bg-primary hover:text-primary-foreground",D||I?"opacity-100 scale-100":"opacity-0 scale-75",G&&"opacity-100 scale-100"),children:e.jsx(rt,{className:"h-3 w-3"})})}),e.jsx(Ce,{align:"center",className:"w-48",children:Object.entries(Yt).map(([S,w])=>e.jsxs(Je,{children:[e.jsx(et,{children:e.jsx("span",{children:S})}),e.jsx(tt,{children:w.map(E=>e.jsx(Z,{onClick:()=>q(E.type),children:E.label},E.type))})]},S))})]})})})]})}const Zt={insertable:Xt};function W({type:t,label:l,description:s,icon:i,color:n,onDragStart:c}){return e.jsx("div",{draggable:!0,onDragStart:p=>c(p,t),className:v("group cursor-grab rounded-lg border border-border bg-card p-2.5 transition-all duration-200","hover:border-primary/50 hover:shadow-md active:cursor-grabbing"),children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:v("flex h-7 w-7 items-center justify-center rounded-md",n),children:i}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"truncate text-xs font-medium",children:l}),e.jsx("div",{className:"truncate text-[10px] text-muted-foreground",children:s})]})]})})}function Jt({onDragStart:t}){const l=[{type:"start",label:"Schedule",description:"Start on schedule",icon:e.jsx(V,{className:"h-3.5 w-3.5 text-orange-500"}),color:"bg-orange-500/10"},{type:"priceAlert",label:"Price Alert",description:"Trigger on price",icon:e.jsx(at,{className:"h-3.5 w-3.5 text-orange-500"}),color:"bg-orange-500/10"},{type:"webhookTrigger",label:"Webhook",description:"External trigger",icon:e.jsx(ot,{className:"h-3.5 w-3.5 text-orange-500"}),color:"bg-orange-500/10"}],s=[{type:"placeOrder",label:"Place Order",description:"Basic order",icon:e.jsx(it,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"smartOrder",label:"Smart Order",description:"Position-aware",icon:e.jsx(lt,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"optionsOrder",label:"Options Order",description:"ATM/ITM/OTM",icon:e.jsx(le,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"optionsMultiOrder",label:"Multi-Leg",description:"Options strategies",icon:e.jsx(ne,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"basketOrder",label:"Basket Order",description:"Multiple orders",icon:e.jsx(nt,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"splitOrder",label:"Split Order",description:"Large order split",icon:e.jsx(ct,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"modifyOrder",label:"Modify Order",description:"Edit order",icon:e.jsx(dt,{className:"h-3.5 w-3.5 text-blue-500"}),color:"bg-blue-500/10"},{type:"cancelOrder",label:"Cancel Order",description:"Cancel by ID",icon:e.jsx(J,{className:"h-3.5 w-3.5 text-red-500"}),color:"bg-red-500/10"},{type:"cancelAllOrders",label:"Cancel All",description:"Cancel orders",icon:e.jsx(J,{className:"h-3.5 w-3.5 text-red-500"}),color:"bg-red-500/10"},{type:"closePositions",label:"Close Positions",description:"Square off all",icon:e.jsx(pt,{className:"h-3.5 w-3.5 text-red-500"}),color:"bg-red-500/10"}],i=[{type:"timeCondition",label:"Time Condition",description:"Entry/Exit time",icon:e.jsx(V,{className:"h-3.5 w-3.5 text-purple-500"}),color:"bg-purple-500/10"},{type:"positionCheck",label:"Position Check",description:"Check position",icon:e.jsx($,{className:"h-3.5 w-3.5 text-purple-500"}),color:"bg-purple-500/10"},{type:"fundCheck",label:"Fund Check",description:"Check funds",icon:e.jsx(he,{className:"h-3.5 w-3.5 text-purple-500"}),color:"bg-purple-500/10"},{type:"priceCondition",label:"Price Check",description:"Check price",icon:e.jsx(le,{className:"h-3.5 w-3.5 text-purple-500"}),color:"bg-purple-500/10"},{type:"timeWindow",label:"Time Window",description:"Market hours",icon:e.jsx(V,{className:"h-3.5 w-3.5 text-purple-500"}),color:"bg-purple-500/10"},{type:"andGate",label:"AND Gate",description:"All must be true",icon:e.jsx("span",{className:"text-[9px] font-bold text-purple-500",children:"AND"}),color:"bg-purple-500/10"},{type:"orGate",label:"OR Gate",description:"Any can be true",icon:e.jsx("span",{className:"text-[9px] font-bold text-purple-500",children:"OR"}),color:"bg-purple-500/10"},{type:"notGate",label:"NOT Gate",description:"Invert condition",icon:e.jsx("span",{className:"text-[9px] font-bold text-purple-500",children:"NOT"}),color:"bg-purple-500/10"}],n=[{type:"getQuote",label:"Get Quote",description:"Real-time quote",icon:e.jsx(ge,{className:"h-3.5 w-3.5 text-cyan-500"}),color:"bg-cyan-500/10"},{type:"getDepth",label:"Get Depth",description:"Bid/ask depth",icon:e.jsx(ne,{className:"h-3.5 w-3.5 text-cyan-500"}),color:"bg-cyan-500/10"},{type:"getOrderStatus",label:"Order Status",description:"Check order",icon:e.jsx(ut,{className:"h-3.5 w-3.5 text-orange-500"}),color:"bg-orange-500/10"},{type:"history",label:"History",description:"OHLCV data",icon:e.jsx(le,{className:"h-3.5 w-3.5 text-cyan-500"}),color:"bg-cyan-500/10"},{type:"openPosition",label:"Open Position",description:"Get position",icon:e.jsx($,{className:"h-3.5 w-3.5 text-violet-500"}),color:"bg-violet-500/10"},{type:"expiry",label:"Expiry Dates",description:"F&O expiry",icon:e.jsx(mt,{className:"h-3.5 w-3.5 text-pink-500"}),color:"bg-pink-500/10"},{type:"multiQuotes",label:"Multi Quotes",description:"Multiple symbols",icon:e.jsx(ge,{className:"h-3.5 w-3.5 text-cyan-500"}),color:"bg-cyan-500/10"},{type:"symbol",label:"Symbol Info",description:"Get symbol details",icon:e.jsx(xt,{className:"h-3.5 w-3.5 text-teal-500"}),color:"bg-teal-500/10"},{type:"optionSymbol",label:"Option Symbol",description:"Resolve options",icon:e.jsx(bt,{className:"h-3.5 w-3.5 text-pink-500"}),color:"bg-pink-500/10"},{type:"orderBook",label:"Order Book",description:"All orders",icon:e.jsx(gt,{className:"h-3.5 w-3.5 text-orange-500"}),color:"bg-orange-500/10"},{type:"tradeBook",label:"Trade Book",description:"Executed trades",icon:e.jsx(ht,{className:"h-3.5 w-3.5 text-orange-500"}),color:"bg-orange-500/10"},{type:"positionBook",label:"Position Book",description:"All positions",icon:e.jsx($,{className:"h-3.5 w-3.5 text-violet-500"}),color:"bg-violet-500/10"},{type:"syntheticFuture",label:"Synthetic Future",description:"Calc future price",icon:e.jsx(yt,{className:"h-3.5 w-3.5 text-pink-500"}),color:"bg-pink-500/10"},{type:"optionChain",label:"Option Chain",description:"Full chain data",icon:e.jsx(ft,{className:"h-3.5 w-3.5 text-pink-500"}),color:"bg-pink-500/10"},{type:"holdings",label:"Holdings",description:"Portfolio holdings",icon:e.jsx($,{className:"h-3.5 w-3.5 text-amber-500"}),color:"bg-amber-500/10"},{type:"funds",label:"Funds",description:"Account balance",icon:e.jsx(he,{className:"h-3.5 w-3.5 text-amber-500"}),color:"bg-amber-500/10"},{type:"margin",label:"Margin Calc",description:"Margin required",icon:e.jsx(Nt,{className:"h-3.5 w-3.5 text-amber-500"}),color:"bg-amber-500/10"}],c=[{type:"subscribeLtp",label:"Subscribe LTP",description:"Live price stream",icon:e.jsx(jt,{className:"h-3.5 w-3.5 text-green-500"}),color:"bg-green-500/10"},{type:"subscribeQuote",label:"Subscribe Quote",description:"Live OHLC stream",icon:e.jsx(wt,{className:"h-3.5 w-3.5 text-green-500"}),color:"bg-green-500/10"},{type:"subscribeDepth",label:"Subscribe Depth",description:"Live order book",icon:e.jsx(ne,{className:"h-3.5 w-3.5 text-green-500"}),color:"bg-green-500/10"},{type:"unsubscribe",label:"Unsubscribe",description:"Stop streaming",icon:e.jsx(vt,{className:"h-3.5 w-3.5 text-red-500"}),color:"bg-red-500/10"}],p=[{type:"variable",label:"Variable",description:"Store values",icon:e.jsx(kt,{className:"h-3.5 w-3.5 text-purple-400"}),color:"bg-purple-400/10"},{type:"mathExpression",label:"Math",description:"Calculate expression",icon:e.jsx(Ct,{className:"h-3.5 w-3.5 text-purple-500"}),color:"bg-purple-500/10"},{type:"log",label:"Log",description:"Debug message",icon:e.jsx(Ot,{className:"h-3.5 w-3.5 text-blue-400"}),color:"bg-blue-400/10"},{type:"telegramAlert",label:"Telegram",description:"Send alert",icon:e.jsx(St,{className:"h-3.5 w-3.5 text-[#0088cc]"}),color:"bg-[#0088cc]/10"},{type:"delay",label:"Delay",description:"Wait duration",icon:e.jsx(Et,{className:"h-3.5 w-3.5 text-muted-foreground"}),color:"bg-muted"},{type:"waitUntil",label:"Wait Until",description:"Wait until time",icon:e.jsx(Tt,{className:"h-3.5 w-3.5 text-amber-500"}),color:"bg-amber-500/10"},{type:"group",label:"Group",description:"Group nodes",icon:e.jsx(Mt,{className:"h-3.5 w-3.5 text-muted-foreground"}),color:"bg-muted"},{type:"httpRequest",label:"HTTP Request",description:"API call",icon:e.jsx(Dt,{className:"h-3.5 w-3.5 text-primary"}),color:"bg-primary/10"},{type:"holidays",label:"Holidays",description:"Market holidays",icon:e.jsx(It,{className:"h-3.5 w-3.5 text-purple-400"}),color:"bg-purple-400/10"},{type:"timings",label:"Timings",description:"Market hours",icon:e.jsx(V,{className:"h-3.5 w-3.5 text-purple-400"}),color:"bg-purple-400/10"}];return e.jsxs("div",{className:"flex h-full flex-col border-r border-border bg-card",children:[e.jsxs("div",{className:"border-b border-border p-3",children:[e.jsx("h2",{className:"text-sm font-semibold",children:"Nodes"}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:"Drag nodes to the canvas"})]}),e.jsxs(Ut,{defaultValue:"triggers",className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"border-b border-border px-1 py-1.5",children:e.jsxs(qt,{className:"h-7 w-full",children:[e.jsx(A,{value:"triggers",className:"flex-1 text-[8px] px-0.5",children:"Trigger"}),e.jsx(A,{value:"actions",className:"flex-1 text-[8px] px-0.5",children:"Action"}),e.jsx(A,{value:"data",className:"flex-1 text-[8px] px-0.5",children:"Data"}),e.jsx(A,{value:"stream",className:"flex-1 text-[8px] px-0.5",children:"Stream"}),e.jsx(A,{value:"conditions",className:"flex-1 text-[8px] px-0.5",children:"Logic"}),e.jsx(A,{value:"utilities",className:"flex-1 text-[8px] px-0.5",children:"Util"})]})}),e.jsxs(ue,{className:"flex-1",children:[e.jsx(L,{value:"triggers",className:"m-0 p-2",children:e.jsx("div",{className:"space-y-1.5",children:l.map(a=>e.jsx(W,{...a,onDragStart:t},a.type))})}),e.jsx(L,{value:"actions",className:"m-0 p-2",children:e.jsx("div",{className:"space-y-1.5",children:s.map(a=>e.jsx(W,{...a,onDragStart:t},a.type))})}),e.jsx(L,{value:"data",className:"m-0 p-2",children:e.jsx("div",{className:"space-y-1.5",children:n.map(a=>e.jsx(W,{...a,onDragStart:t},a.type))})}),e.jsx(L,{value:"stream",className:"m-0 p-2",children:e.jsx("div",{className:"space-y-1.5",children:c.map(a=>e.jsx(W,{...a,onDragStart:t},a.type))})}),e.jsx(L,{value:"conditions",className:"m-0 p-2",children:e.jsx("div",{className:"space-y-1.5",children:i.map(a=>e.jsx(W,{...a,onDragStart:t},a.type))})}),e.jsx(L,{value:"utilities",className:"m-0 p-2",children:e.jsx("div",{className:"space-y-1.5",children:p.map(a=>e.jsx(W,{...a,onDragStart:t},a.type))})})]})]})]})}function es(t){for(const l of Object.values(Ee)){const s=l.find(i=>i.type===t);if(s)return s}return null}function ts(){const{nodes:t,selectedNodeId:l,updateNodeData:s,deleteNode:i,selectNode:n}=me(),c=t.find(N=>N.id===l);if(!c)return e.jsxs("div",{className:"w-72 border-l border-border bg-card flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Configure"})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(ce,{className:"h-12 w-12 mx-auto mb-3 opacity-30"}),e.jsx("p",{className:"text-sm",children:"Select a node to configure"}),e.jsx("p",{className:"text-xs mt-1",children:"Click on a node in the canvas"})]})})]});const p=es(c.type||""),a=c.data,m=()=>{n(null)},g=()=>{i(c.id)},C=N=>{s(c.id,{label:N})};return e.jsxs("div",{className:"w-72 border-l border-border bg-card flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium text-sm truncate",children:p?.label||c.type})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7 text-destructive hover:text-destructive",onClick:g,children:e.jsx(Pt,{className:"h-4 w-4"})}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:m,children:e.jsx(Se,{className:"h-4 w-4"})})]})]}),e.jsx(ue,{className:"flex-1",children:e.jsxs("div",{className:"p-4 space-y-4",children:[p&&e.jsx("div",{className:"rounded-lg border border-border bg-muted/30 p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium",children:p.label}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:p.description})]})]})}),e.jsx(Ne,{}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{htmlFor:"node-label",className:"text-xs",children:"Node Label"}),e.jsx(Oe,{id:"node-label",placeholder:"Enter label...",value:a.label||"",onChange:N=>C(N.target.value),className:"h-8 text-sm"})]})}),e.jsx(Ne,{}),e.jsx("div",{className:"rounded-lg border border-dashed border-amber-500/50 bg-amber-500/5 p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-amber-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-amber-500",children:"Configuration Pending"}),e.jsxs("p",{className:"text-xs text-amber-500/80 mt-1",children:["Full configuration for ",e.jsx("strong",{children:p?.label||c.type})," nodes will be available after Phase 6 implementation."]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{className:"text-xs text-muted-foreground",children:"Node ID"}),e.jsx("code",{className:"block text-xs bg-muted px-2 py-1 rounded font-mono",children:c.id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(de,{className:"text-xs text-muted-foreground",children:"Current Data"}),e.jsx("pre",{className:"text-xs bg-muted px-2 py-2 rounded font-mono overflow-x-auto max-h-40",children:JSON.stringify(a,null,2)})]})]})})]})}function ss({logs:t,status:l,onClose:s}){const i=()=>{switch(l){case"running":return e.jsx(V,{className:"h-4 w-4 animate-pulse text-amber-500"});case"success":return e.jsx(fe,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(J,{className:"h-4 w-4 text-red-500"});default:return e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"})}},n=()=>{switch(l){case"running":return"Executing...";case"success":return"Completed";case"error":return"Failed";default:return"Ready"}},c=a=>{try{return new Date(a).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return a}},p=a=>{switch(a){case"error":return e.jsx(J,{className:"h-3.5 w-3.5 text-red-500"});case"warning":return e.jsx(At,{className:"h-3.5 w-3.5 text-amber-500"});default:return e.jsx(fe,{className:"h-3.5 w-3.5 text-green-500"})}};return e.jsxs("div",{className:"w-80 border-l border-border bg-card flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i(),e.jsx("span",{className:"font-medium",children:"Execution Log"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:v("text-xs px-2 py-0.5 rounded-full",l==="running"&&"bg-amber-500/10 text-amber-500",l==="success"&&"bg-green-500/10 text-green-500",l==="error"&&"bg-red-500/10 text-red-500",l==="idle"&&"bg-muted text-muted-foreground"),children:n()}),e.jsx(k,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:s,children:e.jsx(Se,{className:"h-4 w-4"})})]})]}),e.jsx(ue,{className:"flex-1",children:e.jsx("div",{className:"p-3 space-y-2",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground text-sm",children:[e.jsx(pe,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No logs yet"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Run Now" to execute the workflow'})]}):t.map((a,m)=>e.jsx("div",{className:v("rounded-lg border p-2.5 text-sm",a.level==="error"&&"border-red-500/30 bg-red-500/5",a.level==="warning"&&"border-amber-500/30 bg-amber-500/5",a.level==="info"&&"border-border bg-background"),children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"mt-0.5",children:p(a.level)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:c(a.time)})}),e.jsx("p",{className:v("text-sm break-words",a.level==="error"&&"text-red-500",a.level==="warning"&&"text-amber-500"),children:a.message})]})]})},m))})}),t.length>0&&e.jsx("div",{className:"border-t border-border px-4 py-2 text-xs text-muted-foreground",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[t.length," log entries"]}),e.jsxs("span",{children:[t.filter(a=>a.level==="error").length," errors"]})]})})]})}let Me=0;const rs=()=>`node_${Me++}`;function as(){const{id:t}=Qt(),l=Vt(),s=st(),i=u.useRef(null),{screenToFlowPosition:n}=we(),{name:c,nodes:p,edges:a,selectedNodeId:m,isModified:g,setWorkflow:C,setName:N,onNodesChange:ee,onEdgesChange:G,onConnect:H,addNode:D,selectNode:j,selectEdge:I,deleteSelected:B,markSaved:K,resetWorkflow:F}=me(),[O,P]=u.useState(!1),[R,U]=u.useState(!1),[te,q]=u.useState([]),[S,w]=u.useState("idle"),{isLoading:E,data:x}=He({queryKey:z.workflow(Number(t)),queryFn:()=>Xe(Number(t)),enabled:!!t});u.useEffect(()=>{if(x){const o=x.edges.map(b=>({...b,type:"insertable",animated:!0}));C({id:x.id,name:x.name,description:x.description||"",nodes:x.nodes,edges:o}),P(x.is_active),Me=Math.max(0,...x.nodes.map(b=>{const f=b.id.match(/node_(\d+)/);return f?parseInt(f[1]):0}))+1}},[x,C]),u.useEffect(()=>()=>{F()},[F]);const y=Y({mutationFn:()=>Ke(Number(t),{name:c,nodes:p,edges:a}),onSuccess:()=>{K(),s.invalidateQueries({queryKey:z.workflows()}),h.success("Workflow saved")},onError:o=>{h.error(o.message)}}),T=Y({mutationFn:()=>_e(Number(t)),onSuccess:()=>{P(!0),s.invalidateQueries({queryKey:z.workflow(Number(t))}),h.success("Workflow activated")},onError:o=>{h.error(o.message)}}),Q=Y({mutationFn:()=>ze(Number(t)),onSuccess:()=>{P(!1),s.invalidateQueries({queryKey:z.workflow(Number(t))}),h.success("Workflow deactivated")},onError:o=>{h.error(o.message)}}),_=Y({mutationFn:()=>(w("running"),q([]),U(!0),Ye(Number(t))),onSuccess:o=>{w(o.status==="success"?"success":"error"),o.logs&&q(o.logs),o.status==="success"?h.success(o.message||"Execution completed"):h.error(o.message||"Execution failed")},onError:o=>{w("error"),q([{time:new Date().toISOString(),message:o.message,level:"error"}]),h.error(o.message)}});u.useEffect(()=>{const o=d=>{const b=d.target;b.tagName==="INPUT"||b.tagName==="TEXTAREA"||b.isContentEditable||((d.key==="Delete"||d.key==="Backspace")&&m&&(d.preventDefault(),B()),(d.ctrlKey||d.metaKey)&&d.key==="s"&&(d.preventDefault(),g&&!y.isPending&&y.mutate()),d.key==="Escape"&&j(null))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[m,B,j,g,y]);const se=u.useCallback((o,d)=>{o.dataTransfer.setData("application/reactflow",d),o.dataTransfer.effectAllowed="move"},[]),re=u.useCallback(o=>{o.preventDefault(),o.dataTransfer.dropEffect="move"},[]),ae=u.useCallback(o=>{o.preventDefault();const d=o.dataTransfer.getData("application/reactflow");if(!d||!i.current)return;const b=n({x:o.clientX,y:o.clientY}),f=Te[d]||{},Ie={id:rs(),type:d,position:b,data:{...f}};D(Ie)},[n,D]),oe=u.useCallback((o,d)=>{j(d.id)},[j]),ie=u.useCallback(()=>{j(null)},[j]),M=u.useCallback((o,d)=>{I(d.id)},[I]),De=u.useCallback(async()=>{try{const o=await $e(Number(t)),d=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),b=URL.createObjectURL(d),f=document.createElement("a");f.href=b,f.download=`${o.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(b),h.success("Workflow exported")}catch(o){h.error(o instanceof Error?o.message:"Export failed")}},[t]);return E?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsx(X,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"flex h-screen flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-border bg-card px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>l("/flow"),children:e.jsx(Lt,{className:"h-4 w-4"})}),e.jsx(Oe,{value:c,onChange:o=>N(o.target.value),className:"h-8 w-64 border-transparent bg-transparent px-2 font-medium hover:border-border focus:border-border"}),g&&e.jsx("span",{className:"text-xs text-muted-foreground",children:"Unsaved"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>y.mutate(),disabled:y.isPending||!g,children:[y.isPending?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Wt,{className:"mr-2 h-4 w-4"}),"Save"]}),O?e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>Q.mutate(),disabled:Q.isPending,children:[Q.isPending?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Gt,{className:"mr-2 h-4 w-4"}),"Deactivate"]}):e.jsxs(k,{size:"sm",onClick:()=>T.mutate(),disabled:T.isPending,children:[T.isPending?e.jsx(X,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(Bt,{className:"mr-2 h-4 w-4"}),"Activate"]}),e.jsxs(ve,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",children:e.jsx(Ft,{className:"h-4 w-4"})})}),e.jsxs(Ce,{align:"end",children:[e.jsx(Z,{onClick:()=>_.mutate(),disabled:_.isPending,children:"Run Now"}),e.jsxs(Z,{onClick:()=>U(!R),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),R?"Hide Logs":"Show Logs"]}),e.jsxs(Z,{onClick:De,children:[e.jsx(Rt,{className:"mr-2 h-4 w-4"}),"Export Workflow"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-56 flex-shrink-0",children:e.jsx(Jt,{onDragStart:se})}),e.jsx("div",{ref:i,className:"flex-1",children:e.jsxs(Re,{nodes:p,edges:a,onNodesChange:ee,onEdgesChange:G,onConnect:H,onNodeClick:oe,onEdgeClick:M,onPaneClick:ie,onDragOver:re,onDrop:ae,nodeTypes:zt,edgeTypes:Zt,fitView:!0,snapToGrid:!0,snapGrid:[16,16],deleteKeyCode:null,defaultEdgeOptions:{type:"insertable",animated:!0},children:[e.jsx(Ue,{gap:16,size:1}),e.jsx(qe,{}),e.jsx(Qe,{nodeStrokeWidth:3,pannable:!0,zoomable:!0}),e.jsx(Ve,{position:"bottom-center",className:"mb-4",children:e.jsxs("div",{className:v("flex items-center gap-2 rounded-lg border border-border bg-card px-3 py-2 text-sm",O&&"border-green-500/30 bg-green-500/5"),children:[e.jsx("div",{className:v("h-2 w-2 rounded-full",O?"bg-green-500":"bg-muted-foreground")}),e.jsx("span",{className:"text-muted-foreground",children:O?"Workflow active":"Workflow inactive"})]})})]})}),m&&e.jsx(ts,{}),R&&!m&&e.jsx(ss,{logs:te,status:S,onClose:()=>U(!1)})]})]})}function hs(){return e.jsx(Fe,{children:e.jsx(as,{})})}export{hs as default};
