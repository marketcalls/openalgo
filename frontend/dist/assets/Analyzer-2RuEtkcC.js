import{r as i,j as e}from"./vendor-react-CCyQGCED.js";import{B as N,e as t}from"./index-NHrG-O_Z.js";import{C as d,a as m,b as x,d as c}from"./card-Cn20bp_v.js";import{D as U,b as $,c as P,d as V}from"./dialog-DA9GnjaJ.js";import{I as C}from"./input-BylzFlgY.js";import{L as _}from"./label-_1WWiomg.js";import{T as X,a as q,b,c as l,d as W,e as r}from"./table-Crau903Y.js";import{J as E}from"./json-editor-CV344Puw.js";import{aw as R,u as G,av as Y,T,i as K,ax as Q,z as Z,x as ee}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";import"./index-CCl19WGM.js";import"./index-xqfX1S8Y.js";const se={NSE:"bg-cyan-500/10 text-cyan-600 border-cyan-500/30",NFO:"bg-purple-500/10 text-purple-600 border-purple-500/30",CDS:"bg-blue-500/10 text-blue-600 border-blue-500/30",BSE:"bg-gray-500/10 text-gray-600 border-gray-500/30",BFO:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",BCD:"bg-red-500/10 text-red-600 border-red-500/30",MCX:"bg-primary/10 text-primary border-primary/30",NCDEX:"bg-green-500/10 text-green-600 border-green-500/30"};function je(){const[y,L]=i.useState(null),[z,v]=i.useState(!0),[h,O]=i.useState(""),[u,A]=i.useState(""),[p,B]=i.useState(null),[F,w]=i.useState(!1);i.useEffect(()=>{D()},[]);const D=async(s,a)=>{v(!0);try{const n=new URLSearchParams;s&&n.append("start_date",s),a&&n.append("end_date",a);const f=n.toString()?`/analyzer/api/data?${n}`:"/analyzer/api/data",g=await fetch(f,{credentials:"include"});if(g.ok){const o=await g.json();o.status==="success"&&L(o.data)}}catch{}finally{v(!1)}},I=s=>{s.preventDefault(),D(h,u)},k=()=>{const s=new URLSearchParams;h&&s.append("start_date",h),u&&s.append("end_date",u);const a=s.toString()?`/analyzer/export?${s}`:"/analyzer/export";window.location.href=a},H=s=>{B(s),w(!0)},J=s=>{if(s.api_type==="cancelorder")return`OrderID: ${s.orderid}`;let a=s.symbol||"";return s.quantity&&(a+=` (${s.quantity})`),s.api_type==="placesmartorder"&&s.position_size&&(a+=` [Size: ${s.position_size}]`),a},M=s=>{const a={...s};return delete a.apikey,a};if(z)return e.jsx("div",{className:"container mx-auto py-8 px-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});const j=y?.stats||{total_requests:0,issues:{total:0},symbols:[],sources:[]},S=y?.requests||[];return e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Sandbox Request Monitor"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and validate your sandbox API requests before going live"})]}),e.jsxs(d,{className:"mb-6",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(x,{className:"text-lg flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Filters"]})}),e.jsx(c,{children:e.jsxs("form",{onSubmit:I,className:"grid grid-cols-1 md:grid-cols-4 gap-4 items-end",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"start_date",className:"text-sm font-medium",children:"Start Date"}),e.jsx(C,{id:"start_date",type:"date",value:h,onChange:s=>O(s.target.value),className:"date-input-styled"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{htmlFor:"end_date",className:"text-sm font-medium",children:"End Date"}),e.jsx(C,{id:"end_date",type:"date",value:u,onChange:s=>A(s.target.value),className:"date-input-styled"})]}),e.jsxs("div",{className:"flex gap-2 pt-6",children:[e.jsxs(N,{type:"submit",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"Filter"]}),e.jsxs(N,{type:"button",variant:"secondary",onClick:k,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Export CSV"]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Total Requests"]})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:j.total_requests}),e.jsx(t,{className:"mt-1",children:"Last 24 hours"})]})]}),e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Issues Found"]})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-500",children:j.issues.total}),e.jsx(t,{variant:"secondary",className:"mt-1",children:"Needs Attention"})]})]}),e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Unique Symbols"]})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold",children:j.symbols.length}),e.jsx(t,{variant:"outline",className:"mt-1",children:"Tracked"})]})]}),e.jsxs(d,{children:[e.jsx(m,{className:"pb-2",children:e.jsxs(x,{className:"text-sm font-medium text-muted-foreground flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Active Sources"]})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-3xl font-bold",children:j.sources.length}),e.jsx(t,{variant:"outline",className:"mt-1",children:"Connected"})]})]})]}),e.jsx(d,{children:e.jsx(c,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(q,{children:e.jsxs(b,{children:[e.jsx(l,{children:"Timestamp"}),e.jsx(l,{children:"API Type"}),e.jsx(l,{children:"Source"}),e.jsx(l,{children:"Details"}),e.jsx(l,{children:"Exchange"}),e.jsx(l,{children:"Action"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"View"})]})}),e.jsx(W,{children:S.length===0?e.jsx(b,{children:e.jsx(r,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No requests found"})}):S.map((s,a)=>e.jsxs(b,{className:"hover:bg-muted/50",children:[e.jsx(r,{className:"text-sm",children:s.timestamp}),e.jsx(r,{children:e.jsx(t,{variant:"default",children:s.api_type})}),e.jsx(r,{children:e.jsx(t,{variant:"secondary",className:"truncate max-w-[120px]",children:s.source})}),e.jsx(r,{className:"font-medium",children:J(s)}),e.jsx(r,{children:s.exchange&&e.jsx(t,{className:se[s.exchange]||"",variant:"outline",children:s.exchange})}),e.jsx(r,{children:s.action&&e.jsx(t,{variant:s.action==="BUY"?"default":"destructive",children:s.action})}),e.jsx(r,{children:s.analysis.issues?e.jsxs(t,{variant:"secondary",className:"bg-yellow-500/10 text-yellow-600 border-yellow-500/30",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Error"]}):e.jsxs(t,{variant:"secondary",className:"bg-green-500/10 text-green-600 border-green-500/30",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Success"]})}),e.jsx(r,{children:e.jsxs(N,{size:"sm",onClick:()=>H(s),children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"View"]})})]},a))})]})})})}),e.jsx(U,{open:F,onOpenChange:w,children:e.jsxs($,{className:"max-w-[98vw] w-[98vw] sm:max-w-[98vw] p-4",children:[e.jsx(P,{children:e.jsx(V,{children:"Request Details"})}),p&&(()=>{const s=JSON.stringify(M(p.request_data),null,2),a=JSON.stringify(p.response_data||p.analysis,null,2),n=s.split(`
`).length,f=a.split(`
`).length,g=Math.max(n,f),o=Math.min(Math.max(g*20+24,200),window.innerHeight*.7);return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Request Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50 overflow-auto",style:{height:o},children:e.jsx(E,{value:s,readOnly:!0,lineWrapping:!1})})]}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Response Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50 overflow-auto",style:{height:o},children:e.jsx(E,{value:a,readOnly:!0,lineWrapping:!1})})]})]})})()]})})]})}export{je as default};
