import{r as i,j as e}from"./vendor-react-CCyQGCED.js";import{B as a,e as x,s as r}from"./index-D0023jFM.js";import{s as m}from"./strategy-C-HFlPDr.js";import{A as Q,b as X,a as Z}from"./alert-Dlgyh2fF.js";import{C as j,a as p,b as f,c as y,d as N}from"./card-CDguRyHx.js";import{C as K,b as ee,a as se}from"./collapsible-DcfHjv7p.js";import{D as te,b as ae,c as re,d as ie,e as le,f as ne}from"./dialog-ZgnPSmJp.js";import{S as oe}from"./separator-KBAVEisx.js";import{S as w}from"./skeleton-CAOG8cB0.js";import{T as ce,a as de,b as R,c as n,d as xe,e as o}from"./table-BKP8E0nV.js";import{N as me,aY as he,an as M,V as ge,aW as ue,m as v,a7 as b,_ as je,aZ as pe,T as fe,k as ye,aX as Ne,a3 as we,c as ve}from"./vendor-icons-CCn_k3dF.js";import{d as be,a as Ce,L as C}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function Ie(){const{strategyId:S}=be(),T=Ce(),[s,_]=i.useState(null),[c,k]=i.useState([]),[I,D]=i.useState(!0),[O,A]=i.useState(!1),[L,H]=i.useState(!1),[P,d]=i.useState(!1),[h,U]=i.useState(null),[V,z]=i.useState(!1),[W,F]=i.useState(null),Y=async()=>{if(S)try{D(!0);const t=await m.getStrategy(Number(S));_(t.strategy),k(t.mappings||[])}catch{r.error("Failed to load strategy","strategy"),T("/strategy")}finally{D(!1)}};i.useEffect(()=>{(async()=>{try{const u=await(await fetch("/api/config/host",{credentials:"include"})).json();F(u)}catch{F({host_server:window.location.origin,is_localhost:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"})}})()},[]),i.useEffect(()=>{Y()},[]);const g=async(t,l)=>{try{await navigator.clipboard.writeText(t),U(l),r.success("Copied to clipboard","clipboard"),setTimeout(()=>U(null),2e3)}catch{r.error("Failed to copy","clipboard")}},$=async()=>{if(s)try{A(!0);const t=await m.toggleStrategy(s.id);t.status==="success"?(_({...s,is_active:t.data?.is_active??!s.is_active}),r.success(t.data?.is_active?"Strategy activated":"Strategy deactivated","strategy")):r.error(t.message||"Failed to toggle strategy","strategy")}catch{r.error("Failed to toggle strategy","strategy")}finally{A(!1)}},q=async()=>{if(s)try{H(!0);const t=await m.deleteStrategy(s.id);t.status==="success"?(r.success("Strategy deleted successfully","strategy"),T("/strategy")):r.error(t.message||"Failed to delete strategy","strategy")}catch{r.error("Failed to delete strategy","strategy")}finally{H(!1),d(!1)}},G=async t=>{if(s)try{const l=await m.deleteSymbolMapping(s.id,t);l.status==="success"?(k(c.filter(u=>u.id!==t)),r.success("Symbol mapping deleted","strategy")):r.error(l.message||"Failed to delete mapping","strategy")}catch{r.error("Failed to delete mapping","strategy")}},J=t=>{switch(t){case"LONG":return e.jsx(ve,{className:"h-4 w-4 text-green-500"});case"SHORT":return e.jsx(we,{className:"h-4 w-4 text-red-500"});case"BOTH":return e.jsx(Ne,{className:"h-4 w-4 text-blue-500"});default:return null}},E=t=>({tradingview:"TradingView",amibroker:"Amibroker",python:"Python",metatrader:"Metatrader",excel:"Excel",others:"Others"})[t]||t;if(I)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(w,{className:"h-8 w-32"}),e.jsx(w,{className:"h-48"}),e.jsx(w,{className:"h-64"})]});if(!s)return null;const B=`${W?.host_server||window.location.origin}/strategy/webhook/${s.webhook_id}`;return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(a,{variant:"ghost",asChild:!0,children:e.jsxs(C,{to:"/strategy",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Back to Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[s.name,e.jsx(x,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-muted-foreground",children:[E(s.platform)," â€¢ Created"," ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:s.is_active?"outline":"default",onClick:$,disabled:O,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),O?"Updating...":s.is_active?"Deactivate":"Activate"]}),e.jsxs(a,{variant:"destructive",onClick:()=>d(!0),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsx(f,{children:"Strategy Details"}),e.jsx(y,{children:"Configuration and settings"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(x,{variant:s.is_active?"default":"secondary",className:"mt-1",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(x,{variant:"outline",className:"mt-1",children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[J(s.trading_mode),e.jsx("span",{children:s.trading_mode})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Platform"}),e.jsx("p",{className:"mt-1",children:E(s.platform)})]})]}),s.is_intraday&&s.start_time&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Trading Hours"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("p",{className:"font-mono",children:s.start_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("p",{className:"font-mono",children:s.end_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Square Off"}),e.jsx("p",{className:"font-mono",children:s.squareoff_time})]})]})]})]})]})]}),e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Webhook Configuration"]}),e.jsx(y,{children:"Use this URL to receive trading alerts"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono break-all",children:B}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(B,"url"),children:h==="url"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),s.platform!=="tradingview"&&e.jsxs(K,{open:V,onOpenChange:z,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(a,{variant:"ghost",className:"w-full justify-between",children:[e.jsx("span",{children:"Show Credentials"}),e.jsx(je,{className:"h-4 w-4"})]})}),e.jsxs(se,{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Host URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:window.location.origin}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(window.location.origin,"host"),children:h==="host"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:s.webhook_id}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(s.webhook_id,"webhook_id"),children:h==="webhook_id"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]})]})]}),s.platform==="tradingview"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"TradingView Alert Message Format"]}),e.jsx("pre",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto",children:`{
  "symbol": "{{ticker}}",
  "action": "BUY"
}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use BUY, SELL, SHORT, or COVER for the action field."})]})]})]})]}),e.jsxs(Q,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(X,{children:"Important Notes"}),e.jsx(Z,{children:e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsxs("li",{children:["Orders are processed only when the strategy is ",e.jsx("strong",{children:"active"})]}),s.is_intraday&&e.jsxs("li",{children:["Orders are processed only during trading hours (",s.start_time," -"," ",s.end_time,")"]}),e.jsx("li",{children:"Symbol must be configured in the mappings below to receive orders"}),e.jsx("li",{children:"Use the correct action keywords: BUY, SELL, SHORT, COVER"}),s.trading_mode==="BOTH"&&e.jsxs("li",{children:["In BOTH mode, include ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"position_size"})," ","in your JSON payload"]})]})})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Symbol Mappings"}),e.jsxs(y,{children:["Symbols configured for this strategy (",c.length," total)"]})]}),e.jsx(a,{asChild:!0,children:e.jsxs(C,{to:`/strategy/${s.id}/configure`,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Configure Symbols"]})})]}),e.jsx(N,{children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx(a,{variant:"link",asChild:!0,children:e.jsx(C,{to:`/strategy/${s.id}/configure`,children:"Add your first symbol"})})]}):e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(R,{children:[e.jsx(n,{children:"Symbol"}),e.jsx(n,{children:"Exchange"}),e.jsx(n,{className:"text-right",children:"Quantity"}),e.jsx(n,{children:"Product"}),e.jsx(n,{className:"w-16"})]})}),e.jsx(xe,{children:c.map(t=>e.jsxs(R,{children:[e.jsx(o,{className:"font-medium",children:t.symbol}),e.jsx(o,{children:t.exchange}),e.jsx(o,{className:"text-right",children:t.quantity}),e.jsx(o,{children:e.jsx(x,{variant:"outline",children:t.product_type})}),e.jsx(o,{children:e.jsx(a,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>G(t.id),children:e.jsx(M,{className:"h-4 w-4"})})})]},t.id))})]})})]}),e.jsx(te,{open:P,onOpenChange:d,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Delete Strategy"}),e.jsxs(le,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All symbol mappings will also be deleted.']})]}),e.jsxs(ne,{children:[e.jsx(a,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:q,disabled:L,children:L?"Deleting...":"Delete Strategy"})]})]})})]})}export{Ie as default};
