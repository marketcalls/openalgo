import{r as i,j as e}from"./vendor-react-RhKMXzW9.js";import{B as a,e as m,t as r}from"./index-VXMZv-HQ.js";import{s as n}from"./strategy-CYwqIlZT.js";import{A as Q,b as $,a as G}from"./alert-BkjSMqKh.js";import{C as u,b as j,c as p,d as f,a as y}from"./card-BBNb6tnJ.js";import{C as K,b as X,a as Z}from"./collapsible-CVvMrHJf.js";import{D as ee,b as se,c as te,d as ae,e as re,f as ie}from"./dialog-BPHT0YZK.js";import{S as le}from"./separator-206SBlgn.js";import{S as N}from"./skeleton-BPjZAwP1.js";import{T as ne,a as ce,b as B,c,d as oe,e as o}from"./table-ChBrfTjB.js";import{A as de,aJ as xe,ac as E,P as me,aH as he,s as v,a2 as b,Q as ge,aK as ue,T as je,i as pe,aI as fe,_ as ye,c as Ne}from"./vendor-icons-Ca5eNZvr.js";import{c as ve,a as be,L as w}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-DzupMptF.js";import"./vendor-radix-gKv__6YA.js";function Ee(){const{strategyId:C}=ve(),S=be(),[s,T]=i.useState(null),[d,k]=i.useState([]),[R,_]=i.useState(!0),[D,O]=i.useState(!1),[A,F]=i.useState(!1),[I,x]=i.useState(!1),[h,L]=i.useState(null),[M,P]=i.useState(!1),z=async()=>{if(C)try{_(!0);const t=await n.getStrategy(Number(C));T(t.strategy),k(t.mappings||[])}catch(t){console.error("Failed to fetch strategy:",t),r.error("Failed to load strategy"),S("/strategy")}finally{_(!1)}};i.useEffect(()=>{z()},[]);const g=async(t,l)=>{try{await navigator.clipboard.writeText(t),L(l),r.success("Copied to clipboard"),setTimeout(()=>L(null),2e3)}catch{r.error("Failed to copy")}},V=async()=>{if(s)try{O(!0);const t=await n.toggleStrategy(s.id);t.status==="success"?(T({...s,is_active:t.data?.is_active??!s.is_active}),r.success(t.data?.is_active?"Strategy activated":"Strategy deactivated")):r.error(t.message||"Failed to toggle strategy")}catch(t){console.error("Failed to toggle strategy:",t),r.error("Failed to toggle strategy")}finally{O(!1)}},W=async()=>{if(s)try{F(!0);const t=await n.deleteStrategy(s.id);t.status==="success"?(r.success("Strategy deleted successfully"),S("/strategy")):r.error(t.message||"Failed to delete strategy")}catch(t){console.error("Failed to delete strategy:",t),r.error("Failed to delete strategy")}finally{F(!1),x(!1)}},q=async t=>{if(s)try{const l=await n.deleteSymbolMapping(s.id,t);l.status==="success"?(k(d.filter(J=>J.id!==t)),r.success("Symbol mapping deleted")):r.error(l.message||"Failed to delete mapping")}catch(l){console.error("Failed to delete mapping:",l),r.error("Failed to delete mapping")}},Y=t=>{switch(t){case"LONG":return e.jsx(Ne,{className:"h-4 w-4 text-green-500"});case"SHORT":return e.jsx(ye,{className:"h-4 w-4 text-red-500"});case"BOTH":return e.jsx(fe,{className:"h-4 w-4 text-blue-500"});default:return null}},H=t=>({tradingview:"TradingView",amibroker:"Amibroker",python:"Python",metatrader:"Metatrader",excel:"Excel",others:"Others"})[t]||t;if(R)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(N,{className:"h-8 w-32"}),e.jsx(N,{className:"h-48"}),e.jsx(N,{className:"h-64"})]});if(!s)return null;const U=n.getWebhookUrl(s.webhook_id);return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(a,{variant:"ghost",asChild:!0,children:e.jsxs(w,{to:"/strategy",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Back to Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[s.name,e.jsx(m,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-muted-foreground",children:[H(s.platform)," â€¢ Created"," ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:s.is_active?"outline":"default",onClick:V,disabled:D,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),D?"Updating...":s.is_active?"Deactivate":"Activate"]}),e.jsxs(a,{variant:"destructive",onClick:()=>x(!0),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsx(p,{children:"Strategy Details"}),e.jsx(f,{children:"Configuration and settings"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(m,{variant:s.is_active?"default":"secondary",className:"mt-1",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(m,{variant:"outline",className:"mt-1",children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[Y(s.trading_mode),e.jsx("span",{children:s.trading_mode})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Platform"}),e.jsx("p",{className:"mt-1",children:H(s.platform)})]})]}),s.is_intraday&&s.start_time&&e.jsxs(e.Fragment,{children:[e.jsx(le,{}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Trading Hours"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("p",{className:"font-mono",children:s.start_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("p",{className:"font-mono",children:s.end_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Square Off"}),e.jsx("p",{className:"font-mono",children:s.squareoff_time})]})]})]})]})]})]}),e.jsxs(u,{children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5"}),"Webhook Configuration"]}),e.jsx(f,{children:"Use this URL to receive trading alerts"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono break-all",children:U}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(U,"url"),children:h==="url"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),s.platform!=="tradingview"&&e.jsxs(K,{open:M,onOpenChange:P,children:[e.jsx(X,{asChild:!0,children:e.jsxs(a,{variant:"ghost",className:"w-full justify-between",children:[e.jsx("span",{children:"Show Credentials"}),e.jsx(ge,{className:"h-4 w-4"})]})}),e.jsxs(Z,{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Host URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:window.location.origin}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(window.location.origin,"host"),children:h==="host"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:s.webhook_id}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(s.webhook_id,"webhook_id"),children:h==="webhook_id"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]})]})]}),s.platform==="tradingview"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"TradingView Alert Message Format"]}),e.jsx("pre",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto",children:`{
  "symbol": "{{ticker}}",
  "action": "BUY"
}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use BUY, SELL, SHORT, or COVER for the action field."})]})]})]})]}),e.jsxs(Q,{children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx($,{children:"Important Notes"}),e.jsx(G,{children:e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsxs("li",{children:["Orders are processed only when the strategy is ",e.jsx("strong",{children:"active"})]}),s.is_intraday&&e.jsxs("li",{children:["Orders are processed only during trading hours (",s.start_time," -"," ",s.end_time,")"]}),e.jsx("li",{children:"Symbol must be configured in the mappings below to receive orders"}),e.jsx("li",{children:"Use the correct action keywords: BUY, SELL, SHORT, COVER"}),s.trading_mode==="BOTH"&&e.jsxs("li",{children:["In BOTH mode, include ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"position_size"})," ","in your JSON payload"]})]})})]}),e.jsxs(u,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Symbol Mappings"}),e.jsxs(f,{children:["Symbols configured for this strategy (",d.length," total)"]})]}),e.jsx(a,{asChild:!0,children:e.jsxs(w,{to:`/strategy/${s.id}/configure`,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Configure Symbols"]})})]}),e.jsx(y,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx(a,{variant:"link",asChild:!0,children:e.jsx(w,{to:`/strategy/${s.id}/configure`,children:"Add your first symbol"})})]}):e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs(B,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{className:"text-right",children:"Quantity"}),e.jsx(c,{children:"Product"}),e.jsx(c,{className:"w-16"})]})}),e.jsx(oe,{children:d.map(t=>e.jsxs(B,{children:[e.jsx(o,{className:"font-medium",children:t.symbol}),e.jsx(o,{children:t.exchange}),e.jsx(o,{className:"text-right",children:t.quantity}),e.jsx(o,{children:e.jsx(m,{variant:"outline",children:t.product_type})}),e.jsx(o,{children:e.jsx(a,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>q(t.id),children:e.jsx(E,{className:"h-4 w-4"})})})]},t.id))})]})})]}),e.jsx(ee,{open:I,onOpenChange:x,children:e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Delete Strategy"}),e.jsxs(re,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All symbol mappings will also be deleted.']})]}),e.jsxs(ie,{children:[e.jsx(a,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:W,disabled:A,children:A?"Deleting...":"Delete Strategy"})]})]})})]})}export{Ee as default};
