import{r as t,j as e}from"./vendor-react-CCyQGCED.js";import{B as l,e as Q,s as r}from"./index-a7rEZX68.js";import{s as m}from"./strategy-GdZ1gZk4.js";import{C as $,a as H,b as q,c as _,d as G}from"./card-uB3o9XXI.js";import{P as he,a as ue,b as xe,C as ye,c as ge,d as je,e as pe,f as be,g as fe}from"./popover-Dg1SAl4H.js";import{D as Se,b as Ne,c as ve,d as Ce,e as Te,f as we}from"./dialog-Btr2P_61.js";import{I as De}from"./input-B4q9vPZa.js";import{L as h}from"./label-B-HzRgzh.js";import{S as z,a as K,b as U,c as X,d as Y}from"./select-Dh5t23Ab.js";import{S as k}from"./skeleton-3VUudCB4.js";import{T as ke,a as Ee,b as J,c,d as Pe,e as i}from"./table-fIxAwQ8o.js";import{T as Ae,a as Fe,b as W,c as Z}from"./tabs-C-wXWMA4.js";import{T as Le}from"./textarea-24JQ4bI2.js";import{E as Ie,g as ee}from"./strategy-B77UYF5_.js";import{N as Re,Y as Be,aI as Me,aO as Oe,S as Ve,F as Qe,an as $e}from"./vendor-icons-CCn_k3dF.js";import{d as He,L as qe}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function cs(){const{strategyId:o}=He(),[S,se]=t.useState(null),[d,E]=t.useState([]),[ae,P]=t.useState(!0),[u,x]=t.useState(!1),[N,v]=t.useState(""),[te,A]=t.useState([]),[re,F]=t.useState(!1),[L,I]=t.useState(!1),[y,R]=t.useState(null),[n,C]=t.useState(""),[g,B]=t.useState("1"),[T,j]=t.useState(""),[p,w]=t.useState(""),[le,b]=t.useState(!1),[D,M]=t.useState(null),f=async()=>{if(o)try{P(!0);const s=await m.getStrategy(Number(o));se(s.strategy),E(s.mappings||[])}catch(s){console.error("Failed to fetch strategy:",s),r.error("Failed to load strategy","strategy")}finally{P(!1)}};t.useEffect(()=>{f()},[]);const O=t.useCallback(async s=>{if(s.length<2){A([]);return}try{F(!0);const a=await m.searchSymbols(s,n||void 0);A(a)}catch(a){console.error("Search failed:",a)}finally{F(!1)}},[n]);t.useEffect(()=>{const s=setTimeout(()=>{O(N)},300);return()=>clearTimeout(s)},[N,O]);const ne=s=>{R(s),v(s.symbol),C(s.exchange),I(!1);const a=ee(s.exchange);j(a[0])},oe=async s=>{if(s.preventDefault(),!y){r.error("Please select a symbol","strategy");return}if(!n){r.error("Please select an exchange","strategy");return}if(!g||Number(g)<1){r.error("Quantity must be at least 1","strategy");return}if(!T){r.error("Please select a product type","strategy");return}try{x(!0);const a=await m.addSymbolMapping(Number(o),{symbol:y.symbol,exchange:n,quantity:Number(g),product_type:T});a.status==="success"?(r.success("Symbol added successfully","strategy"),R(null),v(""),C(""),B("1"),j(""),f()):r.error(a.message||"Failed to add symbol","strategy")}catch(a){console.error("Failed to add symbol:",a),r.error("Failed to add symbol","strategy")}finally{x(!1)}},ce=async s=>{if(s.preventDefault(),!p.trim()){r.error("Please enter CSV data","strategy");return}try{x(!0);const a=await m.addBulkSymbols(Number(o),p);if(a.status==="success"){const{added:me=0,failed:V=0}=a.data||{};r.success(`Added ${me} symbols${V>0?`, ${V} failed`:""}`,"strategy"),w(""),f()}else r.error(a.message||"Failed to add symbols","strategy")}catch(a){console.error("Failed to add bulk symbols:",a),r.error("Failed to add symbols","strategy")}finally{x(!1)}},ie=async()=>{if(!(D===null||!o))try{const s=await m.deleteSymbolMapping(Number(o),D);s.status==="success"?(E(d.filter(a=>a.id!==D)),r.success("Symbol removed","strategy")):r.error(s.message||"Failed to remove symbol","strategy")}catch(s){console.error("Failed to delete mapping:",s),r.error("Failed to remove symbol","strategy")}finally{b(!1),M(null)}},de=n?ee(n):[];return ae?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(k,{className:"h-8 w-32"}),e.jsx(k,{className:"h-64"}),e.jsx(k,{className:"h-48"})]}):S?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(l,{variant:"ghost",asChild:!0,children:e.jsxs(qe,{to:`/strategy/${o}`,children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Back to ",S.name]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Configure Symbols"}),e.jsxs("p",{className:"text-muted-foreground",children:["Add symbols to ",S.name]})]}),e.jsxs(l,{variant:"outline",onClick:f,children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs($,{children:[e.jsxs(H,{children:[e.jsx(q,{children:"Add Symbols"}),e.jsx(_,{children:"Add individual symbols or bulk import from CSV"})]}),e.jsx(G,{children:e.jsxs(Ae,{defaultValue:"single",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-2",children:[e.jsxs(W,{value:"single",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Single Symbol"]}),e.jsxs(W,{value:"bulk",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Bulk Import"]})]}),e.jsx(Z,{value:"single",children:e.jsxs("form",{onSubmit:oe,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Symbol"}),e.jsxs(he,{open:L,onOpenChange:I,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(l,{variant:"outline",role:"combobox","aria-expanded":L,className:"w-full justify-between font-normal",children:[y?y.symbol:"Search symbol...",e.jsx(Ve,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(xe,{className:"w-[300px] p-0",align:"start",children:e.jsxs(ye,{children:[e.jsx(ge,{placeholder:"Search symbols...",value:N,onValueChange:v}),e.jsxs(je,{children:[e.jsx(pe,{children:re?"Searching...":"No symbols found."}),e.jsx(be,{children:te.map(s=>e.jsx(fe,{value:s.symbol,onSelect:()=>ne(s),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.symbol}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.name," â€¢ ",s.exchange]})]})},`${s.symbol}-${s.exchange}`))})]})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Exchange"}),e.jsxs(z,{value:n,onValueChange:s=>{C(s),j("")},children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Select exchange"})}),e.jsx(X,{children:Ie.map(s=>e.jsx(Y,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Quantity"}),e.jsx(De,{type:"number",min:"1",value:g,onChange:s=>B(s.target.value),placeholder:"Enter quantity"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Product Type"}),e.jsxs(z,{value:T,onValueChange:j,disabled:!n,children:[e.jsx(K,{children:e.jsx(U,{placeholder:"Select product"})}),e.jsx(X,{children:de.map(s=>e.jsx(Y,{value:s,children:s},s))})]})]})]}),e.jsx(l,{type:"submit",disabled:u,children:u?"Adding...":"Add Symbol"})]})}),e.jsx(Z,{value:"bulk",children:e.jsxs("form",{onSubmit:ce,className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"CSV Data"}),e.jsx(Le,{placeholder:`Symbol,Exchange,Quantity,Product
RELIANCE,NSE,100,CNC
TATAMOTORS,NSE,50,MIS`,value:p,onChange:s=>w(s.target.value),rows:6,maxLength:102400,className:"font-mono text-sm"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Format: Symbol,Exchange,Quantity,Product (one per line, no header row). Max 100KB."})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{type:"submit",disabled:u,children:u?"Importing...":"Import Symbols"}),e.jsx(l,{type:"button",variant:"outline",onClick:()=>w(""),disabled:!p,children:"Clear"})]})]})})]})})]}),e.jsxs($,{children:[e.jsxs(H,{children:[e.jsxs(q,{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-5 w-5"}),"Current Symbol Mappings"]}),e.jsxs(_,{children:[d.length," symbol",d.length!==1?"s":""," configured"]})]}),e.jsx(G,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx("p",{className:"text-sm",children:"Add symbols using the form above."})]}):e.jsxs(ke,{children:[e.jsx(Ee,{children:e.jsxs(J,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{className:"text-right",children:"Quantity"}),e.jsx(c,{children:"Product"}),e.jsx(c,{className:"text-right",children:"Added"}),e.jsx(c,{className:"w-16"})]})}),e.jsx(Pe,{children:d.map(s=>e.jsxs(J,{children:[e.jsx(i,{className:"font-medium",children:s.symbol}),e.jsx(i,{children:e.jsx(Q,{variant:"outline",children:s.exchange})}),e.jsx(i,{className:"text-right",children:s.quantity}),e.jsx(i,{children:e.jsx(Q,{variant:"secondary",children:s.product_type})}),e.jsx(i,{className:"text-right text-muted-foreground text-sm",children:new Date(s.created_at).toLocaleDateString()}),e.jsx(i,{children:e.jsx(l,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>{M(s.id),b(!0)},children:e.jsx($e,{className:"h-4 w-4"})})})]},s.id))})]})})]}),e.jsx(Se,{open:le,onOpenChange:b,children:e.jsxs(Ne,{children:[e.jsxs(ve,{children:[e.jsx(Ce,{children:"Remove Symbol"}),e.jsx(Te,{children:"Are you sure you want to remove this symbol from the strategy? This action cannot be undone."})]}),e.jsxs(we,{children:[e.jsx(l,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:ie,children:"Remove Symbol"})]})]})})]}):null}export{cs as default};
