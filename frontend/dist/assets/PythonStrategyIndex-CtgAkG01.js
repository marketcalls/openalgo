import{r as i,j as e}from"./vendor-react-RhKMXzW9.js";import{B as r,e as T,D as W,h as q,i as K,j as y,k as Y,t as a}from"./index-WpcxHFS3.js";import{p as n}from"./python-strategy-BUJyIbhy.js";import{A as Z,a as G}from"./alert-IHeA4air.js";import{C as o,a as h,b as J,c as Q,d as X}from"./card-DZNVqDal.js";import{D as ee,b as se,c as te,d as ae,e as re,f as le}from"./dialog-Dp5H77tK.js";import{S as g}from"./skeleton-DPJIIDtx.js";import{R as ne,av as _,aL as S,aE as L,ai as b,P as ie,aM as ce,p as de,i as oe,ac as he,T as me,aD as ue,aN as xe,F as je}from"./vendor-icons-Ca5eNZvr.js";import{a as pe,L as f}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-DzupMptF.js";import"./vendor-radix-gKv__6YA.js";const ge=[{value:"mon",label:"Monday"},{value:"tue",label:"Tuesday"},{value:"wed",label:"Wednesday"},{value:"thu",label:"Thursday"},{value:"fri",label:"Friday"},{value:"sat",label:"Saturday"},{value:"sun",label:"Sunday"}],fe={running:"bg-green-500",stopped:"bg-gray-500",error:"bg-red-500",scheduled:"bg-blue-500"},Ne={running:"Running",stopped:"Stopped",error:"Error",scheduled:"Scheduled"};function Le(){const w=pe(),[d,C]=i.useState([]),[N,E]=i.useState(null),[A,D]=i.useState(!0),[x,l]=i.useState(null),[R,j]=i.useState(!1),[m,k]=i.useState(null),[M,z]=i.useState(new Date),c=async()=>{try{D(!0);const[s,t]=await Promise.all([n.getStrategies(),n.getMasterContractStatus()]);C(s),E(t)}catch(s){console.error("Failed to fetch data:",s),a.error("Failed to load strategies")}finally{D(!1)}};i.useEffect(()=>{c();const s=setInterval(()=>z(new Date),1e3);return()=>clearInterval(s)},[]);const P=async s=>{try{l(s.id);const t=await n.startStrategy(s.id);t.status==="success"?(a.success(`Strategy ${s.name} started`),c()):a.error(t.message||"Failed to start strategy")}catch(t){console.error("Failed to start strategy:",t),a.error("Failed to start strategy")}finally{l(null)}},U=async s=>{try{l(s.id);const t=await n.stopStrategy(s.id);t.status==="success"?(a.success(`Strategy ${s.name} stopped`),c()):a.error(t.message||"Failed to stop strategy")}catch(t){console.error("Failed to stop strategy:",t),a.error("Failed to stop strategy")}finally{l(null)}},$=async s=>{try{l(s.id);const t=await n.clearError(s.id);t.status==="success"?(a.success("Error cleared"),c()):a.error(t.message||"Failed to clear error")}catch(t){console.error("Failed to clear error:",t),a.error("Failed to clear error")}finally{l(null)}},O=async s=>{try{l(s.id);const t=await n.unscheduleStrategy(s.id);t.status==="success"?(a.success("Schedule removed"),c()):a.error(t.message||"Failed to remove schedule")}catch(t){console.error("Failed to unschedule:",t),a.error("Failed to remove schedule")}finally{l(null)}},I=async()=>{if(m)try{l(m.id);const s=await n.deleteStrategy(m.id);s.status==="success"?(a.success("Strategy deleted"),C(d.filter(t=>t.id!==m.id))):a.error(s.message||"Failed to delete strategy")}catch(s){console.error("Failed to delete strategy:",s),a.error("Failed to delete strategy")}finally{l(null),j(!1),k(null)}},B=async s=>{try{const t=await n.exportStrategy(s.id),p=URL.createObjectURL(t),u=document.createElement("a");u.href=p,u.download=s.file_name,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),a.success("Strategy exported")}catch(t){console.error("Failed to export strategy:",t),a.error("Failed to export strategy")}},H=async()=>{try{l("master");const s=await n.checkAndStartPending();if(s.status==="success"){const t=s.data?.started||0;a.success(`Started ${t} pending strategies`),c()}else a.error(s.message||"Failed to check contracts")}catch(s){console.error("Failed to check contracts:",s),a.error("Failed to check contracts")}finally{l(null)}},V=s=>!s||s.length===0?"":s.length===7?"Every day":s.length===5&&!s.includes("sat")&&!s.includes("sun")?"Weekdays":s.map(t=>ge.find(p=>p.value===t)?.label.slice(0,3)||t).join(", "),F=s=>s?new Date(s).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"}):"-",v={total:d.length,running:d.filter(s=>s.status==="running").length,scheduled:d.filter(s=>s.is_scheduled).length};return A?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(g,{className:"h-8 w-48"}),e.jsx(g,{className:"h-10 w-32"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-4",children:[1,2,3,4].map(s=>e.jsx(g,{className:"h-24"},s))}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(s=>e.jsx(g,{className:"h-64"},s))})]}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Python Strategies"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and run your Python trading scripts"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:c,children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(r,{onClick:()=>w("/python/new"),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Strategy"]})]})]}),e.jsxs("div",{className:"grid gap-4 grid-cols-2 md:grid-cols-4",children:[e.jsx(o,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold",children:v.total})]}),e.jsx(S,{className:"h-8 w-8 text-muted-foreground"})]})})}),e.jsx(o,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Running"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:v.running})]}),e.jsx(L,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Scheduled"}),e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:v.scheduled})]}),e.jsx(b,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(o,{children:e.jsx(h,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Master Contract"}),e.jsx(T,{variant:N?.ready?"default":"secondary",children:N?.ready?"Ready":"Not Ready"})]}),!N?.ready&&e.jsx(r,{size:"sm",variant:"outline",onClick:H,disabled:x==="master",children:"Check"})]})})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ie,{className:"h-4 w-4"}),"Current IST: ",M.toLocaleString("en-IN",{timeZone:"Asia/Kolkata"})]}),d.length===0?e.jsx(o,{className:"py-12",children:e.jsxs(h,{className:"flex flex-col items-center justify-center text-center",children:[e.jsx(S,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Python Strategies"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Upload your first Python trading script to get started."}),e.jsxs(r,{onClick:()=>w("/python/new"),children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Strategy"]})]})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:d.map(s=>e.jsxs(o,{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-0 left-0 right-0 h-1 ${fe[s.status]}`}),e.jsx(J,{className:"pb-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Q,{className:"text-lg",children:s.name}),e.jsx(X,{className:"font-mono text-xs",children:s.file_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{variant:s.status==="running"?"default":"secondary",className:s.status==="running"?"bg-green-500":"",children:Ne[s.status]}),e.jsxs(W,{children:[e.jsx(q,{asChild:!0,children:e.jsx(r,{variant:"ghost",size:"icon",children:e.jsx(ce,{className:"h-4 w-4"})})}),e.jsxs(K,{align:"end",children:[e.jsxs(y,{onClick:()=>B(s),children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsx(y,{asChild:!0,children:e.jsxs(f,{to:`/python/${s.id}/env`,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Environment Variables"]})}),e.jsx(Y,{}),e.jsxs(y,{className:"text-red-500",disabled:s.status==="running",onClick:()=>{k(s),j(!0)},children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]})}),e.jsxs(h,{className:"space-y-4",children:[s.is_scheduled&&e.jsxs("div",{className:"text-sm p-2 bg-blue-50 dark:bg-blue-950 rounded",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-4 w-4 text-blue-500"}),e.jsxs("span",{children:[s.schedule_start_time,s.schedule_stop_time&&` - ${s.schedule_stop_time}`]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:V(s.schedule_days)})]}),s.status==="error"&&s.error_message&&e.jsxs(Z,{variant:"destructive",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsxs(G,{className:"text-xs",children:[s.error_message,e.jsx(r,{variant:"link",size:"sm",className:"p-0 h-auto ml-2",onClick:()=>$(s),children:"Clear"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Last Started"}),e.jsx("span",{children:F(s.last_started)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block",children:"Last Stopped"}),e.jsx("span",{children:F(s.last_stopped)})]})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[s.status==="running"?e.jsxs(r,{variant:"destructive",size:"sm",className:"flex-1",onClick:()=>U(s),disabled:x===s.id,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Stop"]}):e.jsxs(r,{variant:"default",size:"sm",className:"flex-1 bg-green-600 hover:bg-green-700",onClick:()=>P(s),disabled:x===s.id,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Start"]}),s.is_scheduled?e.jsx(r,{variant:"outline",size:"sm",onClick:()=>O(s),disabled:x===s.id||s.status==="running",children:e.jsx(xe,{className:"h-4 w-4"})}):e.jsx(r,{variant:"outline",size:"sm",asChild:!0,disabled:s.status==="running",children:e.jsx(f,{to:`/python/${s.id}/schedule`,children:e.jsx(b,{className:"h-4 w-4"})})}),e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(f,{to:`/python/${s.id}/logs`,children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx(r,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(f,{to:`/python/${s.id}/edit`,children:e.jsx(S,{className:"h-4 w-4"})})})]})]})]},s.id))}),e.jsx(ee,{open:R,onOpenChange:j,children:e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Delete Strategy"}),e.jsxs(re,{children:['Are you sure you want to delete "',m?.name,'"? This will remove the strategy file and all associated logs.']})]}),e.jsxs(le,{children:[e.jsx(r,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:I,children:"Delete Strategy"})]})]})})]})}export{Le as default};
