import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{w as Y,t as S,B as m,e as u}from"./index-DkJQVPSR.js";import{C as g,b as $,c as z,a as f}from"./card-Dz9sxSkS.js";import{C as Q,b as W,a as X}from"./collapsible-CVvMrHJf.js";import{I as j}from"./input-BiFbwWbt.js";import{J as C}from"./json-editor-H54zhw23.js";import{A as Z,F as L,R as G,p as K,ai as R,S as ee,Z as se,a9 as ae,aa as te,ab as re,Y as ne,a3 as le,x as ie}from"./vendor-icons-Ca5eNZvr.js";import{L as de}from"./vendor-router-DdyOoyPF.js";import"./vendor-radix-gKv__6YA.js";function je(){const[N,D]=r.useState([]),[i,P]=r.useState(1),[n,p]=r.useState(1),[x,E]=r.useState(!0),[b,v]=r.useState(!1),[d,q]=r.useState(""),[c,_]=r.useState(""),[o,B]=r.useState(""),[T,k]=r.useState(new Set),l=r.useCallback(async(s=1)=>{try{const a=new URLSearchParams;a.append("page",s.toString()),d&&a.append("start_date",d),c&&a.append("end_date",c),o&&a.append("search",o);const t=await Y.get(`/logs/?${a.toString()}`,{headers:{"X-Requested-With":"XMLHttpRequest"}});D(Array.isArray(t.data.logs)?t.data.logs:[]),P(t.data.total_pages||1),p(t.data.current_page||1)}catch(a){console.error("Error fetching logs:",a),S.error("Failed to load logs")}finally{E(!1),v(!1)}},[d,c,o]);r.useEffect(()=>{l()},[l]),r.useEffect(()=>{const s=setTimeout(()=>{x||(p(1),l(1))},300);return()=>clearTimeout(s)},[l,x]);const A=async()=>{v(!0),await l(n),S.success("Logs refreshed")},M=()=>{const s=new URLSearchParams;d&&s.append("start_date",d),c&&s.append("end_date",c),o&&s.append("search",o),window.open(`/logs/export?${s.toString()}`,"_blank")},y=()=>{p(1),l(1)},U=s=>{k(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},J=s=>{switch(s){case"placeorder":return"bg-blue-500 hover:bg-blue-600";case"placesmartorder":return"bg-purple-500 hover:bg-purple-600";case"modifyorder":return"bg-yellow-500 hover:bg-yellow-600";case"cancelorder":return"bg-red-500 hover:bg-red-600";case"closeposition":return"bg-green-500 hover:bg-green-600";default:return"bg-gray-500 hover:bg-gray-600"}},O=()=>{if(i<=1)return null;const s=[];if(i<=5)for(let t=1;t<=i;t++)s.push(t);else{s.push(1),n>3&&s.push("...");for(let t=Math.max(2,n-1);t<=Math.min(i-1,n+1);t++)s.includes(t)||s.push(t);n<i-2&&s.push("..."),s.includes(i)||s.push(i)}return e.jsxs("div",{className:"flex items-center justify-center gap-1 mt-6",children:[e.jsx(m,{variant:"outline",size:"icon",onClick:()=>l(n-1),disabled:n<=1,children:e.jsx(le,{className:"h-4 w-4"})}),s.map((t,h)=>e.jsx(m,{variant:t===n?"default":"outline",size:"sm",onClick:()=>typeof t=="number"&&l(t),disabled:typeof t!="number",children:t},h)),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>l(n+1),disabled:n>=i,children:e.jsx(ie,{className:"h-4 w-4"})})]})};return x?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(de,{to:"/logs",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(L,{className:"h-6 w-6"}),"Live Trading Logs"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"View and search your real-time API trading logs"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:A,disabled:b,children:[e.jsx(G,{className:`h-4 w-4 mr-2 ${b?"animate-spin":""}`}),"Refresh"]}),e.jsxs(m,{onClick:M,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Export to CSV"]})]})]}),e.jsxs(g,{children:[e.jsx($,{className:"pb-3",children:e.jsx(z,{className:"text-lg",children:"Filters"})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Start Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{type:"date",value:d,onChange:s=>q(s.target.value),onBlur:y,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"End Date"}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{type:"date",value:c,onChange:s=>_(s.target.value),onBlur:y,className:"pl-10"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{type:"text",placeholder:"Search logs...",value:o,onChange:s=>B(s.target.value),className:"pl-10"})]})]})]})})]}),e.jsx("div",{className:"space-y-4",children:N.length===0?e.jsx(g,{children:e.jsxs(f,{className:"py-16 text-center text-muted-foreground",children:[e.jsx(L,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No logs found for the selected date range"})]})}):N.map(s=>{const a=s.request_data||{},t=T.has(s.id);return e.jsx(g,{className:"hover:shadow-md transition-shadow",children:e.jsxs(f,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(u,{className:J(s.api_type),children:s.api_type}),e.jsxs(u,{variant:"outline",className:"gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),s.strategy]}),a.action?e.jsxs(u,{variant:String(a.action)==="BUY"?"default":"destructive",className:`gap-1 ${String(a.action)==="BUY"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:[String(a.action)==="BUY"?e.jsx(ae,{className:"h-3 w-3"}):e.jsx(te,{className:"h-3 w-3"}),String(a.action)]}):null,a.exchange?e.jsx(u,{variant:"secondary",children:String(a.exchange)}):null,e.jsx(u,{variant:"outline",className:"text-muted-foreground",children:s.created_at})]}),a.symbol||a.quantity||a.price||a.product?e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 mb-4",children:[a.symbol?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Symbol"}),e.jsx("p",{className:"font-semibold",children:String(a.symbol)})]}):null,a.quantity?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Quantity"}),e.jsx("p",{className:"font-semibold",children:String(a.quantity)})]}):null,a.price&&String(a.price)!=="0"?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Price"}),e.jsx("p",{className:"font-semibold",children:String(a.price)})]}):null,a.product?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Product"}),e.jsx("p",{className:"font-semibold",children:String(a.product)})]}):null,a.pricetype?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Price Type"}),e.jsx("p",{className:"font-semibold",children:String(a.pricetype)})]}):null,a.orderid?e.jsxs("div",{className:"bg-muted rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Order ID"}),e.jsx("p",{className:"font-semibold text-sm truncate",children:String(a.orderid)})]}):null]}):null,e.jsxs(Q,{open:t,onOpenChange:()=>U(s.id),children:[e.jsx(W,{asChild:!0,children:e.jsxs(m,{variant:"ghost",className:"w-full justify-between bg-muted hover:bg-muted/80",children:["View Request/Response Data",t?e.jsx(re,{className:"h-4 w-4"}):e.jsx(ne,{className:"h-4 w-4"})]})}),e.jsx(X,{className:"mt-4 space-y-4",children:(()=>{const h=JSON.stringify(a,null,2),w=JSON.stringify(s.response_data,null,2),F=h.split(`
`).length,V=w.split(`
`).length,H=Math.min(Math.max(F*20+24,120),600),I=Math.min(Math.max(V*20+24,120),600);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Request Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50",style:{height:H},children:e.jsx(C,{value:h,readOnly:!0,lineWrapping:!1})})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Response Data"}),e.jsx("div",{className:"rounded-lg border bg-card/50",style:{height:I},children:e.jsx(C,{value:w,readOnly:!0,lineWrapping:!1})})]})]})})()})]})]})},s.id)})}),O()]})}export{je as default};
