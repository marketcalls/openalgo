import{r as t,j as e}from"./vendor-react-CCyQGCED.js";import{s as i,B as r,e as m}from"./index-NHrG-O_Z.js";import{a as b}from"./admin-U6yPFyvv.js";import{A as se,b as ae,c as ne,d as le,e as te,f as ie,g as ce,h as de}from"./alert-dialog-DP5Vbj8e.js";import{C as N,d as _,a as re,b as oe,c as he}from"./card-Cn20bp_v.js";import{C as xe}from"./checkbox-CdehzPk_.js";import{D as me,b as ge,c as pe,d as ue,e as je,f as fe}from"./dialog-DA9GnjaJ.js";import{I as S}from"./input-BylzFlgY.js";import{L as u}from"./label-_1WWiomg.js";import{S as H,a as T,b as w,c as I,d as E}from"./select-DcHsBqkV.js";import{T as ye,a as Ne,b as L,c as g,d as _e,e as o}from"./table-Crau903Y.js";import{N as Se,as as ve,aI as De,a8 as Ae,n as Ce,an as z}from"./vendor-icons-CCn_k3dF.js";import{L as be}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";const He=[{value:"TRADING_HOLIDAY",label:"Trading Holiday"},{value:"SETTLEMENT_HOLIDAY",label:"Settlement Holiday"},{value:"SPECIAL_SESSION",label:"Special Session"}];function Ve(){const[h,M]=t.useState([]),[v,B]=t.useState([]),[j,V]=t.useState([]),[c,D]=t.useState(new Date().getFullYear()),[$,k]=t.useState(!0),[W,f]=t.useState(!1),[n,d]=t.useState({date:"",description:"",holiday_type:"TRADING_HOLIDAY",closed_exchanges:[],open_exchanges:[]}),[O,Y]=t.useState(!1),[p,A]=t.useState(null),[P,R]=t.useState(!1);t.useEffect(()=>{C(c)},[c]);const C=async s=>{k(!0);try{const a=await b.getHolidays(s);M(a.data),B(a.years),V(a.exchanges)}catch{i.error("Failed to load holidays","admin")}finally{k(!1)}},F=(s,a)=>{const[l,y]=a.split(":").map(Number),x=new Date(s+"T00:00:00+05:30");return x.setHours(l,y,0,0),x.getTime()},q=async()=>{if(!n.date||!n.description){i.error("Please fill in date and description","admin");return}if(n.holiday_type==="TRADING_HOLIDAY"&&n.closed_exchanges.length===0){i.error("Please select at least one exchange to close","admin");return}if(n.holiday_type==="SPECIAL_SESSION"){if(n.open_exchanges.length===0){i.error("Please add at least one exchange with timings","admin");return}for(const s of n.open_exchanges)if(!s.start_time||!s.end_time){i.error(`Please enter start and end time for ${s.exchange}`,"admin");return}}Y(!0);try{const s=n.open_exchanges.map(l=>({exchange:l.exchange,start_time:F(n.date,l.start_time),end_time:F(n.date,l.end_time)})),a=await b.addHoliday({date:n.date,description:n.description,holiday_type:n.holiday_type,closed_exchanges:n.closed_exchanges,open_exchanges:n.holiday_type==="SPECIAL_SESSION"?s:void 0});a.status==="success"?(i.success(a.message||"Holiday added successfully","admin"),f(!1),d({date:"",description:"",holiday_type:"TRADING_HOLIDAY",closed_exchanges:[],open_exchanges:[]}),C(c)):i.error(a.message||"Failed to add holiday","admin")}catch(s){const a=s;i.error(a.response?.data?.message||"Failed to add holiday","admin")}finally{Y(!1)}},J=async()=>{if(p){R(!0);try{const s=await b.deleteHoliday(p.id);s.status==="success"?(i.success(s.message||"Holiday deleted successfully","admin"),A(null),C(c)):i.error(s.message||"Failed to delete holiday","admin")}catch(s){const a=s;i.error(a.response?.data?.message||"Failed to delete holiday","admin")}finally{R(!1)}}},K=s=>{d(a=>({...a,closed_exchanges:a.closed_exchanges.includes(s)?a.closed_exchanges.filter(l=>l!==s):[...a.closed_exchanges,s]}))},Q=()=>{d(s=>({...s,closed_exchanges:j}))},U=s=>{n.open_exchanges.find(a=>a.exchange===s)||d(a=>({...a,open_exchanges:[...a.open_exchanges,{exchange:s,start_time:"18:00",end_time:"19:15"}]}))},X=s=>{d(a=>({...a,open_exchanges:a.open_exchanges.filter(l=>l.exchange!==s)}))},G=(s,a,l)=>{d(y=>({...y,open_exchanges:y.open_exchanges.map(x=>x.exchange===s?{...x,[a]:l}:x)}))},Z=()=>{const s=j.filter(a=>!n.open_exchanges.find(l=>l.exchange===a)).map(a=>({exchange:a,start_time:"18:00",end_time:"19:15"}));d(a=>({...a,open_exchanges:[...a.open_exchanges,...s]}))},ee=s=>{switch(s){case"TRADING_HOLIDAY":return e.jsx(m,{variant:"destructive",children:"Trading Holiday"});case"SETTLEMENT_HOLIDAY":return e.jsx(m,{variant:"secondary",children:"Settlement Holiday"});case"SPECIAL_SESSION":return e.jsx(m,{className:"bg-purple-500 hover:bg-purple-600",children:"Special Session"});default:return e.jsx(m,{variant:"outline",children:s})}};return $?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(be,{to:"/admin",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Se,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ve,{className:"h-6 w-6"}),"Market Holidays"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage trading holidays for all supported exchanges"})]}),e.jsxs(r,{onClick:()=>f(!0),children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Add Holiday"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(N,{children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.length}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total Holidays (",c,")"]})]})}),e.jsx(N,{children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.filter(s=>s.holiday_type==="TRADING_HOLIDAY").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Holidays"})]})}),e.jsx(N,{children:e.jsxs(_,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:h.filter(s=>s.holiday_type!=="TRADING_HOLIDAY").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Special Days"})]})})]}),e.jsxs(N,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(oe,{children:"Holiday Calendar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{variant:"outline",size:"icon",onClick:()=>D(s=>s-1),disabled:!v.includes(c-1),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsxs(H,{value:c.toString(),onValueChange:s=>D(parseInt(s,10)),children:[e.jsx(T,{className:"w-[120px]",children:e.jsx(w,{})}),e.jsx(I,{children:v.map(s=>e.jsx(E,{value:s.toString(),children:s},s))})]}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>D(s=>s+1),disabled:!v.includes(c+1),children:e.jsx(Ce,{className:"h-4 w-4"})})]})]}),e.jsxs(he,{children:[h.length," holidays in ",c]})]}),e.jsx(_,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(ye,{children:[e.jsx(Ne,{children:e.jsxs(L,{children:[e.jsx(g,{children:"Date"}),e.jsx(g,{children:"Day"}),e.jsx(g,{children:"Description"}),e.jsx(g,{children:"Type"}),e.jsx(g,{children:"Closed Exchanges"}),e.jsx(g,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(_e,{children:h.length===0?e.jsx(L,{children:e.jsxs(o,{colSpan:6,className:"text-center text-muted-foreground py-8",children:["No holidays configured for ",c]})}):h.map(s=>e.jsxs(L,{children:[e.jsx(o,{className:"font-medium",children:s.date}),e.jsx(o,{children:s.day_name}),e.jsx(o,{children:s.description}),e.jsx(o,{children:ee(s.holiday_type)}),e.jsx(o,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.closed_exchanges.length===0?e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"}):s.closed_exchanges.map(a=>e.jsx(m,{variant:"outline",className:"text-xs",children:a},a))})}),e.jsx(o,{children:e.jsx(r,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>A(s),children:e.jsx(z,{className:"h-4 w-4"})})})]},s.id))})]})})})]}),e.jsx(me,{open:W,onOpenChange:f,children:e.jsxs(ge,{className:"max-w-md",children:[e.jsxs(pe,{children:[e.jsx(ue,{children:"Add Holiday"}),e.jsx(je,{children:"Add a new market holiday entry."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Date"}),e.jsx(S,{type:"date",value:n.date,onChange:s=>d({...n,date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Description"}),e.jsx(S,{placeholder:"e.g., Republic Day",value:n.description,onChange:s=>d({...n,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{children:"Holiday Type"}),e.jsxs(H,{value:n.holiday_type,onValueChange:s=>d({...n,holiday_type:s}),children:[e.jsx(T,{children:e.jsx(w,{})}),e.jsx(I,{children:He.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})]})]}),n.holiday_type==="TRADING_HOLIDAY"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Closed Exchanges"}),e.jsx(r,{variant:"link",size:"sm",className:"h-auto p-0",onClick:Q,children:"Select All"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:j.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xe,{id:s,checked:n.closed_exchanges.includes(s),onCheckedChange:()=>K(s)}),e.jsx("label",{htmlFor:s,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s})]},s))})]}),n.holiday_type==="SPECIAL_SESSION"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(u,{children:"Exchanges with Special Timings"}),e.jsx(r,{variant:"link",size:"sm",className:"h-auto p-0",onClick:Z,children:"Add All"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Set trading hours for each exchange during this special session (e.g., Muhurat Trading 18:00-19:15)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(H,{onValueChange:s=>U(s),value:"",children:[e.jsx(T,{className:"flex-1",children:e.jsx(w,{placeholder:"Select exchange to add..."})}),e.jsx(I,{children:j.filter(s=>!n.open_exchanges.find(a=>a.exchange===s)).map(s=>e.jsx(E,{value:s,children:s},s))})]})}),n.open_exchanges.length>0&&e.jsx("div",{className:"space-y-2 border rounded-md p-3",children:n.open_exchanges.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{variant:"outline",className:"min-w-[50px] justify-center",children:s.exchange}),e.jsx(S,{type:"time",value:s.start_time,onChange:a=>G(s.exchange,"start_time",a.target.value),className:"w-[110px]","aria-label":`Start time for ${s.exchange}`}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(S,{type:"time",value:s.end_time,onChange:a=>G(s.exchange,"end_time",a.target.value),className:"w-[110px]","aria-label":`End time for ${s.exchange}`}),e.jsx(r,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>X(s.exchange),children:e.jsx(z,{className:"h-4 w-4"})})]},s.exchange))})]})]}),e.jsxs(fe,{children:[e.jsx(r,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(r,{onClick:q,disabled:O,children:O?"Adding...":"Add Holiday"})]})]})}),e.jsx(se,{open:!!p,onOpenChange:()=>A(null),children:e.jsxs(ae,{children:[e.jsxs(ne,{children:[e.jsx(le,{children:"Delete Holiday?"}),e.jsxs(te,{children:['Are you sure you want to delete "',p?.description,'" on'," ",p?.date,"? This action cannot be undone."]})]}),e.jsxs(ie,{children:[e.jsx(ce,{children:"Cancel"}),e.jsx(de,{onClick:J,disabled:P,children:P?"Deleting...":"Delete"})]})]})})]})}export{Ve as default};
