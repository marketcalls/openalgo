import{r as m,j as e,a as Ze}from"./vendor-react--vsXx8_n.js";import{v as ke,D as Fe,i as Be,B,j as Re,y as je,z as _e,A as fe,m as Ce,C as Ee,c as j,e as Ue,d as Ve,s as le}from"./index-CsK7LEjJ.js";import{u as et,a as qe}from"./useMarketData-LIMTcZ3_.js";import{g as tt,$ as st,ac as at,aR as rt,aS as nt,R as Oe,c as lt,az as it,aB as ot}from"./vendor-icons-C0P7QAK9.js";import{D as Ae,a as ct,b as ze,c as Ye,d as $e,e as dt,f as Qe,g as ut}from"./dialog-CbbrfEg1.js";import{S as Le}from"./scroll-area-C2rRwt3n.js";import{I as ye}from"./input-ZAa0bom_.js";import{L as te}from"./label-U4BDWSUg.js";import{S as oe,a as ce,b as de,c as ue,d as me}from"./select-BoFvtQv-.js";import{t as Te}from"./trading-ClTHl_JG.js";import{C as mt,b as xt,a as pt}from"./collapsible-BJ9rSfA8.js";import{C as se,d as ae}from"./card-Du5aUwLL.js";import{T as ht,a as ft,b as Se,c as re,d as gt,e as Ne}from"./table-Bn_fVWWF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DkDlinVE.js";function bt(s,t,a,r,c,d={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:i,refreshInterval:h=3e4,pauseWhenHidden:y=!0}=d,{isVisible:v}=et(),[o,n]=m.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),x=m.useRef(null),C=m.useRef(null),f=i&&(!y||v),O=m.useCallback(async()=>{if(!(!s||!t||!a||!r)&&!C.current){n(k=>({...k,isLoading:!0}));try{const k=new AbortController;C.current=k;const _=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:a,expiry_date:r,strike_count:c}),signal:k.signal});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const u=await _.json();u.status==="success"?n(D=>({...D,data:u,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):n(D=>({...D,isLoading:!1,error:u.message||"Failed to fetch option chain"}))}catch(k){k instanceof Error&&(k.name==="AbortError"?C.current===null&&n(_=>({..._,isLoading:!1})):n(_=>({..._,isLoading:!1,error:k.message||"Connection error",isConnected:!1})))}finally{C.current=null}}},[s,t,a,r,c]);m.useEffect(()=>{if(!f){x.current&&(clearInterval(x.current),x.current=null),n(k=>({...k,isPaused:!!i}));return}return n(k=>({...k,isConnected:!0,isPaused:!1})),O(),x.current=setInterval(O,h),()=>{x.current&&(clearInterval(x.current),x.current=null),C.current&&(C.current.abort(),C.current=null)}},[f,O,h,i]);const M=m.useCallback(()=>{O()},[O]);return{...o,refetch:M}}function ne(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function jt(s,t,a,r,c,d,i={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:h,oiRefreshInterval:y=3e4,pauseWhenHidden:v=!0}=i,[o,n]=m.useState(null),[x,C]=m.useState(null),{data:f,isLoading:O,isConnected:M,isPaused:k,error:_,lastUpdate:u,refetch:D}=bt(s,t,a,c,d,{enabled:h,refreshInterval:y,pauseWhenHidden:v}),E=m.useMemo(()=>{const N=[],V=r==="BFO"?"BSE_INDEX":"NSE_INDEX";if(N.push({symbol:t,exchange:V}),f?.chain)for(const X of f.chain)X.ce?.symbol&&N.push({symbol:X.ce.symbol,exchange:r}),X.pe?.symbol&&N.push({symbol:X.pe.symbol,exchange:r});return N},[f?.chain,r,t]),{data:L,isConnected:P,isAuthenticated:g,isPaused:R}=qe({symbols:E,mode:"Depth",enabled:h&&E.length>0,pauseWhenHidden:v}),A=m.useRef(0);m.useEffect(()=>{if(!f){n(null);return}if(L.size===0){n(f);return}const N=f.chain.map(w=>{const G={...w};if(w.ce?.symbol){const q=`${r}:${w.ce.symbol}`,T=L.get(q);if(T?.data){const z=T.data.depth?.buy?.[0],Y=T.data.depth?.sell?.[0],l=w.ce.tick_size;G.ce={...w.ce,ltp:ne(T.data.ltp,l)??w.ce.ltp,bid:ne(z?.price??T.data.bid_price,l)??w.ce.bid,ask:ne(Y?.price??T.data.ask_price,l)??w.ce.ask,bid_qty:z?.quantity??T.data.bid_size??w.ce.bid_qty??0,ask_qty:Y?.quantity??T.data.ask_size??w.ce.ask_qty??0}}}if(w.pe?.symbol){const q=`${r}:${w.pe.symbol}`,T=L.get(q);if(T?.data){const z=T.data.depth?.buy?.[0],Y=T.data.depth?.sell?.[0],l=w.pe.tick_size;G.pe={...w.pe,ltp:ne(T.data.ltp,l)??w.pe.ltp,bid:ne(z?.price??T.data.bid_price,l)??w.pe.bid,ask:ne(Y?.price??T.data.ask_price,l)??w.pe.ask,bid_qty:z?.quantity??T.data.bid_size??w.pe.bid_qty??0,ask_qty:Y?.quantity??T.data.ask_size??w.pe.ask_qty??0}}}return G});let V=!1;for(const[,w]of L)if(w.lastUpdate&&w.lastUpdate>A.current){V=!0,A.current=w.lastUpdate;break}V&&C(new Date);const S=`${r==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${t}`,K=L.get(S)?.data?.ltp??f.underlying_ltp;n({...f,underlying_ltp:K,chain:N})},[f,L,r,t]);const ee=P&&g&&E.length>0,H=k||R,Z=m.useMemo(()=>!u&&!x?null:u?x&&x>u?x:u:x,[u,x]);return{data:o,isLoading:O,isConnected:M,isStreaming:ee,isPaused:H,error:_,lastUpdate:Z,streamingSymbols:E.length,refetch:D}}const U=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],yt=U.map(s=>s.key),Nt=U.filter(s=>s.defaultVisible).map(s=>s.key),W={visibleColumns:Nt,columnOrder:yt,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Xe="openalgo_option_chain_prefs";function vt(){if(typeof window>"u")return W;try{const s=localStorage.getItem(Xe);if(!s)return W;const t=JSON.parse(s),a=new Set(U.map(i=>i.key)),r=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(i=>a.has(i)):W.visibleColumns;r.includes("strike")||r.push("strike");const c=Array.isArray(t.columnOrder)?t.columnOrder.filter(i=>a.has(i)):W.columnOrder,d=new Set(c);return W.columnOrder.forEach(i=>{d.has(i)||c.push(i)}),{visibleColumns:r,columnOrder:c,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:W.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:W.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:W.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:W.barStyle}}catch{return W}}function Ct(s){if(!(typeof window>"u"))try{localStorage.setItem(Xe,JSON.stringify(s))}catch{}}function St(){const[s,t]=m.useState(()=>vt());m.useEffect(()=>{Ct(s)},[s]);const a=m.useCallback(n=>{n!=="strike"&&t(x=>{const f=x.visibleColumns.includes(n)?x.visibleColumns.filter(O=>O!==n):[...x.visibleColumns,n];return{...x,visibleColumns:f}})},[]),r=m.useCallback(n=>{t(x=>({...x,columnOrder:n}))},[]),c=m.useCallback(n=>{t(x=>({...x,strikeCount:n}))},[]),d=m.useCallback(n=>{t(x=>({...x,selectedUnderlying:n}))},[]),i=m.useCallback(n=>{t(x=>({...x,barDataSource:n}))},[]),h=m.useCallback(n=>{t(x=>({...x,barStyle:n}))},[]),y=m.useCallback(()=>{t(W)},[]),v=m.useCallback(n=>s.visibleColumns.includes(n),[s.visibleColumns]),o=m.useCallback(()=>s.columnOrder.filter(n=>s.visibleColumns.includes(n)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:a,reorderColumns:r,setStrikeCount:c,setSelectedUnderlying:d,setBarDataSource:i,setBarStyle:h,resetToDefaults:y,isColumnVisible:v,getOrderedVisibleColumns:o}}const wt={getOptionChain:async(s,t,a,r,c)=>(await ke.post("/optionchain",{apikey:s,underlying:t,exchange:a,expiry_date:r,strike_count:c??20})).data,getExpiries:async(s,t,a,r="options")=>(await ke.post("/expiry",{apikey:s,symbol:t,exchange:a,instrumenttype:r})).data};function Dt({barDataSource:s,barStyle:t,onBarDataSourceChange:a,onBarStyleChange:r}){return e.jsxs(Fe,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs(B,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Re,{align:"end",className:"w-48",children:[e.jsx(je,{children:"Bar Data"}),e.jsxs(_e,{value:s,onValueChange:c=>a(c),children:[e.jsx(fe,{value:"oi",children:"Open Interest"}),e.jsx(fe,{value:"volume",children:"Volume"})]}),e.jsx(Ce,{}),e.jsx(je,{children:"Bar Style"}),e.jsxs(_e,{value:t,onValueChange:c=>r(c),children:[e.jsx(fe,{value:"gradient",children:"Gradient"}),e.jsx(fe,{value:"solid",children:"Solid"})]})]})]})}function kt({visibleColumns:s,onToggleColumn:t,onResetToDefaults:a}){const r=U.filter(i=>i.side==="ce"),c=U.filter(i=>i.side==="pe"),d=i=>s.includes(i);return e.jsxs(Fe,{children:[e.jsx(Be,{asChild:!0,children:e.jsxs(B,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(st,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Re,{align:"end",className:"w-48",children:[e.jsx(je,{children:"CALLS Columns"}),r.map(i=>e.jsx(Ee,{checked:d(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ce,{}),e.jsx(je,{children:"PUTS Columns"}),c.map(i=>e.jsx(Ee,{checked:d(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ce,{}),e.jsxs(B,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:a,children:[e.jsx(at,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Pe({columnKey:s,label:t,side:a,isVisible:r,isDragging:c,onDragStart:d,onDragOver:i,onDrop:h,onDragEnd:y}){return e.jsxs("div",{draggable:!0,onDragStart:v=>d(v,s),onDragOver:i,onDrop:v=>h(v,s),onDragEnd:y,className:j("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",c&&"opacity-50 border-dashed",r?"bg-card":"bg-muted/50 opacity-60",a==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(nt,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:j("text-xs px-1.5 py-0.5 rounded",a==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:a==="ce"?"CE":"PE"})]})}function _t({columnOrder:s,visibleColumns:t,onReorderColumns:a}){const[r,c]=m.useState(s),[d,i]=m.useState(null),[h,y]=m.useState(!1),v=r.filter(u=>U.find(E=>E.key===u)?.side==="ce"),o=r.filter(u=>U.find(E=>E.key===u)?.side==="pe"),n=u=>U.find(E=>E.key===u)?.label??u,x=u=>U.find(E=>E.key===u)?.side==="pe"?"pe":"ce",C=(u,D)=>{i(D),u.dataTransfer.effectAllowed="move",u.dataTransfer.setData("text/plain",D)},f=u=>{u.preventDefault(),u.dataTransfer.dropEffect="move"},O=(u,D)=>{if(u.preventDefault(),!d||d===D)return;const E=x(d),L=x(D);if(E!==L)return;const P=[...r],g=P.indexOf(d),R=P.indexOf(D);P.splice(g,1),P.splice(R,0,d),c(P)},M=()=>{i(null)},k=()=>{a(r),y(!1)},_=u=>{y(u),u&&c(s)};return e.jsxs(Ae,{open:h,onOpenChange:_,children:[e.jsx(ct,{asChild:!0,children:e.jsxs(B,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(rt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(ze,{className:"sm:max-w-md",children:[e.jsxs(Ye,{children:[e.jsx($e,{children:"Reorder Columns"}),e.jsx(dt,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Le,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:v.map(u=>e.jsx(Pe,{columnKey:u,label:n(u),side:"ce",isVisible:t.includes(u),isDragging:d===u,onDragStart:C,onDragOver:f,onDrop:O,onDragEnd:M},u))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Le,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:o.map(u=>e.jsx(Pe,{columnKey:u,label:n(u),side:"pe",isVisible:t.includes(u),isDragging:d===u,onDragStart:C,onDragOver:f,onDrop:O,onDragEnd:M},u))})})]})]}),e.jsxs(Qe,{className:"gap-2 sm:gap-0",children:[e.jsx(ut,{asChild:!0,children:e.jsx(B,{variant:"outline",children:"Cancel"})}),e.jsx(B,{onClick:k,children:"Save Order"})]})]})]})}function Et(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function Ot({exchange:s,ltp:t,prevClose:a,change:r,changePercent:c,bidPrice:d,askPrice:i,bidSize:h,askSize:y,isLoading:v}){const o=r??(t&&a?t-a:void 0),n=c??(o&&a?o/a*100:void 0),x=o!==void 0&&o>=0;return v?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ue,{className:j("text-[10px] px-1.5 py-0",Et(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),o!==void 0&&e.jsxs("span",{className:j("text-sm font-medium",x?"text-green-500":"text-red-500"),children:[x?"+":"",o.toFixed(2),n!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",x?"+":"",n.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:d!==void 0&&d>0?d.toFixed(2):"-"}),h!==void 0&&h>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",h.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:i!==void 0&&i>0?i.toFixed(2):"-"}),y!==void 0&&y>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",y.toLocaleString()]})]})]})]})}function Ie({price:s,quantity:t,maxQty:a,side:r}){const c=a>0?Math.min(t/a*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:j("absolute top-0 bottom-0 transition-all duration-300",r==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${c}%`}})}),e.jsx("span",{className:j("relative z-10 flex-1 font-mono text-xs",r==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function Lt({depth:s,isExpanded:t,onToggle:a,maxLevels:r=5}){const c=s?.buy?.slice(0,r)??[],d=s?.sell?.slice(0,r)??[],i=Math.max(...c.map(o=>o.quantity),1),h=Math.max(...d.map(o=>o.quantity),1),y=Math.max(i,h),v=c.length>0||d.length>0;return e.jsxs(mt,{open:t,onOpenChange:a,children:[e.jsxs(xt,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(pt,{children:v?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:c.length>0?c.map((o,n)=>e.jsx(Ie,{price:o.price,quantity:o.quantity,maxQty:y,side:"buy"},`buy-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:d.length>0?d.map((o,n)=>e.jsx(Ie,{price:o.price,quantity:o.quantity,maxQty:y,side:"sell"},`sell-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:c.reduce((o,n)=>o+n.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:d.reduce((o,n)=>o+n.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}const Tt=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Pt=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],It=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function be(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function ge(s,t,a){const r=be(s,t);return a==="up"?Number((r+t).toFixed(2)):Math.max(0,Number((r-t).toFixed(2)))}function Me(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function Mt({open:s,onOpenChange:t,symbol:a="",exchange:r="",action:c="BUY",quantity:d,lotSize:i=1,tickSize:h=.05,product:y="NRML",priceType:v="MARKET",strategy:o="OptionChain",onSuccess:n,onError:x}){const{apiKey:C}=Ve(),[f,O]=m.useState(c),[M,k]=m.useState(d??i),[_,u]=m.useState(v),[D,E]=m.useState(y),[L,P]=m.useState(0),[g,R]=m.useState(0),[A,ee]=m.useState(!1),[H,Z]=m.useState(!1),[N,V]=m.useState("lots"),[X,S]=m.useState(1),[F,K]=m.useState(null),[w,G]=m.useState(!1),q=Me(r)?Pt:It,T=m.useCallback(async()=>{if(!(!C||!a||!r)){G(!0);try{const b=await Te.getQuotes(C,a,r);b.status==="success"&&b.data&&K(b.data)}catch{console.debug("REST quotes fetch failed")}finally{G(!1)}}},[C,a,r]);m.useEffect(()=>{if(s){O(c),k(d??i),u(v);const b=Me(r),$=b?"NRML":"CNC",he=y&&(b?["NRML","MIS"]:["CNC","MIS"]).includes(y)?y:$;E(he),P(0),R(0),Z(!1),V("lots"),S(1),K(null),T()}},[s,c,d,i,v,y,r,T]);const{data:z,isConnected:Y}=qe({symbols:a&&r?[{symbol:a,exchange:r}]:[],mode:"Depth",enabled:s&&!!a&&!!r}),l=z.get(`${r}:${a}`)?.data,p={ltp:l?.ltp??F?.ltp,close:l?.close??F?.prev_close,change:l?.change,change_percent:l?.change_percent,bidPrice:l?.depth?.buy?.[0]?.price??l?.bid_price??F?.bid,askPrice:l?.depth?.sell?.[0]?.price??l?.ask_price??F?.ask,bidSize:l?.depth?.buy?.[0]?.quantity??l?.bid_size,askSize:l?.depth?.sell?.[0]?.quantity??l?.ask_size,depth:l?.depth},I=p.change??(p.ltp&&p.close?p.ltp-p.close:void 0),We=p.change_percent??(I&&p.close?I/p.close*100:void 0);m.useEffect(()=>{_!=="MARKET"&&p.ltp&&L===0&&P(be(p.ltp,h))},[_,p.ltp,L,h]);const xe=_==="LIMIT"||_==="SL",pe=_==="SL-M"||_==="SL",we=m.useCallback(()=>!(!a||!r||!C||M<=0||xe&&L<=0||pe&&g<=0),[a,r,C,M,xe,L,pe,g]),He=async()=>{if(!we()){le.error("Please fill all required fields");return}if(!C){le.error("API key not found. Please set up your API key."),x?.("API key not found");return}ee(!0);try{const $={apikey:C,strategy:o,exchange:r,symbol:a,action:f,quantity:M,pricetype:_,product:D,...xe&&{price:L},...pe&&{trigger_price:g}},Q=await Te.placeOrder($),he=Q.orderid;if(Q.status==="success"&&he)n?.(he),t(!1);else{const De=Q.message||"Order placement failed";le.error(De,"orders"),x?.(De)}}catch(b){let $="Order placement failed";if(b&&typeof b=="object"){const Q=b;Q.response?.data?.message?$=Q.response.data.message:Q.message&&($=Q.message)}le.error($,"orders"),x?.($)}finally{ee(!1)}},Ke=b=>{const $=parseInt(b)||0;if(N==="lots")k($*i),S($);else{const Q=Math.max(i,Math.round($/i)*i);k(Q),S(Q/i)}},Ge=N==="lots"?X:M,Je=w&&!p.ltp&&!Y;return e.jsx(Ae,{open:s,onOpenChange:t,children:e.jsxs(ze,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(Ye,{children:e.jsxs($e,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:f==="BUY"?"text-green-500":"text-red-500",children:f}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:a})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(Ot,{exchange:r,ltp:p.ltp,prevClose:p.close,change:I,changePercent:We,bidPrice:p.bidPrice,askPrice:p.askPrice,bidSize:p.bidSize,askSize:p.askSize,isLoading:Je}),e.jsx(Lt,{depth:p.depth,isExpanded:H,onToggle:()=>Z(!H),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{type:"button",variant:f==="BUY"?"default":"outline",className:j("flex-1",f==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>O("BUY"),children:"BUY"}),e.jsx(B,{type:"button",variant:f==="SELL"?"default":"outline",className:j("flex-1",f==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>O("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>V("lots"),className:j("px-2 py-0.5 text-[10px] rounded",N==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>V("shares"),className:j("px-2 py-0.5 text-[10px] rounded",N==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(ye,{type:"number",value:Ge,onChange:b=>Ke(b.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",i]}),e.jsxs("span",{children:["Total qty: ",M]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price Type"}),e.jsxs(oe,{value:_,onValueChange:b=>u(b),children:[e.jsx(ce,{children:e.jsx(de,{})}),e.jsx(ue,{children:Tt.map(b=>e.jsx(me,{value:b.value,children:b.label},b.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Product"}),e.jsxs(oe,{value:D,onValueChange:b=>E(b),children:[e.jsx(ce,{children:e.jsx(de,{})}),e.jsx(ue,{children:q.map(b=>e.jsx(me,{value:b.value,children:b.label},b.value))})]})]})]}),xe&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(ge(L,h,"down")),children:"-"}),e.jsx(ye,{type:"number",value:L,onChange:b=>P(parseFloat(b.target.value)||0),onBlur:()=>P(be(L,h)),className:"flex-1 text-center",step:h,min:0}),e.jsx(B,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>P(ge(L,h,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",h]})]}),pe&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>R(ge(g,h,"down")),children:"-"}),e.jsx(ye,{type:"number",value:g,onChange:b=>R(parseFloat(b.target.value)||0),onBlur:()=>R(be(g,h)),className:"flex-1 text-center",step:h,min:0}),e.jsx(B,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>R(ge(g,h,"up")),children:"+"})]})]})]}),e.jsxs(Qe,{className:"gap-2 sm:gap-0",children:[e.jsx(B,{variant:"outline",onClick:()=>t(!1),disabled:A,children:"Cancel"}),e.jsx(B,{onClick:He,disabled:!we()||A,className:j(f==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:A?"Placing...":`Place ${f} Order`})]})]})})}const ve=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],Ft=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function ie(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const a=s/1e3;return a>=1?a.toFixed(1)+"K":s.toLocaleString()}}function J(s){return s==null?"0.00":s.toFixed(2)}function Bt(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function Rt(s){let t=0,a=0;return s.forEach(r=>{r.ce?.oi&&(t+=r.ce.oi),r.pe?.oi&&(a+=r.pe?.oi??0)}),t===0?0:a/t}function Ut(s){let t=0,a=0,r=0,c=0;return s.forEach(d=>{d.ce&&(t+=d.ce.volume??0,r+=d.ce.oi??0),d.pe&&(a+=d.pe.volume??0,c+=d.pe.oi??0)}),{ceVolume:t,peVolume:a,ceOi:r,peOi:c}}function Vt(s,t){let a=0;return s.forEach(r=>{const c=t==="oi"?r.ce?.oi:r.ce?.volume,d=t==="oi"?r.pe?.oi:r.pe?.volume;c&&c>a&&(a=c),d&&d>a&&(a=d)}),a||1}const qt=Ze.memo(function({strike:t,previousStrike:a,maxBarValue:r,visibleCeColumns:c,visiblePeColumns:d,barDataSource:i,barStyle:h,optionExchange:y,onPlaceOrder:v}){const o=t.ce,n=t.pe,x=o?.label??n?.label??"",C=x==="ATM",f=x.startsWith("OTM"),O=x.startsWith("ITM"),M=a?.ce?.ltp!==void 0&&a.ce.ltp!==o?.ltp,k=a?.pe?.ltp!==void 0&&a.pe.ltp!==n?.ltp,_=M?o&&a?.ce&&o.ltp>a.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",u=k?n&&a?.pe&&n.ltp>a.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",D=o&&o.bid>0&&o.ask>0?o.ask-o.bid:0,E=n&&n.bid>0&&n.ask>0?n.ask-n.bid:0,L=D<=1?"text-green-500":D<=2?"text-yellow-500":"text-red-500",P=E<=1?"text-green-500":E<=2?"text-yellow-500":"text-red-500",g=i==="oi"?o?.oi:o?.volume,R=i==="oi"?n?.oi:n?.volume,A=g?Math.min(g/r*100,100):0,ee=R?Math.min(R/r*100,100):0,H=h==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",Z=h==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",N="font-mono tabular-nums text-xs",V=S=>{switch(S){case"ce_oi":return e.jsx("span",{className:N,children:ie(o?.oi)});case"ce_volume":return e.jsx("span",{className:N,children:ie(o?.volume)});case"ce_bid_qty":return e.jsx("span",{className:N,children:o?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:j(N,"text-red-500"),children:J(o?.bid)});case"ce_ltp":return e.jsx("span",{className:j(N,"font-semibold",_),children:J(o?.ltp)});case"ce_ask":return e.jsx("span",{className:j(N,"text-green-500"),children:J(o?.ask)});case"ce_ask_qty":return e.jsx("span",{className:N,children:o?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:j(N,L),children:J(D)});default:return null}},X=S=>{switch(S){case"pe_oi":return e.jsx("span",{className:N,children:ie(n?.oi)});case"pe_volume":return e.jsx("span",{className:N,children:ie(n?.volume)});case"pe_bid_qty":return e.jsx("span",{className:N,children:n?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:j(N,"text-red-500"),children:J(n?.bid)});case"pe_ltp":return e.jsx("span",{className:j(N,"font-semibold",u),children:J(n?.ltp)});case"pe_ask":return e.jsx("span",{className:j(N,"text-green-500"),children:J(n?.ask)});case"pe_ask_qty":return e.jsx("span",{className:N,children:n?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:j(N,P),children:J(E)});default:return null}};return e.jsxs(Se,{className:j("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":x,children:[c.length>0&&e.jsxs(Ne,{className:j("p-0 relative",f&&!C&&"bg-amber-500/5"),children:[e.jsx("div",{className:j("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",H),style:{width:`${A}%`}}),o&&e.jsxs("div",{className:j("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),v({symbol:o.symbol,exchange:y,action:"BUY",lotSize:o.lotsize??1,tickSize:o.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:S=>{S.stopPropagation(),v({symbol:o.symbol,exchange:y,action:"SELL",lotSize:o.lotsize??1,tickSize:o.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:c.map(S=>{const F=U.find(K=>K.key===S);return e.jsx("div",{className:j("flex-1 px-2 py-1.5 min-w-0",F?.align==="right"&&"text-right",F?.align==="center"&&"text-center",F?.align==="left"&&"text-left"),children:V(S)},S)})})]}),e.jsx(Ne,{className:j("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",C?"bg-primary/15":"bg-muted/30"),children:t.strike}),d.length>0&&e.jsxs(Ne,{className:j("p-0 relative",O&&!C&&"bg-amber-500/5"),children:[e.jsx("div",{className:j("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",Z),style:{width:`${ee}%`}}),n&&e.jsxs("div",{className:j("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:S=>{S.stopPropagation(),v({symbol:n.symbol,exchange:y,action:"BUY",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:S=>{S.stopPropagation(),v({symbol:n.symbol,exchange:y,action:"SELL",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:d.map(S=>{const F=U.find(K=>K.key===S);return e.jsx("div",{className:j("flex-1 px-2 py-1.5 min-w-0",F?.align==="right"&&"text-right",F?.align==="center"&&"text-center",F?.align==="left"&&"text-left"),children:X(S)},S)})})]})]})});function rs(){const{apiKey:s}=Ve(),{visibleColumns:t,columnOrder:a,strikeCount:r,selectedUnderlying:c,barDataSource:d,barStyle:i,toggleColumn:h,reorderColumns:y,setStrikeCount:v,setSelectedUnderlying:o,setBarDataSource:n,setBarStyle:x,resetToDefaults:C}=St(),[f,O]=m.useState(""),[M,k]=m.useState([]),_=m.useRef(new Map),[u,D]=m.useState(null),E=ve.find(l=>l.value===c),L=E?.brokerExchange??"NSE_INDEX",P=E?.exchange??"NFO",{data:g,isConnected:R,isStreaming:A,isPaused:ee,error:H,lastUpdate:Z,refetch:N,isLoading:V,streamingSymbols:X}=jt(s,c,L,P,Bt(f),r,{enabled:!!f,oiRefreshInterval:3e4,pauseWhenHidden:!0});m.useEffect(()=>{(async()=>{if(!(!s||!c))try{const p=await wt.getExpiries(s,c,P);p.status==="success"&&p.data.length>0?(k(p.data),O(I=>I||p.data[0])):le.error(p.message||"Failed to load expiries")}catch(p){console.error("Error loading expiries:",p),le.error("Failed to load expiry dates")}})()},[s,c,P]),m.useEffect(()=>{if(g?.chain){const l=setTimeout(()=>{const p=new Map;g.chain.forEach(I=>{p.set(I.strike,I)}),_.current=p},100);return()=>clearTimeout(l)}},[g?.chain]);const S=l=>{ve.find(I=>I.value===l)&&(o(l),O(""),k([]))},F=()=>{N()},K=m.useCallback(l=>{D({open:!0,symbol:l.symbol,exchange:l.exchange,action:l.action,quantity:l.lotSize,lotSize:l.lotSize,tickSize:l.tickSize})},[]),w=m.useCallback(l=>{l||D(null)},[]),G=m.useMemo(()=>g?.chain?Rt(g.chain):0,[g?.chain]),q=m.useMemo(()=>g?.chain?Ut(g.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[g?.chain]),T=m.useMemo(()=>g?.chain?Vt(g.chain,d):1,[g?.chain,d]),z=m.useMemo(()=>a.filter(l=>U.find(I=>I.key===l)?.side==="ce"&&t.includes(l)),[a,t]),Y=m.useMemo(()=>a.filter(l=>U.find(I=>I.key===l)?.side==="pe"&&t.includes(l)),[a,t]);return H?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(se,{className:"max-w-md",children:e.jsx(ae,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:H}),e.jsxs(B,{onClick:F,className:"mt-4",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lt,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(oe,{value:c,onValueChange:S,children:[e.jsx(ce,{className:"w-36",children:e.jsx(de,{placeholder:"Select Underlying"})}),e.jsx(ue,{children:ve.map(l=>e.jsx(me,{value:l.value,children:l.label},l.value))})]}),e.jsxs(oe,{value:f,onValueChange:O,disabled:M.length===0,children:[e.jsx(ce,{className:"w-36",children:e.jsx(de,{placeholder:"Select Expiry"})}),e.jsx(ue,{children:M.map(l=>e.jsx(me,{value:l,children:l},l))})]}),e.jsxs(oe,{value:String(r),onValueChange:l=>v(Number(l)),children:[e.jsx(ce,{className:"w-36",children:e.jsx(de,{placeholder:"Strike Count"})}),e.jsx(ue,{children:Ft.map(l=>e.jsx(me,{value:String(l.value),children:l.label},l.value))})]}),e.jsx(Dt,{barDataSource:d,barStyle:i,onBarDataSourceChange:n,onBarStyleChange:x}),e.jsx(kt,{visibleColumns:t,onToggleColumn:h,onResetToDefaults:C}),e.jsx(_t,{columnOrder:a,visibleColumns:t,onReorderColumns:y}),e.jsxs(B,{onClick:F,disabled:!f||V,children:[e.jsx(Oe,{className:`h-4 w-4 mr-2 ${V?"animate-spin":""}`}),"Refresh"]})]})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[c," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:J(g.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",J(g.underlying_prev_close)]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:g.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",g.expiry_date]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${G>1?"text-green-500":"text-yellow-500"}`,children:G.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:ie(q.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:ie(q.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:q.ceOi+q.peOi>0?`${q.ceOi/(q.ceOi+q.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",G.toFixed(2)]})})]})})]}),e.jsx(se,{children:e.jsx(ae,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ht,{className:"w-full table-fixed",children:[e.jsxs(ft,{children:[e.jsxs(Se,{className:"bg-muted/30 border-b-0",children:[z.length>0&&e.jsx(re,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(re,{className:"text-center w-20 min-w-20"}),Y.length>0&&e.jsx(re,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Se,{className:"bg-muted/50",children:[z.length>0&&e.jsx(re,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:z.map(l=>{const p=U.find(I=>I.key===l);return e.jsx("div",{className:j("flex-1 px-2 py-2 text-xs font-medium min-w-0",p?.align==="right"&&"text-right",p?.align==="center"&&"text-center",p?.align==="left"&&"text-left"),children:p?.label},l)})})}),e.jsx(re,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),Y.length>0&&e.jsx(re,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:Y.map(l=>{const p=U.find(I=>I.key===l);return e.jsx("div",{className:j("flex-1 px-2 py-2 text-xs font-medium min-w-0",p?.align==="right"&&"text-right",p?.align==="center"&&"text-center",p?.align==="left"&&"text-left"),children:p?.label},l)})})})]})]}),e.jsx(gt,{children:g.chain.map(l=>e.jsx(qt,{strike:l,previousStrike:_.current.get(l.strike),maxBarValue:T,visibleCeColumns:z,visiblePeColumns:Y,barDataSource:d,barStyle:i,optionExchange:P,onPlaceOrder:K},l.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[A?e.jsx(it,{className:"h-4 w-4 text-green-500"}):e.jsx(ot,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Ue,{variant:A?"default":R?"secondary":"destructive",children:ee?"Paused":A?`Streaming ${X} symbols`:R?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",d==="oi"?"OI":"Volume"," (",i,")"]})]}),e.jsxs("div",{children:["Last Update: ",Z?Z.toLocaleTimeString():"-"]})]})]}),!g&&!H&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Mt,{open:u?.open??!1,onOpenChange:w,symbol:u?.symbol,exchange:u?.exchange,action:u?.action,quantity:u?.quantity,lotSize:u?.lotSize,tickSize:u?.tickSize,strategy:"OptionChain"})]})}export{rs as default};
