import{r as c,j as e}from"./vendor-react-RhKMXzW9.js";import{d as G,o as J,l as X,e as $,B,c as f,s as u}from"./index-BAiUdT0p.js";import{t as Z}from"./trading-DIlOEgom.js";import{C as b,b as P,d as T,c as C,a as ee}from"./card-BDJt10wr.js";import{T as te,a as se,b as k,c as h,d as ae,e as o,f as ne}from"./table-C_Y-2tNB.js";import{u as re}from"./useMarketData-CaDaQee9.js";import{Q as le,R as ce,D as oe,c as U,Y as z,L as ie}from"./vendor-icons-Chlwwn8V.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-router-DdyOoyPF.js";import"./vendor-radix-B_grJx4K.js";function j(m){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(m)}function D(m){return`${m>=0?"+":""}${m.toFixed(2)}%`}function Ne(){const{apiKey:m}=G(),[g,A]=c.useState([]),[y,Q]=c.useState(null),[O,E]=c.useState(!0),[I,H]=c.useState(!1),[_,L]=c.useState(null),K=c.useMemo(()=>g.map(t=>({symbol:t.symbol,exchange:t.exchange})),[g]),{data:M,isConnected:S}=re({symbols:K,mode:"LTP",enabled:g.length>0}),v=c.useMemo(()=>g.map(t=>{const n=`${t.exchange}:${t.symbol}`,l=M.get(n),r=t.quantity||0,x=l?.data?.ltp&&l.lastUpdate&&Date.now()-l.lastUpdate<5e3,i=x?l.data.ltp:t.ltp;let s=t.average_price;const w=t.pnl||0;if(i&&r!==0&&!s&&(s=i-w/r),x&&l?.data?.ltp&&s&&r!==0){const N=l.data.ltp,F=(N-s)*r,V=Math.abs(s*r),Y=V>0?F/V*100:0;return{...t,ltp:N,average_price:s,pnl:F,pnlpercent:Y}}let R=t.pnlpercent;if(s&&r!==0&&R===void 0){const N=Math.abs(s*r);R=N>0?w/N*100:0}return{...t,ltp:i??t.ltp,average_price:s,pnlpercent:R??0}}),[g,M]),a=c.useMemo(()=>{if(!y||v.length===0)return y;let t=0,n=0,l=0;v.forEach(x=>{t+=x.pnl||0;const i=x.average_price||0,s=x.quantity||0,w=x.ltp||i;n+=i*s,l+=w*s});const r=n>0?t/n*100:0;return{...y,totalholdingvalue:l,totalinvvalue:n,totalprofitandloss:t,totalpnlpercentage:r}},[y,v]),d=c.useCallback(async(t=!1)=>{if(!m){E(!1);return}t&&H(!0);try{const n=await Z.getHoldings(m);n.status==="success"&&n.data?(A(n.data.holdings||[]),Q(n.data.statistics),L(null)):L(n.message||"Failed to fetch holdings")}catch{L("Failed to fetch holdings")}finally{E(!1),H(!1)}},[m]);c.useEffect(()=>{d();const n=setInterval(()=>d(),S?3e4:1e4);return()=>clearInterval(n)},[d,S]),c.useEffect(()=>{const t=J(()=>{d()});return()=>t()},[d]);const q=c.useRef(null);c.useEffect(()=>{const t=window.location.protocol,n=window.location.hostname,l=window.location.port;q.current=X(`${t}//${n}:${l}`,{transports:["websocket","polling"]});const r=q.current;return r.on("order_event",()=>{setTimeout(()=>d(),500)}),r.on("analyzer_update",()=>{setTimeout(()=>d(),500)}),()=>{r.disconnect()}},[d]);const W=()=>{const t=["Symbol","Exchange","Quantity","Avg Price","LTP","Product","P&L","P&L %"],n=v.map(s=>[u(s.symbol),u(s.exchange),u(s.quantity),u(s.average_price),u(s.ltp),u(s.product),u(s.pnl),u(s.pnlpercent)]),l=[t,...n].map(s=>s.join(",")).join(`
`),r=new Blob([l],{type:"text/csv"}),x=URL.createObjectURL(r),i=document.createElement("a");i.href=x,i.download=`holdings_${new Date().toISOString().split("T")[0]}.csv`,i.click()},p=t=>t>=0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Investor Summary"}),S&&e.jsxs($,{variant:"outline",className:"bg-emerald-500/10 text-emerald-600 border-emerald-500/30 gap-1",children:[e.jsx(le,{className:"h-3 w-3 animate-pulse"}),"Live"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"View your holdings portfolio"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>d(!0),disabled:I,children:[e.jsx(ce,{className:f("h-4 w-4 mr-2",I&&"animate-spin")}),"Refresh"]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:W,children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(b,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(T,{children:"Total Holding Value"}),e.jsx(C,{className:"text-2xl text-primary",children:a?j(a.totalholdingvalue):"---"})]})}),e.jsx(b,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(T,{children:"Total Investment Value"}),e.jsx(C,{className:"text-2xl",children:a?j(a.totalinvvalue):"---"})]})}),e.jsx(b,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(T,{children:"Total Profit and Loss"}),e.jsx(C,{className:f("text-2xl",a&&p(a.totalprofitandloss)?"text-green-600":"text-red-600"),children:a?e.jsxs("div",{className:"flex items-center gap-1",children:[p(a.totalprofitandloss)?e.jsx(U,{className:"h-5 w-5"}):e.jsx(z,{className:"h-5 w-5"}),j(a.totalprofitandloss)]}):"---"})]})}),e.jsx(b,{children:e.jsxs(P,{className:"pb-2",children:[e.jsx(T,{children:"Total PnL Percentage"}),e.jsx(C,{className:f("text-2xl",a&&p(a.totalpnlpercentage)?"text-green-600":"text-red-600"),children:a?D(a.totalpnlpercentage):"---"})]})})]}),e.jsx(b,{children:e.jsx(ee,{className:"p-0",children:O?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ie,{className:"h-8 w-8 animate-spin"})}):_?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:_}):g.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No holdings found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(te,{children:[e.jsx(se,{children:e.jsxs(k,{children:[e.jsx(h,{children:"Trading Symbol"}),e.jsx(h,{children:"Exchange"}),e.jsx(h,{className:"text-right",children:"Quantity"}),e.jsx(h,{className:"text-right",children:"Avg Price"}),e.jsx(h,{className:"text-right",children:"LTP"}),e.jsx(h,{children:"Product"}),e.jsx(h,{className:"text-right",children:"Profit and Loss"}),e.jsx(h,{className:"text-right",children:"PnL %"})]})}),e.jsx(ae,{children:v.map((t,n)=>e.jsxs(k,{children:[e.jsx(o,{className:"font-medium",children:t.symbol}),e.jsx(o,{children:e.jsx($,{variant:"outline",children:t.exchange})}),e.jsx(o,{className:"text-right font-mono",children:t.quantity}),e.jsx(o,{className:"text-right font-mono",children:t.average_price!==void 0?j(t.average_price):"-"}),e.jsx(o,{className:"text-right font-mono",children:t.ltp!==void 0?j(t.ltp):"-"}),e.jsx(o,{children:e.jsx($,{variant:"secondary",children:t.product})}),e.jsx(o,{className:f("text-right font-medium",p(t.pnl)?"text-green-600":"text-red-600"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[p(t.pnl)?e.jsx(U,{className:"h-4 w-4"}):e.jsx(z,{className:"h-4 w-4"}),j(t.pnl)]})}),e.jsx(o,{className:f("text-right",p(t.pnlpercent)?"text-green-600":"text-red-600"),children:D(t.pnlpercent)})]},`${t.symbol}-${t.exchange}-${n}`))}),e.jsx(ne,{children:e.jsxs(k,{className:"bg-muted/50",children:[e.jsx(o,{colSpan:6,className:"text-right text-muted-foreground",children:"Total P&L:"}),e.jsx(o,{className:f("text-right font-bold",a&&p(a.totalprofitandloss)?"text-green-600":"text-red-600"),children:a?`${a.totalprofitandloss>=0?"+":""}${j(a.totalprofitandloss)}`:"-"}),e.jsx(o,{className:f("text-right font-bold",a&&p(a.totalpnlpercentage)?"text-green-600":"text-red-600"),children:a?D(a.totalpnlpercentage):"-"})]})})]})})})})]})}export{Ne as default};
