import{r as p}from"./vendor-react-CCyQGCED.js";import{t as F}from"./trading-L0e-hk9o.js";import{u as V,a as T}from"./useMarketStatus-B5zaupYn.js";import{d as U,g as W}from"./index-D0023jFM.js";function X(t,y={}){const{enabled:n=!0,staleThreshold:o=5e3,useMultiQuotesFallback:s=!0,multiQuotesRefreshInterval:i=3e4,pauseWhenHidden:c=!0}=y,{apiKey:d}=U(),{isMarketOpen:g,isAnyMarketOpen:P}=V(),{isVisible:M,wasHidden:q,timeSinceHidden:Q}=W(),S=P(),[k,C]=p.useState(new Map),w=p.useRef(Date.now()),H=p.useMemo(()=>t.map(e=>({symbol:e.symbol,exchange:e.exchange})),[t]),{data:m,isConnected:L,isPaused:O,isFallbackMode:I}=T({symbols:H,mode:"LTP",enabled:n&&t.length>0}),R=L&&S&&!O,f=p.useCallback(async()=>{if(!(!d||t.length===0||!s))try{const e=t.map(a=>({symbol:a.symbol,exchange:a.exchange})),h=await F.getMultiQuotes(d,e);if(h.status==="success"&&h.results){const a=new Map;h.results.forEach(l=>{const r=`${l.exchange}:${l.symbol}`;l.data&&a.set(r,l.data)}),C(a)}}catch{}},[d,t,s]);return p.useEffect(()=>{if(!n||t.length===0||!s||c&&!M)return;f(),w.current=Date.now();const e=setInterval(()=>{f(),w.current=Date.now()},i);return()=>clearInterval(e)},[n,t.length,s,f,i,c,M]),p.useEffect(()=>{!q||!M||!s||!n||Q>i&&(f(),w.current=Date.now())},[q,M,Q,i,s,n,f]),{data:p.useMemo(()=>t.map(e=>{const h=`${e.exchange}:${e.symbol}`,a=m.get(h),l=k.get(h),r=e.quantity||0,b=e.average_price||0,_=g(e.exchange)&&a?.data?.ltp&&a.lastUpdate&&Date.now()-a.lastUpdate<o,$=!_&&l?.ltp;let u,v="rest";if(_&&a?.data?.ltp?(u=a.data.ltp,v="websocket"):$&&l?.ltp?(u=l.ltp,v="multiquotes"):(u=e.ltp,v="rest"),r===0)return{...e,_dataSource:"rest"};let D=e.pnl||0,E=e.pnlpercent||0;const z=e.today_realized_pnl||0;if(u&&b>0){let x;r>0?x=(u-b)*r:x=(b-u)*Math.abs(r),D=z+x;const A=Math.abs(b*r);E=A>0?D/A*100:0}return{...e,ltp:u,pnl:D,pnlpercent:E,_dataSource:v}}),[t,m,k,g,o]),isLive:R,isConnected:L,isPaused:O,isFallbackMode:I,isAnyMarketOpen:S,multiQuotes:k,refreshMultiQuotes:f}}function Y(t,y){if(!y)return null;let n=0,o=0,s=0;t.forEach(c=>{n+=c.pnl||0;const d=c.average_price||0,g=c.quantity||0,P=c.ltp||d;o+=d*g,s+=P*g});const i=o>0?n/o*100:0;return{...y,totalholdingvalue:s,totalinvvalue:o,totalprofitandloss:n,totalpnlpercentage:i}}export{Y as c,X as u};
