import{r as i,j as e}from"./vendor-react--vsXx8_n.js";import{t as H}from"./trading-BAHaEXcC.js";import{d as Z,o as $,B as x,c as F,e as j,s as l}from"./index-DNt4N-JN.js";import{C as T,a as B,c as L,b as E,d as q}from"./card-Dpvf5dQO.js";import{D as Q,a as X,b as G,c as J,d as W,e as ee,f as se}from"./dialog-DxDiEYFR.js";import{L as I}from"./label-C35B46J7.js";import{T as ae,a as te,b as U,c,d as re,e as o}from"./table-DlhKEnAB.js";import{_ as ne,R as ie,r as le,c as z,a0 as Y,L as ce}from"./vendor-icons-D7CGgVJ-.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DnptSSCf.js";function _(d){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2}).format(d)}function oe(d){try{const h=new Date(d),p=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),w=new Date(p.getFullYear(),p.getMonth(),p.getDate()),u=new Date(h.toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),y=new Date(u.getFullYear(),u.getMonth(),u.getDate());return w.getTime()===y.getTime()?h.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kolkata"}):h.toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kolkata"})}catch{return d}}function ye(){const{apiKey:d}=Z(),[h,p]=i.useState([]),[w,u]=i.useState(!0),[y,C]=i.useState(!1),[A,S]=i.useState(null),[t,O]=i.useState({action:[],exchange:[],product:[]}),[K,R]=i.useState(!1),f=i.useMemo(()=>h.filter(s=>!(t.action.length>0&&!t.action.includes(s.action)||t.exchange.length>0&&!t.exchange.includes(s.exchange)||t.product.length>0&&!t.product.includes(s.product))),[h,t]),v=t.action.length>0||t.exchange.length>0||t.product.length>0,P=(s,a)=>{O(m=>{const N=m[s];return N.indexOf(a)>-1?{...m,[s]:N.filter(b=>b!==a)}:{...m,[s]:[...N,a]}})},k=()=>{O({action:[],exchange:[],product:[]})},g=i.useCallback(async(s=!1)=>{if(!d){u(!1);return}s&&C(!0);try{const a=await H.getTrades(d);a.status==="success"&&a.data?(p(a.data),S(null)):S(a.message||"Failed to fetch trades")}catch{S("Failed to fetch trades")}finally{u(!1),C(!1)}},[d]);i.useEffect(()=>{g();const s=setInterval(()=>g(),1e4);return()=>clearInterval(s)},[g]),i.useEffect(()=>{const s=$(()=>{g()});return()=>s()},[g]);const V=()=>{const s=["Symbol","Exchange","Product","Action","Qty","Price","Trade Value","Order ID","Time"],a=h.map(n=>[l(n.symbol),l(n.exchange),l(n.product),l(n.action),l(n.quantity),l(n.average_price),l(n.trade_value),l(n.orderid),l(n.timestamp)]),m=[s,...a].map(n=>n.join(",")).join(`
`),N=new Blob([m],{type:"text/csv"}),M=URL.createObjectURL(N),b=document.createElement("a");b.href=M,b.download=`tradebook_${new Date().toISOString().split("T")[0]}.csv`,b.click()},D={total:f.length,buyTrades:f.filter(s=>s.action==="BUY").length,sellTrades:f.filter(s=>s.action==="SELL").length},r=({type:s,value:a,label:m})=>e.jsx(x,{variant:t[s].includes(a)?"default":"outline",size:"sm",className:F("rounded-full",t[s].includes(a)&&"bg-pink-500 hover:bg-pink-600"),onClick:()=>P(s,a),children:m});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trade Book"}),e.jsx("p",{className:"text-muted-foreground",children:"View your executed trades"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(Q,{open:K,onOpenChange:R,children:[e.jsx(X,{asChild:!0,children:e.jsxs(x,{variant:v?"default":"outline",size:"sm",className:"relative",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Filters",v&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]})}),e.jsxs(G,{className:"max-w-md",children:[e.jsxs(J,{children:[e.jsx(W,{children:"Trade Filters"}),e.jsx(ee,{children:"Filter trades by action, exchange, or product"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Action"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"action",value:"BUY",label:"Buy"}),e.jsx(r,{type:"action",value:"SELL",label:"Sell"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Exchange"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"exchange",value:"NSE",label:"NSE"}),e.jsx(r,{type:"exchange",value:"BSE",label:"BSE"}),e.jsx(r,{type:"exchange",value:"NFO",label:"NFO"}),e.jsx(r,{type:"exchange",value:"BFO",label:"BFO"}),e.jsx(r,{type:"exchange",value:"MCX",label:"MCX"}),e.jsx(r,{type:"exchange",value:"CDS",label:"CDS"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(I,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Product"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"product",value:"CNC",label:"CNC"}),e.jsx(r,{type:"product",value:"MIS",label:"MIS"}),e.jsx(r,{type:"product",value:"NRML",label:"NRML"})]})]})]}),e.jsxs(se,{children:[e.jsx(x,{variant:"ghost",onClick:k,children:"Clear All"}),e.jsx(x,{onClick:()=>R(!1),children:"Done"})]})]})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>g(!0),disabled:y,children:[e.jsx(ie,{className:F("h-4 w-4 mr-2",y&&"animate-spin")}),"Refresh"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:V,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),v&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Filters:"}),t.action.map(s=>e.jsx(j,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),t.exchange.map(s=>e.jsx(j,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),t.product.map(s=>e.jsx(j,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),e.jsx(x,{variant:"outline",size:"sm",className:"text-red-500 border-red-500/50 hover:bg-red-500/10",onClick:k,children:"Clear All"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(T,{children:e.jsxs(B,{className:"pb-2",children:[e.jsx(L,{children:"Total Trades"}),e.jsx(E,{className:"text-2xl",children:D.total})]})}),e.jsx(T,{children:e.jsxs(B,{className:"pb-2",children:[e.jsx(L,{children:"Buy Trades"}),e.jsxs(E,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),D.buyTrades]})]})}),e.jsx(T,{children:e.jsxs(B,{className:"pb-2",children:[e.jsx(L,{children:"Sell Trades"}),e.jsxs(E,{className:"text-2xl text-red-600 flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),D.sellTrades]})]})})]}),e.jsx(T,{children:e.jsx(q,{className:"p-0",children:w?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(ce,{className:"h-8 w-8 animate-spin"})}):A?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:A}):f.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:v?e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:"No trades match your filters"}),e.jsx(x,{variant:"ghost",size:"sm",onClick:k,children:"Clear Filters"})]}):"No trades today"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(U,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Action"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"Price"}),e.jsx(c,{className:"text-right",children:"Trade Value"}),e.jsx(c,{children:"Order ID"}),e.jsx(c,{children:"Time"})]})}),e.jsx(re,{children:f.map((s,a)=>e.jsxs(U,{children:[e.jsx(o,{className:"font-medium",children:s.symbol}),e.jsx(o,{children:e.jsx(j,{variant:"outline",children:s.exchange})}),e.jsx(o,{children:e.jsx(j,{variant:"secondary",children:s.product})}),e.jsx(o,{children:e.jsxs(j,{variant:s.action==="BUY"?"default":"destructive",className:F("gap-1",s.action==="BUY"?"bg-green-500":""),children:[s.action==="BUY"?e.jsx(z,{className:"h-3 w-3"}):e.jsx(Y,{className:"h-3 w-3"}),s.action]})}),e.jsx(o,{className:"text-right font-mono",children:s.quantity}),e.jsx(o,{className:"text-right font-mono",children:_(s.average_price)}),e.jsx(o,{className:"text-right font-mono",children:_(s.trade_value)}),e.jsx(o,{className:"font-mono text-xs",children:s.orderid}),e.jsx(o,{className:"text-sm text-muted-foreground",children:oe(s.timestamp)})]},`${s.orderid}-${a}`))})]})})})})]})}export{ye as default};
