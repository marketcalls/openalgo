import{r as c,j as e}from"./vendor-react-CCyQGCED.js";import{c as u,B as L,s as R}from"./index-NHrG-O_Z.js";import{A as N,a as P}from"./alert-BoGaKMRC.js";import{C as T,d as D}from"./card-Cn20bp_v.js";import{I as p}from"./input-BylzFlgY.js";import{L as h}from"./label-_1WWiomg.js";import{P as E}from"./progress-B1t1mGW6.js";import{I as O,L as M,m as C}from"./vendor-icons-CCn_k3dF.js";import{a as z}from"./vendor-router-Dzc1xxhr.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CYVJEJRR.js";function B(s){let a=0;return s.length>=8&&(a+=20),s.length>=12&&(a+=10),s.length>=16&&(a+=10),/[A-Z]/.test(s)&&(a+=15),/[a-z]/.test(s)&&(a+=15),/[0-9]/.test(s)&&(a+=15),/[!@#$%^&*]/.test(s)&&(a+=15),a}function Z(s){return{length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[!@#$%^&*]/.test(s)}}function ee(){const s=z(),[a,y]=c.useState(!1),[b,x]=c.useState(null),[t,S]=c.useState({username:"",email:"",password:"",confirmPassword:""}),[n,A]=c.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[d,F]=c.useState(0);c.useEffect(()=>{const r=Z(t.password);A(r),F(B(t.password))},[t.password]);const k=Object.values(n).every(Boolean),f=t.password===t.confirmPassword,q=Object.values(t).every(r=>r.trim()!==""),v=k&&f&&q,g=d>=80?{label:"Strong",color:"text-green-500"}:d>=50?{label:"Medium",color:"text-yellow-500"}:d>0?{label:"Weak",color:"text-red-500"}:{label:"",color:""},m=r=>{const{name:i,value:j}=r.target;S(l=>({...l,[i]:j}))},I=async r=>{if(r.preventDefault(),!!v){y(!0),x(null);try{const j=await(await fetch("/auth/csrf-token",{credentials:"include"})).json(),l=new FormData;l.append("username",t.username),l.append("email",t.email),l.append("password",t.password),l.append("confirm_password",t.confirmPassword),l.append("csrf_token",j.csrf_token);const w=await fetch("/setup",{method:"POST",body:l,credentials:"include"});if(await w.text(),w.ok||w.redirected){R.success("Account created successfully");try{await fetch("/auth/logout",{method:"POST",credentials:"include"})}catch{}s("/login")}else x("Setup failed. Please try again.")}catch{x("Setup failed. Please check your connection and try again.")}finally{y(!1)}}},o=({met:r,children:i})=>e.jsxs("div",{className:u("flex items-center gap-2 text-sm py-1 transition-colors",r?"text-green-500":"text-muted-foreground"),children:[e.jsx(C,{className:u("h-4 w-4",r?"opacity-100":"opacity-0")}),e.jsx("span",{children:i})]});return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center py-12 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center",children:[e.jsxs("div",{className:"space-y-6 lg:pr-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold leading-tight",children:["Initial ",e.jsx("span",{className:"text-primary",children:"Setup"})]}),e.jsx("p",{className:"text-lg lg:text-xl text-muted-foreground leading-relaxed",children:"Welcome to OpenAlgo! Create your administrator account to get started with algorithmic trading. This account will have full access to manage the platform."})]}),e.jsxs(N,{children:[e.jsx(O,{className:"h-5 w-5"}),e.jsxs(P,{children:[e.jsx("strong",{className:"block mb-1",children:"First Time Setup"}),"This form will create the initial administrator account. You'll receive a TOTP QR code for password resets after setup."]})]})]}),e.jsx("div",{className:"w-full",children:e.jsx(T,{children:e.jsx(D,{className:"p-6 lg:p-8",children:e.jsxs("form",{onSubmit:I,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"username",children:"Username"}),e.jsx(p,{id:"username",name:"username",type:"text",placeholder:"Choose a username",value:t.username,onChange:m,required:!0,disabled:a,autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"email",children:"Email"}),e.jsx(p,{id:"email",name:"email",type:"email",placeholder:"Enter your email",value:t.email,onChange:m,required:!0,disabled:a})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(p,{id:"password",name:"password",type:"password",placeholder:"Choose a password",value:t.password,onChange:m,required:!0,disabled:a,autoComplete:"new-password"}),e.jsx(E,{value:d,className:"h-2"}),g.label&&e.jsx("p",{className:u("text-xs font-medium",g.color),children:g.label})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(p,{id:"confirmPassword",name:"confirmPassword",type:"password",placeholder:"Confirm your password",value:t.confirmPassword,onChange:m,required:!0,disabled:a,autoComplete:"new-password"}),t.confirmPassword&&e.jsx("p",{className:u("text-xs",f?"text-green-500":"text-red-500"),children:f?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-1",children:[e.jsx(o,{met:n.length,children:"Minimum 8 characters"}),e.jsx(o,{met:n.uppercase,children:"At least 1 uppercase letter (A-Z)"}),e.jsx(o,{met:n.lowercase,children:"At least 1 lowercase letter (a-z)"}),e.jsx(o,{met:n.number,children:"At least 1 number (0-9)"}),e.jsx(o,{met:n.special,children:"At least 1 special character (!@#$%^&*)"})]}),b&&e.jsx(N,{variant:"destructive",children:e.jsx(P,{children:b})}),e.jsx(L,{type:"submit",className:"w-full",disabled:!v||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating Account..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"mr-2 h-4 w-4"}),"Create Account"]})})]})})})})]})})})}export{ee as default};
