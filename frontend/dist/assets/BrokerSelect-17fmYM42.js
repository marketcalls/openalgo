import{r as o,j as e}from"./vendor-react-CCyQGCED.js";import{A as h,a as f,b as w}from"./alert-BoGaKMRC.js";import{d as S,B as y}from"./index-NHrG-O_Z.js";import{C,a as v,b as _,c as A,d as B}from"./card-Cn20bp_v.js";import{L as I}from"./label-_1WWiomg.js";import{S as $,a as L,b as F,c as D,d as z}from"./select-DcHsBqkV.js";import{L as b,I as P,_ as E,p as k}from"./vendor-icons-CCn_k3dF.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";const M=[{id:"fivepaisa",name:"5 Paisa",authType:"totp"},{id:"fivepaisaxts",name:"5 Paisa (XTS)",authType:"totp"},{id:"aliceblue",name:"Alice Blue",authType:"totp"},{id:"angel",name:"Angel One",authType:"totp"},{id:"compositedge",name:"CompositEdge",authType:"oauth"},{id:"dhan",name:"Dhan",authType:"oauth"},{id:"indmoney",name:"IndMoney",authType:"totp"},{id:"dhan_sandbox",name:"Dhan (Sandbox)",authType:"totp"},{id:"definedge",name:"Definedge",authType:"totp"},{id:"firstock",name:"Firstock",authType:"totp"},{id:"flattrade",name:"Flattrade",authType:"oauth"},{id:"motilal",name:"Motilal Oswal",authType:"totp"},{id:"fyers",name:"Fyers",authType:"oauth"},{id:"groww",name:"Groww",authType:"totp"},{id:"ibulls",name:"Ibulls",authType:"totp"},{id:"iifl",name:"IIFL",authType:"totp"},{id:"jainamxts",name:"JainamXts",authType:"totp"},{id:"kotak",name:"Kotak Securities",authType:"totp"},{id:"mstock",name:"mStock by Mirae Asset",authType:"totp"},{id:"nubra",name:"Nubra",authType:"totp"},{id:"paytm",name:"Paytm Money",authType:"oauth"},{id:"pocketful",name:"Pocketful",authType:"oauth"},{id:"samco",name:"Samco",authType:"totp"},{id:"shoonya",name:"Shoonya",authType:"totp"},{id:"tradejini",name:"Tradejini",authType:"totp"},{id:"upstox",name:"Upstox",authType:"oauth"},{id:"wisdom",name:"Wisdom Capital",authType:"totp"},{id:"zebu",name:"Zebu",authType:"totp"},{id:"zerodha",name:"Zerodha",authType:"oauth"}];function K(n){if(!n)return"";const t=n.split(":::");return t.length>1?t[1]:n}function O(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let i="";for(let l=0;l<16;l++)i+=t.charAt(Math.floor(Math.random()*t.length));return i}function Q(){const{user:n}=S(),[t,i]=o.useState(""),[l,j]=o.useState(!0),[m,x]=o.useState(!1),[g,c]=o.useState(null),[p,T]=o.useState(null);o.useEffect(()=>{(async()=>{try{const a=await(await fetch("/auth/broker-config",{credentials:"include"})).json();a.status==="success"?(T(a),i(a.broker_name)):c(a.message||"Failed to load broker configuration")}catch{c("Failed to load broker configuration")}finally{j(!1)}})()},[]);const N=r=>{if(r.preventDefault(),!t){c("Please select a broker");return}if(!p){c("Broker configuration not loaded");return}x(!0);let s="";const{broker_api_key:a,redirect_url:d}=p;switch(t){case"fivepaisa":case"fivepaisaxts":case"aliceblue":case"angel":case"mstock":case"indmoney":case"jainamxts":case"dhan_sandbox":case"definedge":case"firstock":case"samco":case"motilal":case"nubra":case"groww":case"ibulls":case"iifl":case"kotak":case"shoonya":case"tradejini":case"wisdom":case"zebu":s=`/${t}/callback`;break;case"dhan":s="/dhan/initiate-oauth";break;case"compositedge":s=`https://xts.compositedge.com/interactive/thirdparty?appKey=${a}&returnURL=${d}`;break;case"flattrade":{s=`https://auth.flattrade.in/?app_key=${K(a)}`;break}case"fyers":s=`https://api-t1.fyers.in/api/v3/generate-authcode?client_id=${a}&redirect_uri=${d}&response_type=code&state=2e9b44629ebb28226224d09db3ffb47c`;break;case"upstox":s=`https://api.upstox.com/v2/login/authorization/dialog?response_type=code&client_id=${a}&redirect_uri=${d}`;break;case"zerodha":s=`https://kite.trade/connect/login?api_key=${a}`;break;case"paytm":s=`https://login.paytmmoney.com/merchant-login?apiKey=${a}&state={default}`;break;case"pocketful":{const u=O();localStorage.setItem("pocketful_oauth_state",u),s=`https://trade.pocketful.in/oauth2/auth?client_id=${a}&redirect_uri=${d}&response_type=code&scope=${encodeURIComponent("orders holdings")}&state=${encodeURIComponent(u)}`;break}default:c("Please select a broker"),x(!1);return}setTimeout(()=>{window.location.href=s},100)};return l?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(b,{className:"h-8 w-8 animate-spin"})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center py-8 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-16",children:[e.jsxs(C,{className:"w-full max-w-md shadow-xl order-1 lg:order-2",children:[e.jsxs(v,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/logo.png",alt:"OpenAlgo",className:"h-20 w-20"})}),e.jsx(_,{className:"text-2xl",children:"Connect Your Trading Account"}),e.jsxs(A,{children:["Welcome, ",e.jsx("span",{className:"font-medium",children:n?.username}),"!"]})]}),e.jsxs(B,{children:[g&&e.jsx(h,{variant:"destructive",className:"mb-4",children:e.jsx(f,{children:g})}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"broker-select",className:"block text-center",children:"Login with your Broker"}),e.jsxs($,{value:t,onValueChange:i,disabled:m,children:[e.jsx(L,{id:"broker-select",className:"w-full",children:e.jsx(F,{placeholder:"Select a Broker"})}),e.jsx(D,{children:M.filter(r=>r.id===p?.broker_name).map(r=>e.jsx(z,{value:r.id,children:r.name},r.id))})]})]}),(t==="zerodha"||t==="dhan")&&e.jsxs(h,{className:"border-amber-500/50 bg-amber-500/10",children:[e.jsx(P,{className:"h-4 w-4 text-amber-500"}),e.jsx(f,{className:"text-amber-200",children:t==="zerodha"?"Zerodha requires an active Kite Connect data subscription for market data access.":"Dhan requires an active Data API subscription for market data access."})]}),e.jsx(y,{type:"submit",className:"w-full",disabled:!t||m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Connecting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"mr-2 h-4 w-4"}),"Connect Account"]})})]})]})]}),e.jsxs("div",{className:"flex-1 max-w-xl text-center lg:text-left order-2 lg:order-1",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["Connect Your ",e.jsx("span",{className:"text-primary",children:"Broker"})]}),e.jsx("p",{className:"text-lg lg:text-xl mb-8 text-muted-foreground",children:"Link your trading account to start executing trades through OpenAlgo's algorithmic trading platform."}),e.jsxs(h,{className:"mb-6",children:[e.jsx(k,{className:"h-4 w-4"}),e.jsx(w,{children:"Need Help?"}),e.jsx(f,{children:"Check our documentation for broker setup guides."})]}),e.jsx("div",{className:"flex justify-center lg:justify-start gap-4",children:e.jsx(y,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://docs.openalgo.in",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Documentation"]})})})]})]})})})}export{Q as default};
