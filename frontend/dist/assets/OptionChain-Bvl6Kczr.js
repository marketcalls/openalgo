import{r as l,j as e,a as He}from"./vendor-react--vsXx8_n.js";import{v as De,D as Ie,i as Me,B as $,j as Fe,y as ge,z as ke,A as pe,m as Ne,C as _e,c as w,e as Re,d as Se,s as le}from"./index-6sWrLAWs.js";import{u as Be,b as Ue,a as Ke}from"./useMarketStatus-DWFRwrtR.js";import{g as Ge,$ as Je,ac as Ze,aR as et,aS as tt,R as Ee,c as st,az as at,aB as nt}from"./vendor-icons-C0P7QAK9.js";import{D as Ve,a as rt,b as qe,c as Ae,d as ze,e as lt,f as $e,g as it}from"./dialog-D3HlcFfB.js";import{S as Pe}from"./scroll-area-DncwXfqL.js";import{I as be}from"./input-BKbwLQAr.js";import{L as te}from"./label-DEtU0BL2.js";import{S as oe,a as ce,b as de,c as ue,d as me}from"./select-CUr7K9_3.js";import{t as ve}from"./trading-CYt6IuMe.js";import{C as ot,b as ct,a as dt}from"./collapsible-BJ9rSfA8.js";import{C as se,d as ae}from"./card-CTM77lTR.js";import{T as ut,a as mt,b as Ce,c as ne,d as xt,e as je}from"./table-CLorScnL.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DkDlinVE.js";function pt(s,t,r,a,c,u={enabled:!0,refreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:i,refreshInterval:b=3e4,pauseWhenHidden:y=!0}=u,{isVisible:S}=Be(),[o,n]=l.useState({data:null,isLoading:!1,isConnected:!1,isPaused:!1,error:null,lastUpdate:null}),x=l.useRef(null),P=l.useRef(null),h=i&&(!y||S),j=l.useCallback(async()=>{if(!(!s||!t||!r||!a)&&!P.current){n(p=>({...p,isLoading:!0}));try{const p=new AbortController;P.current=p;const _=await fetch("/api/v1/optionchain",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apikey:s,underlying:t,exchange:r,expiry_date:a,strike_count:c}),signal:p.signal});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const m=await _.json();m.status==="success"?n(D=>({...D,data:m,isLoading:!1,isConnected:!0,error:null,lastUpdate:new Date})):n(D=>({...D,isLoading:!1,error:m.message||"Failed to fetch option chain"}))}catch(p){p instanceof Error&&(p.name==="AbortError"?P.current===null&&n(_=>({..._,isLoading:!1})):n(_=>({..._,isLoading:!1,error:p.message||"Connection error",isConnected:!1})))}finally{P.current=null}}},[s,t,r,a,c]);l.useEffect(()=>{if(!h){x.current&&(clearInterval(x.current),x.current=null),n(p=>({...p,isPaused:!!i}));return}return n(p=>({...p,isConnected:!0,isPaused:!1})),j(),x.current=setInterval(j,b),()=>{x.current&&(clearInterval(x.current),x.current=null),P.current&&(P.current.abort(),P.current=null)}},[h,j,b,i]);const B=l.useCallback(()=>{j()},[j]);return{...o,refetch:B}}function re(s,t){if(s!=null)return!t||t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function ht(s,t,r,a,c,u,i={enabled:!0,oiRefreshInterval:3e4,pauseWhenHidden:!0}){const{enabled:b,oiRefreshInterval:y=3e4,pauseWhenHidden:S=!0}=i,[o,n]=l.useState(null),[x,P]=l.useState(null),{data:h,isLoading:j,isConnected:B,isPaused:p,error:_,lastUpdate:m,refetch:D}=pt(s,t,r,c,u,{enabled:b,refreshInterval:y,pauseWhenHidden:S}),T=l.useMemo(()=>{const N=[],Q=a==="BFO"?"BSE_INDEX":"NSE_INDEX";if(N.push({symbol:t,exchange:Q}),h?.chain)for(const q of h.chain)q.ce?.symbol&&N.push({symbol:q.ce.symbol,exchange:a}),q.pe?.symbol&&N.push({symbol:q.pe.symbol,exchange:a});return N},[h?.chain,a,t]),{data:C,isConnected:F,isAuthenticated:f,isPaused:V}=Ue({symbols:T,mode:"Depth",enabled:b&&T.length>0,pauseWhenHidden:S}),Y=l.useRef(0);l.useEffect(()=>{if(!h){n(null);return}if(C.size===0){n(h);return}const N=h.chain.map(k=>{const L={...k};if(k.ce?.symbol){const g=`${a}:${k.ce.symbol}`,R=C.get(g);if(R?.data){const X=R.data.depth?.buy?.[0],A=R.data.depth?.sell?.[0],d=k.ce.tick_size;L.ce={...k.ce,ltp:re(R.data.ltp,d)??k.ce.ltp,bid:re(X?.price??R.data.bid_price,d)??k.ce.bid,ask:re(A?.price??R.data.ask_price,d)??k.ce.ask,bid_qty:X?.quantity??R.data.bid_size??k.ce.bid_qty??0,ask_qty:A?.quantity??R.data.ask_size??k.ce.ask_qty??0}}}if(k.pe?.symbol){const g=`${a}:${k.pe.symbol}`,R=C.get(g);if(R?.data){const X=R.data.depth?.buy?.[0],A=R.data.depth?.sell?.[0],d=k.pe.tick_size;L.pe={...k.pe,ltp:re(R.data.ltp,d)??k.pe.ltp,bid:re(X?.price??R.data.bid_price,d)??k.pe.bid,ask:re(A?.price??R.data.ask_price,d)??k.pe.ask,bid_qty:X?.quantity??R.data.bid_size??k.pe.bid_qty??0,ask_qty:A?.quantity??R.data.ask_size??k.pe.ask_qty??0}}}return L});let Q=!1;for(const[,k]of C)if(k.lastUpdate&&k.lastUpdate>Y.current){Q=!0,Y.current=k.lastUpdate;break}Q&&P(new Date);const v=`${a==="BFO"?"BSE_INDEX":"NSE_INDEX"}:${t}`,U=C.get(v)?.data?.ltp??h.underlying_ltp;n({...h,underlying_ltp:U,chain:N})},[h,C,a,t]);const E=F&&f&&T.length>0,H=p||V,J=l.useMemo(()=>!m&&!x?null:m?x&&x>m?x:m:x,[m,x]);return{data:o,isLoading:j,isConnected:B,isStreaming:E,isPaused:H,error:_,lastUpdate:J,streamingSymbols:T.length,refetch:D}}const W=[{key:"ce_oi",label:"OI",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_volume",label:"Volume",side:"ce",width:"w-20",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid_qty",label:"Bid Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_bid",label:"Bid",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ltp",label:"LTP",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask",label:"Ask",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"price"},{key:"ce_ask_qty",label:"Ask Qty",side:"ce",width:"w-16",align:"right",defaultVisible:!0,formatter:"number"},{key:"ce_spread",label:"Spread",side:"ce",width:"w-14",align:"right",defaultVisible:!0,formatter:"spread"},{key:"strike",label:"Strike",side:"center",width:"w-20",align:"center",defaultVisible:!0,formatter:"none"},{key:"pe_spread",label:"Spread",side:"pe",width:"w-14",align:"left",defaultVisible:!0,formatter:"spread"},{key:"pe_ask_qty",label:"Ask Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_ask",label:"Ask",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_ltp",label:"LTP",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid",label:"Bid",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"price"},{key:"pe_bid_qty",label:"Bid Qty",side:"pe",width:"w-16",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_volume",label:"Volume",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"},{key:"pe_oi",label:"OI",side:"pe",width:"w-20",align:"left",defaultVisible:!0,formatter:"number"}],ft=W.map(s=>s.key),gt=W.filter(s=>s.defaultVisible).map(s=>s.key),Z={visibleColumns:gt,columnOrder:ft,strikeCount:10,selectedUnderlying:"NIFTY",barDataSource:"oi",barStyle:"gradient"},Ye="openalgo_option_chain_prefs";function bt(){if(typeof window>"u")return Z;try{const s=localStorage.getItem(Ye);if(!s)return Z;const t=JSON.parse(s),r=new Set(W.map(i=>i.key)),a=Array.isArray(t.visibleColumns)?t.visibleColumns.filter(i=>r.has(i)):Z.visibleColumns;a.includes("strike")||a.push("strike");const c=Array.isArray(t.columnOrder)?t.columnOrder.filter(i=>r.has(i)):Z.columnOrder,u=new Set(c);return Z.columnOrder.forEach(i=>{u.has(i)||c.push(i)}),{visibleColumns:a,columnOrder:c,strikeCount:typeof t.strikeCount=="number"&&t.strikeCount>0?t.strikeCount:Z.strikeCount,selectedUnderlying:typeof t.selectedUnderlying=="string"&&t.selectedUnderlying?t.selectedUnderlying:Z.selectedUnderlying,barDataSource:t.barDataSource==="oi"||t.barDataSource==="volume"?t.barDataSource:Z.barDataSource,barStyle:t.barStyle==="gradient"||t.barStyle==="solid"?t.barStyle:Z.barStyle}}catch{return Z}}function jt(s){if(!(typeof window>"u"))try{localStorage.setItem(Ye,JSON.stringify(s))}catch{}}function yt(){const[s,t]=l.useState(()=>bt());l.useEffect(()=>{jt(s)},[s]);const r=l.useCallback(n=>{n!=="strike"&&t(x=>{const h=x.visibleColumns.includes(n)?x.visibleColumns.filter(j=>j!==n):[...x.visibleColumns,n];return{...x,visibleColumns:h}})},[]),a=l.useCallback(n=>{t(x=>({...x,columnOrder:n}))},[]),c=l.useCallback(n=>{t(x=>({...x,strikeCount:n}))},[]),u=l.useCallback(n=>{t(x=>({...x,selectedUnderlying:n}))},[]),i=l.useCallback(n=>{t(x=>({...x,barDataSource:n}))},[]),b=l.useCallback(n=>{t(x=>({...x,barStyle:n}))},[]),y=l.useCallback(()=>{t(Z)},[]),S=l.useCallback(n=>s.visibleColumns.includes(n),[s.visibleColumns]),o=l.useCallback(()=>s.columnOrder.filter(n=>s.visibleColumns.includes(n)),[s.columnOrder,s.visibleColumns]);return{preferences:s,visibleColumns:s.visibleColumns,columnOrder:s.columnOrder,strikeCount:s.strikeCount,selectedUnderlying:s.selectedUnderlying,barDataSource:s.barDataSource,barStyle:s.barStyle,toggleColumn:r,reorderColumns:a,setStrikeCount:c,setSelectedUnderlying:u,setBarDataSource:i,setBarStyle:b,resetToDefaults:y,isColumnVisible:S,getOrderedVisibleColumns:o}}const Nt={getOptionChain:async(s,t,r,a,c)=>(await De.post("/optionchain",{apikey:s,underlying:t,exchange:r,expiry_date:a,strike_count:c??20})).data,getExpiries:async(s,t,r,a="options")=>(await De.post("/expiry",{apikey:s,symbol:t,exchange:r,instrumenttype:a})).data};function vt({barDataSource:s,barStyle:t,onBarDataSourceChange:r,onBarStyleChange:a}){return e.jsxs(Ie,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Bar settings"})]})}),e.jsxs(Fe,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"Bar Data"}),e.jsxs(ke,{value:s,onValueChange:c=>r(c),children:[e.jsx(pe,{value:"oi",children:"Open Interest"}),e.jsx(pe,{value:"volume",children:"Volume"})]}),e.jsx(Ne,{}),e.jsx(ge,{children:"Bar Style"}),e.jsxs(ke,{value:t,onValueChange:c=>a(c),children:[e.jsx(pe,{value:"gradient",children:"Gradient"}),e.jsx(pe,{value:"solid",children:"Solid"})]})]})]})}function Ct({visibleColumns:s,onToggleColumn:t,onResetToDefaults:r}){const a=W.filter(i=>i.side==="ce"),c=W.filter(i=>i.side==="pe"),u=i=>s.includes(i);return e.jsxs(Ie,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(Je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Column settings"})]})}),e.jsxs(Fe,{align:"end",className:"w-48",children:[e.jsx(ge,{children:"CALLS Columns"}),a.map(i=>e.jsx(_e,{checked:u(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ne,{}),e.jsx(ge,{children:"PUTS Columns"}),c.map(i=>e.jsx(_e,{checked:u(i.key),onCheckedChange:()=>t(i.key),children:i.label},i.key)),e.jsx(Ne,{}),e.jsxs($,{variant:"ghost",size:"sm",className:"w-full justify-start px-2",onClick:r,children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"Reset to Defaults"]})]})]})}function Le({columnKey:s,label:t,side:r,isVisible:a,isDragging:c,onDragStart:u,onDragOver:i,onDrop:b,onDragEnd:y}){return e.jsxs("div",{draggable:!0,onDragStart:S=>u(S,s),onDragOver:i,onDrop:S=>b(S,s),onDragEnd:y,className:w("flex items-center gap-2 rounded-md border px-3 py-2 cursor-grab active:cursor-grabbing transition-all",c&&"opacity-50 border-dashed",a?"bg-card":"bg-muted/50 opacity-60",r==="ce"?"border-l-2 border-l-green-500":"border-r-2 border-r-red-500"),children:[e.jsx(tt,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"}),e.jsx("span",{className:"text-sm flex-1",children:t}),e.jsx("span",{className:w("text-xs px-1.5 py-0.5 rounded",r==="ce"?"bg-green-500/10 text-green-500":"bg-red-500/10 text-red-500"),children:r==="ce"?"CE":"PE"})]})}function St({columnOrder:s,visibleColumns:t,onReorderColumns:r}){const[a,c]=l.useState(s),[u,i]=l.useState(null),[b,y]=l.useState(!1),S=a.filter(m=>W.find(T=>T.key===m)?.side==="ce"),o=a.filter(m=>W.find(T=>T.key===m)?.side==="pe"),n=m=>W.find(T=>T.key===m)?.label??m,x=m=>W.find(T=>T.key===m)?.side==="pe"?"pe":"ce",P=(m,D)=>{i(D),m.dataTransfer.effectAllowed="move",m.dataTransfer.setData("text/plain",D)},h=m=>{m.preventDefault(),m.dataTransfer.dropEffect="move"},j=(m,D)=>{if(m.preventDefault(),!u||u===D)return;const T=x(u),C=x(D);if(T!==C)return;const F=[...a],f=F.indexOf(u),V=F.indexOf(D);F.splice(f,1),F.splice(V,0,u),c(F)},B=()=>{i(null)},p=()=>{r(a),y(!1)},_=m=>{y(m),m&&c(s)};return e.jsxs(Ve,{open:b,onOpenChange:_,children:[e.jsx(rt,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"icon",className:"h-9 w-9",children:[e.jsx(et,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Reorder columns"})]})}),e.jsxs(qe,{className:"sm:max-w-md",children:[e.jsxs(Ae,{children:[e.jsx(ze,{children:"Reorder Columns"}),e.jsx(lt,{children:"Drag columns to reorder them. CE and PE columns can only be reordered within their respective sections."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-green-500",children:"CALLS (CE)"}),e.jsx(Pe,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:S.map(m=>e.jsx(Le,{columnKey:m,label:n(m),side:"ce",isVisible:t.includes(m),isDragging:u===m,onDragStart:P,onDragOver:h,onDrop:j,onDragEnd:B},m))})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-red-500",children:"PUTS (PE)"}),e.jsx(Pe,{className:"h-64 pr-2",children:e.jsx("div",{className:"space-y-1.5",children:o.map(m=>e.jsx(Le,{columnKey:m,label:n(m),side:"pe",isVisible:t.includes(m),isDragging:u===m,onDragStart:P,onDragOver:h,onDrop:j,onDragEnd:B},m))})})]})]}),e.jsxs($e,{className:"gap-2 sm:gap-0",children:[e.jsx(it,{asChild:!0,children:e.jsx($,{variant:"outline",children:"Cancel"})}),e.jsx($,{onClick:p,children:"Save Order"})]})]})]})}function wt(s){switch(s){case"NFO":return"bg-purple-500/20 text-purple-400 border-purple-500/30";case"BFO":return"bg-amber-500/20 text-amber-400 border-amber-500/30";case"NSE":return"bg-blue-500/20 text-blue-400 border-blue-500/30";case"BSE":return"bg-pink-500/20 text-pink-400 border-pink-500/30";case"MCX":return"bg-orange-500/20 text-orange-400 border-orange-500/30";case"CDS":return"bg-cyan-500/20 text-cyan-400 border-cyan-500/30";case"BCD":return"bg-rose-500/20 text-rose-400 border-rose-500/30";default:return"bg-gray-500/20 text-gray-400 border-gray-500/30"}}function Dt({exchange:s,ltp:t,prevClose:r,change:a,changePercent:c,bidPrice:u,askPrice:i,bidSize:b,askSize:y,isLoading:S}){const o=a??(t&&r?t-r:void 0),n=c??(o&&r?o/r*100:void 0),x=o!==void 0&&o>=0;return S?e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg animate-pulse",children:[e.jsx("div",{className:"h-4 bg-muted rounded w-24 mb-2"}),e.jsx("div",{className:"h-6 bg-muted rounded w-32"})]}):e.jsxs("div",{className:"p-3 bg-muted/30 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Re,{className:w("text-[10px] px-1.5 py-0",wt(s)),children:s}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl font-bold",children:t!==void 0?t.toFixed(2):"-"}),o!==void 0&&e.jsxs("span",{className:w("text-sm font-medium",x?"text-green-500":"text-red-500"),children:[x?"+":"",o.toFixed(2),n!==void 0&&e.jsxs("span",{className:"ml-1",children:["(",x?"+":"",n.toFixed(2),"%)"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm border-t border-border/50 pt-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Bid:"}),e.jsx("span",{className:"text-emerald-400 font-medium font-mono",children:u!==void 0&&u>0?u.toFixed(2):"-"}),b!==void 0&&b>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",b.toLocaleString()]})]}),e.jsx("div",{className:"text-muted-foreground",children:"|"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Ask:"}),e.jsx("span",{className:"text-rose-400 font-medium font-mono",children:i!==void 0&&i>0?i.toFixed(2):"-"}),y!==void 0&&y>0&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:["x",y.toLocaleString()]})]})]})]})}function Oe({price:s,quantity:t,maxQty:r,side:a}){const c=r>0?Math.min(t/r*100,100):0;return e.jsxs("div",{className:"relative flex items-center gap-2 py-1 px-2",children:[e.jsx("div",{className:"absolute inset-0 overflow-hidden",children:e.jsx("div",{className:w("absolute top-0 bottom-0 transition-all duration-300",a==="buy"?"left-0 bg-gradient-to-r from-emerald-500/20 to-transparent":"right-0 bg-gradient-to-l from-rose-500/20 to-transparent"),style:{width:`${c}%`}})}),e.jsx("span",{className:w("relative z-10 flex-1 font-mono text-xs",a==="buy"?"text-emerald-400":"text-rose-400"),children:s.toFixed(2)}),e.jsx("span",{className:"relative z-10 font-mono text-xs text-muted-foreground",children:t.toLocaleString()})]})}function kt({depth:s,isExpanded:t,onToggle:r,maxLevels:a=5}){const c=s?.buy?.slice(0,a)??[],u=s?.sell?.slice(0,a)??[],i=Math.max(...c.map(o=>o.quantity),1),b=Math.max(...u.map(o=>o.quantity),1),y=Math.max(i,b),S=c.length>0||u.length>0;return e.jsxs(ot,{open:t,onOpenChange:r,children:[e.jsxs(ct,{className:"flex items-center justify-between w-full py-2 px-3 bg-muted/20 rounded hover:bg-muted/30 transition-colors",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[t?"Hide":"Show"," Market Depth"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?"[-]":"[+]"})]}),e.jsx(dt,{children:S?e.jsxs("div",{className:"mt-2 border rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30",children:[e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-emerald-500 border-r",children:"Bids"}),e.jsx("div",{className:"px-2 py-1.5 text-xs font-medium text-rose-500",children:"Asks"})]}),e.jsxs("div",{className:"grid grid-cols-2 divide-x",children:[e.jsx("div",{className:"divide-y divide-border/50",children:c.length>0?c.map((o,n)=>e.jsx(Oe,{price:o.price,quantity:o.quantity,maxQty:y,side:"buy"},`buy-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})}),e.jsx("div",{className:"divide-y divide-border/50",children:u.length>0?u.map((o,n)=>e.jsx(Oe,{price:o.price,quantity:o.quantity,maxQty:y,side:"sell"},`sell-${n}`)):e.jsx("div",{className:"py-2 text-center text-xs text-muted-foreground",children:"-"})})]}),e.jsxs("div",{className:"grid grid-cols-2 bg-muted/30 border-t divide-x",children:[e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{className:"font-mono text-emerald-400",children:c.reduce((o,n)=>o+n.quantity,0).toLocaleString()})]}),e.jsxs("div",{className:"px-2 py-1.5 text-xs text-muted-foreground flex justify-between",children:[e.jsx("span",{className:"font-mono text-rose-400",children:u.reduce((o,n)=>o+n.quantity,0).toLocaleString()}),e.jsx("span",{children:"Total"})]})]})]}):e.jsx("div",{className:"py-4 text-center text-sm text-muted-foreground",children:"No depth data available"})})]})}function _t(s,t,r={}){const{enabled:a=!0,mode:c="Depth",useQuotesFallback:u=!0,useDepthFallback:i=!0,staleThreshold:b=5e3,refreshInterval:y=3e4,pauseWhenHidden:S=!0}=r,{apiKey:o}=Se(),{isMarketOpen:n}=Ke(),{isVisible:x,wasHidden:P,timeSinceHidden:h}=Be(),[j,B]=l.useState(null),[p,_]=l.useState(null),[m,D]=l.useState(!1),T=l.useRef(0),C=!!s&&!!t,F=l.useMemo(()=>C?[{symbol:s,exchange:t}]:[],[s,t,C]),{data:f,isConnected:V,isPaused:Y}=Ue({symbols:F,mode:c,enabled:a&&C,pauseWhenHidden:S}),E=f.get(`${t}:${s}`)?.data,H=f.get(`${t}:${s}`)?.lastUpdate,J=n(t),N=!!(V&&E&&H&&Date.now()-H<b),Q=N&&J&&!Y,q=l.useCallback(async()=>{if(!(!o||!C)){D(!0);try{const L=[];u&&L.push(ve.getQuotes(o,s,t).then(g=>{g.status==="success"&&g.data&&B(g.data)}).catch(()=>{console.debug("REST quotes fetch failed")})),i&&c==="Depth"&&L.push(ve.getDepth(o,s,t).then(g=>{g.status==="success"&&g.data&&_(g.data)}).catch(()=>{console.debug("REST depth fetch failed")})),await Promise.all(L),T.current=Date.now()}finally{D(!1)}}},[o,s,t,C,u,i,c]);l.useEffect(()=>{if(!a||!C||S&&!x)return;q();const L=setInterval(q,y);return()=>clearInterval(L)},[a,C,q,y,S,x]),l.useEffect(()=>{!P||!x||!a||!C||h>y&&q()},[P,x,h,y,a,C,q]),l.useEffect(()=>{B(null),_(null)},[s,t]);const v=l.useMemo(()=>{if(p)return{buy:p.bids.map(L=>({price:L.price,quantity:L.quantity})),sell:p.asks.map(L=>({price:L.price,quantity:L.quantity}))}},[p]),M=l.useMemo(()=>{const L=E?.depth??v,g=E?.depth?.buy?.[0]?.price??v?.buy?.[0]?.price??E?.bid_price??j?.bid,R=E?.depth?.sell?.[0]?.price??v?.sell?.[0]?.price??E?.ask_price??j?.ask,X=E?.depth?.buy?.[0]?.quantity??v?.buy?.[0]?.quantity??E?.bid_size,A=E?.depth?.sell?.[0]?.quantity??v?.sell?.[0]?.quantity??E?.ask_size;return{ltp:E?.ltp??p?.ltp??j?.ltp,open:E?.open??p?.open??j?.open,high:E?.high??p?.high??j?.high,low:E?.low??p?.low??j?.low,close:E?.close??p?.prev_close??j?.prev_close,volume:E?.volume??p?.volume??j?.volume,oi:p?.oi??j?.oi,change:E?.change,changePercent:E?.change_percent,bidPrice:g,askPrice:R,bidSize:X,askSize:A,depth:L}},[E,j,p,v]),U=l.useMemo(()=>{if(M.change!==void 0)return M;const L=M.ltp&&M.close?M.ltp-M.close:void 0,g=L&&M.close?L/M.close*100:void 0;return{...M,change:L,changePercent:g}},[M]),k=l.useMemo(()=>N?"websocket":j||p?"rest":"none",[N,j,p]);return{data:U,isLive:Q,isConnected:V,isLoading:m&&!j&&!p,isPaused:Y,dataSource:k,refresh:q}}const Et=[{value:"MARKET",label:"Market"},{value:"LIMIT",label:"Limit"},{value:"SL-M",label:"SL-M"},{value:"SL",label:"SL-L"}],Pt=[{value:"NRML",label:"NRML"},{value:"MIS",label:"MIS"}],Lt=[{value:"CNC",label:"CNC"},{value:"MIS",label:"MIS"}];function fe(s,t){return t<=0?s:Number((Math.round(s/t)*t).toFixed(2))}function he(s,t,r){const a=fe(s,t);return r==="up"?Number((a+t).toFixed(2)):Math.max(0,Number((a-t).toFixed(2)))}function Te(s){return["NFO","BFO","MCX","CDS","BCD","NCDEX"].includes(s)}function Ot({open:s,onOpenChange:t,symbol:r="",exchange:a="",action:c="BUY",quantity:u,lotSize:i=1,tickSize:b=.05,product:y="NRML",priceType:S="MARKET",strategy:o="OptionChain",onSuccess:n,onError:x}){const{apiKey:P}=Se(),[h,j]=l.useState(c),[B,p]=l.useState(u??i),[_,m]=l.useState(S),[D,T]=l.useState(y),[C,F]=l.useState(0),[f,V]=l.useState(0),[Y,E]=l.useState(!1),[H,J]=l.useState(!1),[N,Q]=l.useState("lots"),[q,v]=l.useState(1),M=Te(a)?Pt:Lt,{data:U,isLoading:k,isConnected:L}=_t(r,a,{enabled:s&&!!r&&!!a,mode:"Depth",useQuotesFallback:!0,useDepthFallback:!0});l.useEffect(()=>{if(s){j(c),p(u??i),m(S);const O=Te(a),K=O?"NRML":"CNC",xe=y&&(O?["NRML","MIS"]:["CNC","MIS"]).includes(y)?y:K;T(xe),F(0),V(0),J(!1),Q("lots"),v(1)}},[s,c,u,i,S,y,a]);const g={ltp:U.ltp,close:U.close,change:U.change,change_percent:U.changePercent,bidPrice:U.bidPrice,askPrice:U.askPrice,bidSize:U.bidSize,askSize:U.askSize,depth:U.depth},R=g.change,X=g.change_percent;l.useEffect(()=>{_!=="MARKET"&&g.ltp&&C===0&&F(fe(g.ltp,b))},[_,g.ltp,C,b]);const A=_==="LIMIT"||_==="SL",d=_==="SL-M"||_==="SL",I=l.useCallback(()=>!(!r||!a||!P||B<=0||A&&C<=0||d&&f<=0),[r,a,P,B,A,C,d,f]),z=async()=>{if(!I()){le.error("Please fill all required fields");return}if(!P){le.error("API key not found. Please set up your API key."),x?.("API key not found");return}E(!0);try{const K={apikey:P,strategy:o,exchange:a,symbol:r,action:h,quantity:B,pricetype:_,product:D,...A&&{price:C},...d&&{trigger_price:f}},G=await ve.placeOrder(K),xe=G.orderid;if(G.status==="success"&&xe)n?.(xe),t(!1);else{const we=G.message||"Order placement failed";le.error(we,"orders"),x?.(we)}}catch(O){let K="Order placement failed";if(O&&typeof O=="object"){const G=O;G.response?.data?.message?K=G.response.data.message:G.message&&(K=G.message)}le.error(K,"orders"),x?.(K)}finally{E(!1)}},Qe=O=>{const K=parseInt(O)||0;if(N==="lots")p(K*i),v(K);else{const G=Math.max(i,Math.round(K/i)*i);p(G),v(G/i)}},We=N==="lots"?q:B,Xe=k&&!g.ltp&&!L;return e.jsx(Ve,{open:s,onOpenChange:t,children:e.jsxs(qe,{className:"sm:max-w-[420px]","aria-describedby":void 0,children:[e.jsx(Ae,{children:e.jsxs(ze,{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Place Order -"}),e.jsx("span",{className:h==="BUY"?"text-green-500":"text-red-500",children:h}),e.jsx("span",{className:"text-muted-foreground font-normal text-sm truncate",children:r})]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsx(Dt,{exchange:a,ltp:g.ltp,prevClose:g.close,change:R,changePercent:X,bidPrice:g.bidPrice,askPrice:g.askPrice,bidSize:g.bidSize,askSize:g.askSize,isLoading:Xe}),e.jsx(kt,{depth:g.depth,isExpanded:H,onToggle:()=>J(!H),maxLevels:5}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Action"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",variant:h==="BUY"?"default":"outline",className:w("flex-1",h==="BUY"&&"bg-green-600 hover:bg-green-700"),onClick:()=>j("BUY"),children:"BUY"}),e.jsx($,{type:"button",variant:h==="SELL"?"default":"outline",className:w("flex-1",h==="SELL"&&"bg-red-600 hover:bg-red-700"),onClick:()=>j("SELL"),children:"SELL"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(te,{className:"text-xs",children:"Quantity"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:()=>Q("lots"),className:w("px-2 py-0.5 text-[10px] rounded",N==="lots"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Lots"}),e.jsx("button",{type:"button",onClick:()=>Q("shares"),className:w("px-2 py-0.5 text-[10px] rounded",N==="shares"?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground hover:bg-muted/80"),children:"Shares"})]})]}),e.jsx(be,{type:"number",value:We,onChange:O=>Qe(O.target.value),min:1}),e.jsxs("div",{className:"flex justify-between text-[10px] text-muted-foreground",children:[e.jsxs("span",{children:["Lot size: ",i]}),e.jsxs("span",{children:["Total qty: ",B]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price Type"}),e.jsxs(oe,{value:_,onValueChange:O=>m(O),children:[e.jsx(ce,{children:e.jsx(de,{})}),e.jsx(ue,{children:Et.map(O=>e.jsx(me,{value:O.value,children:O.label},O.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Product"}),e.jsxs(oe,{value:D,onValueChange:O=>T(O),children:[e.jsx(ce,{children:e.jsx(de,{})}),e.jsx(ue,{children:M.map(O=>e.jsx(me,{value:O.value,children:O.label},O.value))})]})]})]}),A&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>F(he(C,b,"down")),children:"-"}),e.jsx(be,{type:"number",value:C,onChange:O=>F(parseFloat(O.target.value)||0),onBlur:()=>F(fe(C,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>F(he(C,b,"up")),children:"+"})]}),e.jsxs("p",{className:"text-[10px] text-muted-foreground",children:["Tick size: ",b]})]}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{className:"text-xs",children:"Trigger Price"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>V(he(f,b,"down")),children:"-"}),e.jsx(be,{type:"number",value:f,onChange:O=>V(parseFloat(O.target.value)||0),onBlur:()=>V(fe(f,b)),className:"flex-1 text-center",step:b,min:0}),e.jsx($,{type:"button",variant:"outline",size:"sm",className:"px-2",onClick:()=>V(he(f,b,"up")),children:"+"})]})]})]}),e.jsxs($e,{className:"gap-2 sm:gap-0",children:[e.jsx($,{variant:"outline",onClick:()=>t(!1),disabled:Y,children:"Cancel"}),e.jsx($,{onClick:z,disabled:!I()||Y,className:w(h==="BUY"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:Y?"Placing...":`Place ${h} Order`})]})]})})}const ye=[{value:"NIFTY",label:"NIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"BANKNIFTY",label:"BANKNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"SENSEX",label:"SENSEX",exchange:"BFO",brokerExchange:"BSE_INDEX"},{value:"FINNIFTY",label:"FINNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"},{value:"MIDCPNIFTY",label:"MIDCPNIFTY",exchange:"NFO",brokerExchange:"NSE_INDEX"}],Tt=[{value:5,label:"5 strikes"},{value:10,label:"10 strikes"},{value:15,label:"15 strikes"},{value:20,label:"20 strikes"},{value:25,label:"25 strikes"}];function ie(s){if(s==null||s===0)return"0";const t=s/1e5;if(t>=100)return t.toFixed(0)+"L";if(t>=10)return t.toFixed(1)+"L";if(t>=1)return t.toFixed(2)+"L";{const r=s/1e3;return r>=1?r.toFixed(1)+"K":s.toLocaleString()}}function ee(s){return s==null?"0.00":s.toFixed(2)}function It(s){if(!s)return"";const t=s.split("-");return t.length===3?`${t[0]}${t[1].toUpperCase()}${t[2].slice(-2)}`:s.replace(/-/g,"").toUpperCase()}function Mt(s){let t=0,r=0;return s.forEach(a=>{a.ce?.oi&&(t+=a.ce.oi),a.pe?.oi&&(r+=a.pe?.oi??0)}),t===0?0:r/t}function Ft(s){let t=0,r=0,a=0,c=0;return s.forEach(u=>{u.ce&&(t+=u.ce.volume??0,a+=u.ce.oi??0),u.pe&&(r+=u.pe.volume??0,c+=u.pe.oi??0)}),{ceVolume:t,peVolume:r,ceOi:a,peOi:c}}function Rt(s,t){let r=0;return s.forEach(a=>{const c=t==="oi"?a.ce?.oi:a.ce?.volume,u=t==="oi"?a.pe?.oi:a.pe?.volume;c&&c>r&&(r=c),u&&u>r&&(r=u)}),r||1}const Bt=He.memo(function({strike:t,previousStrike:r,maxBarValue:a,visibleCeColumns:c,visiblePeColumns:u,barDataSource:i,barStyle:b,optionExchange:y,onPlaceOrder:S}){const o=t.ce,n=t.pe,x=o?.label??n?.label??"",P=x==="ATM",h=x.startsWith("OTM"),j=x.startsWith("ITM"),B=r?.ce?.ltp!==void 0&&r.ce.ltp!==o?.ltp,p=r?.pe?.ltp!==void 0&&r.pe.ltp!==n?.ltp,_=B?o&&r?.ce&&o.ltp>r.ce.ltp?"bg-green-500/30":"bg-red-500/30":"",m=p?n&&r?.pe&&n.ltp>r.pe.ltp?"bg-green-500/30":"bg-red-500/30":"",D=o&&o.bid>0&&o.ask>0?o.ask-o.bid:0,T=n&&n.bid>0&&n.ask>0?n.ask-n.bid:0,C=D<=1?"text-green-500":D<=2?"text-yellow-500":"text-red-500",F=T<=1?"text-green-500":T<=2?"text-yellow-500":"text-red-500",f=i==="oi"?o?.oi:o?.volume,V=i==="oi"?n?.oi:n?.volume,Y=f?Math.min(f/a*100,100):0,E=V?Math.min(V/a*100,100):0,H=b==="gradient"?"bg-gradient-to-r from-green-500/25 to-transparent":"bg-green-500/20",J=b==="gradient"?"bg-gradient-to-l from-red-500/25 to-transparent":"bg-red-500/20",N="font-mono tabular-nums text-xs",Q=v=>{switch(v){case"ce_oi":return e.jsx("span",{className:N,children:ie(o?.oi)});case"ce_volume":return e.jsx("span",{className:N,children:ie(o?.volume)});case"ce_bid_qty":return e.jsx("span",{className:N,children:o?.bid_qty??0});case"ce_bid":return e.jsx("span",{className:w(N,"text-red-500"),children:ee(o?.bid)});case"ce_ltp":return e.jsx("span",{className:w(N,"font-semibold",_),children:ee(o?.ltp)});case"ce_ask":return e.jsx("span",{className:w(N,"text-green-500"),children:ee(o?.ask)});case"ce_ask_qty":return e.jsx("span",{className:N,children:o?.ask_qty??0});case"ce_spread":return e.jsx("span",{className:w(N,C),children:ee(D)});default:return null}},q=v=>{switch(v){case"pe_oi":return e.jsx("span",{className:N,children:ie(n?.oi)});case"pe_volume":return e.jsx("span",{className:N,children:ie(n?.volume)});case"pe_bid_qty":return e.jsx("span",{className:N,children:n?.bid_qty??0});case"pe_bid":return e.jsx("span",{className:w(N,"text-red-500"),children:ee(n?.bid)});case"pe_ltp":return e.jsx("span",{className:w(N,"font-semibold",m),children:ee(n?.ltp)});case"pe_ask":return e.jsx("span",{className:w(N,"text-green-500"),children:ee(n?.ask)});case"pe_ask_qty":return e.jsx("span",{className:N,children:n?.ask_qty??0});case"pe_spread":return e.jsx("span",{className:w(N,F),children:ee(T)});default:return null}};return e.jsxs(Ce,{className:w("hover:bg-muted/50 relative group"),"data-strike":t.strike,"data-label":x,children:[c.length>0&&e.jsxs(je,{className:w("p-0 relative",h&&!P&&"bg-amber-500/5"),children:[e.jsx("div",{className:w("absolute left-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",H),style:{width:`${Y}%`}}),o&&e.jsxs("div",{className:w("absolute right-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:o.symbol,exchange:y,action:"BUY",lotSize:o.lotsize??1,tickSize:o.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:o.symbol,exchange:y,action:"SELL",lotSize:o.lotsize??1,tickSize:o.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:c.map(v=>{const M=W.find(U=>U.key===v);return e.jsx("div",{className:w("flex-1 px-2 py-1.5 min-w-0",M?.align==="right"&&"text-right",M?.align==="center"&&"text-center",M?.align==="left"&&"text-left"),children:Q(v)},v)})})]}),e.jsx(je,{className:w("text-center font-bold px-2 py-1.5 text-sm w-20 min-w-20",P?"bg-primary/15":"bg-muted/30"),children:t.strike}),u.length>0&&e.jsxs(je,{className:w("p-0 relative",j&&!P&&"bg-amber-500/5"),children:[e.jsx("div",{className:w("absolute right-0 top-0 bottom-0 pointer-events-none z-0 transition-all duration-300",J),style:{width:`${E}%`}}),n&&e.jsxs("div",{className:w("absolute left-1 top-1/2 -translate-y-1/2 z-20","flex gap-0.5","opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:n.symbol,exchange:y,action:"BUY",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-green-600 text-white hover:bg-green-700",children:"B"}),e.jsx("button",{onClick:v=>{v.stopPropagation(),S({symbol:n.symbol,exchange:y,action:"SELL",lotSize:n.lotsize??1,tickSize:n.tick_size??.05})},className:"px-1.5 py-0.5 text-[10px] font-bold rounded bg-amber-600 text-white hover:bg-amber-700",children:"S"})]}),e.jsx("div",{className:"relative z-10 flex",children:u.map(v=>{const M=W.find(U=>U.key===v);return e.jsx("div",{className:w("flex-1 px-2 py-1.5 min-w-0",M?.align==="right"&&"text-right",M?.align==="center"&&"text-center",M?.align==="left"&&"text-left"),children:q(v)},v)})})]})]})});function ts(){const{apiKey:s}=Se(),{visibleColumns:t,columnOrder:r,strikeCount:a,selectedUnderlying:c,barDataSource:u,barStyle:i,toggleColumn:b,reorderColumns:y,setStrikeCount:S,setSelectedUnderlying:o,setBarDataSource:n,setBarStyle:x,resetToDefaults:P}=yt(),[h,j]=l.useState(""),[B,p]=l.useState([]),_=l.useRef(new Map),[m,D]=l.useState(null),T=ye.find(d=>d.value===c),C=T?.brokerExchange??"NSE_INDEX",F=T?.exchange??"NFO",{data:f,isConnected:V,isStreaming:Y,isPaused:E,error:H,lastUpdate:J,refetch:N,isLoading:Q,streamingSymbols:q}=ht(s,c,C,F,It(h),a,{enabled:!!h,oiRefreshInterval:3e4,pauseWhenHidden:!0});l.useEffect(()=>{(async()=>{if(!(!s||!c))try{const I=await Nt.getExpiries(s,c,F);I.status==="success"&&I.data.length>0?(p(I.data),j(z=>z||I.data[0])):le.error(I.message||"Failed to load expiries")}catch(I){console.error("Error loading expiries:",I),le.error("Failed to load expiry dates")}})()},[s,c,F]),l.useEffect(()=>{if(f?.chain){const d=setTimeout(()=>{const I=new Map;f.chain.forEach(z=>{I.set(z.strike,z)}),_.current=I},100);return()=>clearTimeout(d)}},[f?.chain]);const v=d=>{ye.find(z=>z.value===d)&&(o(d),j(""),p([]))},M=()=>{N()},U=l.useCallback(d=>{D({open:!0,symbol:d.symbol,exchange:d.exchange,action:d.action,quantity:d.lotSize,lotSize:d.lotSize,tickSize:d.tickSize})},[]),k=l.useCallback(d=>{d||D(null)},[]),L=l.useMemo(()=>f?.chain?Mt(f.chain):0,[f?.chain]),g=l.useMemo(()=>f?.chain?Ft(f.chain):{ceVolume:0,peVolume:0,ceOi:0,peOi:0},[f?.chain]),R=l.useMemo(()=>f?.chain?Rt(f.chain,u):1,[f?.chain,u]),X=l.useMemo(()=>r.filter(d=>W.find(z=>z.key===d)?.side==="ce"&&t.includes(d)),[r,t]),A=l.useMemo(()=>r.filter(d=>W.find(z=>z.key===d)?.side==="pe"&&t.includes(d)),[r,t]);return H?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx(se,{className:"max-w-md",children:e.jsx(ae,{className:"p-6",children:e.jsxs("div",{className:"text-center text-red-500",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Error Loading Option Chain"}),e.jsx("p",{children:H}),e.jsxs($,{onClick:M,className:"mt-4",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Retry"]})]})})})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(st,{className:"h-6 w-6"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Option Chain"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(oe,{value:c,onValueChange:v,children:[e.jsx(ce,{className:"w-36",children:e.jsx(de,{placeholder:"Select Underlying"})}),e.jsx(ue,{children:ye.map(d=>e.jsx(me,{value:d.value,children:d.label},d.value))})]}),e.jsxs(oe,{value:h,onValueChange:j,disabled:B.length===0,children:[e.jsx(ce,{className:"w-36",children:e.jsx(de,{placeholder:"Select Expiry"})}),e.jsx(ue,{children:B.map(d=>e.jsx(me,{value:d,children:d},d))})]}),e.jsxs(oe,{value:String(a),onValueChange:d=>S(Number(d)),children:[e.jsx(ce,{className:"w-36",children:e.jsx(de,{placeholder:"Strike Count"})}),e.jsx(ue,{children:Tt.map(d=>e.jsx(me,{value:String(d.value),children:d.label},d.value))})]}),e.jsx(vt,{barDataSource:u,barStyle:i,onBarDataSourceChange:n,onBarStyleChange:x}),e.jsx(Ct,{visibleColumns:t,onToggleColumn:b,onResetToDefaults:P}),e.jsx(St,{columnOrder:r,visibleColumns:t,onReorderColumns:y}),e.jsxs($,{onClick:M,disabled:!h||Q,children:[e.jsx(Ee,{className:`h-4 w-4 mr-2 ${Q?"animate-spin":""}`}),"Refresh"]})]})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[c," Spot"]}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:ee(f.underlying_ltp)}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Prev Close: ",ee(f.underlying_prev_close)]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"ATM Strike"}),e.jsx("div",{className:"text-2xl font-bold",children:f.atm_strike}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Expiry: ",f.expiry_date]})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"PCR"}),e.jsx("div",{className:`text-2xl font-bold ${L>1?"text-green-500":"text-yellow-500"}`,children:L.toFixed(2)}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Put/Call Ratio"})]})}),e.jsx(se,{children:e.jsxs(ae,{className:"p-4",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total OI"}),e.jsxs("div",{className:"text-sm mt-1",children:[e.jsx("span",{className:"text-green-500 font-mono tabular-nums",children:ie(g.ceOi)}),e.jsx("span",{className:"mx-2 text-muted-foreground",children:"|"}),e.jsx("span",{className:"text-red-500 font-mono tabular-nums",children:ie(g.peOi)})]}),e.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden mt-2",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-primary transition-all duration-500",style:{width:g.ceOi+g.peOi>0?`${g.ceOi/(g.ceOi+g.peOi)*100}%`:"0%"}})}),e.jsx("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:e.jsxs("span",{children:["PCR: ",L.toFixed(2)]})})]})})]}),e.jsx(se,{children:e.jsx(ae,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ut,{className:"w-full table-fixed",children:[e.jsxs(mt,{children:[e.jsxs(Ce,{className:"bg-muted/30 border-b-0",children:[X.length>0&&e.jsx(ne,{className:"text-center text-green-500 font-bold text-sm border-r border-border",children:"CALLS"}),e.jsx(ne,{className:"text-center w-20 min-w-20"}),A.length>0&&e.jsx(ne,{className:"text-center text-red-500 font-bold text-sm border-l border-border",children:"PUTS"})]}),e.jsxs(Ce,{className:"bg-muted/50",children:[X.length>0&&e.jsx(ne,{className:"p-0 border-r border-border",children:e.jsx("div",{className:"flex",children:X.map(d=>{const I=W.find(z=>z.key===d);return e.jsx("div",{className:w("flex-1 px-2 py-2 text-xs font-medium min-w-0",I?.align==="right"&&"text-right",I?.align==="center"&&"text-center",I?.align==="left"&&"text-left"),children:I?.label},d)})})}),e.jsx(ne,{className:"text-center bg-muted/30 text-xs w-20 min-w-20",children:"Strike"}),A.length>0&&e.jsx(ne,{className:"p-0 border-l border-border",children:e.jsx("div",{className:"flex",children:A.map(d=>{const I=W.find(z=>z.key===d);return e.jsx("div",{className:w("flex-1 px-2 py-2 text-xs font-medium min-w-0",I?.align==="right"&&"text-right",I?.align==="center"&&"text-center",I?.align==="left"&&"text-left"),children:I?.label},d)})})})]})]}),e.jsx(xt,{children:f.chain.map(d=>e.jsx(Bt,{strike:d,previousStrike:_.current.get(d.strike),maxBarValue:R,visibleCeColumns:X,visiblePeColumns:A,barDataSource:u,barStyle:i,optionExchange:F,onPlaceOrder:U},d.strike))})]})})})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Y?e.jsx(at,{className:"h-4 w-4 text-green-500"}):e.jsx(nt,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(Re,{variant:Y?"default":V?"secondary":"destructive",children:E?"Paused":Y?`Streaming ${q} symbols`:V?"Polling":"Disconnected"})]}),e.jsxs("div",{className:"text-xs",children:["Bar: ",u==="oi"?"OI":"Volume"," (",i,")"]})]}),e.jsxs("div",{children:["Last Update: ",J?J.toLocaleTimeString():"-"]})]})]}),!f&&!H&&e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),e.jsx(Ot,{open:m?.open??!1,onOpenChange:k,symbol:m?.symbol,exchange:m?.exchange,action:m?.action,quantity:m?.quantity,lotSize:m?.lotSize,tickSize:m?.tickSize,strategy:"OptionChain"})]})}export{ts as default};
