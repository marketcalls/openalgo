import{r,j as e}from"./vendor-react-RhKMXzW9.js";import{B as p,f as g,t as H}from"./index-BI1ZbBzK.js";import{A as v,a as C}from"./alert-Dmqvwunc.js";import{C as W,b as Z,c as U,a as Y}from"./card-C6VA_J5n.js";import{I as w}from"./input-rKQRdAl-.js";import{L as y}from"./label-Cl8hR1Lw.js";import{P as G}from"./progress-Cqyz6WrK.js";import{u as K,v as Q,w as ee,x as A,y as E,I as se,z as te,A as ae,s as re}from"./vendor-icons-Ca5eNZvr.js";import{L as O}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-DzupMptF.js";import"./vendor-radix-gKv__6YA.js";function je(){const[m,u]=r.useState("email"),[c,q]=r.useState(""),[N,L]=r.useState(""),[a,M]=r.useState(""),[h,D]=r.useState(""),[$,B]=r.useState(""),[i,o]=r.useState(!1),[S,l]=r.useState(""),[k,I]=r.useState(""),[d,z]=r.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[f,_]=r.useState(0),[j,T]=r.useState(null);r.useEffect(()=>{const s={length:a.length>=8,uppercase:/[A-Z]/.test(a),lowercase:/[a-z]/.test(a),number:/[0-9]/.test(a),special:/[!@#$%^&*]/.test(a)};z(s);let t=0;a.length>=8&&(t+=20),a.length>=12&&(t+=10),a.length>=16&&(t+=10),s.uppercase&&(t+=15),s.lowercase&&(t+=15),s.number&&(t+=15),s.special&&(t+=15),_(t)},[a]),r.useEffect(()=>{T(h===""?null:a===h)},[a,h]);const P=Object.values(d).every(Boolean)&&j===!0,R=()=>f>=80?{label:"Strong",color:"text-green-500"}:f>=50?{label:"Medium",color:"text-yellow-500"}:f>0?{label:"Weak",color:"text-red-500"}:{label:"",color:""},J=async s=>{s.preventDefault(),o(!0),l("");try{const t=await g(),n=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:"email",email:c})})).json();n.status==="success"?u("method"):l(n.message||"Email not found")}catch{l("Failed to process request")}finally{o(!1)}},F=async s=>{o(!0),l("");try{const t=await g(),n=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:`select_${s}`,email:c})})).json();n.status==="success"?u(s==="totp"?"totp":"email_sent"):l(n.message||"Failed to select method")}catch{l("Failed to process request")}finally{o(!1)}},X=async s=>{s.preventDefault(),o(!0),l("");try{const t=await g(),n=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:"totp",email:c,totp_code:N})})).json();n.status==="success"?(B(n.token||""),u("password")):l(n.message||"Invalid TOTP code")}catch{l("Failed to verify code")}finally{o(!1)}},V=async s=>{if(s.preventDefault(),!!P){o(!0),l("");try{const t=await g(),n=await(await fetch("/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t},credentials:"include",body:JSON.stringify({step:"password",email:c,token:$,password:a,confirm_password:h})})).json();n.status==="success"?(I("Password reset successfully! Redirecting to login..."),H.success("Password reset successfully!"),setTimeout(()=>{window.location.href="/login"},2e3)):l(n.message||"Failed to reset password")}catch{l("Failed to reset password")}finally{o(!1)}}},x=({met:s,label:t})=>e.jsxs("div",{className:`flex items-center gap-2 text-sm transition-colors ${s?"text-green-500":"text-muted-foreground"}`,children:[e.jsx(re,{className:`h-4 w-4 ${s?"opacity-100":"opacity-0"}`}),e.jsx("span",{children:t})]});return e.jsx("div",{className:"min-h-[calc(100vh-8rem)] flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-lg",children:e.jsxs(W,{children:[e.jsx(Z,{children:e.jsx(U,{className:"text-2xl",children:"Reset Password"})}),e.jsxs(Y,{className:"space-y-4",children:[S&&e.jsxs(v,{variant:"destructive",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(C,{children:S})]}),k&&e.jsxs(v,{className:"border-green-500 bg-green-50 dark:bg-green-950",children:[e.jsx(Q,{className:"h-4 w-4 text-green-500"}),e.jsx(C,{className:"text-green-700 dark:text-green-300",children:k})]}),m==="email"&&e.jsxs("form",{onSubmit:J,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"email",children:"Email Address"}),e.jsx(w,{id:"email",type:"email",value:c,onChange:s=>q(s.target.value),placeholder:"Enter your email",required:!0,autoFocus:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the email address associated with your account"})]}),e.jsx(p,{type:"submit",className:"w-full",disabled:i,children:i?"Processing...":"Continue"})]}),m==="method"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Choose Verification Method"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-2",children:"How would you like to verify your identity?"})]}),e.jsx("button",{type:"button",onClick:()=>F("totp"),disabled:i,className:"w-full p-4 rounded-lg border bg-muted/50 hover:bg-muted transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary flex items-center justify-center",children:e.jsx(ee,{className:"h-6 w-6 text-primary-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:"Authenticator App (TOTP)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use your authenticator app to generate a verification code"})]}),e.jsx(A,{className:"h-5 w-5 text-muted-foreground"})]})}),e.jsx("button",{type:"button",onClick:()=>F("email"),disabled:i,className:"w-full p-4 rounded-lg border bg-muted/50 hover:bg-muted transition-colors text-left",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-secondary flex items-center justify-center",children:e.jsx(E,{className:"h-6 w-6 text-secondary-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:"Email Reset Link"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive a password reset link via email"})]}),e.jsx(A,{className:"h-5 w-5 text-muted-foreground"})]})})]}),m==="totp"&&e.jsxs("form",{onSubmit:X,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"totp",children:"TOTP Code"}),e.jsx(w,{id:"totp",type:"text",value:N,onChange:s=>L(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",pattern:"[0-9]{6}",maxLength:6,className:"text-center text-2xl tracking-widest",required:!0,autoFocus:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the 6-digit code from your authenticator app"})]}),e.jsx(p,{type:"submit",className:"w-full",disabled:i||N.length!==6,children:i?"Verifying...":"Verify Code"})]}),m==="email_sent"&&e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-16 h-16 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx(E,{className:"h-8 w-8 text-white"})})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Check Your Email"}),e.jsxs("p",{className:"text-muted-foreground",children:["We've sent a password reset link to ",e.jsx("strong",{children:c}),". Click the link in the email to continue resetting your password."]}),e.jsxs(v,{children:[e.jsx(se,{className:"h-4 w-4"}),e.jsxs(C,{children:[e.jsx("strong",{children:"Didn't receive the email?"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Check your spam/junk folder"}),e.jsxs("li",{children:["Make sure ",c," is correct"]}),e.jsx("li",{children:"The link expires in 1 hour"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>u("method"),children:"Try Different Method"}),e.jsx(p,{size:"sm",asChild:!0,children:e.jsx(O,{to:"/login",children:"Back to Login"})})]})]}),m==="password"&&e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"password",children:"New Password"}),e.jsx(w,{id:"password",type:"password",value:a,onChange:s=>M(s.target.value),placeholder:"Enter new password",required:!0,autoFocus:!0}),e.jsx(G,{value:f,className:"h-2"}),a&&e.jsx("p",{className:`text-sm font-medium ${R().color}`,children:R().label})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"confirmPassword",children:"Confirm New Password"}),e.jsx(w,{id:"confirmPassword",type:"password",value:h,onChange:s=>D(s.target.value),placeholder:"Confirm new password",required:!0}),j!==null&&e.jsx("p",{className:`text-sm ${j?"text-green-500":"text-red-500"}`,children:j?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-2",children:[e.jsx(x,{met:d.length,label:"Minimum 8 characters"}),e.jsx(x,{met:d.uppercase,label:"At least 1 uppercase letter (A-Z)"}),e.jsx(x,{met:d.lowercase,label:"At least 1 lowercase letter (a-z)"}),e.jsx(x,{met:d.number,label:"At least 1 number (0-9)"}),e.jsx(x,{met:d.special,label:"At least 1 special character (!@#$%^&*)"})]}),e.jsxs(p,{type:"submit",className:"w-full",disabled:i||!P,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),i?"Resetting...":"Reset Password"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"OR"})})]}),e.jsx("div",{className:"text-center",children:e.jsxs(O,{to:"/login",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),"Back to Login"]})})]})]})})})}export{je as default};
