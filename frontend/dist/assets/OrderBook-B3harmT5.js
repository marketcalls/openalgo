import{r as a,j as e}from"./vendor-react-RhKMXzW9.js";import{d as fe,o as Ne,B as c,c as I,e as g,t as h,s as x}from"./index-BMUK8JJ8.js";import{t as C}from"./trading-cEnSDZz0.js";import{A as ve,a as ye,b as be,c as Ce,d as we,e as Oe,f as Se,g as De,h as Te}from"./alert-dialog-BpEhU5tN.js";import{C as N,b as w,d as O,c as S,a as ke}from"./card-LW4Ab5PL.js";import{D as Y,a as Ae,b as X,c as G,d as J,e as W,f as Z}from"./dialog-isTrH2B3.js";import{I as ee}from"./input-BUxN6OFh.js";import{L}from"./label-BfzNqE9j.js";import{T as Fe,a as _e,b as se,c as n,d as Ee,e as o}from"./table-Bjc3TaWi.js";import{Q as Me,R as Ie,D as Le,X as te,L as re,N as Re,_ as ae,C as Be,$ as qe}from"./vendor-icons-Vls1I20C.js";import"./vendor-syntax-D6hV6JR3.js";import"./vendor-router-DdyOoyPF.js";import"./vendor-radix-hRiDuY7W.js";function j(m){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2}).format(m)}function ze(m){try{return new Date(m).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return m}}const le={complete:{icon:Be,color:"text-green-500",label:"complete"},rejected:{icon:ae,color:"text-red-500",label:"rejected"},cancelled:{icon:ae,color:"text-gray-500",label:"cancelled"},open:{icon:Re,color:"text-blue-500",label:"open"}};function es(){const{apiKey:m}=fe(),[v,ie]=a.useState([]),[y,ce]=a.useState(null),[ne,R]=a.useState(!0),[B,q]=a.useState(!1),[z,F]=a.useState(null),[f,P]=a.useState([]),[oe,Q]=a.useState(!1),[de,D]=a.useState(!1),[l,xe]=a.useState(null),[u,H]=a.useState(null),[U,$]=a.useState(!1),[r,_]=a.useState({quantity:0,price:0,trigger_price:0,pricetype:"MARKET",product:"MIS"}),K=a.useMemo(()=>f.length===0?v:v.filter(s=>f.includes(s.order_status)),[v,f]),T=f.length>0,me=s=>{P(t=>t.includes(s)?t.filter(d=>d!==s):[...t,s])},E=()=>{P([])},p=a.useCallback(async(s=!1)=>{if(!m){R(!1);return}s&&q(!0);try{const t=await C.getOrders(m);t.status==="success"&&t.data?(ie(t.data.orders||[]),ce(t.data.statistics),F(null)):F(t.message||"Failed to fetch orders")}catch{F("Failed to fetch orders")}finally{R(!1),q(!1)}},[m]);a.useEffect(()=>{p();const s=setInterval(()=>p(),1e4);return()=>clearInterval(s)},[p]),a.useEffect(()=>{const s=Ne(()=>{p()});return()=>s()},[p]);const he=async s=>{try{const t=await C.cancelOrder(s);console.log("[CancelOrder] Response:",t),t.status==="success"?(h.success(`Order cancelled: ${s}`),setTimeout(()=>p(!0),1e3)):h.error(t.message||"Failed to cancel order")}catch(t){console.error("[CancelOrder] Error:",t);const b=t.response?.data?.message||"Failed to cancel order";h.error(b)}},ue=async()=>{try{const s=await C.cancelAllOrders();console.log("[CancelAll] Response:",s),s.status==="success"?(h.success(s.message||"All orders cancelled"),setTimeout(()=>p(!0),2e3)):s.status==="info"?h.info(s.message||"No open orders to cancel"):h.error(s.message||"Failed to cancel all orders")}catch(s){console.error("[CancelAll] Error:",s);const d=s.response?.data?.message||"Failed to cancel all orders";h.error(d)}},pe=async s=>{if(xe(s),_({quantity:s.quantity,price:s.price,trigger_price:s.trigger_price,pricetype:s.pricetype,product:s.product}),H(null),D(!0),m){$(!0);try{const t=await C.getQuotes(m,s.symbol,s.exchange);t.status==="success"&&t.data&&H(t.data)}catch(t){console.error("[Quotes] Error:",t)}finally{$(!1)}}},je=async()=>{if(l)try{const s=await C.modifyOrder(l.orderid,{symbol:l.symbol,exchange:l.exchange,action:l.action,product:l.product,pricetype:r.pricetype,price:r.price,quantity:r.quantity,trigger_price:r.trigger_price});console.log("[ModifyOrder] Response:",s),s.status==="success"?(h.success(`Order modified: ${l.orderid}`),D(!1),setTimeout(()=>p(!0),1e3)):h.error(s.message||"Failed to modify order")}catch(s){console.error("[ModifyOrder] Error:",s);const d=s.response?.data?.message||"Failed to modify order";h.error(d)}},ge=()=>{const s=["Symbol","Exchange","Action","Qty","Price","Trigger","Type","Product","Order ID","Status","Time"],t=v.map(i=>[x(i.symbol),x(i.exchange),x(i.action),x(i.quantity),x(i.price),x(i.trigger_price),x(i.pricetype),x(i.product),x(i.orderid),x(i.order_status),x(i.timestamp)]),d=[s,...t].map(i=>i.join(",")).join(`
`),b=new Blob([d],{type:"text/csv"}),A=URL.createObjectURL(b),M=document.createElement("a");M.href=A,M.download=`orderbook_${new Date().toISOString().split("T")[0]}.csv`,M.click()},V=v.filter(s=>s.order_status==="open"),k=({status:s,label:t})=>e.jsx(c,{variant:f.includes(s)?"default":"outline",size:"sm",className:I("rounded-full",f.includes(s)&&"bg-pink-500 hover:bg-pink-600"),onClick:()=>me(s),children:t});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Order Book"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your orders"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(Y,{open:oe,onOpenChange:Q,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(c,{variant:T?"default":"outline",size:"sm",className:"relative",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Filters",T&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]})}),e.jsxs(X,{className:"max-w-md",children:[e.jsxs(G,{children:[e.jsx(J,{children:"Order Filters"}),e.jsx(W,{children:"Filter orders by status"})]}),e.jsx("div",{className:"space-y-6 py-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(L,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Order Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(k,{status:"complete",label:"Complete"}),e.jsx(k,{status:"open",label:"Open"}),e.jsx(k,{status:"rejected",label:"Rejected"}),e.jsx(k,{status:"cancelled",label:"Cancelled"})]})]})}),e.jsxs(Z,{children:[e.jsx(c,{variant:"ghost",onClick:E,children:"Clear All"}),e.jsx(c,{onClick:()=>Q(!1),children:"Done"})]})]})]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>p(!0),disabled:B,children:[e.jsx(Ie,{className:I("h-4 w-4 mr-2",B&&"animate-spin")}),"Refresh"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:ge,children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(ve,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(c,{variant:"destructive",size:"sm",disabled:V.length===0,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Cancel All"]})}),e.jsxs(be,{children:[e.jsxs(Ce,{children:[e.jsx(we,{children:"Cancel All Orders?"}),e.jsxs(Oe,{children:["This will cancel all ",V.length," open orders. This action cannot be undone."]})]}),e.jsxs(Se,{children:[e.jsx(De,{children:"Keep Orders"}),e.jsx(Te,{onClick:ue,children:"Cancel All"})]})]})]})]})]}),T&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Filters:"}),f.map(s=>e.jsx(g,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),e.jsx(c,{variant:"outline",size:"sm",className:"text-red-500 border-red-500/50 hover:bg-red-500/10",onClick:E,children:"Clear All"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Buy Orders"}),e.jsx(S,{className:"text-2xl text-green-600",children:y?.total_buy_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Sell Orders"}),e.jsx(S,{className:"text-2xl text-red-600",children:y?.total_sell_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Completed"}),e.jsx(S,{className:"text-2xl",children:y?.total_completed_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Open"}),e.jsx(S,{className:"text-2xl text-blue-600",children:y?.total_open_orders??0})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(O,{children:"Rejected"}),e.jsx(S,{className:"text-2xl text-red-600",children:y?.total_rejected_orders??0})]})})]}),e.jsx(N,{children:e.jsx(ke,{className:"p-0",children:ne?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(re,{className:"h-8 w-8 animate-spin"})}):z?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:z}):K.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:T?e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:"No orders match your filters"}),e.jsx(c,{variant:"ghost",size:"sm",onClick:E,children:"Clear Filters"})]}):"No orders today"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(_e,{children:e.jsxs(se,{children:[e.jsx(n,{className:"w-[120px]",children:"Symbol"}),e.jsx(n,{className:"w-[80px]",children:"Exchange"}),e.jsx(n,{className:"w-[70px]",children:"Action"}),e.jsx(n,{className:"w-[70px] text-right",children:"Qty"}),e.jsx(n,{className:"w-[100px] text-right",children:"Price"}),e.jsx(n,{className:"w-[100px] text-right",children:"Trigger"}),e.jsx(n,{className:"w-[80px]",children:"Type"}),e.jsx(n,{className:"w-[70px]",children:"Product"}),e.jsx(n,{className:"w-[140px]",children:"Order ID"}),e.jsx(n,{className:"w-[100px]",children:"Status"}),e.jsx(n,{className:"w-[100px]",children:"Time"}),e.jsx(n,{className:"w-[60px]",children:"Cancel"}),e.jsx(n,{className:"w-[60px]",children:"Modify"})]})}),e.jsx(Ee,{children:K.map((s,t)=>{const d=le[s.order_status]||le.open,b=d.icon,A=s.order_status==="open";return e.jsxs(se,{children:[e.jsx(o,{className:"font-medium",children:s.symbol}),e.jsx(o,{children:e.jsx(g,{variant:"outline",children:s.exchange})}),e.jsx(o,{children:e.jsx(g,{variant:s.action==="BUY"?"default":"destructive",className:s.action==="BUY"?"bg-green-500":"",children:s.action})}),e.jsx(o,{className:"text-right font-mono",children:s.quantity}),e.jsx(o,{className:"text-right font-mono",children:j(s.price)}),e.jsx(o,{className:"text-right font-mono",children:j(s.trigger_price)}),e.jsx(o,{children:e.jsx(g,{variant:"secondary",children:s.pricetype})}),e.jsx(o,{children:e.jsx(g,{variant:"outline",children:s.product})}),e.jsx(o,{className:"font-mono text-xs",children:s.orderid}),e.jsx(o,{children:e.jsxs("div",{className:I("flex items-center gap-1",d.color),children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:d.label})]})}),e.jsx(o,{className:"text-sm text-muted-foreground",children:ze(s.timestamp)}),e.jsx(o,{children:A&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>he(s.orderid),children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(o,{children:A&&e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>pe(s),children:e.jsx(qe,{className:"h-4 w-4"})})})]},`${s.orderid}-${t}`)})})]})})})}),e.jsx(Y,{open:de,onOpenChange:D,children:e.jsxs(X,{className:"sm:max-w-[550px]",children:[e.jsxs(G,{children:[e.jsxs(J,{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Modify Order"}),e.jsx(g,{variant:l?.action==="BUY"?"default":"destructive",className:l?.action==="BUY"?"bg-green-500":"",children:l?.action})]}),e.jsx(W,{className:"sr-only",children:"Modify order details"})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:l?.symbol}),e.jsx("div",{className:"text-sm text-muted-foreground",children:l?.exchange})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Order ID"}),e.jsx("div",{className:"font-mono text-sm",children:l?.orderid})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Type:"}),e.jsx(g,{variant:"secondary",className:"text-xs",children:r.pricetype})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Product:"}),e.jsx(g,{variant:"outline",className:"text-xs",children:r.product})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Qty:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:r.quantity})]})]})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Market Data"}),U&&e.jsx(re,{className:"h-4 w-4 animate-spin"})]}),u?e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"LTP"}),e.jsx("div",{className:"font-mono font-semibold",children:j(u.ltp)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Bid"}),e.jsx("div",{className:"font-mono text-green-600",children:j(u.bid)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Ask"}),e.jsx("div",{className:"font-mono text-red-600",children:j(u.ask)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Prev Close"}),e.jsx("div",{className:"font-mono",children:j(u.prev_close)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Open"}),e.jsx("div",{className:"font-mono",children:j(u.open)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"High"}),e.jsx("div",{className:"font-mono text-green-600",children:j(u.high)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Low"}),e.jsx("div",{className:"font-mono text-red-600",children:j(u.low)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Volume"}),e.jsx("div",{className:"font-mono",children:u.volume.toLocaleString("en-IN")})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:U?"Loading quotes...":"Quotes not available"})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[(r.pricetype==="LIMIT"||r.pricetype==="SL")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(L,{htmlFor:"price",className:"text-right",children:"Price"}),e.jsx(ee,{id:"price",type:"number",step:"0.05",value:r.price,onChange:s=>_({...r,price:parseFloat(s.target.value)||0}),className:"col-span-3"})]}),(r.pricetype==="SL"||r.pricetype==="SL-M")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(L,{htmlFor:"trigger_price",className:"text-right",children:"Trigger Price"}),e.jsx(ee,{id:"trigger_price",type:"number",step:"0.05",value:r.trigger_price,onChange:s=>_({...r,trigger_price:parseFloat(s.target.value)||0}),className:"col-span-3"})]}),r.pricetype==="MARKET"&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-2",children:"Market orders cannot be modified. Cancel and place a new order."})]}),e.jsxs(Z,{children:[e.jsx(c,{variant:"outline",onClick:()=>D(!1),children:"Cancel"}),e.jsx(c,{onClick:je,children:"Modify Order"})]})]})})]})}export{es as default};
