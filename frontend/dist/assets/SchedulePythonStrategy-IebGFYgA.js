import{r as a,j as e}from"./vendor-react--vsXx8_n.js";import{B as r,t as i}from"./index-ScfISvPc.js";import{p as S}from"./python-strategy-sO6kxOGf.js";import{C as v,d as N,a as L,b as P,c as I}from"./card-C6-3biFX.js";import{I as b}from"./input-DQMjDm1S.js";import{L as h}from"./label-DZ6LBx4o.js";import{S as x}from"./skeleton-Bl10DDGf.js";import{b as B}from"./python-strategy-CJF1bPLS.js";import{A as C,am as q,P as w}from"./vendor-icons-N1cWsVu6.js";import{d as A,a as z,L as _}from"./vendor-router-CiBIGs7t.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DnptSSCf.js";function V(){const{strategyId:l}=A(),c=z(),[d,k]=a.useState(null),[T,p]=a.useState(!0),[f,y]=a.useState(!1),[m,g]=a.useState("09:15"),[u,j]=a.useState("15:30"),[n,o]=a.useState(["mon","tue","wed","thu","fri"]);a.useEffect(()=>{(async()=>{if(l)try{p(!0);const s=await S.getStrategy(l);k(s),s.schedule_start_time&&g(s.schedule_start_time),s.schedule_stop_time&&j(s.schedule_stop_time),s.schedule_days?.length&&o(s.schedule_days)}catch(s){console.error("Failed to fetch strategy:",s),i.error("Failed to load strategy"),c("/python")}finally{p(!1)}})()},[l]);const D=t=>{o(s=>s.includes(t)?s.filter(F=>F!==t):[...s,t])},E=async t=>{if(t.preventDefault(),!!l){if(n.length===0){i.error("Please select at least one day");return}if(!m){i.error("Start time is required");return}if(!u){i.error("Stop time is required");return}try{y(!0);const s=await S.scheduleStrategy(l,{start_time:m,stop_time:u,days:n});s.status==="success"?(i.success("Schedule saved successfully"),c("/python")):i.error(s.message||"Failed to save schedule")}catch(s){console.error("Failed to schedule:",s),i.error("Failed to save schedule")}finally{y(!1)}}};return T?e.jsxs("div",{className:"container mx-auto py-6 max-w-2xl space-y-6",children:[e.jsx(x,{className:"h-8 w-32"}),e.jsx(x,{className:"h-12"}),e.jsx(x,{className:"h-64"})]}):d?d.status==="running"?e.jsxs("div",{className:"container mx-auto py-6 max-w-2xl space-y-6",children:[e.jsx(r,{variant:"ghost",asChild:!0,children:e.jsxs(_,{to:"/python",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsx(v,{children:e.jsx(N,{className:"pt-6",children:e.jsx("p",{className:"text-muted-foreground",children:"Cannot modify schedule while strategy is running. Please stop the strategy first."})})})]}):e.jsxs("div",{className:"container mx-auto py-6 max-w-2xl space-y-6",children:[e.jsx(r,{variant:"ghost",asChild:!0,children:e.jsxs(_,{to:"/python",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Edit Schedule"}),e.jsx("p",{className:"text-muted-foreground",children:d.name})]}),e.jsxs(v,{children:[e.jsxs(L,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Schedule Settings"]}),e.jsx(I,{children:"Set when the strategy should automatically start and stop (IST)"})]}),e.jsx(N,{children:e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{htmlFor:"start_time",className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Start Time (IST)"]}),e.jsx(b,{id:"start_time",type:"time",value:m,onChange:t=>g(t.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(h,{htmlFor:"stop_time",className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-4 w-4"}),"Stop Time (IST)"]}),e.jsx(b,{id:"stop_time",type:"time",value:u,onChange:t=>j(t.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(h,{children:"Days to Run"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(t=>e.jsxs("button",{type:"button",className:`flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-colors ${n.includes(t.value)?"bg-primary text-primary-foreground border-primary":"bg-background hover:bg-muted"}`,onClick:()=>D(t.value),children:[e.jsx("div",{className:`h-4 w-4 rounded border flex items-center justify-center ${n.includes(t.value)?"bg-primary-foreground border-primary-foreground":"border-current"}`,children:n.includes(t.value)&&e.jsx("svg",{className:"h-3 w-3 text-primary",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:"text-sm font-medium",children:t.label})]},t.value))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>o(["mon","tue","wed","thu","fri"]),children:"Weekdays"}),e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>o(["sat","sun"]),children:"Weekend"}),e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>o(["mon","tue","wed","thu","fri","sat","sun"]),children:"Every Day"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",className:"flex-1",onClick:()=>c("/python"),children:"Cancel"}),e.jsx(r,{type:"submit",className:"flex-1",disabled:f,children:f?"Saving...":"Save Schedule"})]})]})})]})]}):null}export{V as default};
