import{r as t}from"./vendor-react-Df-MYEHc.js";import{y as D,M as F}from"./index-Bd6js41n.js";function E({symbols:o,mode:b="LTP",enabled:g=!0,autoReconnect:M=!0}){const a=D(),c=t.useRef(a?.manager??F.getInstance()),[m,u]=t.useState(new Map),[s,C]=t.useState({isConnected:a?.isConnected??!1,isAuthenticated:a?.isAuthenticated??!1,isPaused:a?.isPaused??!1,isFallbackMode:a?.isFallbackMode??!1,error:a?.error??null}),[p,P]=t.useState(!1),S=t.useMemo(()=>o.map(n=>`${n.exchange}:${n.symbol}`).sort().join(","),[o]);t.useEffect(()=>{c.current.setAutoReconnect(M)},[M]),t.useEffect(()=>c.current.addStateListener(e=>{C({isConnected:e.isConnected,isAuthenticated:e.isAuthenticated,isPaused:e.isPaused,isFallbackMode:e.isFallbackMode,error:e.error}),P(e.connectionState==="connecting"||e.connectionState==="authenticating")}),[]),t.useEffect(()=>{if(!g||o.length===0){u(new Map);return}const n=c.current;!s.isConnected&&!s.isPaused&&n.connect();const d=[];for(const{symbol:e,exchange:l}of o){const y=n.subscribe(e,l,b,r=>{u(f=>{const i=`${r.exchange}:${r.symbol}`,k=new Map(f);return k.set(i,r),k})});d.push(y);const h=n.getCachedData(e,l);if(h){const r=`${l}:${e}`;u(f=>{const i=new Map(f);return i.set(r,h),i})}}return()=>{d.forEach(e=>e())}},[g,S,b]);const x=t.useCallback(async()=>{await c.current.connect()},[]),A=t.useCallback(()=>{c.current.disconnect()},[]);return{data:m,isConnected:s.isConnected,isAuthenticated:s.isAuthenticated,isConnecting:p,isPaused:s.isPaused,isFallbackMode:s.isFallbackMode,error:s.error,connect:x,disconnect:A}}export{E as u};
