import{r as s,j as t}from"./vendor-react-CCyQGCED.js";import{q as Fe,K as Ee,W as ke,n as te}from"./lightweight-charts.production-EcMg1Lek.js";import{w as fe,u as Te,s as se,B as De}from"./index-DLrRZEmO.js";import{o as he}from"./oi-profile-CkxblXa3.js";import{C as Me,a as Ie,b as Re,d as Le}from"./card-BHRAREBW.js";import{S as k,a as T,b as D,c as M,d as I}from"./select-CSWw-9Vv.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-icons-Ys8lBJ3m.js";import"./vendor-router-Dzc1xxhr.js";import"./vendor-radix-CYVJEJRR.js";const me={getStraddleData:async p=>(await fe.post("/straddle/api/straddle-data",p)).data,getIntervals:async()=>(await fe.get("/straddle/api/intervals")).data},Ue=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"}],xe={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX"]},ge=500;function He(p){if(!p)return"";const f=p.split("-");return f.length===3?`${f[0]}${f[1].toUpperCase()}${f[2].slice(-2)}`:p.replace(/-/g,"").toUpperCase()}function Ve(p){const f=new Date(p*1e3),m=new Date(f.getTime()+5.5*60*60*1e3),R=m.getUTCDate().toString().padStart(2,"0"),U=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][m.getUTCMonth()],h=m.getUTCHours().toString().padStart(2,"0"),A=m.getUTCMinutes().toString().padStart(2,"0"),z=m.getUTCHours()>=12?"PM":"AM";return{date:`${R} ${U}`,time:`${h}:${A} ${z}`}}function Ke(){const{mode:p,appMode:f}=Te(),m=p==="dark",R=f==="analyzer",[L,U]=s.useState(!1),[h,A]=s.useState("NFO"),[z,re]=s.useState(xe.NFO),[y,P]=s.useState("NIFTY"),[ye,H]=s.useState([]),[V,S]=s.useState(""),[be,ne]=s.useState([]),[B,ae]=s.useState("1m"),[v,Se]=s.useState("3"),[j,Y]=s.useState(null),[w,ve]=s.useState(!0),[C,je]=s.useState(!1),[N,we]=s.useState(!1),G=s.useRef(null),d=s.useRef(null),O=s.useRef(null),W=s.useRef(null),_=s.useRef(null),$=s.useRef(null),b=s.useRef(null),F=s.useRef(null),ie=s.useRef(new Map),a=s.useMemo(()=>R?{text:"#d4bfff",grid:"rgba(139, 92, 246, 0.1)",border:"rgba(139, 92, 246, 0.2)",crosshair:"rgba(139, 92, 246, 0.5)",crosshairLabel:"#4c1d95",spot:"#e2e8f0",straddle:"#a78bfa",synthetic:"#60a5fa",watermark:"rgba(139, 92, 246, 0.12)",tooltipBg:"rgba(30, 15, 60, 0.92)",tooltipBorder:"rgba(139, 92, 246, 0.3)",tooltipText:"#d4bfff",tooltipMuted:"#a78bfa"}:m?{text:"#a6adbb",grid:"rgba(166, 173, 187, 0.1)",border:"rgba(166, 173, 187, 0.2)",crosshair:"rgba(166, 173, 187, 0.5)",crosshairLabel:"#1f2937",spot:"#e2e8f0",straddle:"#4ade80",synthetic:"#60a5fa",watermark:"rgba(166, 173, 187, 0.12)",tooltipBg:"rgba(17, 24, 39, 0.92)",tooltipBorder:"rgba(166, 173, 187, 0.2)",tooltipText:"#e2e8f0",tooltipMuted:"#9ca3af"}:{text:"#333",grid:"rgba(0, 0, 0, 0.1)",border:"rgba(0, 0, 0, 0.2)",crosshair:"rgba(0, 0, 0, 0.3)",crosshairLabel:"#2563eb",spot:"#1e293b",straddle:"#16a34a",synthetic:"#2563eb",watermark:"rgba(0, 0, 0, 0.06)",tooltipBg:"rgba(255, 255, 255, 0.95)",tooltipBorder:"rgba(0, 0, 0, 0.15)",tooltipText:"#1e293b",tooltipMuted:"#6b7280"},[m,R]),oe=s.useRef(a);oe.current=a;const le=s.useCallback(()=>{if(!G.current)return;d.current&&(d.current.remove(),d.current=null);const e=G.current,i=$.current;e.innerHTML="",i&&e.appendChild(i);const n=Fe(e,{width:e.offsetWidth,height:ge,layout:{background:{type:ke.Solid,color:"transparent"},textColor:a.text},grid:{vertLines:{color:a.grid,style:1,visible:!0},horzLines:{color:a.grid,style:1,visible:!0}},leftPriceScale:{visible:!0,borderColor:a.border,scaleMargins:{top:.05,bottom:.05}},rightPriceScale:{visible:!0,borderColor:a.border,scaleMargins:{top:.05,bottom:.05}},timeScale:{borderColor:a.border,timeVisible:!0,secondsVisible:!1,tickMarkFormatter:l=>{const c=new Date(l*1e3),g=new Date(c.getTime()+5.5*60*60*1e3),u=g.getUTCHours().toString().padStart(2,"0"),o=g.getUTCMinutes().toString().padStart(2,"0");if(parseInt(v)>1){const q=g.getUTCDate().toString().padStart(2,"0"),Q=(g.getUTCMonth()+1).toString().padStart(2,"0");return`${q}/${Q} ${u}:${o}`}return`${u}:${o}`}},crosshair:{mode:Ee.Normal,vertLine:{width:1,color:a.crosshair,style:2,labelVisible:!1},horzLine:{width:1,color:a.crosshair,style:2,labelBackgroundColor:a.crosshairLabel}}}),r=document.createElement("div");if(r.style.cssText=`position:absolute;z-index:2;font-family:Arial,sans-serif;font-size:48px;font-weight:bold;user-select:none;pointer-events:none;color:${a.watermark}`,r.textContent="OpenAlgo",e.appendChild(r),b.current=r,setTimeout(()=>{r.style.left=`${e.offsetWidth/2-r.offsetWidth/2}px`,r.style.top=`${e.offsetHeight/2-r.offsetHeight/2}px`},0),$.current)e.appendChild($.current);else{const l=document.createElement("div");l.style.cssText="position:absolute;z-index:10;pointer-events:none;display:none;border-radius:6px;padding:8px 12px;font-family:ui-monospace,SFMono-Regular,monospace;font-size:12px;line-height:1.6;white-space:nowrap;",e.appendChild(l),$.current=l}const X=n.addSeries(te,{color:a.spot,lineWidth:2,priceScaleId:"left",title:"Spot",lastValueVisible:!0,priceLineVisible:!0,visible:C}),Ce=n.addSeries(te,{color:a.straddle,lineWidth:2,priceScaleId:"right",title:"Straddle",lastValueVisible:!0,priceLineVisible:!0,visible:w}),Ne=n.addSeries(te,{color:a.synthetic,lineWidth:1,lineStyle:2,priceScaleId:"left",title:"Synthetic Fut",lastValueVisible:!0,priceLineVisible:!1,visible:N});d.current=n,O.current=X,W.current=Ce,_.current=Ne,n.subscribeCrosshairMove(l=>{const c=$.current;if(!c||!e)return;if(!l.time||!l.point||l.point.x<0||l.point.y<0||l.point.x>e.offsetWidth||l.point.y>e.offsetHeight){c.style.display="none";return}const g=l.time,u=ie.current.get(g);if(!u){c.style.display="none";return}const o=oe.current,{date:q,time:Q}=Ve(g);c.style.display="block",c.style.background=o.tooltipBg,c.style.border=`1px solid ${o.tooltipBorder}`,c.style.color=o.tooltipText,c.innerHTML=`
        <div style="display:flex;justify-content:space-between;gap:16px">
          <span style="color:${o.straddle};font-weight:600">Straddle Price</span>
          <span style="color:${o.straddle};font-weight:600">${u.straddle.toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;gap:16px">
          <span style="color:${o.tooltipMuted}">&bull; ${u.atm_strike} Call:</span>
          <span>${u.ce_price.toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;gap:16px">
          <span style="color:${o.tooltipMuted}">&bull; ${u.atm_strike} Put:</span>
          <span>${u.pe_price.toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;gap:16px">
          <span style="color:${o.synthetic}">Synthetic Fut</span>
          <span style="color:${o.synthetic}">${u.synthetic_future.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
        </div>
        <div style="display:flex;justify-content:space-between;gap:16px">
          <span style="color:${o.tooltipMuted}">Spot Price</span>
          <span>${u.spot.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}</span>
        </div>
        <div style="display:flex;justify-content:space-between;gap:16px;margin-top:4px;border-top:1px solid ${o.tooltipBorder};padding-top:4px">
          <span style="color:${o.tooltipMuted}">${q}</span>
          <span style="color:${o.tooltipMuted}">${Q}</span>
        </div>
      `;const de=c.offsetWidth,Z=c.offsetHeight,ue=l.point.x,$e=l.point.y,pe=16;let ee=ue+pe;ee+de>e.offsetWidth&&(ee=ue-de-pe);let E=$e-Z/2;E<0&&(E=0),E+Z>e.offsetHeight&&(E=e.offsetHeight-Z),c.style.left=`${ee}px`,c.style.top=`${E}px`}),F.current&&J(F.current);const ce=()=>{d.current&&e&&(d.current.applyOptions({width:e.offsetWidth}),b.current&&(b.current.style.left=`${e.offsetWidth/2-b.current.offsetWidth/2}px`,b.current.style.top=`${e.offsetHeight/2-b.current.offsetHeight/2}px`))};return window.addEventListener("resize",ce),()=>{window.removeEventListener("resize",ce)}},[a,v,w,C,N]),J=s.useCallback(e=>{if(!e.series||e.series.length===0)return;const i=[...e.series].sort((r,X)=>r.time-X.time),n=new Map;for(const r of i)n.set(r.time,r);ie.current=n,O.current&&O.current.setData(i.map(r=>({time:r.time,value:r.spot}))),W.current&&W.current.setData(i.map(r=>({time:r.time,value:r.straddle}))),_.current&&_.current.setData(i.map(r=>({time:r.time,value:r.synthetic_future}))),d.current&&d.current.timeScale().fitContent()},[]);s.useEffect(()=>{const e=le();return()=>{e?.(),d.current&&(d.current.remove(),d.current=null)}},[le]),s.useEffect(()=>{O.current?.applyOptions({visible:C})},[C]),s.useEffect(()=>{W.current?.applyOptions({visible:w})},[w]),s.useEffect(()=>{_.current?.applyOptions({visible:N})},[N]),s.useEffect(()=>{(async()=>{try{const i=await me.getIntervals();if(i.status==="success"&&i.data){const n=[...i.data.seconds||[],...i.data.minutes||[],...i.data.hours||[]];ne(n.length>0?n:["1m","3m","5m","10m","15m","30m","1h"]),n.length>0&&!n.includes(B)&&ae(n.includes("1m")?"1m":n[0])}}catch{ne(["1m","3m","5m","10m","15m","30m","1h"])}})()},[]),s.useEffect(()=>{const e=xe[h]||[];re(e),P(e[0]||""),H([]),S(""),Y(null),F.current=null;let i=!1;return(async()=>{try{const r=await he.getUnderlyings(h);if(i)return;r.status==="success"&&r.underlyings.length>0&&(re(r.underlyings),r.underlyings.includes(e[0])||P(r.underlyings[0]))}catch{}})(),()=>{i=!0}},[h]),s.useEffect(()=>{if(!y)return;H([]),S(""),Y(null),F.current=null;let e=!1;return(async()=>{try{const n=await he.getExpiries(h,y);if(e)return;n.status==="success"&&n.expiries.length>0?(H(n.expiries),S(n.expiries[0])):(H([]),S(""))}catch{if(e)return;se.error("Failed to fetch expiry dates","positions")}})(),()=>{e=!0}},[y]);const K=s.useCallback(async()=>{if(V){U(!0);try{const e=await me.getStraddleData({underlying:y,exchange:h,expiry_date:He(V),interval:B,days:parseInt(v)});e.status==="success"&&e.data?(F.current=e.data,Y(e.data),J(e.data)):se.error(e.message||"Failed to load straddle data","positions")}catch{se.error("Failed to fetch straddle data","positions")}finally{U(!1)}}},[V,B,v,y,h,J]);s.useEffect(()=>{K()},[K]);const x=s.useMemo(()=>j?.series?.length?j.series[j.series.length-1]:null,[j]);return t.jsx("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:t.jsxs(Me,{children:[t.jsx(Ie,{className:"pb-4",children:t.jsx(Re,{className:"text-xl font-semibold",children:"Straddle Chart"})}),t.jsxs(Le,{children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[t.jsxs(k,{value:h,onValueChange:A,children:[t.jsx(T,{className:"w-[100px]",children:t.jsx(D,{placeholder:"Exchange"})}),t.jsx(M,{children:Ue.map(e=>t.jsx(I,{value:e.value,children:e.label},e.value))})]}),t.jsxs(k,{value:y,onValueChange:P,children:[t.jsx(T,{className:"w-[140px]",children:t.jsx(D,{placeholder:"Underlying"})}),t.jsx(M,{children:z.map(e=>t.jsx(I,{value:e,children:e},e))})]}),t.jsxs(k,{value:V,onValueChange:S,children:[t.jsx(T,{className:"w-[140px]",children:t.jsx(D,{placeholder:"Expiry"})}),t.jsx(M,{children:ye.map(e=>t.jsx(I,{value:e,children:e},e))})]}),t.jsxs(k,{value:B,onValueChange:ae,children:[t.jsx(T,{className:"w-[100px]",children:t.jsx(D,{placeholder:"Interval"})}),t.jsx(M,{children:be.map(e=>t.jsx(I,{value:e,children:e},e))})]}),t.jsxs(k,{value:v,onValueChange:Se,children:[t.jsx(T,{className:"w-[100px]",children:t.jsx(D,{placeholder:"Days"})}),t.jsx(M,{children:["1","3","5"].map(e=>t.jsxs(I,{value:e,children:[e," ",e==="1"?"Day":"Days"]},e))})]}),t.jsx(De,{variant:"outline",size:"sm",onClick:K,disabled:L,children:L?"Loading...":"Refresh"})]}),x&&j&&t.jsxs("div",{className:"flex flex-wrap items-center gap-x-6 gap-y-1 mb-4 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Straddle Price "}),t.jsx("span",{className:"font-semibold",style:{color:a.straddle},children:x.straddle.toFixed(2)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Spot "}),t.jsx("span",{className:"font-medium",children:x.spot.toFixed(2)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-muted-foreground",children:"Straddle Strike "}),t.jsx("span",{className:"font-medium",children:x.atm_strike})]}),t.jsxs("div",{children:[t.jsxs("span",{className:"text-muted-foreground",children:[x.atm_strike," CE"," "]}),t.jsx("span",{className:"font-medium",children:x.ce_price.toFixed(2)})]}),t.jsxs("div",{children:[t.jsxs("span",{className:"text-muted-foreground",children:[x.atm_strike," PE"," "]}),t.jsx("span",{className:"font-medium",children:x.pe_price.toFixed(2)})]})]}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{ref:G,className:"relative w-full rounded-lg border border-border/50",style:{height:ge}}),L&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-background/60 rounded-lg",children:t.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[t.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}),"Loading straddle data..."]})})]}),t.jsxs("div",{className:"flex items-center justify-center gap-4 mt-3",children:[t.jsxs("button",{type:"button",onClick:()=>ve(e=>!e),className:`flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs transition-colors ${w?"bg-muted font-medium":"opacity-50 hover:opacity-75"}`,children:[t.jsx("span",{className:"inline-block h-0.5 w-5 rounded",style:{backgroundColor:a.straddle}}),"Straddle"]}),t.jsxs("button",{type:"button",onClick:()=>je(e=>!e),className:`flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs transition-colors ${C?"bg-muted font-medium":"opacity-50 hover:opacity-75"}`,children:[t.jsx("span",{className:"inline-block h-0.5 w-5 rounded",style:{backgroundColor:a.spot}}),"Spot"]}),t.jsxs("button",{type:"button",onClick:()=>we(e=>!e),className:`flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs transition-colors ${N?"bg-muted font-medium":"opacity-50 hover:opacity-75"}`,children:[t.jsx("span",{className:"inline-block h-0.5 w-5 rounded border-dashed border-t-2",style:{borderColor:a.synthetic,backgroundColor:"transparent"}}),"Synthetic Fut"]})]})]})]})})}export{Ke as default};
