import{j as e,r as l}from"./vendor-react-Df-MYEHc.js";import{T as K,a as z,b as v,c as W}from"./tabs-jWCANazw.js";import{a as q,b as J,c as B}from"./PresetSelector-qvwBdxpk.js";import{e as Q,B as D,w as Z,s as T}from"./index-jmNeOP74.js";import{C as ee,a as se,b as ae,d as le,e as te}from"./card-NBBx4fP2.js";import{D as re,b as ne,c as ce,d as ie,f as de}from"./dialog-CeCCLaOV.js";import{I as f}from"./input-BiM5Ngw3.js";import{L as d}from"./label-BDVFS1En.js";import{S as h,a as m,b as g,c as p,d as n}from"./select-Mroud02a.js";import{a as oe}from"./vendor-router-4BT-EZah.js";import"./vendor-charts-DPXZ0pfV.js";import"./vendor-radix-IoylIoim.js";import"./vendor-icons-nFj7rtAi.js";const xe={neutral:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",bullish:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",bearish:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"};function ue({template:t,onDeploy:r}){return e.jsxs(ee,{className:"flex flex-col",children:[e.jsx(se,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"text-sm",children:t.name}),e.jsx(Q,{variant:"outline",className:`text-[10px] ${xe[t.category]||""}`,children:t.category})]})}),e.jsxs(le,{className:"flex-1 pb-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:t.description}),e.jsx("div",{className:"space-y-1",children:t.legs.map((a,u)=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs",children:[e.jsx("span",{className:a.action==="BUY"?"text-green-600":"text-red-600",children:a.action}),e.jsx("span",{children:a.option_type||"FUT"}),e.jsx("span",{className:"text-muted-foreground",children:a.offset})]},u))})]}),e.jsx(te,{className:"pt-2",children:e.jsx(D,{size:"sm",className:"w-full",onClick:()=>r(t),children:"Deploy"})})]})}function he({templates:t,onDeploy:r}){return t.length===0?e.jsx("div",{className:"flex items-center justify-center h-40 text-sm text-muted-foreground",children:"No templates match the selected filter."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(a=>e.jsx(ue,{template:a,onDeploy:r},a.id))})}const me=[{value:"NFO",label:"NFO"},{value:"BFO",label:"BFO"},{value:"CDS",label:"CDS"},{value:"BCD",label:"BCD"},{value:"MCX",label:"MCX"}],b={NFO:["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY"],BFO:["SENSEX","BANKEX","SENSEX50"],CDS:["USDINR","EURINR","GBPINR","JPYINR"],BCD:["USDINR","EURINR"],MCX:["CRUDEOIL","GOLD","SILVER","NATURALGAS"]};function ge({open:t,onClose:r,template:a,onDeployed:u}){const[o,j]=l.useState(""),[c,U]=l.useState("NFO"),[S,E]=l.useState("NIFTY"),[L,C]=l.useState(b.NFO),[F,w]=l.useState("current_week"),[I,V]=l.useState(1),[N,A]=l.useState(""),[_,Y]=l.useState(null),[y,G]=l.useState(""),[O,M]=l.useState(null),[k,R]=l.useState(!1),P=s=>{s?a&&j(`${a.name} - ${S}`):r()};l.useEffect(()=>{let s=!1;return(async()=>{try{const x=await Z.get(`/search/api/underlyings?exchange=${c}`);!s&&x.data.underlyings?.length>0?C(x.data.underlyings):s||C(b[c]||[])}catch{s||C(b[c]||[])}})(),()=>{s=!0}},[c]);const X=s=>{const i=s;U(i);const x=b[i]||[];E(x[0]||"")},H=async()=>{if(!(!a||!o.trim())){R(!0);try{const s=a.legs.map($=>({...$,quantity_lots:I})),i={...q};N&&(i.combined_stoploss_type=N,i.combined_stoploss_value=_),y&&(i.combined_target_type=y,i.combined_target_value=O);const x=await J.saveStrategy({basics:{name:o,exchange:c,underlying:S,expiry_type:F,product_type:"MIS",is_intraday:!0,trading_mode:"BOTH"},legs:s,riskConfig:i,preset:a.id});x.status==="success"?(T.success("Strategy deployed"),u(),r()):T.error(x.message||"Failed to deploy")}catch{T.error("Failed to deploy template")}finally{R(!1)}}};return e.jsx(re,{open:t,onOpenChange:P,children:e.jsxs(ne,{className:"sm:max-w-[440px]",children:[e.jsx(ce,{children:e.jsxs(ie,{children:["Deploy ",a?.name]})}),e.jsxs("div",{className:"space-y-4 py-2",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{children:"Strategy Name"}),e.jsx(f,{value:o,onChange:s=>j(s.target.value),placeholder:"e.g., NIFTY Short Straddle"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{children:"Exchange"}),e.jsxs(h,{value:c,onValueChange:X,children:[e.jsx(m,{children:e.jsx(g,{})}),e.jsx(p,{children:me.map(s=>e.jsx(n,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{children:"Underlying"}),e.jsxs(h,{value:S,onValueChange:E,children:[e.jsx(m,{children:e.jsx(g,{})}),e.jsx(p,{children:L.map(s=>e.jsx(n,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{children:"Expiry Type"}),e.jsxs(h,{value:F,onValueChange:w,children:[e.jsx(m,{children:e.jsx(g,{})}),e.jsxs(p,{children:[e.jsx(n,{value:"current_week",children:"Current Week"}),e.jsx(n,{value:"next_week",children:"Next Week"}),e.jsx(n,{value:"current_month",children:"Current Month"}),e.jsx(n,{value:"next_month",children:"Next Month"})]})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{children:"Lots per Leg"}),e.jsx(f,{type:"number",min:1,value:I,onChange:s=>V(Math.max(1,Number(s.target.value)))})]})]}),e.jsxs("div",{className:"border-t pt-3 space-y-3",children:[e.jsx(d,{className:"text-xs text-muted-foreground",children:"Risk Parameters (optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{className:"text-xs",children:"Stop Loss"}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs(h,{value:N,onValueChange:A,children:[e.jsx(m,{className:"h-8 text-xs w-[90px]",children:e.jsx(g,{placeholder:"Off"})}),e.jsxs(p,{children:[e.jsx(n,{value:"",children:"Off"}),e.jsx(n,{value:"percentage",children:"%"}),e.jsx(n,{value:"points",children:"Pts"})]})]}),e.jsx(f,{type:"number",step:"0.01",className:"h-8 text-xs",value:_??"",disabled:!N,onChange:s=>Y(s.target.value?Number(s.target.value):null)})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(d,{className:"text-xs",children:"Target"}),e.jsxs("div",{className:"flex gap-1.5",children:[e.jsxs(h,{value:y,onValueChange:G,children:[e.jsx(m,{className:"h-8 text-xs w-[90px]",children:e.jsx(g,{placeholder:"Off"})}),e.jsxs(p,{children:[e.jsx(n,{value:"",children:"Off"}),e.jsx(n,{value:"percentage",children:"%"}),e.jsx(n,{value:"points",children:"Pts"})]})]}),e.jsx(f,{type:"number",step:"0.01",className:"h-8 text-xs",value:O??"",disabled:!y,onChange:s=>M(s.target.value?Number(s.target.value):null)})]})]})]})]})]}),e.jsxs(de,{children:[e.jsx(D,{variant:"outline",onClick:r,children:"Cancel"}),e.jsx(D,{onClick:H,disabled:k||!o.trim(),children:k?"Deploying...":"Deploy"})]})]})})}function Ie(){const t=oe(),[r,a]=l.useState("all"),[u,o]=l.useState(null),j=r==="all"?B:B.filter(c=>c.category===r);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold mb-1",children:"Strategy Templates"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pre-built F&O strategy templates. Deploy with one click and customize."})]}),e.jsxs(K,{value:r,onValueChange:c=>a(c),children:[e.jsxs(z,{children:[e.jsx(v,{value:"all",className:"text-xs",children:"All"}),e.jsx(v,{value:"neutral",className:"text-xs",children:"Neutral"}),e.jsx(v,{value:"bullish",className:"text-xs",children:"Bullish"}),e.jsx(v,{value:"bearish",className:"text-xs",children:"Bearish"})]}),e.jsx(W,{value:r,className:"mt-4",children:e.jsx(he,{templates:j,onDeploy:o})})]}),e.jsx(ge,{open:!!u,onClose:()=>o(null),template:u,onDeployed:()=>t("/strategy/hub")})]})}export{Ie as default};
