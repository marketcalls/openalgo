import{r as i,j as e}from"./vendor-react--vsXx8_n.js";import{B as a,e as x,t as r}from"./index-u29fUGPF.js";import{s as m}from"./strategy-ByBqw75H.js";import{A as J,b as K,a as X}from"./alert-C7dlInBj.js";import{C as j,b as p,c as f,d as y,a as N}from"./card-D0GBublx.js";import{C as Z,b as ee,a as se}from"./collapsible-oki6G1qf.js";import{D as te,b as ae,c as re,d as ie,e as le,f as ne}from"./dialog-CjI7Br1p.js";import{S as oe}from"./separator-CIFo3XA9.js";import{S as w}from"./skeleton-CzC8gIUN.js";import{T as ce,a as de,b as B,c as n,d as xe,e as o}from"./table-D_dfFOXa.js";import{A as me,aQ as he,ag as P,P as ge,aO as ue,t as v,a3 as b,Q as je,aR as pe,T as fe,i as ye,aP as Ne,$ as we,c as ve}from"./vendor-icons-BPoFgeym.js";import{d as be,a as Ce,L as C}from"./vendor-router-CclZ5Z6W.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-DIebA-qg.js";function Me(){const{strategyId:S}=be(),T=Ce(),[s,_]=i.useState(null),[c,k]=i.useState([]),[M,D]=i.useState(!0),[O,F]=i.useState(!1),[A,L]=i.useState(!1),[I,d]=i.useState(!1),[h,H]=i.useState(null),[z,V]=i.useState(!1),[$,U]=i.useState(null),W=async()=>{if(S)try{D(!0);const t=await m.getStrategy(Number(S));_(t.strategy),k(t.mappings||[])}catch(t){console.error("Failed to fetch strategy:",t),r.error("Failed to load strategy"),T("/strategy")}finally{D(!1)}};i.useEffect(()=>{(async()=>{try{const u=await(await fetch("/api/config/host",{credentials:"include"})).json();U(u)}catch(l){console.error("Failed to fetch host config:",l),U({host_server:window.location.origin,is_localhost:window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"})}})()},[]),i.useEffect(()=>{W()},[]);const g=async(t,l)=>{try{await navigator.clipboard.writeText(t),H(l),r.success("Copied to clipboard"),setTimeout(()=>H(null),2e3)}catch{r.error("Failed to copy")}},q=async()=>{if(s)try{F(!0);const t=await m.toggleStrategy(s.id);t.status==="success"?(_({...s,is_active:t.data?.is_active??!s.is_active}),r.success(t.data?.is_active?"Strategy activated":"Strategy deactivated")):r.error(t.message||"Failed to toggle strategy")}catch(t){console.error("Failed to toggle strategy:",t),r.error("Failed to toggle strategy")}finally{F(!1)}},Q=async()=>{if(s)try{L(!0);const t=await m.deleteStrategy(s.id);t.status==="success"?(r.success("Strategy deleted successfully"),T("/strategy")):r.error(t.message||"Failed to delete strategy")}catch(t){console.error("Failed to delete strategy:",t),r.error("Failed to delete strategy")}finally{L(!1),d(!1)}},Y=async t=>{if(s)try{const l=await m.deleteSymbolMapping(s.id,t);l.status==="success"?(k(c.filter(u=>u.id!==t)),r.success("Symbol mapping deleted")):r.error(l.message||"Failed to delete mapping")}catch(l){console.error("Failed to delete mapping:",l),r.error("Failed to delete mapping")}},G=t=>{switch(t){case"LONG":return e.jsx(ve,{className:"h-4 w-4 text-green-500"});case"SHORT":return e.jsx(we,{className:"h-4 w-4 text-red-500"});case"BOTH":return e.jsx(Ne,{className:"h-4 w-4 text-blue-500"});default:return null}},E=t=>({tradingview:"TradingView",amibroker:"Amibroker",python:"Python",metatrader:"Metatrader",excel:"Excel",others:"Others"})[t]||t;if(M)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(w,{className:"h-8 w-32"}),e.jsx(w,{className:"h-48"}),e.jsx(w,{className:"h-64"})]});if(!s)return null;const R=`${$?.host_server||window.location.origin}/strategy/webhook/${s.webhook_id}`;return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(a,{variant:"ghost",asChild:!0,children:e.jsxs(C,{to:"/strategy",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Back to Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[s.name,e.jsx(x,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-muted-foreground",children:[E(s.platform)," â€¢ Created"," ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(a,{variant:s.is_active?"outline":"default",onClick:q,disabled:O,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),O?"Updating...":s.is_active?"Deactivate":"Activate"]}),e.jsxs(a,{variant:"destructive",onClick:()=>d(!0),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsx(f,{children:"Strategy Details"}),e.jsx(y,{children:"Configuration and settings"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(x,{variant:s.is_active?"default":"secondary",className:"mt-1",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(x,{variant:"outline",className:"mt-1",children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[G(s.trading_mode),e.jsx("span",{children:s.trading_mode})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Platform"}),e.jsx("p",{className:"mt-1",children:E(s.platform)})]})]}),s.is_intraday&&s.start_time&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Trading Hours"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("p",{className:"font-mono",children:s.start_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("p",{className:"font-mono",children:s.end_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Square Off"}),e.jsx("p",{className:"font-mono",children:s.squareoff_time})]})]})]})]})]})]}),e.jsxs(j,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Webhook Configuration"]}),e.jsx(y,{children:"Use this URL to receive trading alerts"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono break-all",children:R}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(R,"url"),children:h==="url"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),s.platform!=="tradingview"&&e.jsxs(Z,{open:z,onOpenChange:V,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(a,{variant:"ghost",className:"w-full justify-between",children:[e.jsx("span",{children:"Show Credentials"}),e.jsx(je,{className:"h-4 w-4"})]})}),e.jsxs(se,{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Host URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:window.location.origin}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(window.location.origin,"host"),children:h==="host"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:s.webhook_id}),e.jsx(a,{variant:"outline",size:"icon",onClick:()=>g(s.webhook_id,"webhook_id"),children:h==="webhook_id"?e.jsx(v,{className:"h-4 w-4 text-green-500"}):e.jsx(b,{className:"h-4 w-4"})})]})]})]})]}),s.platform==="tradingview"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"TradingView Alert Message Format"]}),e.jsx("pre",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto",children:`{
  "symbol": "{{ticker}}",
  "action": "BUY"
}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use BUY, SELL, SHORT, or COVER for the action field."})]})]})]})]}),e.jsxs(J,{children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx(K,{children:"Important Notes"}),e.jsx(X,{children:e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsxs("li",{children:["Orders are processed only when the strategy is ",e.jsx("strong",{children:"active"})]}),s.is_intraday&&e.jsxs("li",{children:["Orders are processed only during trading hours (",s.start_time," -"," ",s.end_time,")"]}),e.jsx("li",{children:"Symbol must be configured in the mappings below to receive orders"}),e.jsx("li",{children:"Use the correct action keywords: BUY, SELL, SHORT, COVER"}),s.trading_mode==="BOTH"&&e.jsxs("li",{children:["In BOTH mode, include ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"position_size"})," ","in your JSON payload"]})]})})]}),e.jsxs(j,{children:[e.jsxs(p,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(f,{children:"Symbol Mappings"}),e.jsxs(y,{children:["Symbols configured for this strategy (",c.length," total)"]})]}),e.jsx(a,{asChild:!0,children:e.jsxs(C,{to:`/strategy/${s.id}/configure`,children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Configure Symbols"]})})]}),e.jsx(N,{children:c.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx(a,{variant:"link",asChild:!0,children:e.jsx(C,{to:`/strategy/${s.id}/configure`,children:"Add your first symbol"})})]}):e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(B,{children:[e.jsx(n,{children:"Symbol"}),e.jsx(n,{children:"Exchange"}),e.jsx(n,{className:"text-right",children:"Quantity"}),e.jsx(n,{children:"Product"}),e.jsx(n,{className:"w-16"})]})}),e.jsx(xe,{children:c.map(t=>e.jsxs(B,{children:[e.jsx(o,{className:"font-medium",children:t.symbol}),e.jsx(o,{children:t.exchange}),e.jsx(o,{className:"text-right",children:t.quantity}),e.jsx(o,{children:e.jsx(x,{variant:"outline",children:t.product_type})}),e.jsx(o,{children:e.jsx(a,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>Y(t.id),children:e.jsx(P,{className:"h-4 w-4"})})})]},t.id))})]})})]}),e.jsx(te,{open:I,onOpenChange:d,children:e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(ie,{children:"Delete Strategy"}),e.jsxs(le,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All symbol mappings will also be deleted.']})]}),e.jsxs(ne,{children:[e.jsx(a,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(a,{variant:"destructive",onClick:Q,disabled:A,children:A?"Deleting...":"Delete Strategy"})]})]})})]})}export{Me as default};
