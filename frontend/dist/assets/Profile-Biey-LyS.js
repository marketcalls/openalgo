import{r as t,j as e}from"./vendor-react-RhKMXzW9.js";import{d as De,u as Ee,w as f,t as r,e as ze,B as x}from"./index-BI1ZbBzK.js";import{A as b,b as v,a as y}from"./alert-Dmqvwunc.js";import{C as o,b as d,c as m,a as p,d as w}from"./card-C6VA_J5n.js";import{C as Le}from"./checkbox-BLIgYg3y.js";import{I as i}from"./input-rKQRdAl-.js";import{L as c}from"./label-Cl8hR1Lw.js";import{P as Re}from"./progress-Cqyz6WrK.js";import{T as $e,a as Oe,b as P,c as A}from"./tabs-B2Xo2TYH.js";import{A as Ue,U as Ie,z as me,a5 as Be,y as z,w as he,s as ue,X as Ge,R as N,u as He,k as qe,l as Qe,a6 as Ve,a7 as Ye,a2 as Ze}from"./vendor-icons-Ca5eNZvr.js";import{L as We}from"./vendor-router-DdyOoyPF.js";import"./vendor-syntax-DzupMptF.js";import"./vendor-radix-gKv__6YA.js";const Xe=[{value:"light",label:"Light",icon:qe,description:"Clean, bright interface for daytime trading"},{value:"dark",label:"Dark",icon:Qe,description:"Reduced eye strain for extended sessions"}],Je=[{value:"zinc",label:"Zinc",color:"bg-zinc-500"},{value:"slate",label:"Slate",color:"bg-slate-500"},{value:"gray",label:"Gray",color:"bg-gray-500"},{value:"neutral",label:"Neutral",color:"bg-neutral-500"},{value:"green",label:"Green",color:"bg-green-500"},{value:"blue",label:"Blue",color:"bg-blue-500"},{value:"violet",label:"Violet",color:"bg-violet-500"},{value:"orange",label:"Orange",color:"bg-orange-500"}];function hs(){const pe=De(s=>s.user),{mode:S,color:T,appMode:xe,setMode:L,setColor:R}=Ee(),[ge,je]=t.useState("account"),[fe,be]=t.useState(!0),[h,ve]=t.useState(null),[_,$]=t.useState(""),[g,O]=t.useState(""),[j,U]=t.useState(""),[M,ye]=t.useState({length:!1,uppercase:!1,lowercase:!1,number:!1,special:!1}),[I,B]=t.useState(!1),[G,H]=t.useState("smtp.gmail.com"),[q,Q]=t.useState("587"),[V,Y]=t.useState(""),[F,Z]=t.useState(""),[W,X]=t.useState(""),[J,K]=t.useState("smtp.gmail.com"),[ee,se]=t.useState(!0),[ae,te]=t.useState(!1),[k,re]=t.useState(""),[le,ne]=t.useState(!1),[ce,ie]=t.useState(!1),[u,C]=t.useState(null),n=xe==="analyzer";t.useEffect(()=>{we()},[]);const we=async()=>{try{const s=await f.get("/auth/profile-data");if(s.data.status==="success"){ve(s.data.data);const a=s.data.data.smtp_settings;a&&(H(a.smtp_server||"smtp.gmail.com"),Q(String(a.smtp_port||587)),Y(a.smtp_username||""),X(a.smtp_from_email||""),K(a.smtp_helo_hostname||"smtp.gmail.com"),se(a.smtp_use_tls!==!1),re(a.smtp_username||""))}}catch(s){console.error("Error fetching profile data:",s),r.error("Failed to load profile data")}finally{be(!1)}},oe=t.useCallback(s=>{const a={length:s.length>=8,uppercase:/[A-Z]/.test(s),lowercase:/[a-z]/.test(s),number:/[0-9]/.test(s),special:/[!@#$%^&*]/.test(s)};return ye(a),Object.values(a).every(Boolean)},[]);t.useEffect(()=>{oe(g)},[g,oe]);const Ne=()=>{const s=Object.values(M).filter(Boolean).length;return s===0?{percentage:0,label:"None",color:"bg-gray-400"}:s<=2?{percentage:40,label:"Weak",color:"bg-red-500"}:s<=3?{percentage:60,label:"Fair",color:"bg-yellow-500"}:s<=4?{percentage:80,label:"Good",color:"bg-blue-500"}:{percentage:100,label:"Strong",color:"bg-green-500"}},D=g===j&&j!=="",Se=Object.values(M).every(Boolean),de=D&&Se&&_!=="",Te=async s=>{if(s.preventDefault(),!!de){B(!0);try{const a=new FormData;a.append("old_password",_),a.append("new_password",g),a.append("confirm_password",j);const l=await f.post("/auth/change-password",a);l.data.status==="success"?(r.success(l.data.message||"Password changed successfully"),$(""),O(""),U("")):r.error(l.data.message||"Failed to change password")}catch(a){const l=a;r.error(l.response?.data?.message||"Failed to change password")}finally{B(!1)}}},Ce=async s=>{s.preventDefault(),te(!0);try{const a=new FormData;a.append("smtp_server",G),a.append("smtp_port",q),a.append("smtp_username",V),F&&a.append("smtp_password",F),a.append("smtp_from_email",W),a.append("smtp_helo_hostname",J),ee&&a.append("smtp_use_tls","on");const l=await f.post("/auth/smtp-config",a);l.data.status==="success"?(r.success(l.data.message||"SMTP settings saved successfully"),Z("")):r.error(l.data.message||"Failed to save SMTP settings")}catch(a){const l=a;r.error(l.response?.data?.message||"Failed to save SMTP settings")}finally{te(!1)}},Pe=async()=>{if(!k){r.error("Please enter an email address to test");return}ne(!0),C(null);try{const s=new FormData;s.append("test_email",k);const a=await f.post("/auth/test-smtp",s);a.data.success?r.success(a.data.message||"Test email sent successfully"):r.error(a.data.message||"Failed to send test email")}catch(s){const a=s;r.error(a.response?.data?.message||"Failed to send test email")}finally{ne(!1)}},Ae=async()=>{ie(!0),C(null);try{const s=await f.post("/auth/debug-smtp",{});C(s.data)}catch(s){C({success:!1,message:s.response?.data?.message||"Failed to debug SMTP",details:[]})}finally{ie(!1)}},_e=s=>{if(n){r.error("Cannot change theme while in Analyzer Mode");return}L(s),r.success(`Theme changed to ${s}`)},Me=s=>{if(n){r.error("Cannot change theme while in Analyzer Mode");return}R(s),r.success(`Accent color changed to ${s}`)},Fe=()=>{if(n){r.error("Cannot change theme while in Analyzer Mode");return}L("light"),R("zinc"),r.success("Theme reset to default")},ke=s=>{navigator.clipboard.writeText(s).then(()=>{r.success("Copied to clipboard")}).catch(()=>{r.error("Failed to copy")})},E=Ne();return fe?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 max-w-3xl mx-auto space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(We,{to:"/dashboard",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Ue,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Ie,{className:"h-6 w-6"}),"Profile Settings"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your account settings and security preferences"})]}),e.jsxs($e,{value:ge,onValueChange:je,children:[e.jsxs(Oe,{className:"grid w-full grid-cols-4",children:[e.jsxs(P,{value:"account",className:"gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Account"})]}),e.jsxs(P,{value:"theme",className:"gap-1",children:[e.jsx(Be,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Theme"})]}),e.jsxs(P,{value:"smtp",className:"gap-1",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"SMTP"})]}),e.jsxs(P,{value:"totp",className:"gap-1",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"TOTP"})]})]}),e.jsxs(A,{value:"account",className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{children:"Account Information"})}),e.jsxs(p,{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Username"}),e.jsx(i,{value:pe?.username||h?.username||"",disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Account Type"}),e.jsx("div",{className:"pt-2",children:e.jsx(ze,{children:"Administrator"})})]})]})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{children:"Change Password"})}),e.jsx(p,{children:e.jsxs("form",{onSubmit:Te,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Current Password"}),e.jsx(i,{type:"password",placeholder:"Enter your current password",value:_,onChange:s=>$(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"New Password"}),e.jsx(i,{type:"password",placeholder:"Enter your new password",value:g,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Confirm New Password"}),e.jsx(i,{type:"password",placeholder:"Confirm your new password",value:j,onChange:s=>U(s.target.value)}),j&&e.jsx("p",{className:`text-sm ${D?"text-green-500":"text-red-500"}`,children:D?"Passwords match":"Passwords do not match"})]}),e.jsxs("div",{className:"bg-muted rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Strength"}),e.jsx("span",{className:"font-medium",children:E.label})]}),e.jsx(Re,{value:E.percentage,className:E.color}),e.jsx("div",{className:"grid grid-cols-2 gap-2 text-xs",children:Object.entries(M).map(([s,a])=>e.jsxs("div",{className:`flex items-center gap-1 px-2 py-1 rounded-full border ${a?"bg-green-500/10 border-green-500 text-green-600":"bg-muted border-border text-muted-foreground"}`,children:[a?e.jsx(ue,{className:"h-3 w-3"}):e.jsx(Ge,{className:"h-3 w-3"}),e.jsxs("span",{children:[s==="length"&&"8+ chars",s==="uppercase"&&"A-Z",s==="lowercase"&&"a-z",s==="number"&&"0-9",s==="special"&&"Special (@#$%^&*)"]})]},s))})]}),e.jsx(x,{type:"submit",disabled:!de||I,children:I?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Change Password"]})})]})})]})]}),e.jsxs(A,{value:"theme",className:"space-y-6",children:[n&&e.jsxs(b,{variant:"destructive",children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx(v,{children:"Theme Changes Disabled"}),e.jsx(y,{children:"Theme customization is disabled while in Analyzer Mode. The purple theme is automatically applied for visual distinction. Switch back to Live Mode to change themes."})]}),e.jsx(o,{children:e.jsx(d,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Current Theme"}),e.jsx(w,{children:n?"Analyzer Mode (Purple Theme)":`${S.charAt(0).toUpperCase()+S.slice(1)} Mode with ${T.charAt(0).toUpperCase()+T.slice(1)} accent`})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded bg-primary",title:"Primary"}),e.jsx("div",{className:"w-6 h-6 rounded bg-secondary",title:"Secondary"}),e.jsx("div",{className:"w-6 h-6 rounded bg-accent",title:"Accent"}),e.jsx("div",{className:"w-6 h-6 rounded bg-muted",title:"Muted"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:Fe,disabled:n||S==="light"&&T==="zinc",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Reset"]})]})]})})}),e.jsxs(o,{className:n?"opacity-60":"",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Theme Mode"}),e.jsx(w,{children:"Choose between light and dark interface"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:Xe.map(s=>{const a=s.icon,l=S===s.value&&!n;return e.jsxs("button",{type:"button",onClick:()=>_e(s.value),disabled:n,className:`flex items-start gap-4 p-4 rounded-lg border-2 transition-all text-left ${l?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${n?"cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("div",{className:`p-2 rounded-lg ${l?"bg-primary text-primary-foreground":"bg-muted"}`,children:e.jsx(a,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.label}),l&&e.jsx(ue,{className:"h-4 w-4 text-primary"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]})]},s.value)})})})]}),e.jsxs(o,{className:n?"opacity-60":"",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Accent Color"}),e.jsx(w,{children:"Customize the primary accent color"})]}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-8 gap-3",children:Je.map(s=>{const a=T===s.value&&!n;return e.jsxs("button",{type:"button",onClick:()=>Me(s.value),disabled:n,className:`flex flex-col items-center gap-2 p-3 rounded-lg border-2 transition-all ${a?"border-primary bg-primary/5":"border-border hover:border-primary/50"} ${n?"cursor-not-allowed":"cursor-pointer"}`,title:s.label,children:[e.jsx("div",{className:`w-8 h-8 rounded-full ${s.color} ring-2 ring-offset-2 ring-offset-background ${a?"ring-primary":"ring-transparent"}`}),e.jsx("span",{className:"text-xs font-medium",children:s.label})]},s.value)})})})]}),e.jsxs(o,{children:[e.jsx(d,{children:e.jsx(m,{children:"About Themes"})}),e.jsxs(p,{className:"text-sm text-muted-foreground space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Light Mode:"})," Optimized for daytime use with high contrast and readability."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dark Mode:"})," Reduces eye strain during extended trading sessions, especially in low-light environments."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Analyzer Mode:"})," When in sandbox/analyzer mode, a distinct purple theme is applied automatically to clearly indicate you are not trading with real funds."]})]})]})]}),e.jsx(A,{value:"smtp",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"SMTP Configuration"}),e.jsx(w,{children:"Configure email settings for password reset notifications"})]}),e.jsxs(p,{children:[e.jsxs(b,{className:"mb-6",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(v,{children:"Gmail Configuration Tips"}),e.jsx(y,{children:e.jsxs("ul",{className:"text-sm list-disc list-inside mt-1 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Personal Gmail:"})," Server: smtp.gmail.com:587"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Password:"})," Use App Password (not your regular password)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Setup:"})," Google Account - Security - 2-Step Verification - App passwords"]})]})})]}),e.jsxs("form",{onSubmit:Ce,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"SMTP Server"}),e.jsx(i,{value:G,onChange:s=>H(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"SMTP Port"}),e.jsx(i,{type:"number",value:q,onChange:s=>Q(s.target.value),placeholder:"587"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"587 (STARTTLS) or 465 (SSL/TLS)"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Username/Email"}),e.jsx(i,{type:"email",value:V,onChange:s=>Y(s.target.value),placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Password/App Password"}),e.jsx(i,{type:"password",value:F,onChange:s=>Z(s.target.value),placeholder:h?.smtp_settings?.smtp_password?"Password is set (enter new to change)":"Enter your App Password"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"From Email"}),e.jsx(i,{type:"email",value:W,onChange:s=>X(s.target.value),placeholder:"your-email@gmail.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"HELO Hostname"}),e.jsx(i,{value:J,onChange:s=>K(s.target.value),placeholder:"smtp.gmail.com"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Le,{id:"smtp_tls",checked:ee,onCheckedChange:s=>se(s===!0)}),e.jsx(c,{htmlFor:"smtp_tls",children:"Use TLS/SSL"})]}),e.jsx(x,{type:"submit",disabled:ae,children:ae?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Save SMTP Settings"]})}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Test Configuration"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Send a test email to verify your SMTP settings."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{type:"email",value:k,onChange:s=>re(s.target.value),placeholder:"Enter email address to test",className:"flex-1"}),e.jsx(x,{type:"button",variant:"outline",onClick:Pe,disabled:le,children:le?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"Send Test"]})}),e.jsx(x,{type:"button",variant:"ghost",onClick:Ae,disabled:ce,children:ce?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Debug"]})})]}),u&&e.jsxs(b,{className:`mt-4 ${u.success?"border-green-500":"border-yellow-500"}`,children:[e.jsx(v,{children:u.success?"SMTP Debug Complete":"SMTP Connection Issues"}),e.jsxs(y,{children:[e.jsx("p",{children:u.message}),u.details&&u.details.length>0&&e.jsx("ul",{className:"text-xs mt-2 list-disc list-inside",children:u.details.map((s,a)=>e.jsx("li",{children:s},a))})]})]})]})]})]})]})}),e.jsx(A,{value:"totp",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(d,{children:[e.jsx(m,{children:"TOTP Authentication"}),e.jsx(w,{children:"Manage your Two-Factor Authentication settings"})]}),e.jsxs(p,{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx(v,{children:"About TOTP Authentication"}),e.jsx(y,{children:"TOTP (Time-based One-Time Password) provides an additional layer of security. You'll need an authenticator app like Google Authenticator or Authy to generate codes for password recovery."})]}),h?.qr_code&&h?.totp_secret?e.jsxs("div",{className:"bg-muted rounded-lg p-6 space-y-6",children:[e.jsx("h3",{className:"font-semibold text-center",children:"Your TOTP QR Code"}),e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"p-4 bg-white rounded-lg shadow",children:e.jsx("img",{src:`data:image/png;base64,${h.qr_code}`,alt:"TOTP QR Code",className:"w-48 h-48"})})}),e.jsxs("div",{className:"bg-background rounded-lg p-4 space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Manual Entry"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Secret key for manual entry:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-muted p-2 rounded text-sm break-all",children:h.totp_secret}),e.jsx(x,{size:"icon",variant:"outline",onClick:()=>ke(h.totp_secret),children:e.jsx(Ze,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Setup Instructions:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm text-muted-foreground",children:[e.jsx("li",{children:"Install an authenticator app (Google Authenticator, Authy, etc.)"}),e.jsx("li",{children:"Scan the QR code above or enter the secret key manually"}),e.jsx("li",{children:"Save your backup codes in a safe place"}),e.jsx("li",{children:"You'll need the TOTP code to reset your password if you forget it"})]})]})]}):e.jsxs(b,{variant:"destructive",children:[e.jsx(v,{children:"TOTP Not Available"}),e.jsx(y,{children:"Unable to load TOTP setup. Please contact your administrator."})]})]})]})})]})]})}export{hs as default};
