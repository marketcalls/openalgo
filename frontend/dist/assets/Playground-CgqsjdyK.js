import{r,j as e}from"./vendor-react-z89-0JOV.js";import{u as ie,d as qe,t as i,B as d,c as f,e as P,D as Ue,h as Ke,i as $e,p as Fe,j as _,k as Ge,m as He}from"./index-BFhQJuAS.js";import{I as de}from"./input-Bj-b9VF3.js";import{S as We}from"./scroll-area-B673DZbe.js";import{T as ce,a as xe,b as q,c as U}from"./tabs-pFCd4o6t.js";import{J as _e}from"./json-editor-DS10zURR.js";import{k as Ve,X as Xe,ay as Ze,Z as Qe,g as Ye,l as es,m as ss,N as ts,n as as,o as rs,S as ns,j as os,Y as ls,K as me,E as is,u as ds,a2 as ue,R as he,a9 as pe,P as cs,q as xs,ar as ms}from"./vendor-icons-CHYcgrp0.js";import{a as us,L as fe}from"./vendor-router-3k9vkKfj.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-radix-CPYAX5SR.js";import"./index-CAPLoq5M.js";import"./index-Cp6hhLVC.js";async function hs(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}function ps(n){if(n.length>100*1024)return[{text:n,type:"plain"}];const c=[],x=/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?)/g;let g=0,j=x.exec(n);for(;j!==null;){j.index>g&&c.push({text:n.slice(g,j.index),type:"plain"});const u=j[0];let y="number";/^"/.test(u)?y=/:$/.test(u)?"key":"string":/true|false/.test(u)?y="boolean":/null/.test(u)&&(y="null"),c.push({text:u,type:y}),g=x.lastIndex,j=x.exec(n)}return g<n.length&&c.push({text:n.slice(g),type:"plain"}),c}function fs(n){switch(n){case"key":return"text-sky-400";case"string":return"text-emerald-400";case"number":return"text-orange-400";case"boolean":return"text-purple-400";case"null":return"text-red-400";default:return""}}function gs(n){if(n.startsWith("/api/")||n.startsWith("/playground/"))return{valid:!0};try{const c=new URL(n,window.location.origin);return c.origin!==window.location.origin?{valid:!1,error:"Only same-origin requests are allowed"}:!c.pathname.startsWith("/api/")&&!c.pathname.startsWith("/playground/")?{valid:!1,error:"Only /api/ and /playground/ endpoints are allowed"}:{valid:!0}}catch{return{valid:!1,error:"Invalid URL format"}}}function As(){const n=us(),{mode:c,appMode:x,toggleMode:g,toggleAppMode:j,isTogglingMode:u}=ie(),{user:y,logout:V}=qe(),ge=async()=>{try{await He.logout(),V(),n("/login"),i.success("Logged out successfully")}catch{V(),n("/login")}},[b,je]=r.useState(""),[K,be]=r.useState(!1),[I,Ne]=r.useState({}),[X,ve]=r.useState(new Set),[M,ye]=r.useState(""),[C,$]=r.useState([]),[T,O]=r.useState(null),[N,z]=r.useState("POST"),[h,A]=r.useState(""),[m,w]=r.useState(""),[F,G]=r.useState(!1),[S,E]=r.useState(null),[Z,B]=r.useState(null),[Q,H]=r.useState(null),[k,L]=r.useState(null),[Y,ee]=r.useState({}),[se,we]=r.useState(!0);r.useEffect(()=>{Se(),ke()},[]);const Se=async()=>{try{const s=await fetch("/playground/api-key",{credentials:"include"});if(s.ok){const t=await s.json();je(t.api_key||"")}}catch{}},ke=async()=>{try{const s=await fetch("/playground/endpoints",{credentials:"include"});if(s.ok){const t=await s.json();Ne(t)}}catch{i.error("Failed to load endpoints")}},te=r.useCallback(s=>{let t={};return s.method==="GET"&&s.params?t={...s.params}:s.body&&(t={...s.body}),b&&!t.apikey&&(t.apikey=b),JSON.stringify(t,null,2)},[b]),ae=s=>{const t=C.find(a=>a.endpoint.path===s.path&&a.endpoint.name===s.name);if(t)O(t.id),z(t.endpoint.method),A(t.endpoint.path),w(t.requestBody);else{const a={id:`${s.name}-${Date.now()}`,endpoint:s,requestBody:te(s),modified:!1};$(o=>[...o,a]),O(a.id),z(s.method),A(s.path),w(a.requestBody)}L(null),E(null),B(null),H(null)},Ce=(s,t)=>{t.stopPropagation();const a=C.findIndex(l=>l.id===s),o=C.filter(l=>l.id!==s);if($(o),T===s)if(o.length>0){const l=Math.min(a,o.length-1),p=o[l];O(p.id),z(p.endpoint.method),A(p.endpoint.path),w(p.requestBody)}else O(null),z("POST"),A(""),w("")},Te=s=>{O(s.id),z(s.endpoint.method),A(s.endpoint.path),w(s.requestBody),L(null),E(null)},re=s=>{w(s),T&&$(t=>t.map(a=>a.id===T?{...a,requestBody:s,modified:s!==te(a.endpoint)}:a))},Oe=s=>{ve(t=>{const a=new Set(t);return a.has(s)?a.delete(s):a.add(s),a})},ze=()=>{try{const s=JSON.parse(m),t=JSON.stringify(s,null,2);re(t),i.success("JSON prettified")}catch{i.error("Invalid JSON - cannot prettify")}},Ae=async()=>{if(!h){i.warning("Please select an endpoint");return}const s=gs(h);if(!s.valid){i.error(s.error);return}G(!0),L(null),E(null),B(null),H(null),ee({});const t=Date.now();try{const a={method:N,credentials:"include",headers:{Accept:"application/json"}};let o=h;if(N==="GET"){if(m.trim())try{const R=JSON.parse(m),D=new URL(h,window.location.origin);Object.entries(R).forEach(([Pe,J])=>{J!=null&&J!==""&&D.searchParams.append(Pe,String(J))}),o=D.toString()}catch{i.error("Invalid JSON for query parameters"),G(!1);return}}else{const R=await hs();a.headers["Content-Type"]="application/json",a.headers["X-CSRFToken"]=R,m.trim()&&(a.body=m)}const l=await fetch(o,a),p=Date.now()-t,v={};l.headers.forEach((R,D)=>{v[D]=R}),ee(v);let W;const oe=l.headers.get("content-type");oe?.includes("application/json")?W=await l.json():W={text:await l.text(),contentType:oe};const le=JSON.stringify(W,null,2);E(l.status),B(p),H(new Blob([le]).size),L(le)}catch(a){const o=Date.now()-t;E(0),B(o),L(JSON.stringify({error:a instanceof Error?a.message:"Unknown error"},null,2))}finally{G(!1)}},Ee=()=>{k&&(navigator.clipboard.writeText(k),i.success("Response copied!"))},Le=()=>{b&&(navigator.clipboard.writeText(b),i.success("API key copied!"))},Re=async()=>{const s=await j();if(s.success){const t=ie.getState().appMode;i.success(`Switched to ${t==="live"?"Live":"Analyze"} mode`),t==="analyzer"&&setTimeout(()=>{i.warning("⚠️ Analyzer (Sandbox) mode is for testing purposes only",{duration:1e4})},2e3)}else i.error(s.message||"Failed to toggle mode")},Ie=()=>{if(!h)return;let s=h;if(N==="GET"&&m.trim())try{const o=JSON.parse(m),l=new URL(h,window.location.origin);Object.entries(o).forEach(([p,v])=>{v!=null&&v!==""&&l.searchParams.append(p,String(v))}),s=l.toString()}catch{i.error("Invalid JSON for query parameters");return}const t=new URL(s,window.location.origin).href;let a=`curl -X ${N} "${t}"`;a+=` \\
  -H "Accept: application/json"`,N!=="GET"&&m.trim()&&(a+=` \\
  -H "Content-Type: application/json"`,a+=` \\
  -d '${m.replace(/'/g,"'\\''")}'`),navigator.clipboard.writeText(a),i.success("Copied as cURL")},Me=Object.entries(I).reduce((s,[t,a])=>{if(!M)s[t]=a;else{const o=a.filter(l=>l.name.toLowerCase().includes(M.toLowerCase())||l.path.toLowerCase().includes(M.toLowerCase()));o.length&&(s[t]=o)}return s},{}),Be=s=>s?s>=200&&s<300?"text-emerald-500 dark:text-emerald-400":s>=400?"text-red-500 dark:text-red-400":"text-yellow-500 dark:text-yellow-400":"text-muted-foreground",De=s=>s?s>=200&&s<300?"bg-emerald-500/10":s>=400?"bg-red-500/10":"bg-yellow-500/10":"bg-muted/50",Je=s=>s>=1024?`${(s/1024).toFixed(1)}KB`:`${s}B`,ne=C.find(s=>s.id===T);return e.jsxs("div",{className:"h-full flex flex-col bg-background text-foreground",children:[e.jsxs("div",{className:"h-12 border-b border-border flex items-center px-2 bg-card/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-foreground hover:bg-accent",onClick:()=>we(!se),children:e.jsx(Ve,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsx("img",{src:"/images/android-chrome-192x192.png",alt:"OpenAlgo",className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold text-sm",children:"openalgo"})]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 px-4 overflow-x-auto",children:[C.map(s=>e.jsxs("div",{className:f("flex items-center gap-2 px-3 py-1.5 rounded-md text-xs cursor-pointer group","hover:bg-accent",s.id===T?"bg-accent text-foreground":"text-muted-foreground"),onClick:()=>Te(s),children:[e.jsx(P,{variant:"outline",className:f("text-[9px] px-1 py-0 h-4 border-0 font-semibold",s.endpoint.method==="GET"?"bg-sky-500/20 text-sky-400":"bg-emerald-500/20 text-emerald-400"),children:s.endpoint.method}),e.jsx("span",{className:"truncate max-w-[100px]",children:s.endpoint.name}),s.modified&&e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-amber-500"}),e.jsx("button",{type:"button",className:"opacity-0 group-hover:opacity-100 hover:text-foreground p-0.5 -mr-1",onClick:t=>Ce(s.id,t),children:e.jsx(Xe,{className:"h-3 w-3"})})]},s.id)),e.jsx(d,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-foreground hover:bg-accent",onClick:()=>{const s=Object.keys(I)[0];s&&I[s]?.[0]&&ae(I[s][0])},children:e.jsx(Ze,{className:"h-3.5 w-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 px-2",children:[e.jsxs(P,{variant:x==="live"?"default":"secondary",className:f("text-xs",x==="analyzer"&&"bg-purple-500 hover:bg-purple-600 text-white"),children:[e.jsx("span",{className:"hidden sm:inline",children:x==="live"?"Live Mode":"Analyze Mode"}),e.jsx("span",{className:"sm:hidden",children:x==="live"?"Live":"Analyze"})]}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:Re,disabled:u,title:`Switch to ${x==="live"?"Analyze":"Live"} mode`,children:u?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"}):x==="live"?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(Ye,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:g,disabled:x!=="live",title:c==="light"?"Switch to dark mode":"Switch to light mode",children:c==="light"?e.jsx(es,{className:"h-4 w-4"}):e.jsx(ss,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-7 text-xs",asChild:!0,children:e.jsxs(fe,{to:"/dashboard",children:[e.jsx(ts,{className:"h-3.5 w-3.5 mr-1.5"}),"Dashboard"]})}),e.jsxs(Ue,{children:[e.jsx(Ke,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full bg-primary text-primary-foreground",children:e.jsx("span",{className:"text-sm font-medium",children:y?.username?.[0]?.toUpperCase()||"O"})})}),e.jsxs($e,{align:"end",className:"w-56",children:[Fe.map(s=>e.jsxs(_,{onSelect:()=>n(s.href),className:"cursor-pointer",children:[e.jsx(s.icon,{className:"h-4 w-4 mr-2"}),s.label]},s.href)),e.jsx(_,{asChild:!0,children:e.jsxs("a",{href:"https://docs.openalgo.in",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Docs"]})}),e.jsx(Ge,{}),e.jsxs(_,{onClick:ge,className:"text-destructive focus:text-destructive",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Logout"]})]})]})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:f("w-56 border-r border-border bg-card/30 flex flex-col overflow-hidden","transition-all duration-200",se?"translate-x-0":"-translate-x-full absolute h-full z-50"),children:[e.jsx("div",{className:"p-2 border-b border-border shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"h-3.5 w-3.5 absolute left-2.5 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(de,{placeholder:"search",className:"h-7 pl-8 text-xs bg-secondary/50 border-border text-foreground placeholder:text-muted-foreground",value:M,onChange:s=>ye(s.target.value)})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0",children:e.jsx("div",{className:"p-2",children:Object.entries(Me).map(([s,t])=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("button",{type:"button",className:"flex items-center gap-1.5 w-full px-2 py-1 rounded text-[11px] font-medium uppercase tracking-wider text-muted-foreground hover:text-foreground hover:bg-accent/50",onClick:()=>Oe(s),children:[X.has(s)?e.jsx(os,{className:"h-3 w-3"}):e.jsx(ls,{className:"h-3 w-3"}),s]}),!X.has(s)&&e.jsx("div",{className:"mt-0.5 space-y-0.5",children:t.map((a,o)=>e.jsxs("button",{type:"button",className:f("w-full flex items-center gap-2 px-2 py-1 rounded text-left text-xs hover:bg-accent/50",ne?.endpoint.path===a.path&&"bg-accent text-foreground"),onClick:()=>ae(a),children:[e.jsx(P,{variant:"outline",className:f("text-[9px] px-1 py-0 h-4 border-0 font-semibold shrink-0",a.method==="GET"?"bg-sky-500/20 text-sky-400":"bg-emerald-500/20 text-emerald-400"),children:a.method}),e.jsx("span",{className:"truncate text-foreground/80",children:a.name})]},o))})]},s))})}),e.jsx("div",{className:"p-2 border-t border-border shrink-0",children:e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded bg-secondary/50",children:[e.jsx(me,{className:"h-3 w-3 text-muted-foreground"}),e.jsx(de,{type:K?"text":"password",value:b,readOnly:!0,className:"flex-1 h-5 text-[10px] font-mono bg-transparent border-none p-0 text-muted-foreground",placeholder:"No API key"}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-5 w-5 text-muted-foreground hover:text-foreground",onClick:()=>be(!K),children:K?e.jsx(is,{className:"h-3 w-3"}):e.jsx(ds,{className:"h-3 w-3"})}),e.jsx(d,{variant:"ghost",size:"icon",className:"h-5 w-5 text-muted-foreground hover:text-foreground",onClick:Le,children:e.jsx(ue,{className:"h-3 w-3"})})]})})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:ne?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 border-b border-border bg-card/30",children:[e.jsx(P,{variant:"outline",className:f("text-xs px-2 py-0.5 border-0 font-semibold",N==="GET"?"bg-sky-500/20 text-sky-400":"bg-emerald-500/20 text-emerald-400"),children:N}),e.jsxs("div",{className:"flex-1 flex items-center gap-1 px-3 py-1.5 rounded bg-secondary/50 font-mono text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"http://127.0.0.1:5000"}),e.jsx("span",{className:"text-foreground",children:h})]}),e.jsx(d,{size:"sm",className:"h-8 px-4 bg-emerald-600 hover:bg-emerald-700 text-white",onClick:Ae,disabled:F,children:F?e.jsx(he,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-3.5 w-3.5 mr-1.5"}),"Send"]})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 flex flex-col border-r border-border min-w-0",children:e.jsxs(ce,{defaultValue:"body",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-1.5 border-b border-border bg-card/30",children:[e.jsxs(xe,{className:"h-7 bg-transparent p-0 gap-2",children:[e.jsx(q,{value:"body",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Body"}),e.jsx(q,{value:"headers",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Headers"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[10px] text-muted-foreground mr-2",children:"JSON"}),e.jsx(d,{variant:"ghost",size:"sm",className:"h-6 text-[10px] text-muted-foreground hover:text-foreground hover:bg-accent",onClick:ze,children:"Prettify"})]})]}),e.jsx(U,{value:"body",className:"flex-1 m-0 overflow-hidden",children:e.jsx("div",{className:"h-full flex bg-background",children:e.jsx(_e,{value:m,onChange:re,placeholder:'{"apikey": ""}',className:"flex-1 min-h-0"})})}),e.jsx(U,{value:"headers",className:"flex-1 m-0 p-4 overflow-auto bg-background",children:e.jsxs("div",{className:"text-xs font-mono space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Content-Type:"}),e.jsx("span",{className:"text-foreground/80",children:"application/json"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Accept:"}),e.jsx("span",{className:"text-foreground/80",children:"application/json"})]})]})})]})}),e.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:e.jsxs(ce,{defaultValue:"response",className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-1.5 border-b border-border bg-card/30",children:[e.jsxs(xe,{className:"h-7 bg-transparent p-0 gap-2",children:[e.jsx(q,{value:"response",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Response"}),e.jsx(q,{value:"headers",className:"h-6 px-2 text-xs data-[state=active]:bg-accent data-[state=active]:text-foreground text-muted-foreground",children:"Headers"})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono",children:[S!==null&&e.jsxs("span",{className:f("px-2 py-0.5 rounded",De(S),Be(S)),children:[S," ",S>=200&&S<300?"OK":"Error"]}),Z!==null&&e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(cs,{className:"h-3 w-3"}),Z,"ms"]}),Q!==null&&e.jsxs("span",{className:"text-muted-foreground flex items-center gap-1",children:[e.jsx(xs,{className:"h-3 w-3"}),Je(Q)]}),e.jsxs(d,{variant:"ghost",size:"sm",className:"h-6 text-[10px] text-muted-foreground hover:text-foreground hover:bg-accent",onClick:Ie,children:[e.jsx(ms,{className:"h-3 w-3 mr-1"}),"cURL"]}),k&&e.jsx(d,{variant:"ghost",size:"icon",className:"h-6 w-6 text-muted-foreground hover:text-foreground",onClick:Ee,children:e.jsx(ue,{className:"h-3 w-3"})})]})]}),e.jsx(U,{value:"response",className:"flex-1 m-0 overflow-hidden",children:e.jsx("div",{className:"h-full flex bg-background",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 bg-card/50 text-muted-foreground/50 text-xs font-mono py-3 px-2 text-right select-none overflow-hidden border-r border-border",children:k.split(`
`).map((s,t)=>e.jsx("div",{className:"leading-5",children:t+1},t))}),e.jsx(We,{className:"flex-1 p-3",children:e.jsx("pre",{className:"text-xs font-mono whitespace-pre-wrap break-words leading-5",children:ps(k).map((s,t)=>e.jsx("span",{className:fs(s.type),children:s.text},t))})})]}):e.jsx("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:F?e.jsx(he,{className:"h-8 w-8 text-muted-foreground/50 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-10 w-10 text-muted-foreground/30 mb-3"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"No response yet"}),e.jsx("p",{className:"text-muted-foreground/70 text-xs mt-1",children:"Click Send to make a request"})]})})})}),e.jsx(U,{value:"headers",className:"flex-1 m-0 p-4 overflow-auto bg-background",children:Object.keys(Y).length>0?e.jsx("div",{className:"text-xs font-mono space-y-2",children:Object.entries(Y).map(([s,t])=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s,":"]}),e.jsx("span",{className:"text-foreground/80 break-all",children:t})]},s))}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"No headers to display"})})]})})]})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center bg-background",children:[e.jsx("img",{src:"/images/android-chrome-192x192.png",alt:"OpenAlgo",className:"w-16 h-16 mb-4"}),e.jsx("h2",{className:"text-lg font-semibold text-foreground/80 mb-2",children:"API Playground"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:"Select an endpoint from the sidebar to get started"}),!b&&e.jsx(d,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(fe,{to:"/apikey",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Generate API Key"]})})]})})]})]})}export{As as default};
