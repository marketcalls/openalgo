import{r as a,j as e}from"./vendor-react--vsXx8_n.js";import{d as fe,o as Ne,B as n,c as q,e as f,t as h,s as x}from"./index-DNt4N-JN.js";import{t as S}from"./trading-BAHaEXcC.js";import{A as ve,a as ye,b as be,c as we,d as Ce,e as Se,f as De,g as Oe,h as Te}from"./alert-dialog-DMyv-EMo.js";import{C as y,a as D,c as O,b as T,d as ke}from"./card-Dpvf5dQO.js";import{D as G,a as Ae,b as J,c as W,d as ee,e as se,f as te}from"./dialog-DxDiEYFR.js";import{I as re}from"./input-CngWwNIO.js";import{L as z}from"./label-C35B46J7.js";import{T as Fe,a as _e,b as ae,c,d as Ie,e as o}from"./table-DlhKEnAB.js";import{_ as Le,R as Me,r as Ee,X as ie,L as le,Q as Be,a2 as ne,C as Re,a3 as qe}from"./vendor-icons-D7CGgVJ-.js";import"./vendor-charts-l0_txfiz.js";import"./vendor-router-CiBIGs7t.js";import"./vendor-radix-DnptSSCf.js";function j(m){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2}).format(m)}function ze(m){try{const u=new Date(m),b=new Date(new Date().toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),N=new Date(b.getFullYear(),b.getMonth(),b.getDate()),w=new Date(u.toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),I=new Date(w.getFullYear(),w.getMonth(),w.getDate());return N.getTime()===I.getTime()?u.toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kolkata"}):u.toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kolkata"})}catch{return m}}const ce={complete:{icon:Re,color:"text-green-500",label:"complete"},rejected:{icon:ne,color:"text-red-500",label:"rejected"},cancelled:{icon:ne,color:"text-gray-500",label:"cancelled"},open:{icon:Be,color:"text-blue-500",label:"open"}};function es(){const{apiKey:m}=fe(),[u,b]=a.useState([]),[N,w]=a.useState(null),[I,L]=a.useState(!0),[P,Q]=a.useState(!1),[K,M]=a.useState(null),[v,U]=a.useState([]),[oe,H]=a.useState(!1),[de,k]=a.useState(!1),[i,xe]=a.useState(null),[p,Y]=a.useState(null),[$,V]=a.useState(!1),[r,E]=a.useState({quantity:0,price:0,trigger_price:0,pricetype:"MARKET",product:"MIS"}),Z=a.useMemo(()=>v.length===0?u:u.filter(s=>v.includes(s.order_status)),[u,v]),A=v.length>0,me=s=>{U(t=>t.includes(s)?t.filter(d=>d!==s):[...t,s])},B=()=>{U([])},g=a.useCallback(async(s=!1)=>{if(!m){L(!1);return}s&&Q(!0);try{const t=await S.getOrders(m);t.status==="success"&&t.data?(b(t.data.orders||[]),w(t.data.statistics),M(null)):M(t.message||"Failed to fetch orders")}catch{M("Failed to fetch orders")}finally{L(!1),Q(!1)}},[m]);a.useEffect(()=>{g();const s=setInterval(()=>g(),1e4);return()=>clearInterval(s)},[g]),a.useEffect(()=>{const s=Ne(()=>{g()});return()=>s()},[g]);const he=async s=>{try{const t=await S.cancelOrder(s);t.status==="success"?(h.success(`Order cancelled: ${s}`),setTimeout(()=>g(!0),1e3)):h.error(t.message||"Failed to cancel order")}catch(t){const C=t.response?.data?.message||"Failed to cancel order";h.error(C)}},ue=async()=>{try{const s=await S.cancelAllOrders();s.status==="success"?(h.success(s.message||"All orders cancelled"),setTimeout(()=>g(!0),2e3)):s.status==="info"?h.info(s.message||"No open orders to cancel"):h.error(s.message||"Failed to cancel all orders")}catch(s){const d=s.response?.data?.message||"Failed to cancel all orders";h.error(d)}},pe=async s=>{if(xe(s),E({quantity:s.quantity,price:s.price,trigger_price:s.trigger_price,pricetype:s.pricetype,product:s.product}),Y(null),k(!0),m){V(!0);try{const t=await S.getQuotes(m,s.symbol,s.exchange);t.status==="success"&&t.data&&Y(t.data)}catch{}finally{V(!1)}}},ge=async()=>{if(i)try{const s=await S.modifyOrder(i.orderid,{symbol:i.symbol,exchange:i.exchange,action:i.action,product:i.product,pricetype:r.pricetype,price:r.price,quantity:r.quantity,trigger_price:r.trigger_price});s.status==="success"?(h.success(`Order modified: ${i.orderid}`),k(!1),setTimeout(()=>g(!0),1e3)):h.error(s.message||"Failed to modify order")}catch(s){const d=s.response?.data?.message||"Failed to modify order";h.error(d)}},je=()=>{const s=["Symbol","Exchange","Action","Qty","Price","Trigger","Type","Product","Order ID","Status","Time"],t=u.map(l=>[x(l.symbol),x(l.exchange),x(l.action),x(l.quantity),x(l.price),x(l.trigger_price),x(l.pricetype),x(l.product),x(l.orderid),x(l.order_status),x(l.timestamp)]),d=[s,...t].map(l=>l.join(",")).join(`
`),C=new Blob([d],{type:"text/csv"}),_=URL.createObjectURL(C),R=document.createElement("a");R.href=_,R.download=`orderbook_${new Date().toISOString().split("T")[0]}.csv`,R.click()},X=u.filter(s=>s.order_status==="open"),F=({status:s,label:t})=>e.jsx(n,{variant:v.includes(s)?"default":"outline",size:"sm",className:q("rounded-full",v.includes(s)&&"bg-pink-500 hover:bg-pink-600"),onClick:()=>me(s),children:t});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Order Book"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage your orders"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(G,{open:oe,onOpenChange:H,children:[e.jsx(Ae,{asChild:!0,children:e.jsxs(n,{variant:A?"default":"outline",size:"sm",className:"relative",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Filters",A&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]})}),e.jsxs(J,{className:"max-w-md",children:[e.jsxs(W,{children:[e.jsx(ee,{children:"Order Filters"}),e.jsx(se,{children:"Filter orders by status"})]}),e.jsx("div",{className:"space-y-6 py-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(z,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Order Status"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(F,{status:"complete",label:"Complete"}),e.jsx(F,{status:"open",label:"Open"}),e.jsx(F,{status:"rejected",label:"Rejected"}),e.jsx(F,{status:"cancelled",label:"Cancelled"})]})]})}),e.jsxs(te,{children:[e.jsx(n,{variant:"ghost",onClick:B,children:"Clear All"}),e.jsx(n,{onClick:()=>H(!1),children:"Done"})]})]})]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>g(!0),disabled:P,children:[e.jsx(Me,{className:q("h-4 w-4 mr-2",P&&"animate-spin")}),"Refresh"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:je,children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Export"]}),e.jsxs(ve,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(n,{variant:"destructive",size:"sm",disabled:X.length===0,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Cancel All"]})}),e.jsxs(be,{children:[e.jsxs(we,{children:[e.jsx(Ce,{children:"Cancel All Orders?"}),e.jsxs(Se,{children:["This will cancel all ",X.length," open orders. This action cannot be undone."]})]}),e.jsxs(De,{children:[e.jsx(Oe,{children:"Keep Orders"}),e.jsx(Te,{onClick:ue,children:"Cancel All"})]})]})]})]})]}),A&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Filters:"}),v.map(s=>e.jsx(f,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),e.jsx(n,{variant:"outline",size:"sm",className:"text-red-500 border-red-500/50 hover:bg-red-500/10",onClick:B,children:"Clear All"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(y,{children:e.jsxs(D,{className:"pb-2",children:[e.jsx(O,{children:"Buy Orders"}),e.jsx(T,{className:"text-2xl text-green-600",children:N?.total_buy_orders??0})]})}),e.jsx(y,{children:e.jsxs(D,{className:"pb-2",children:[e.jsx(O,{children:"Sell Orders"}),e.jsx(T,{className:"text-2xl text-red-600",children:N?.total_sell_orders??0})]})}),e.jsx(y,{children:e.jsxs(D,{className:"pb-2",children:[e.jsx(O,{children:"Completed"}),e.jsx(T,{className:"text-2xl",children:N?.total_completed_orders??0})]})}),e.jsx(y,{children:e.jsxs(D,{className:"pb-2",children:[e.jsx(O,{children:"Open"}),e.jsx(T,{className:"text-2xl text-blue-600",children:N?.total_open_orders??0})]})}),e.jsx(y,{children:e.jsxs(D,{className:"pb-2",children:[e.jsx(O,{children:"Rejected"}),e.jsx(T,{className:"text-2xl text-red-600",children:N?.total_rejected_orders??0})]})})]}),e.jsx(y,{children:e.jsx(ke,{className:"p-0",children:I?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(le,{className:"h-8 w-8 animate-spin"})}):K?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:K}):Z.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:A?e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:"No orders match your filters"}),e.jsx(n,{variant:"ghost",size:"sm",onClick:B,children:"Clear Filters"})]}):"No orders today"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fe,{children:[e.jsx(_e,{children:e.jsxs(ae,{children:[e.jsx(c,{className:"w-[120px]",children:"Symbol"}),e.jsx(c,{className:"w-[80px]",children:"Exchange"}),e.jsx(c,{className:"w-[70px]",children:"Action"}),e.jsx(c,{className:"w-[70px] text-right",children:"Qty"}),e.jsx(c,{className:"w-[100px] text-right",children:"Price"}),e.jsx(c,{className:"w-[100px] text-right",children:"Trigger"}),e.jsx(c,{className:"w-[80px]",children:"Type"}),e.jsx(c,{className:"w-[70px]",children:"Product"}),e.jsx(c,{className:"w-[140px]",children:"Order ID"}),e.jsx(c,{className:"w-[100px]",children:"Status"}),e.jsx(c,{className:"w-[100px]",children:"Time"}),e.jsx(c,{className:"w-[60px]",children:"Cancel"}),e.jsx(c,{className:"w-[60px]",children:"Modify"})]})}),e.jsx(Ie,{children:Z.map((s,t)=>{const d=ce[s.order_status]||ce.open,C=d.icon,_=s.order_status==="open";return e.jsxs(ae,{children:[e.jsx(o,{className:"font-medium",children:s.symbol}),e.jsx(o,{children:e.jsx(f,{variant:"outline",children:s.exchange})}),e.jsx(o,{children:e.jsx(f,{variant:s.action==="BUY"?"default":"destructive",className:s.action==="BUY"?"bg-green-500":"",children:s.action})}),e.jsx(o,{className:"text-right font-mono",children:s.quantity}),e.jsx(o,{className:"text-right font-mono",children:j(s.price)}),e.jsx(o,{className:"text-right font-mono",children:j(s.trigger_price)}),e.jsx(o,{children:e.jsx(f,{variant:"secondary",children:s.pricetype})}),e.jsx(o,{children:e.jsx(f,{variant:"outline",children:s.product})}),e.jsx(o,{className:"font-mono text-xs",children:s.orderid}),e.jsx(o,{children:e.jsxs("div",{className:q("flex items-center gap-1",d.color),children:[e.jsx(C,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:d.label})]})}),e.jsx(o,{className:"text-sm text-muted-foreground",children:ze(s.timestamp)}),e.jsx(o,{children:_&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:()=>he(s.orderid),children:e.jsx(ie,{className:"h-4 w-4"})})}),e.jsx(o,{children:_&&e.jsx(n,{variant:"ghost",size:"icon",className:"h-8 w-8 text-blue-500 hover:text-blue-600",onClick:()=>pe(s),children:e.jsx(qe,{className:"h-4 w-4"})})})]},`${s.orderid}-${t}`)})})]})})})}),e.jsx(G,{open:de,onOpenChange:k,children:e.jsxs(J,{className:"sm:max-w-[550px]",children:[e.jsxs(W,{children:[e.jsxs(ee,{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Modify Order"}),e.jsx(f,{variant:i?.action==="BUY"?"default":"destructive",className:i?.action==="BUY"?"bg-green-500":"",children:i?.action})]}),e.jsx(se,{className:"sr-only",children:"Modify order details"})]}),e.jsxs("div",{className:"rounded-lg border p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-semibold",children:i?.symbol}),e.jsx("div",{className:"text-sm text-muted-foreground",children:i?.exchange})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Order ID"}),e.jsx("div",{className:"font-mono text-sm",children:i?.orderid})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Type:"}),e.jsx(f,{variant:"secondary",className:"text-xs",children:r.pricetype})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Product:"}),e.jsx(f,{variant:"outline",className:"text-xs",children:r.product})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Qty:"}),e.jsx("span",{className:"font-mono text-sm font-medium",children:r.quantity})]})]})]}),e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium",children:"Market Data"}),$&&e.jsx(le,{className:"h-4 w-4 animate-spin"})]}),p?e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"LTP"}),e.jsx("div",{className:"font-mono font-semibold",children:j(p.ltp)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Bid"}),e.jsx("div",{className:"font-mono text-green-600",children:j(p.bid)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Ask"}),e.jsx("div",{className:"font-mono text-red-600",children:j(p.ask)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Prev Close"}),e.jsx("div",{className:"font-mono",children:j(p.prev_close)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Open"}),e.jsx("div",{className:"font-mono",children:j(p.open)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"High"}),e.jsx("div",{className:"font-mono text-green-600",children:j(p.high)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Low"}),e.jsx("div",{className:"font-mono text-red-600",children:j(p.low)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted-foreground text-xs",children:"Volume"}),e.jsx("div",{className:"font-mono",children:p.volume.toLocaleString("en-IN")})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:$?"Loading quotes...":"Quotes not available"})]}),e.jsxs("div",{className:"grid gap-4 py-2",children:[(r.pricetype==="LIMIT"||r.pricetype==="SL")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(z,{htmlFor:"price",className:"text-right",children:"Price"}),e.jsx(re,{id:"price",type:"number",step:"0.05",value:r.price,onChange:s=>E({...r,price:parseFloat(s.target.value)||0}),className:"col-span-3"})]}),(r.pricetype==="SL"||r.pricetype==="SL-M")&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(z,{htmlFor:"trigger_price",className:"text-right",children:"Trigger Price"}),e.jsx(re,{id:"trigger_price",type:"number",step:"0.05",value:r.trigger_price,onChange:s=>E({...r,trigger_price:parseFloat(s.target.value)||0}),className:"col-span-3"})]}),r.pricetype==="MARKET"&&e.jsx("div",{className:"text-sm text-muted-foreground text-center py-2",children:"Market orders cannot be modified. Cancel and place a new order."})]}),e.jsxs(te,{children:[e.jsx(n,{variant:"outline",onClick:()=>k(!1),children:"Cancel"}),e.jsx(n,{onClick:ge,children:"Modify Order"})]})]})})]})}export{es as default};
